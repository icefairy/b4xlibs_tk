"use strict";var FontInspector=function(){function e(){for(var a=document.querySelectorAll("div["+d+"]"),b=0,c=a.length;b<c;++b){var e=a[b];e.className=""}}function f(){for(var a=document.querySelectorAll("div["+d+"]"),b=0,c=a.length;b<c;++b){var e=a[b];e.className="debuggerHideText"}}function g(a,b){for(var c=document.querySelectorAll("div["+d+"="+a+"]"),e=0,f=c.length;e<f;++e){var g=c[e];g.className=b?"debuggerShowText":"debuggerHideText"}}function h(a){if(a.target.dataset.fontName&&"DIV"===a.target.tagName.toUpperCase())for(var b=a.target.dataset.fontName,c=document.getElementsByTagName("input"),d=0;d<c.length;++d){var e=c[d];e.dataset.fontName===b&&(e.checked=!e.checked,g(b,e.checked),e.scrollIntoView())}}var b,c=!1,d="data-font-name";return{id:"FontInspector",name:"Font Inspector",panel:null,manager:null,init:function(){var c=this.panel;c.setAttribute("style","padding: 5px;");var d=document.createElement("button");d.addEventListener("click",f),d.textContent="Refresh",c.appendChild(d),b=document.createElement("div"),c.appendChild(b)},cleanup:function(){b.textContent=""},enabled:!1,get active(){return c},set active(a){c=a,c?(document.body.addEventListener("click",h,!0),f()):(document.body.removeEventListener("click",h,!0),e())},fontAdded:function(c,d){function e(a,b){for(var c=document.createElement("table"),d=0;d<b.length;d++){var e=document.createElement("tr"),f=document.createElement("td");f.textContent=b[d],e.appendChild(f);var g=document.createElement("td");g.textContent=a[b[d]].toString(),e.appendChild(g),c.appendChild(e)}return c}var h=e(c,["name","type"]),i=c.loadedName,j=document.createElement("div"),k=document.createElement("span");k.textContent=i;var l=document.createElement("a");d?(d=/url\(['"]?([^\)"']+)/.exec(d),l.href=d[1]):c.data&&(d=URL.createObjectURL(new Blob([c.data],{type:c.mimeType})),l.href=d),l.textContent="Download";var m=document.createElement("a");m.href="",m.textContent="Log",m.addEventListener("click",function(a){a.preventDefault(),console.log(c)});var n=document.createElement("input");n.setAttribute("type","checkbox"),n.dataset.fontName=i,n.addEventListener("click",function(a,b){return function(){g(b,a.checked)}}(n,i)),j.appendChild(n),j.appendChild(k),j.appendChild(document.createTextNode(" ")),j.appendChild(l),j.appendChild(document.createTextNode(" ")),j.appendChild(m),j.appendChild(h),b.appendChild(j),setTimeout(function(){this.active&&f()}.bind(this),2e3)}}}(),StepperManager=function(){var b=[],c=null,d=null,e=null,f={};return{id:"Stepper",name:"Stepper",panel:null,manager:null,init:function(){var b=this;this.panel.setAttribute("style","padding: 5px;"),d=document.createElement("div"),e=document.createElement("select"),e.addEventListener("change",function(a){b.selectStepper(this.value)}),d.appendChild(e),c=document.createElement("div"),this.panel.appendChild(d),this.panel.appendChild(c),sessionStorage.getItem("pdfjsBreakPoints")&&(f=JSON.parse(sessionStorage.getItem("pdfjsBreakPoints")))},cleanup:function(){e.textContent="",c.textContent="",b=[]},enabled:!1,active:!1,create:function(d){var g=document.createElement("div");g.id="stepper"+d,g.setAttribute("hidden",!0),g.className="stepper",c.appendChild(g);var h=document.createElement("option");h.textContent="Page "+(d+1),h.value=d,e.appendChild(h);var i=f[d]||[],j=new Stepper(g,d,i);return b.push(j),1===b.length&&this.selectStepper(d,!1),j},selectStepper:function(c,d){var f;for(c=0|c,d&&this.manager.selectPanel(this),f=0;f<b.length;++f){var g=b[f];g.pageIndex===c?g.panel.removeAttribute("hidden"):g.panel.setAttribute("hidden",!0)}var h=e.options;for(f=0;f<h.length;++f){var i=h[f];i.selected=(0|i.value)===c}},saveBreakPoints:function(b,c){f[b]=c,sessionStorage.setItem("pdfjsBreakPoints",JSON.stringify(f))}}}(),Stepper=function(){function b(a,b){var c=document.createElement(a);return b&&(c.textContent=b),c}function d(a){if("string"==typeof a){var b=75;return a.length<=b?a:a.substr(0,b)+"..."}if("object"!=typeof a||null===a)return a;if("length"in a){var e,f,c=[],g=10;for(e=0,f=Math.min(g,a.length);e<f;e++)c.push(d(a[e]));return e<a.length&&c.push("..."),c}var h={};for(var i in a)h[i]=d(a[i]);return h}function e(a,b,c){this.panel=a,this.breakPoint=0,this.nextBreakPoint=null,this.pageIndex=b,this.breakPoints=c,this.currentIdx=-1,this.operatorListIdx=0}var c=null;return e.prototype={init:function(){var d=this.panel,e=b("div","c=continue, s=step"),f=b("table");e.appendChild(f),f.cellSpacing=0;var g=b("tr");if(f.appendChild(g),g.appendChild(b("th","Break")),g.appendChild(b("th","Idx")),g.appendChild(b("th","fn")),g.appendChild(b("th","args")),d.appendChild(e),this.table=f,!c){c=Object.create(null);for(var h in PDFJS.OPS)c[PDFJS.OPS[h]]=h}},updateOperatorList:function(e){function g(){var a=+this.dataset.idx;this.checked?f.breakPoints.push(a):f.breakPoints.splice(f.breakPoints.indexOf(a),1),StepperManager.saveBreakPoints(f.pageIndex,f.breakPoints)}var f=this,h=15e3;if(!(this.operatorListIdx>h)){for(var i=document.createDocumentFragment(),j=Math.min(h,e.fnArray.length),k=this.operatorListIdx;k<j;k++){var l=b("tr");l.className="line",l.dataset.idx=k,i.appendChild(l);var m=this.breakPoints.indexOf(k)!==-1,n=e.argsArray[k]||[],o=b("td"),p=b("input");p.type="checkbox",p.className="points",p.checked=m,p.dataset.idx=k,p.onclick=g,o.appendChild(p),l.appendChild(o),l.appendChild(b("td",k.toString()));var q=c[e.fnArray[k]],r=n;if("showText"===q){for(var s=n[0],t=[],u=[],v=0;v<s.length;v++){var w=s[v];"object"==typeof w&&null!==w?u.push(w.fontChar):(u.length>0&&(t.push(u.join("")),u=[]),t.push(w))}u.length>0&&t.push(u.join("")),r=[t]}l.appendChild(b("td",q)),l.appendChild(b("td",JSON.stringify(d(r))))}if(j<e.fnArray.length){l=b("tr");var x=b("td","...");x.colspan=4,i.appendChild(x)}this.operatorListIdx=e.fnArray.length,this.table.appendChild(i)}},getNextBreakPoint:function(){this.breakPoints.sort(function(a,b){return a-b});for(var b=0;b<this.breakPoints.length;b++)if(this.breakPoints[b]>this.currentIdx)return this.breakPoints[b];return null},breakIt:function(b,c){StepperManager.selectStepper(this.pageIndex,!0);var d=this,e=document;d.currentIdx=b;var f=function(a){switch(a.keyCode){case 83:e.removeEventListener("keydown",f,!1),d.nextBreakPoint=d.currentIdx+1,d.goTo(-1),c();break;case 67:e.removeEventListener("keydown",f,!1);var b=d.getNextBreakPoint();d.nextBreakPoint=b,d.goTo(-1),c()}};e.addEventListener("keydown",f,!1),d.goTo(b)},goTo:function(b){for(var c=this.panel.getElementsByClassName("line"),d=0,e=c.length;d<e;++d){var f=c[d];(0|f.dataset.idx)===b?(f.style.backgroundColor="rgb(251,250,207)",f.scrollIntoView()):f.style.backgroundColor=null}}},e}(),Stats=function(){function c(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)}function d(a){for(var c=0,d=b.length;c<d;++c)if(b[c].pageNumber===a)return c;return!1}var b=[];return{id:"Stats",name:"Stats",panel:null,manager:null,init:function(){this.panel.setAttribute("style","padding: 5px;"),PDFJS.enableStats=!0},enabled:!1,active:!1,add:function(a,e){if(e){var f=d(a);if(f!==!1){var g=b[f];this.panel.removeChild(g.div),b.splice(f,1)}var h=document.createElement("div");h.className="stats";var i=document.createElement("div");i.className="title",i.textContent="Page: "+a;var j=document.createElement("div");j.textContent=e.toString(),h.appendChild(i),h.appendChild(j),b.push({pageNumber:a,div:h}),b.sort(function(a,b){return a.pageNumber-b.pageNumber}),c(this.panel);for(var k=0,l=b.length;k<l;++k)this.panel.appendChild(b[k].div)}},cleanup:function(){b=[],c(this.panel)}}}(),PDFBug=function(){var b=300,c=[],d=null;return{tools:[FontInspector,StepperManager,Stats],enable:function(a){var b=!1,c=this.tools;1===a.length&&"all"===a[0]&&(b=!0);for(var d=0;d<c.length;++d){var e=c[d];(b||a.indexOf(e.id)!==-1)&&(e.enabled=!0)}b||c.sort(function(b,d){var e=a.indexOf(b.id);e=e<0?c.length:e;var f=a.indexOf(d.id);return f=f<0?c.length:f,e-f})},init:function(){var d=document.createElement("div");d.id="PDFBug";var e=document.createElement("div");e.setAttribute("class","controls"),d.appendChild(e);var f=document.createElement("div");f.setAttribute("class","panels"),d.appendChild(f);var g=document.getElementById("viewerContainer");g.appendChild(d),g.style.right=b+"px";for(var h=this.tools,i=this,j=0;j<h.length;++j){var k=h[j],l=document.createElement("div"),m=document.createElement("button");m.textContent=k.name,m.addEventListener("click",function(a){return function(b){b.preventDefault(),i.selectPanel(a)}}(j)),e.appendChild(m),f.appendChild(l),k.panel=l,k.manager=this,k.enabled?k.init():l.textContent=k.name+' is disabled. To enable add  "'+k.id+'" to the pdfBug parameter and refresh (seperate multiple by commas).',c.push(m)}this.selectPanel(0)},cleanup:function(){for(var b=0,c=this.tools.length;b<c;b++)this.tools[b].enabled&&this.tools[b].cleanup()},selectPanel:function(b){if("number"!=typeof b&&(b=this.tools.indexOf(b)),b!==d){d=b;for(var e=this.tools,f=0;f<e.length;++f)f===b?(c[f].setAttribute("class","active"),e[f].active=!0,e[f].panel.removeAttribute("hidden")):(c[f].setAttribute("class",""),e[f].active=!1,e[f].panel.setAttribute("hidden","true"))}}}}();