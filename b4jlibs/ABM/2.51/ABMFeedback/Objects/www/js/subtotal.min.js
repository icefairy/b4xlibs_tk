(function(){var a,b=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},c={}.hasOwnProperty,d=[].slice;(a=function(a){return"object"==typeof exports&&"object"==typeof module?a(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){var e,f,g,h,i;return e=function(a){function d(a,b){d.__super__.constructor.call(this,a,b)}var c;return b(d,a),c=function(a,b,c,d,e){var f,g,h,i,j,k,l;for(j=[],f=!1,i=0,k=d.length;i<k;i++)g=d[i],j.push(null!=(l=a[g])?l:"null"),h=j.join(String.fromCharCode(0)),b[h]||(b[h]=e(j.slice()),f=!0),b[h].push(a);return f&&c.push(j),j},d.prototype.processRecord=function(a){var b,d,e,f,g,h,i,j,k,l,m,n,o;if(o=[],b=[],this.allTotal.push(a),o=c(a,this.rowTotals,this.rowKeys,this.rowAttrs,function(a){return function(b){return a.aggregator(a,b,[])}}(this)),b=c(a,this.colTotals,this.colKeys,this.colAttrs,function(a){return function(b){return a.aggregator(a,[],b)}}(this)),k=o.length-1,l=b.length-1,!(k<0||l<0)){for(n=[],h=j=0,m=k;0<=m?j<=m:j>=m;h=0<=m?++j:--j)e=o.slice(0,h+1),g=e.join(String.fromCharCode(0)),this.tree[g]||(this.tree[g]={}),n.push(function(){var c,h,j;for(j=[],i=c=0,h=l;0<=h?c<=h:c>=h;i=0<=h?++c:--c)d=b.slice(0,i+1),f=d.join(String.fromCharCode(0)),this.tree[g][f]||(this.tree[g][f]=this.aggregator(this,e,d)),j.push(this.tree[g][f].push(a));return j}.call(this));return n}},d}(a.pivotUtilities.PivotData),a.pivotUtilities.SubtotalPivotData=e,f=function(b,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z;return E={table:{clickCallback:null},localeStrings:{totals:"Totals"}},d=a.extend(!0,{},E,d),g=null!=d.arrowCollapsed?d.arrowCollapsed:d.arrowCollapsed="▶",h=null!=d.arrowExpanded?d.arrowExpanded:d.arrowExpanded="◢",v="expanded",u="collapsed",w=b.colAttrs,R=b.rowAttrs,S=b.getRowKeys(),x=b.getColKeys(),Z=b.tree,T=b.rowTotals,y=b.colTotals,f=b.allTotal,M=function(a,b){var c;return c=new RegExp("(?:^|\\s)"+b+"(?!\\S)","g"),a.className.match(c)},P=function(a,b){var c;return c=new RegExp("(?:^|\\s)"+b+"(?!\\S)","g"),a.className=a.className.replace(c,"")},e=function(a,b){if(!M(a,b))return a.className+=" "+b},Q=function(a,b,c){return P(a,b),e(a,c)},L=function(a,e,f){var g,h,i,j,k,l,m;if(d.table||d.table.eventHandlers){i={},m=d.table.eventHandlers;for(h in m)if(c.call(m,h)){k=m[h],j={};for(l in w)c.call(w,l)&&(g=w[l],null!=f[l]&&(j[g]=f[l]));for(l in R)c.call(R,l)&&(g=R[l],null!=e[l]&&(j[g]=e[l]));i[h]=function(c){return k(c,a,j,b)}}return i}},D=function(a,b,d,e,f){var g,h,i,j,k;if(j=document.createElement(a),null!=b&&(j.className=b),null!=d&&(j.textContent=d),null!=e)for(g in e)c.call(e,g)&&(k=e[g],j.setAttribute(g,k));if(null!=f)for(h in f)c.call(f,h)&&(i=f[h],j.addEventListener(h,i));return j},O=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(d=[],h=a.length-1,g=a[0].length-1,l=[],o=D("th",b,a[0][0]),f=[],f.push(a[0][0]),j=0,i={node:j,row:0,col:0,th:o,parent:null,children:[],descendants:g,leaves:1,key:f,flatKey:f.join(String.fromCharCode(0))},d.push(i),l[0]=i,c=1;c<=g;)o=D("th",b,a[0][c]),f=f.slice(),f.push(a[0][c]),++j,i={node:j,row:0,col:c,th:o,parent:l[c-1],children:[],descendants:g-c,leaves:1,key:f,flatKey:f.join(String.fromCharCode(0))},l[c]=i,l[c-1].children.push(i),++c;for(l[g].leaves=0,k=1;k<=h;){for(n=!0,f=[],c=0;c<=g;)if(f=f.slice(),f.push(a[k][c]),a[k][c]===a[l[c].row][c]&&c!==g&&n)n=!0,++c;else{if(o=D("th",b,a[k][c]),++j,i={node:j,row:k,col:c,th:o,parent:null,children:[],descendants:0,leaves:1,key:f,flatKey:f.join(String.fromCharCode(0))},0===c)d.push(i);else for(i.parent=l[c-1],l[c-1].children.push(i),p=0;p<=c-1;)++l[p].descendants,++p;l[c]=i,n=!1,++c}for(c=e=0,m=g;0<=m?e<=m:e>=m;c=0<=m?++e:--e)++l[c].leaves;l[g].leaves=0,++k}return d},i=function(a,b,c,d,e,f){var g,i,j,k;return i=d[f],j=i,g="pvtAxisLabel",f<d.length-1&&(g+=" expanded",j=" "+h+" "+i),k=D("th",g,j),k.setAttribute("data-colAttr",i),e.appendChild(k),b.push({tr:e,th:k,clickStatus:v,expandedCount:0,nHeaders:0}),a.appendChild(e)},j=function(a,b,c,d){var e,f,g,h,j;for(j=document.createElement("tr"),0!==c.length&&j.appendChild(D("th",null,null,{colspan:c.length,rowspan:d.length})),i(a,b,c,d,j,0),h=[],e=f=1,g=d.length;1<=g?f<=g:f>=g;e=1<=g?++f:--f)e<d.length&&(j=document.createElement("tr"),h.push(i(a,b,c,d,j,e)));return h},k=function(a,b,c){var d,e,f,g,h,i,j;for(g=c.length-1,i=[],e=f=0,h=g;0<=h?f<=h:f>=h;e=0<=h?++f:--f)e<g&&(j=a[e].th,d=c[e],i.push(j.onclick=function(d){return d=d||window.event,W(a,b,c,d.target.getAttribute("data-colAttr"))}));return i},l=function(a,b,c,d,f){var g,i,j,k,m,n,o,p,q;for(m=c.children,j=0,k=m.length;j<k;j++)g=m[j],l(a,b,g,d,f);return i=a[c.col],++i.expandedCount,++i.nHeaders,q=i.tr,p=c.th,p.setAttribute("data-colHeader",p.textContent),c.col===f.length-1&&0!==d.length&&p.setAttribute("rowspan",2),0!==c.children.length&&p.setAttribute("colspan",c.descendants+1),p.setAttribute("data-node",b.length),q.appendChild(p),0!==c.children.length&&(e(p,v),p.textContent=" "+h+" "+p.textContent,p.onclick=function(c){return c=c||window.event,V(a,b,parseInt(c.target.getAttribute("data-node")))},n=f.length-(c.col+1)+(0!==d.length?1:0),o="pvtColLabel pvtColSubtotal col"+c.row,p=D("th",o,"",{rowspan:n}),c.children[0].tr.appendChild(p),c.sTh=p),c.clickStatus=v,c.tr=q,b.push(c)},p=function(a,b,d,e){var f,g,i,j,k,l;l=document.createElement("tr"),b.hh=[];for(g in d)c.call(d,g)&&(i=d[g],j=i,f="pvtAxisLabel",g<d.length-1&&(f+=" expanded",j=" "+h+" "+i),k=D("th",f,j),k.setAttribute("data-rowAttr",i),l.appendChild(k),b.hh.push({th:k,clickStatus:v,expandedCount:0,nHeaders:0}));return 0!==e.length&&(k=D("th"),l.appendChild(k)),a.appendChild(l),b.tr=l},q=function(a,b,c){var d,e,f,g,h,i,j;for(f=c.length-1,h=[],d=e=0,g=f;0<=g?e<=g:e>=g;d=0<=g?++e:--e)d<f&&(j=a.hh[d],i=c[d],h.push(j.th.onclick=function(d){return d=d||window.event,Y(a,b,c,d.target.getAttribute("data-rowAttr"))}));return h},s=function(a,b,c){var e,f;return e=1,0!==c.length&&(e=c.length+(0===b.length?0:1)),f=D("th","pvtTotalLabel rowTotal",d.localeStrings.totals,{rowspan:e}),a.appendChild(f)},r=function(a,b,c,d,f,g){var i,j,k,l,m,n,o,p,q;for(k=b.hh[d.col],++k.expandedCount,++k.nHeaders,q=document.createElement("tr"),p=d.th,p.setAttribute("rowspan",d.descendants+1),p.setAttribute("data-rowHeader",p.textContent),d.col===f.length-1&&0!==g.length&&p.setAttribute("colspan",2),p.setAttribute("data-node",c.length),q.appendChild(p),0!==d.children.length&&(e(p,v),p.textContent=" "+h+" "+p.textContent,p.onclick=function(a){return a=a||window.event,X(b,c,parseInt(a.target.getAttribute("data-node")))},i=f.length-(d.col+1)+(0!==g.length?1:0),p=D("th","pvtRowLabel pvtRowSubtotal","",{colspan:i}),q.appendChild(p)),d.clickStatus=v,d.tr=q,c.push(d),a.appendChild(q),n=d.children,o=[],l=0,m=n.length;l<m;l++)j=n[l],o.push(r(a,b,c,j,f,g));return o},t=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(m=[],h=0,j=a.length;h<j;h++){for(n=a[h],r=n.tr,g=n.flatKey,i=0,k=b.length;i<k;i++)d=b[i],f=d.flatKey,c=null!=(l=Z[g][f])?l:{value:function(){return null},format:function(){return""}},s=c.value(),o="pvtVal",0!==d.children.length&&(o+=" pvtColSubtotal"),0!==n.children.length&&(o+=" pvtRowSubtotal"),o+=" row"+n.row+" col"+d.row+" rowcol"+n.col+" colcol"+d.col,e=L(s,n.key,d.key),p=D("td",o,c.format(s),{"data-value":s},e),r.appendChild(p);q=T[g],s=q.value(),o="pvtTotal rowTotal",0!==n.children.length&&(o+=" pvtRowSubtotal"),o+=" row"+n.row+" rowcol"+n.col,p=D("td",o,q.format(s),{"data-value":s,"data-row":"row"+n.row,"data-col":"col"+n.col},L(s,n.key,[])),m.push(r.appendChild(p))}return m},n=function(a,b){var c,e,f;return f=document.createElement("tr"),c=a.length+(0===b.length?0:1),e=D("th","pvtTotalLabel colTotal",d.localeStrings.totals,{colspan:c}),f.appendChild(e),f},m=function(a,b){var c,d,e,f,g,h,i,j;for(f=[],d=0,e=b.length;d<e;d++)c=b[d],i=y[c.flatKey],j=i.value(),g="pvtVal pvtTotal colTotal",0!==c.children.length&&(g+=" pvtColSubtotal"),g+=" col"+c.row+" colcol"+c.col,h=D("td",g,i.format(j),{"data-value":j,"data-for":"col"+c.col},L(j,[],c.key)),f.push(a.appendChild(h));return f},o=function(a,b){var c,d,e;return d=f,e=d.value(),c=D("td","pvtGrandTotal",d.format(e),{"data-value":e},L(e,[],[])),b.appendChild(c),a.appendChild(b)},U=function(b,c){if(c.th.style.display=b,0!==c.children.length?a(c.th).closest("table.pvtTable").find("tbody tr td.pvtColSubtotal.col"+c.row+".colcol"+c.col).css("display",b):a(c.th).closest("table.pvtTable").find("tbody tr td.pvtVal.col"+c.row).not(".pvtColSubtotal").css("display",b),c.sTh)return c.sTh.style.display=b},z=function(a,b,c){var d,e,f,h,i,j,k,l,m,n,o,p;if(b[c]&&(h=b[c],h.clickStatus!==u)){for(e=0,i=j=1,m=h.descendants;1<=m?j<=m:j>=m;i=1<=m?++j:--j)0!==h.descendants&&(f=b[c-i],"none"!==f.th.style.display&&(++e,U("none",f)));for(l=h.parent;null!==l;)l.th.setAttribute("colspan",parseInt(l.th.getAttribute("colspan"))-e),l=l.parent;if(0!==h.descendants&&(Q(h.th,v,u),h.th.textContent=" "+g+" "+h.th.getAttribute("data-colHeader")),h.clickStatus=u,h.th.setAttribute("colspan",1),h.th.style.display="",d=a[h.col],d.expandedCount--,0===d.expandedCount){for(p=[],i=k=n=h.col,o=a.length-2;n<=o?k<=o:k>=o;i=n<=o?++k:--k)d=a[i],Q(d.th,v,u),d.th.textContent=" "+g+" "+d.th.getAttribute("data-colAttr"),p.push(d.clickStatus=u);return p}}},F=function(a){var b,c,d,e,f;if("none"===a.th.style.display&&U("",a),a.clickStatus!==u){for(e=a.children,f=[],c=0,d=e.length;c<d;c++)b=e[c],f.push(F(b));return f}},H=function(a,b,c){var d,e,f,g,i,j,k,l;if(b[c]&&(f=b[c],f.clickStatus!==v)){for(e=0,l=f.children,i=0,j=l.length;i<j;i++)d=l[i],e+=d.th.colSpan,"none"===d.th.style.display&&U("",d),F(d);for(0!==f.descendants&&(Q(f.th,u,v),f.th.textContent=" "+h+" "+f.th.getAttribute("data-colHeader")),f.th.setAttribute("colspan",e+1),f.clickStatus=v,f.th.style.display="",null!=f.sTh&&(f.sTh.style.display=""),k=f.parent;null!==k;)k.th.setAttribute("colspan",e+parseInt(k.th.getAttribute("colspan"))),k=k.parent;return g=a[f.col],++g.expandedCount,g.expandedCount===g.nHeaders?(Q(g.th,u,v),g.th.textContent=" "+h+" "+g.th.getAttribute("data-colAttr"),g.clickStatus=v):void 0}},B=function(a,b,c){var d,e,f,h,i,j,k,l,m,n,o,p,q;if(b[c]&&(e=b[c],e.clickStatus!==u)){for(q=0,f=i=1,l=e.descendants;1<=l?i<=l:i>=l;f=1<=l?++i:--i)0!==e.descendants&&(d=b[c+f],"none"!==d.tr.style.display&&(++q,d.tr.style.display="none"));for(k=e.parent;null!==k;)k.th.setAttribute("rowspan",parseInt(k.th.getAttribute("rowspan")-q)),k=k.parent;if(0!==e.descendants&&(Q(e.th,v,u),e.th.textContent=" "+g+" "+e.th.getAttribute("data-rowHeader")),e.clickStatus=u,e.th.setAttribute("rowspan",1),e.tr.style.display="",p=a.hh[e.col],p.expandedCount--,0===p.expandedCount){for(o=[],h=j=m=e.col,n=a.hh.length-2;m<=n?j<=n:j>=n;h=m<=n?++j:--j)p=a.hh[h],Q(p.th,v,u),p.th.textContent=" "+g+" "+p.th.getAttribute("data-rowAttr"),o.push(p.clickStatus=u);return o}}},G=function(a){var b,c,d,e,f;if("none"===a.tr.style.display&&(a.tr.style.display=""),a.clickStatus!==u){for(e=a.children,f=[],c=0,d=e.length;c<d;c++)b=e[c],f.push(G(b));return f}},J=function(a,b,c){var d,e,f,g,i,j,k,l;if(b[c]&&(e=b[c],e.clickStatus!==v)){for(l=0,k=e.children,g=0,i=k.length;g<i;g++)d=k[g],l+=d.th.rowSpan,"none"===d.tr.style.display&&(d.tr.style.display=""),G(d);for(0!==e.descendants&&(Q(e.th,u,v),e.th.textContent=" "+h+" "+e.th.getAttribute("data-rowHeader")),e.th.setAttribute("rowspan",l+1),e.clickStatus=v,e.tr.style.display="",j=e.parent;null!==j;)j.th.setAttribute("rowspan",l+parseInt(j.th.getAttribute("rowspan"))),j=j.parent;return f=a.hh[e.col],++f.expandedCount,f.expandedCount===f.nHeaders?(Q(f.th,u,v),f.th.textContent=" "+h+" "+f.th.getAttribute("data-rowAttr"),f.clickStatus=v):void 0}},V=function(a,b,c){var d;if(null!=b[c])return d=b[c],d.clickStatus===u?H(a,b,c):z(a,b,c),d.th.scrollIntoView},X=function(a,b,c){if(null!=b[c])return b[c].clickStatus===u?J(a,b,c):B(a,b,c)},A=function(a,b,c,d){var e,f,h,i,j,k,l;if(i="string"==typeof d?c.indexOf(d):d,!(i<0||i===c.length-1)){for(h=i,j=c.length-1;h<j;)f=a[h],Q(f.th,v,u),f.th.textContent=" "+g+" "+c[h],f.clickStatus=u,++h;for(h=0,k=b.length,l=[];h<k;)e=b[h],e.col===i&&e.clickStatus!==u&&"none"!==e.th.style.display&&z(a,b,parseInt(e.th.getAttribute("data-node"))),l.push(++h);return l}},I=function(a,b,c,d){var e,f,i,j,k,l,m,n,o,p;if(k="string"==typeof d?c.indexOf(d):d,!(k<0||k===c.length-1)){for(j=m=0,o=k;0<=o?m<=o:m>=o;j=0<=o?++m:--m)for(i=a[j],Q(i.th,u,v),i.th.textContent=" "+h+" "+c[j],i.clickStatus=v,l=0,n=b.length;l<n;)f=b[l],f.col===j&&H(a,b,l),++l;for(++k,p=[];k<c.length-1;)e=a[k],0===e.expandedCount?(Q(e.th,v,u),e.th.textContent=" "+g+" "+c[k],e.clickStatus=u):e.expandedCount===e.nHeaders&&(Q(e.th,u,v),e.th.textContent=" "+h+" "+c[k],e.clickStatus=v),p.push(++k);return p}},C=function(a,b,c,d){var e,f,h,i,j,k,l;if(h="string"==typeof d?c.indexOf(d):d,!(h<0||h===c.length-1)){for(f=h,j=c.length-1;f<j;)e=a.hh[f],Q(e.th,v,u),e.th.textContent=" "+g+" "+c[f],e.clickStatus=u,++f;for(i=0,k=b.length,l=[];i<k;)e=b[i],e.col===h&&e.clickStatus!==u&&"none"!==e.tr.style.display?(B(a,b,i),l.push(i=i+e.descendants+1)):l.push(++i);return l}},K=function(a,b,c,d){var e,f,i,j,k,l,m,n,o,p;if(j="string"==typeof d?c.indexOf(d):d,!(j<0||j===c.length-1)){for(i=l=0,n=j;0<=n?l<=n:l>=n;i=0<=n?++l:--l)for(f=a.hh[i],Q(f.th,u,v),f.th.textContent=" "+h+" "+c[i],f.clickStatus=v,k=0,m=b.length;k<m;)e=b[k],e.col===i?(J(a,b,k),k+=e.descendants+1):++k;for(++j,o=[];j<c.length-1;)p=a.hh[j],0===p.expandedCount?(Q(p.th,v,u),p.th.textContent=" "+g+" "+c[j],p.clickStatus=u):p.expandedCount===p.nHeaders&&(Q(p.th,u,v),p.th.textContent=" "+h+" "+c[j],p.clickStatus=v),o.push(++j);return o}},W=function(a,b,c,d){var e,f;return f=c.indexOf(d),e=a[f],e.clickStatus===u?I(a,b,c,d):A(a,b,c,d)},Y=function(a,b,c,d){var e,f;return e=c.indexOf(d),f=a.hh[e],f.clickStatus===u?K(a,b,c,d):C(a,b,c,d)},(N=function(a,b,c,e){var f,g,h,i,u,v,w,x,y,z,B,D,E,F,G;if(D=[],h=[],z={},B=[],g=[],f=[],a.length>0&&b.length>0&&(D=O(b,"pvtRowLabel")),c.length>0&&e.length>0&&(h=O(e,"pvtColLabel")),y=document.createElement("table"),y.className="pvtTable",y.style.display="none",F=document.createElement("thead"),y.appendChild(F),c.length>0){for(j(F,g,a,c),u=0,w=h.length;u<w;u++)i=h[u],l(g,f,i,a,c);k(g,f,c)}if(a.length>0&&(p(F,z,a,c),0===c.length&&s(z.tr,a,c)),c.length>0&&s(g[0].tr,a,c),E=document.createElement("tbody"),y.appendChild(E),a.length>0)for(v=0,x=D.length;v<x;v++)i=D[v],r(E,z,B,i,a,c);return q(z,B,a),t(B,f),G=n(a,c),c.length>0&&m(G,f),o(E,G),y.setAttribute("data-numrows",b.length),y.setAttribute("data-numcols",e.length),null==d.collapseRowsAt&&null==d.collapseColsAt&&(y.style.display=""),null!=d.collapseRowsAt&&C(z,B,a,d.collapseRowsAt),null==d.collapseColsAt?(y.style.display="",y):(null!=d.collapseColsAt&&A(g,f,c,d.collapseColsAt),y.style.display="",y)})(R,S,w,x)},a.pivotUtilities.subtotal_renderers={"Table With Subtotal":function(a,b){return f(a,b)},"Table With Subtotal Bar Chart":function(b,c){return a(f(b,c)).barchart()},"Table With Subtotal Heatmap":function(b,c){return a(f(b,c)).heatmap("heatmap",c)},"Table With Subtotal Row Heatmap":function(b,c){return a(f(b,c)).heatmap("rowheatmap",c)},"Table With Subtotal Col Heatmap":function(b,c){return a(f(b,c)).heatmap("colheatmap",c)}},i=a.pivotUtilities.numberFormat({digitsAfterDecimal:1,scaler:100,suffix:"%"}),g=a.pivotUtilities.aggregatorTemplates,h={fractionOf:function(a,b,c){return null==b&&(b="row"),null==c&&(c=i),function(){var e;return e=1<=arguments.length?d.call(arguments,0):[],function(d,f,g){return"undefined"==typeof f&&(f=[]),"undefined"==typeof g&&(g=[]),{selector:{row:[f.slice(0,-1),[]],col:[[],g.slice(0,-1)]}[b],inner:a.apply(null,e)(d,f,g),push:function(a){return this.inner.push(a)},format:c,value:function(){return this.inner.value()/d.getAggregator.apply(d,this.selector).inner.value()},numInputs:a.apply(null,e)().numInputs}}}}},a.pivotUtilities.subtotalAggregatorTemplates=h,a.pivotUtilities.subtotal_aggregators=function(a,b){return{"Sum As Fraction Of Parent Row":b.fractionOf(a.sum(),"row",i),"Sum As Fraction Of Parent Column":b.fractionOf(a.sum(),"col",i),"Count As Fraction Of Parent Row":b.fractionOf(a.count(),"row",i),"Count As Fraction Of Parent Column":b.fractionOf(a.count(),"col",i)}}(g,h)})}).call(this);