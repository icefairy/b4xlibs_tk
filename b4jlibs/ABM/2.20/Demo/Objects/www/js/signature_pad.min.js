!function(t,e){"function"==typeof define&&define.amd?define([],function(){return t.SignaturePad=e()}):"object"==typeof exports?module.exports=e():t.SignaturePad=e()}(this,function(){var t=function(t){"use strict";var e=function(t,e){var n=this,o=e||{};this.velocityFilterWeight=o.velocityFilterWeight||.7,this.minWidth=o.minWidth||.5,this.maxWidth=o.maxWidth||2.5,this.dotSize=o.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=o.penColor||"black",this.backgroundColor=o.backgroundColor||"rgba(0,0,0,0)",this.onEnd=o.onEnd,this.onBegin=o.onBegin,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(t){1===t.which&&(n._mouseButtonDown=!0,n._strokeBegin(t))},this._handleMouseMove=function(t){n._mouseButtonDown&&n._strokeUpdate(t)},this._handleMouseUp=function(t){1===t.which&&n._mouseButtonDown&&(n._mouseButtonDown=!1,n._strokeEnd(t))},this._handleTouchStart=function(t){var e=t.changedTouches[0];n._strokeBegin(e)},this._handleTouchMove=function(t){t.preventDefault();var e=t.changedTouches[0];n._strokeUpdate(e)},this._handleTouchEnd=function(t){var e=t.target===n._canvas;e&&(t.preventDefault(),n._strokeEnd(t))},this._handleMouseEvents(),this._handleTouchEvents()};e.prototype.clear=function(){var t=this._ctx,e=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._reset()},e.prototype.toDataURL=function(){var t=this._canvas;return t.toDataURL.apply(t,arguments)},e.prototype.fromDataURL=function(t){var e=this,n=new Image,o=window.devicePixelRatio||1,i=this._canvas.width/o,s=this._canvas.height/o;this._reset(),n.src=t,n.onload=function(){e._ctx.drawImage(n,0,0,i,s)},this._isEmpty=!1},e.prototype._strokeUpdate=function(t){var e=this._createPoint(t);this._addPoint(e)},e.prototype._strokeBegin=function(t){this._reset(),this._strokeUpdate(t),"function"==typeof this.onBegin&&this.onBegin(t)},e.prototype._strokeDraw=function(t){var e=this._ctx,n="function"==typeof this.dotSize?this.dotSize():this.dotSize;e.beginPath(),this._drawPoint(t.x,t.y,n),e.closePath(),e.fill()},e.prototype._strokeEnd=function(t){var e=this.points.length>2,n=this.points[0];!e&&n&&this._strokeDraw(n),"function"==typeof this.onEnd&&this.onEnd(t)},e.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),t.addEventListener("mouseup",this._handleMouseUp)},e.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),t.addEventListener("touchend",this._handleTouchEnd)},e.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},e.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),t.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),t.removeEventListener("touchend",this._handleTouchEnd)},e.prototype.isEmpty=function(){return this._isEmpty},e.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._isEmpty=!0,this._ctx.fillStyle=this.penColor},e.prototype._createPoint=function(t){var e=this._canvas.getBoundingClientRect();return new n((t.clientX-e.left)*(this._canvas.width/e.width),(t.clientY-e.top)*(this._canvas.height/e.height))},e.prototype._addPoint=function(t){var e,n,i,s,h=this.points;h.push(t),h.length>2&&(3===h.length&&h.unshift(h[0]),s=this._calculateCurveControlPoints(h[0],h[1],h[2]),e=s.c2,s=this._calculateCurveControlPoints(h[1],h[2],h[3]),n=s.c1,i=new o(h[1],e,n,h[2]),this._addCurve(i),h.shift())},e.prototype._calculateCurveControlPoints=function(t,e,o){var i=t.x-e.x,s=t.y-e.y,h=e.x-o.x,r=e.y-o.y,a={x:(t.x+e.x)/2,y:(t.y+e.y)/2},c={x:(e.x+o.x)/2,y:(e.y+o.y)/2},u=Math.sqrt(i*i+s*s),d=Math.sqrt(h*h+r*r),l=a.x-c.x,_=a.y-c.y,v=d/(u+d),p={x:c.x+l*v,y:c.y+_*v},y=e.x-p.x,f=e.y-p.y;return{c1:new n(a.x+y,a.y+f),c2:new n(c.x+y,c.y+f)}},e.prototype._addCurve=function(t){var e,n,o=t.startPoint,i=t.endPoint;e=i.velocityFrom(o),e=this.velocityFilterWeight*e+(1-this.velocityFilterWeight)*this._lastVelocity,n=this._strokeWidth(e),this._drawCurve(t,this._lastWidth,n),this._lastVelocity=e,this._lastWidth=n},e.prototype._drawPoint=function(t,e,n){var o=this._ctx;o.moveTo(t,e),o.arc(t,e,n,0,2*Math.PI,!1),this._isEmpty=!1},e.prototype._drawCurve=function(t,e,n){var o,i,s,h,r,a,c,u,d,l,_,v=this._ctx,p=n-e;for(o=Math.floor(t.length()),v.beginPath(),s=0;o>s;s++)h=s/o,r=h*h,a=r*h,c=1-h,u=c*c,d=u*c,l=d*t.startPoint.x,l+=3*u*h*t.control1.x,l+=3*c*r*t.control2.x,l+=a*t.endPoint.x,_=d*t.startPoint.y,_+=3*u*h*t.control1.y,_+=3*c*r*t.control2.y,_+=a*t.endPoint.y,i=e+a*p,this._drawPoint(l,_,i);v.closePath(),v.fill()},e.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)};var n=function(t,e,n){this.x=t,this.y=e,this.time=n||(new Date).getTime()};n.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},n.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))};var o=function(t,e,n,o){this.startPoint=t,this.control1=e,this.control2=n,this.endPoint=o};return o.prototype.length=function(){var t,e,n,o,i,s,h,r,a=10,c=0;for(t=0;a>=t;t++)e=t/a,n=this._point(e,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),o=this._point(e,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),t>0&&(h=n-i,r=o-s,c+=Math.sqrt(h*h+r*r)),i=n,s=o;return c},o.prototype._point=function(t,e,n,o,i){return e*(1-t)*(1-t)*(1-t)+3*n*(1-t)*(1-t)*t+3*o*(1-t)*t*t+i*t*t*t},e}(document);return t});