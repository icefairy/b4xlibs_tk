var tmxloader={};tmxloader.trim=function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},tmxloader.Map=function(a,b,c,d,e,f){this.width=a,this.height=b,this.tileWidth=c,this.tileHeight=d,this.tilesets=new Array,this.layers=new Array(e),this.properties=f},tmxloader.Tileset=function(a,b,c,d,e,f,g,h){this.firstGid=a,this.name=b,this.tileWidth=c,this.tileHeight=d,this.src=e,this.width=f,this.height=g,this.properties=h},tmxloader.Layer=function(a,b,c,d){this.name=a,this.width=b,this.height=c,this.data=new Array(c),this.properties=d;for(var e=0;e<c;++e)this.data[e]=new Array(b);this.loadCSV=function(a){for(var c=tmxloader.trim(a).split("\n"),d=0;d<c.length;++d)for(var e=tmxloader.trim(c[d]),f=e.split(","),g=0;g<b;++g)this.data[d][g]=f[g]}},tmxloader.Object=function(a,b,c,d,e,f,g){this.name=a,this.width=e,this.height=f,this.x=c,this.y=d,this.type=b,this.properties=g},tmxloader.ObjectGroup=function(a,b,c,d){this.name=a,this.width=b,this.height=c,this.objects=new Array,this.properties=d},tmxloader.parseProperties=function(a){var b=new Array;return a.find("properties:first ").each(function(){a.find("property").each(function(){console.log("Processing Property: "+$(this).attr("name")+" =  "+$(this).attr("value")),b[""+$(this).attr("name")]=$(this).attr("value")})}),b},tmxloader.load=function(a){var b=jQuery.parseXML(a);$xml=$(b),$version=$xml.find("map").attr("version"),console.log("Parsing..."+$version),$width=$xml.find("map").attr("width"),$height=$xml.find("map").attr("height"),$tilewidth=$xml.find("map").attr("tilewidth"),$tileheight=$xml.find("map").attr("tileheight");var c=tmxloader.parseProperties($xml);tmxloader.map=new tmxloader.Map($width,$height,$tilewidth,$tileheight,$xml.find("layer").length,c),console.log("Creating Map..."+tmxloader.map.width+" x "+tmxloader.map.height+" Tiles: "+tmxloader.map.tileWidth+" x "+tmxloader.map.tileHeight),console.log("Found "+$xml.find("layer").length+" Layers");var d=0;$xml.find("layer").each(function(){console.log("Processing Layer: "+$(this).attr("name")),$data=$(this).find("data"),$lwidth=$(this).attr("width"),$lheight=$(this).attr("height");var a=tmxloader.parseProperties($(this));if(tmxloader.map.layers[d]=new tmxloader.Layer($(this).attr("name"),$lwidth,$lheight,a),"csv"==$data.attr("encoding")){console.log("Processing CSV");var b=$data.text();tmxloader.map.layers[d].loadCSV(b)}else console.log("Unsupported Encoding Scheme");++d}),$xml.find("tileset").each(function(){$firstgid=$(this).attr("firstgid"),$name=$(this).attr("name"),$tilewidth=$(this).attr("tilewidth"),$tileheight=$(this).attr("tileheight"),$image=$(this).find("image"),$src=$image.attr("source"),$width=$image.attr("width"),$height=$image.attr("height");var a=tmxloader.parseProperties($(this));tmxloader.map.tilesets.push(new tmxloader.Tileset($firstgid,$name,$tilewidth,$tileheight,$src,$width,$height,a))}),$xml.find("objectgroup").each(function(){$lwidth=$(this).attr("width"),$lheight=$(this).attr("height"),$numobjects=$(this).find("object").length,tmxloader.map.objectgroup=new Object,console.log("Processing Object Group: "+$(this).attr("name")+" with "+$numobjects+" Objects");var a=tmxloader.parseProperties($(this));tmxloader.map.objectgroup[""+$(this).attr("name")]=new tmxloader.ObjectGroup($(this).attr("name"),$lwidth,$lheight,a),$objectGroupName=$(this).attr("name"),$xml.find("object").each(function(){$objectname=$(this).attr("name"),$objecttype=$(this).attr("type"),$objectx=$(this).attr("x"),$objecty=$(this).attr("y"),$objectwidth=$(this).attr("width"),$objectheight=$(this).attr("height"),console.log("Processing Object: "+$objectname);var a=tmxloader.parseProperties($(this));tmxloader.map.objectgroup[""+$objectGroupName].objects.push(new tmxloader.Object($objectname,$objecttype,$objectx,$objecty,$objectwidth,$objectheight,a))})})},function(){var a=this,b=b||{};b.WEBGL_RENDERER=0,b.CANVAS_RENDERER=1,b.VERSION="v2.0.0",b.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},b.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},b._UID=0,"undefined"!=typeof Float32Array?(b.Float32Array=Float32Array,b.Uint16Array=Uint16Array):(b.Float32Array=Array,b.Uint16Array=Array),b.INTERACTION_FREQUENCY=30,b.AUTO_PREVENT_DEFAULT=!0,b.PI_2=2*Math.PI,b.RAD_TO_DEG=180/Math.PI,b.DEG_TO_RAD=Math.PI/180,b.RETINA_PREFIX="@2x",b.dontSayHello=!1,b.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0},b.sayHello=function(a){if(!b.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var c=["%c %c %c Pixi.js "+b.VERSION+" - "+a+"  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,c)}else window.console&&console.log("Pixi.js "+b.VERSION+" - http://www.pixijs.com/");b.dontSayHello=!0}},b.Point=function(a,b){this.x=a||0,this.y=b||0},b.Point.prototype.clone=function(){return new b.Point(this.x,this.y)},b.Point.prototype.set=function(a,b){this.x=a||0,this.y=b||(0!==b?this.x:0)},b.Point.prototype.constructor=b.Point,b.Rectangle=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},b.Rectangle.prototype.clone=function(){return new b.Rectangle(this.x,this.y,this.width,this.height)},b.Rectangle.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=this.x;if(a>=c&&a<=c+this.width){var d=this.y;if(b>=d&&b<=d+this.height)return!0}return!1},b.Rectangle.prototype.constructor=b.Rectangle,b.EmptyRectangle=new b.Rectangle(0,0,0,0),b.Polygon=function(a){if(a instanceof Array||(a=Array.prototype.slice.call(arguments)),a[0]instanceof b.Point){for(var c=[],d=0,e=a.length;d<e;d++)c.push(a[d].x,a[d].y);a=c}this.closed=!0,this.points=a},b.Polygon.prototype.clone=function(){var a=this.points.slice();return new b.Polygon(a)},b.Polygon.prototype.contains=function(a,b){for(var c=!1,d=this.points.length/2,e=0,f=d-1;e<d;f=e++){var g=this.points[2*e],h=this.points[2*e+1],i=this.points[2*f],j=this.points[2*f+1],k=h>b!=j>b&&a<(i-g)*(b-h)/(j-h)+g;k&&(c=!c)}return c},b.Polygon.prototype.constructor=b.Polygon,b.Circle=function(a,b,c){this.x=a||0,this.y=b||0,this.radius=c||0},b.Circle.prototype.clone=function(){return new b.Circle(this.x,this.y,this.radius)},b.Circle.prototype.contains=function(a,b){if(this.radius<=0)return!1;var c=this.x-a,d=this.y-b,e=this.radius*this.radius;return c*=c,d*=d,c+d<=e},b.Circle.prototype.getBounds=function(){return new b.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},b.Circle.prototype.constructor=b.Circle,b.Ellipse=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},b.Ellipse.prototype.clone=function(){return new b.Ellipse(this.x,this.y,this.width,this.height)},b.Ellipse.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=(a-this.x)/this.width,d=(b-this.y)/this.height;return c*=c,d*=d,c+d<=1},b.Ellipse.prototype.getBounds=function(){return new b.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},b.Ellipse.prototype.constructor=b.Ellipse,b.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},b.Matrix.prototype.fromArray=function(a){this.a=a[0],this.b=a[1],this.c=a[3],this.d=a[4],this.tx=a[2],this.ty=a[5]},b.Matrix.prototype.toArray=function(a){this.array||(this.array=new b.Float32Array(9));var c=this.array;return a?(c[0]=this.a,c[1]=this.b,c[2]=0,c[3]=this.c,c[4]=this.d,c[5]=0,c[6]=this.tx,c[7]=this.ty,c[8]=1):(c[0]=this.a,c[1]=this.c,c[2]=this.tx,c[3]=this.b,c[4]=this.d,c[5]=this.ty,c[6]=0,c[7]=0,c[8]=1),c},b.Matrix.prototype.apply=function(a,c){return c=c||new b.Point,c.x=this.a*a.x+this.c*a.y+this.tx,c.y=this.b*a.x+this.d*a.y+this.ty,c},b.Matrix.prototype.applyInverse=function(a,c){c=c||new b.Point;var d=1/(this.a*this.d+this.c*-this.b);return c.x=this.d*d*a.x+-this.c*d*a.y+(this.ty*this.c-this.tx*this.d)*d,c.y=this.a*d*a.y+-this.b*d*a.x+(-this.ty*this.a+this.tx*this.b)*d,c},b.Matrix.prototype.translate=function(a,b){return this.tx+=a,this.ty+=b,this},b.Matrix.prototype.scale=function(a,b){return this.a*=a,this.d*=b,this.c*=a,this.b*=b,this.tx*=a,this.ty*=b,this},b.Matrix.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.a,e=this.c,f=this.tx;return this.a=d*b-this.b*c,this.b=d*c+this.b*b,this.c=e*b-this.d*c,this.d=e*c+this.d*b,this.tx=f*b-this.ty*c,this.ty=f*c+this.ty*b,this},b.Matrix.prototype.append=function(a){var b=this.a,c=this.b,d=this.c,e=this.d;return this.a=a.a*b+a.b*d,this.b=a.a*c+a.b*e,this.c=a.c*b+a.d*d,this.d=a.c*c+a.d*e,this.tx=a.tx*b+a.ty*d+this.tx,this.ty=a.tx*c+a.ty*e+this.ty,this},b.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},b.identityMatrix=new b.Matrix,b.DisplayObject=function(){this.position=new b.Point,this.scale=new b.Point(1,1),this.pivot=new b.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new b.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new b.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},b.DisplayObject.prototype.constructor=b.DisplayObject,Object.defineProperty(b.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(a){this._interactive=a,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(b.DisplayObject.prototype,"worldVisible",{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}}),Object.defineProperty(b.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.isMask=!1),this._mask=a,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(b.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(a){if(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].passes,e=0;e<d.length;e++)b.push(d[e]);this._filterBlock={target:this,filterPasses:b}}this._filters=a}}),Object.defineProperty(b.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap!==a&&(a?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=a)}}),b.DisplayObject.prototype.updateTransform=function(){var d,e,f,g,h,i,a=this.parent.worldTransform,c=this.worldTransform;this.rotation%b.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),d=this._cr*this.scale.x,e=this._sr*this.scale.x,f=-this._sr*this.scale.y,g=this._cr*this.scale.y,h=this.position.x,i=this.position.y,(this.pivot.x||this.pivot.y)&&(h-=this.pivot.x*d+this.pivot.y*f,i-=this.pivot.x*e+this.pivot.y*g),c.a=d*a.a+e*a.c,c.b=d*a.b+e*a.d,c.c=f*a.a+g*a.c,c.d=f*a.b+g*a.d,c.tx=h*a.a+i*a.c+a.tx,c.ty=h*a.b+i*a.d+a.ty):(d=this.scale.x,g=this.scale.y,h=this.position.x-this.pivot.x*d,i=this.position.y-this.pivot.y*g,c.a=a.a*d,c.b=a.b*g,c.c=a.c*d,c.d=a.d*g,c.tx=h*a.a+i*a.c+a.tx,c.ty=h*a.b+i*a.d+a.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha},b.DisplayObject.prototype.getBounds=function(a){return a=a,b.EmptyRectangle},b.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(b.identityMatrix)},b.DisplayObject.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0)},b.DisplayObject.prototype.generateTexture=function(a,c,d){var e=this.getLocalBounds(),f=new b.RenderTexture(0|e.width,0|e.height,d,c,a);return b.DisplayObject._tempMatrix.tx=-e.x,b.DisplayObject._tempMatrix.ty=-e.y,f.render(this,b.DisplayObject._tempMatrix),f},b.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},b.DisplayObject.prototype.toGlobal=function(a){return this.updateTransform(),this.worldTransform.apply(a)},b.DisplayObject.prototype.toLocal=function(a,b){return b&&(a=b.toGlobal(a)),this.updateTransform(),this.worldTransform.applyInverse(a)},b.DisplayObject.prototype._renderCachedSprite=function(a){this._cachedSprite.worldAlpha=this.worldAlpha,a.gl?b.Sprite.prototype._renderWebGL.call(this._cachedSprite,a):b.Sprite.prototype._renderCanvas.call(this._cachedSprite,a)},b.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|a.width,0|a.height);else{var c=new b.RenderTexture(0|a.width,0|a.height);this._cachedSprite=new b.Sprite(c),this._cachedSprite.worldTransform=this.worldTransform}var d=this._filters;this._filters=null,this._cachedSprite.filters=d,b.DisplayObject._tempMatrix.tx=-a.x,b.DisplayObject._tempMatrix.ty=-a.y,this._cachedSprite.texture.render(this,b.DisplayObject._tempMatrix),this._cachedSprite.anchor.x=-(a.x/a.width),this._cachedSprite.anchor.y=-(a.y/a.height),this._filters=d,this._cacheAsBitmap=!0},b.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},b.DisplayObject.prototype._renderWebGL=function(a){a=a},b.DisplayObject.prototype._renderCanvas=function(a){a=a},b.DisplayObject._tempMatrix=new b.Matrix,Object.defineProperty(b.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(b.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),b.DisplayObjectContainer=function(){b.DisplayObject.call(this),this.children=[]},b.DisplayObjectContainer.prototype=Object.create(b.DisplayObject.prototype),b.DisplayObjectContainer.prototype.constructor=b.DisplayObjectContainer,Object.defineProperty(b.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(a){var b=this.getLocalBounds().width;0!==b?this.scale.x=a/(b/this.scale.x):this.scale.x=1,this._width=a}}),Object.defineProperty(b.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(a){var b=this.getLocalBounds().height;0!==b?this.scale.y=a/(b/this.scale.y):this.scale.y=1,this._height=a}}),b.DisplayObjectContainer.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)},b.DisplayObjectContainer.prototype.addChildAt=function(a,b){if(b>=0&&b<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),this.stage&&a.setStageReference(this.stage),a;throw new Error(a+"addChildAt: The index "+b+" supplied is out of bounds "+this.children.length)},b.DisplayObjectContainer.prototype.swapChildren=function(a,b){if(a!==b){var c=this.getChildIndex(a),d=this.getChildIndex(b);if(c<0||d<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[c]=b,this.children[d]=a}},b.DisplayObjectContainer.prototype.getChildIndex=function(a){var b=this.children.indexOf(a);if(b===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return b},b.DisplayObjectContainer.prototype.setChildIndex=function(a,b){if(b<0||b>=this.children.length)throw new Error("The supplied index is out of bounds");var c=this.getChildIndex(a);this.children.splice(c,1),this.children.splice(b,0,a)},b.DisplayObjectContainer.prototype.getChildAt=function(a){if(a<0||a>=this.children.length)throw new Error("getChildAt: Supplied index "+a+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[a]},b.DisplayObjectContainer.prototype.removeChild=function(a){var b=this.children.indexOf(a);if(b!==-1)return this.removeChildAt(b)},b.DisplayObjectContainer.prototype.removeChildAt=function(a){var b=this.getChildAt(a);return this.stage&&b.removeStageReference(),b.parent=void 0,this.children.splice(a,1),b},b.DisplayObjectContainer.prototype.removeChildren=function(a,b){var c=a||0,d="number"==typeof b?b:this.children.length,e=d-c;if(e>0&&e<=d){for(var f=this.children.splice(c,e),g=0;g<f.length;g++){var h=f[g];this.stage&&h.removeStageReference(),h.parent=void 0}return f}if(0===e&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},b.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(b.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var a=0,c=this.children.length;a<c;a++)this.children[a].updateTransform()},b.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return b.EmptyRectangle;for(var f,g,h,a=1/0,c=1/0,d=-(1/0),e=-(1/0),i=!1,j=0,k=this.children.length;j<k;j++){var l=this.children[j];l.visible&&(i=!0,f=this.children[j].getBounds(),a=a<f.x?a:f.x,c=c<f.y?c:f.y,g=f.width+f.x,h=f.height+f.y,d=d>g?d:g,e=e>h?e:h)}if(!i)return b.EmptyRectangle;var m=this._bounds;return m.x=a,m.y=c,m.width=d-a,m.height=e-c,m},b.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=b.identityMatrix;for(var c=0,d=this.children.length;c<d;c++)this.children[c].updateTransform();var e=this.getBounds();return this.worldTransform=a,e},b.DisplayObjectContainer.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0);for(var b=0,c=this.children.length;b<c;b++){var d=this.children[b];d.setStageReference(a)}},b.DisplayObjectContainer.prototype.removeStageReference=function(){for(var a=0,b=this.children.length;a<b;a++){var c=this.children[a];c.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},b.DisplayObjectContainer.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);var b,c;if(this._mask||this._filters){for(this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),b=0,c=this.children.length;b<c;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&a.filterManager.popFilter(),a.spriteBatch.start()}else for(b=0,c=this.children.length;b<c;b++)this.children[b]._renderWebGL(a)}},b.DisplayObjectContainer.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);this._mask&&a.maskManager.pushMask(this._mask,a);for(var b=0,c=this.children.length;b<c;b++){var d=this.children[b];d._renderCanvas(a)}this._mask&&a.maskManager.popMask(a)}},b.Sprite=function(a){b.DisplayObjectContainer.call(this),this.anchor=new b.Point,this.texture=a,this._width=0,this._height=0,this.tint=16777215,this.blendMode=b.blendModes.NORMAL,this.shader=null,a.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.on("update",this.onTextureUpdateBind)),this.renderable=!0},b.Sprite.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Sprite.prototype.constructor=b.Sprite,Object.defineProperty(b.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}}),Object.defineProperty(b.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}}),b.Sprite.prototype.setTexture=function(a){this.texture=a,this.cachedTint=16777215},b.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},b.Sprite.prototype.getBounds=function(a){var b=this.texture.frame.width,c=this.texture.frame.height,d=b*(1-this.anchor.x),e=b*-this.anchor.x,f=c*(1-this.anchor.y),g=c*-this.anchor.y,h=a||this.worldTransform,i=h.a,j=h.c,k=h.b,l=h.d,m=h.tx,n=h.ty,o=i*e+k*g+m,p=l*g+j*e+n,q=i*d+k*g+m,r=l*g+j*d+n,s=i*d+k*f+m,t=l*f+j*d+n,u=i*e+k*f+m,v=l*f+j*e+n,w=-(1/0),x=-(1/0),y=1/0,z=1/0;y=o<y?o:y,y=q<y?q:y,y=s<y?s:y,y=u<y?u:y,z=p<z?p:z,z=r<z?r:z,z=t<z?t:z,z=v<z?v:z,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w,x=p>x?p:x,x=r>x?r:x,x=t>x?t:x,x=v>x?v:x;var A=this._bounds;return A.x=y,A.width=w-y,A.y=z,A.height=x-z,this._currentBounds=A,A},b.Sprite.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){var b,c;if(this._mask||this._filters){var d=a.spriteBatch;for(this._filters&&(d.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(d.stop(),a.maskManager.pushMask(this.mask,a),d.start()),d.render(this),b=0,c=this.children.length;b<c;b++)this.children[b]._renderWebGL(a);d.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&a.filterManager.popFilter(),d.start()}else for(a.spriteBatch.render(this),b=0,c=this.children.length;b<c;b++)this.children[b]._renderWebGL(a)}},b.Sprite.prototype._renderCanvas=function(a){if(!(this.visible===!1||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,a.context.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a),this.texture.valid){var c=this.texture.baseTexture.resolution/a.resolution;a.context.globalAlpha=this.worldAlpha,a.roundPixels?a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0):a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution),a.smoothProperty&&a.scaleMode!==this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,a.context[a.smoothProperty]=a.scaleMode===b.scaleModes.LINEAR);var d=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,e=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=b.CanvasTinter.getTintedTexture(this,this.tint)),a.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,d/c,e/c,this.texture.crop.width/c,this.texture.crop.height/c)):a.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,d/c,e/c,this.texture.crop.width/c,this.texture.crop.height/c)}for(var f=0,g=this.children.length;f<g;f++)this.children[f]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}},b.Sprite.fromFrame=function(a){var c=b.TextureCache[a];if(!c)throw new Error('The frameId "'+a+'" does not exist in the texture cache'+this);return new b.Sprite(c)},b.Sprite.fromImage=function(a,c,d){var e=b.Texture.fromImage(a,c,d);return new b.Sprite(e)},b.SpriteBatch=function(a){b.DisplayObjectContainer.call(this),this.textureThing=a,this.ready=!1},b.SpriteBatch.prototype=Object.create(b.DisplayObjectContainer.prototype),b.SpriteBatch.prototype.constructor=b.SpriteBatch,b.SpriteBatch.prototype.initWebGL=function(a){this.fastSpriteBatch=new b.WebGLFastSpriteBatch(a),this.ready=!0},b.SpriteBatch.prototype.updateTransform=function(){b.DisplayObject.prototype.updateTransform.call(this)},b.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(a.gl),a.spriteBatch.stop(),a.shaderManager.setShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.spriteBatch.start())},b.SpriteBatch.prototype._renderCanvas=function(a){if(this.visible&&!(this.alpha<=0)&&this.children.length){var c=a.context;c.globalAlpha=this.worldAlpha,b.DisplayObject.prototype.updateTransform.call(this);for(var d=this.worldTransform,e=!0,f=0;f<this.children.length;f++){var g=this.children[f];if(g.visible){var h=g.texture,i=h.frame;if(c.globalAlpha=this.worldAlpha*g.alpha,g.rotation%(2*Math.PI)===0)e&&(c.setTransform(d.a,d.b,d.c,d.d,d.tx,d.ty),e=!1),c.drawImage(h.baseTexture.source,i.x,i.y,i.width,i.height,g.anchor.x*(-i.width*g.scale.x)+g.position.x+.5|0,g.anchor.y*(-i.height*g.scale.y)+g.position.y+.5|0,i.width*g.scale.x,i.height*g.scale.y);else{e||(e=!0),b.DisplayObject.prototype.updateTransform.call(g);var j=g.worldTransform;a.roundPixels?c.setTransform(j.a,j.b,j.c,j.d,0|j.tx,0|j.ty):c.setTransform(j.a,j.b,j.c,j.d,j.tx,j.ty),c.drawImage(h.baseTexture.source,i.x,i.y,i.width,i.height,g.anchor.x*-i.width+.5|0,g.anchor.y*-i.height+.5|0,i.width,i.height)}}}}},b.MovieClip=function(a){b.Sprite.call(this,a[0]),this.textures=a,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},b.MovieClip.prototype=Object.create(b.Sprite.prototype),b.MovieClip.prototype.constructor=b.MovieClip,Object.defineProperty(b.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),b.MovieClip.prototype.stop=function(){this.playing=!1},b.MovieClip.prototype.play=function(){this.playing=!0},b.MovieClip.prototype.gotoAndStop=function(a){this.playing=!1,this.currentFrame=a;var b=this.currentFrame+.5|0;this.setTexture(this.textures[b%this.textures.length])},b.MovieClip.prototype.gotoAndPlay=function(a){this.currentFrame=a,this.playing=!0},b.MovieClip.prototype.updateTransform=function(){if(b.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var a=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||a<this.textures.length?this.setTexture(this.textures[a%this.textures.length]):a>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},b.MovieClip.fromFrames=function(a){for(var c=[],d=0;d<a.length;d++)c.push(new b.Texture.fromFrame(a[d]));return new b.MovieClip(c)},b.MovieClip.fromImages=function(a){for(var c=[],d=0;d<a.length;d++)c.push(new b.Texture.fromImage(a[d]));return new b.MovieClip(c)},b.FilterBlock=function(){this.visible=!0,this.renderable=!0},b.FilterBlock.prototype.constructor=b.FilterBlock,b.Text=function(a,c){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,b.Sprite.call(this,b.Texture.fromCanvas(this.canvas)),this.setText(a),this.setStyle(c)},b.Text.prototype=Object.create(b.Sprite.prototype),b.Text.prototype.constructor=b.Text,Object.defineProperty(b.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}}),Object.defineProperty(b.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}}),b.Text.prototype.setStyle=function(a){a=a||{},a.font=a.font||"bold 20pt Arial",a.fill=a.fill||"black",a.align=a.align||"left",a.stroke=a.stroke||"black",a.strokeThickness=a.strokeThickness||0,a.wordWrap=a.wordWrap||!1,a.wordWrapWidth=a.wordWrapWidth||100,a.dropShadow=a.dropShadow||!1,a.dropShadowAngle=a.dropShadowAngle||Math.PI/6,a.dropShadowDistance=a.dropShadowDistance||4,a.dropShadowColor=a.dropShadowColor||"black",this.style=a,this.dirty=!0},b.Text.prototype.setText=function(a){this.text=a.toString()||" ",this.dirty=!0},b.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.wordWrap(this.text));for(var b=a.split(/(?:\r\n|\r|\n)/),c=[],d=0,e=this.determineFontProperties(this.style.font),f=0;f<b.length;f++){var g=this.context.measureText(b[f]).width;c[f]=g,d=Math.max(d,g)}var h=d+this.style.strokeThickness;this.style.dropShadow&&(h+=this.style.dropShadowDistance),this.canvas.width=(h+this.context.lineWidth)*this.resolution;var i=e.fontSize+this.style.strokeThickness,j=i*b.length;this.style.dropShadow&&(j+=this.style.dropShadowDistance),this.canvas.height=j*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.context.lineJoin="round";var k,l;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var m=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,n=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(f=0;f<b.length;f++)k=this.style.strokeThickness/2,l=this.style.strokeThickness/2+f*i+e.ascent,"right"===this.style.align?k+=d-c[f]:"center"===this.style.align&&(k+=(d-c[f])/2),this.style.fill&&this.context.fillText(b[f],k+m,l+n)}for(this.context.fillStyle=this.style.fill,f=0;f<b.length;f++)k=this.style.strokeThickness/2,l=this.style.strokeThickness/2+f*i+e.ascent,"right"===this.style.align?k+=d-c[f]:"center"===this.style.align&&(k+=(d-c[f])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(b[f],k,l),this.style.fill&&this.context.fillText(b[f],k,l);this.updateTexture()},b.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},b.Text.prototype._renderWebGL=function(a){this.dirty&&(this.resolution=a.resolution,this.updateText(),this.dirty=!1),b.Sprite.prototype._renderWebGL.call(this,a)},b.Text.prototype._renderCanvas=function(a){this.dirty&&(this.resolution=a.resolution,this.updateText(),this.dirty=!1),b.Sprite.prototype._renderCanvas.call(this,a)},b.Text.prototype.determineFontProperties=function(a){var c=b.Text.fontPropertiesCache[a];if(!c){c={};var d=b.Text.fontPropertiesCanvas,e=b.Text.fontPropertiesContext;e.font=a;var f=Math.ceil(e.measureText("|Mq").width),g=Math.ceil(e.measureText("M").width),h=2*g;g=1.4*g|0,d.width=f,d.height=h,e.fillStyle="#f00",e.fillRect(0,0,f,h),e.font=a,e.textBaseline="alphabetic",e.fillStyle="#000",e.fillText("|Mq",0,g);var l,m,i=e.getImageData(0,0,f,h).data,j=i.length,k=4*f,n=0,o=!1;for(l=0;l<g;l++){for(m=0;m<k;m+=4)if(255!==i[n+m]){o=!0;break}if(o)break;n+=k}for(c.ascent=g-l,n=j-k,o=!1,l=h;l>g;l--){for(m=0;m<k;m+=4)if(255!==i[n+m]){o=!0;break}if(o)break;n-=k}c.descent=l-g,c.fontSize=c.ascent+c.descent,b.Text.fontPropertiesCache[a]=c}return c},b.Text.prototype.wordWrap=function(a){for(var b="",c=a.split("\n"),d=0;d<c.length;d++){for(var e=this.style.wordWrapWidth,f=c[d].split(" "),g=0;g<f.length;g++){var h=this.context.measureText(f[g]).width,i=h+this.context.measureText(" ").width;0===g||i>e?(g>0&&(b+="\n"),b+=f[g],e=this.style.wordWrapWidth-h):(e-=i,b+=" "+f[g])}d<c.length-1&&(b+="\n")}return b},b.Text.prototype.destroy=function(a){this.context=null,this.canvas=null,this.texture.destroy(void 0===a||a)},b.Text.fontPropertiesCache={},b.Text.fontPropertiesCanvas=document.createElement("canvas"),b.Text.fontPropertiesContext=b.Text.fontPropertiesCanvas.getContext("2d"),b.BitmapText=function(a,c){b.DisplayObjectContainer.call(this),this.textWidth=0,
this.textHeight=0,this._pool=[],this.setText(a),this.setStyle(c),this.updateText(),this.dirty=!1},b.BitmapText.prototype=Object.create(b.DisplayObjectContainer.prototype),b.BitmapText.prototype.constructor=b.BitmapText,b.BitmapText.prototype.setText=function(a){this.text=a||" ",this.dirty=!0},b.BitmapText.prototype.setStyle=function(a){a=a||{},a.align=a.align||"left",this.style=a;var c=a.font.split(" ");this.fontName=c[c.length-1],this.fontSize=c.length>=2?parseInt(c[c.length-2],10):b.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=a.tint},b.BitmapText.prototype.updateText=function(){for(var a=b.BitmapText.fonts[this.fontName],c=new b.Point,d=null,e=[],f=0,g=[],h=0,i=this.fontSize/a.size,j=0;j<this.text.length;j++){var k=this.text.charCodeAt(j);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(j)))g.push(c.x),f=Math.max(f,c.x),h++,c.x=0,c.y+=a.lineHeight,d=null;else{var l=a.chars[k];l&&(d&&l.kerning[d]&&(c.x+=l.kerning[d]),e.push({texture:l.texture,line:h,charCode:k,position:new b.Point(c.x+l.xOffset,c.y+l.yOffset)}),c.x+=l.xAdvance,d=k)}}g.push(c.x),f=Math.max(f,c.x);var m=[];for(j=0;j<=h;j++){var n=0;"right"===this.style.align?n=f-g[j]:"center"===this.style.align&&(n=(f-g[j])/2),m.push(n)}var o=this.children.length,p=e.length,q=this.tint||16777215;for(j=0;j<p;j++){var r=j<o?this.children[j]:this._pool.pop();r?r.setTexture(e[j].texture):r=new b.Sprite(e[j].texture),r.position.x=(e[j].position.x+m[e[j].line])*i,r.position.y=e[j].position.y*i,r.scale.x=r.scale.y=i,r.tint=q,r.parent||this.addChild(r)}for(;this.children.length>p;){var s=this.getChildAt(this.children.length-1);this._pool.push(s),this.removeChild(s)}this.textWidth=f*i,this.textHeight=(c.y+a.lineHeight)*i},b.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),b.DisplayObjectContainer.prototype.updateTransform.call(this)},b.BitmapText.fonts={},b.InteractionData=function(){this.global=new b.Point,this.target=null,this.originalEvent=null},b.InteractionData.prototype.getLocalPosition=function(a,c){var d=a.worldTransform,e=this.global,f=d.a,g=d.b,h=d.tx,i=d.c,j=d.d,k=d.ty,l=1/(f*j+g*-i);return c=c||new b.Point,c.x=j*l*e.x+-g*l*e.y+(k*g-h*j)*l,c.y=f*l*e.y+-i*l*e.x+(-k*f+h*i)*l,c},b.InteractionData.prototype.constructor=b.InteractionData,b.InteractionManager=function(a){this.stage=a,this.mouse=new b.InteractionData,this.touches={},this.tempPoint=new b.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1,this.resolution=1},b.InteractionManager.prototype.constructor=b.InteractionManager,b.InteractionManager.prototype.collectInteractiveSprite=function(a,b){for(var c=a.children,d=c.length,e=d-1;e>=0;e--){var f=c[e];f._interactive?(b.interactiveChildren=!0,this.interactiveItems.push(f),f.children.length>0&&this.collectInteractiveSprite(f,f)):(f.__iParent=null,f.children.length>0&&this.collectInteractiveSprite(f,b))}},b.InteractionManager.prototype.setTarget=function(a){this.target=a,this.resolution=a.resolution,null===this.interactionDOMElement&&this.setTargetDomElement(a.view)},b.InteractionManager.prototype.setTargetDomElement=function(a){this.removeEvents(),window.navigator.msPointerEnabled&&(a.style["-ms-content-zooming"]="none",a.style["-ms-touch-action"]="none"),this.interactionDOMElement=a,a.addEventListener("mousemove",this.onMouseMove,!0),a.addEventListener("mousedown",this.onMouseDown,!0),a.addEventListener("mouseout",this.onMouseOut,!0),a.addEventListener("touchstart",this.onTouchStart,!0),a.addEventListener("touchend",this.onTouchEnd,!0),a.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},b.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},b.InteractionManager.prototype.update=function(){if(this.target){var a=Date.now(),c=a-this.last;if(c=c*b.INTERACTION_FREQUENCY/1e3,!(c<1)){this.last=a;var d=0;this.dirty&&this.rebuildInteractiveGraph();var e=this.interactiveItems.length,f="inherit",g=!1;for(d=0;d<e;d++){var h=this.interactiveItems[d];h.__hit=this.hitTest(h,this.mouse),this.mouse.target=h,h.__hit&&!g?(h.buttonMode&&(f=h.defaultCursor),h.interactiveChildren||(g=!0),h.__isOver||(h.mouseover&&h.mouseover(this.mouse),h.__isOver=!0)):h.__isOver&&(h.mouseout&&h.mouseout(this.mouse),h.__isOver=!1)}this.currentCursorStyle!==f&&(this.currentCursorStyle=f,this.interactionDOMElement.style.cursor=f)}}},b.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var a=this.interactiveItems.length,b=0;b<a;b++)this.interactiveItems[b].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},b.InteractionManager.prototype.onMouseMove=function(a){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=a;var b=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(a.clientX-b.left)*(this.target.width/b.width)/this.resolution,this.mouse.global.y=(a.clientY-b.top)*(this.target.height/b.height)/this.resolution;for(var c=this.interactiveItems.length,d=0;d<c;d++){var e=this.interactiveItems[d];e.mousemove&&e.mousemove(this.mouse)}},b.InteractionManager.prototype.onMouseDown=function(a){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=a,b.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var c=this.interactiveItems.length,d=this.mouse.originalEvent,e=2===d.button||3===d.which,f=e?"rightdown":"mousedown",g=e?"rightclick":"click",h=e?"__rightIsDown":"__mouseIsDown",i=e?"__isRightDown":"__isDown",j=0;j<c;j++){var k=this.interactiveItems[j];if((k[f]||k[g])&&(k[h]=!0,k.__hit=this.hitTest(k,this.mouse),k.__hit&&(k[f]&&k[f](this.mouse),k[i]=!0,!k.interactiveChildren)))break}},b.InteractionManager.prototype.onMouseOut=function(a){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=a;var b=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var c=0;c<b;c++){var d=this.interactiveItems[c];d.__isOver&&(this.mouse.target=d,d.mouseout&&d.mouseout(this.mouse),d.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},b.InteractionManager.prototype.onMouseUp=function(a){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=a;for(var b=this.interactiveItems.length,c=!1,d=this.mouse.originalEvent,e=2===d.button||3===d.which,f=e?"rightup":"mouseup",g=e?"rightclick":"click",h=e?"rightupoutside":"mouseupoutside",i=e?"__isRightDown":"__isDown",j=0;j<b;j++){var k=this.interactiveItems[j];(k[g]||k[f]||k[h])&&(k.__hit=this.hitTest(k,this.mouse),k.__hit&&!c?(k[f]&&k[f](this.mouse),k[i]&&k[g]&&k[g](this.mouse),k.interactiveChildren||(c=!0)):k[i]&&k[h]&&k[h](this.mouse),k[i]=!1)}},b.InteractionManager.prototype.hitTest=function(a,c){var d=c.global;if(!a.worldVisible)return!1;var f,e=a.worldTransform,g=e.a,h=e.b,i=e.c,j=e.tx,k=e.d,l=e.ty,m=1/(g*k+i*-h),n=k*m*d.x+-i*m*d.y+(l*i-j*k)*m,o=g*m*d.y+-h*m*d.x+(-l*g+j*h)*m;if(c.target=a,a.hitArea&&a.hitArea.contains)return!!a.hitArea.contains(n,o)&&(c.target=a,!0);if(a instanceof b.Sprite){var s,p=a.texture.frame.width,q=a.texture.frame.height,r=-p*a.anchor.x;if(n>r&&n<r+p&&(s=-q*a.anchor.y,o>s&&o<s+q))return c.target=a,!0}else if(a instanceof b.Graphics){var t=a.graphicsData;for(f=0;f<t.length;f++){var u=t[f];if(u.fill&&u.shape&&u.shape.contains(n,o))return c.target=a,!0}}var v=a.children.length;for(f=0;f<v;f++){var w=a.children[f],x=this.hitTest(w,c);if(x)return c.target=a,!0}return!1},b.InteractionManager.prototype.onTouchMove=function(a){this.dirty&&this.rebuildInteractiveGraph();var d,b=this.interactionDOMElement.getBoundingClientRect(),c=a.changedTouches,e=0;for(e=0;e<c.length;e++){var f=c[e];d=this.touches[f.identifier],d.originalEvent=a,d.global.x=(f.clientX-b.left)*(this.target.width/b.width)/this.resolution,d.global.y=(f.clientY-b.top)*(this.target.height/b.height)/this.resolution,!navigator.isCocoonJS||b.left||b.top||a.target.style.width||a.target.style.height||(d.global.x=f.clientX,d.global.y=f.clientY);for(var g=0;g<this.interactiveItems.length;g++){var h=this.interactiveItems[g];h.touchmove&&h.__touchData&&h.__touchData[f.identifier]&&h.touchmove(d)}}},b.InteractionManager.prototype.onTouchStart=function(a){this.dirty&&this.rebuildInteractiveGraph();var c=this.interactionDOMElement.getBoundingClientRect();b.AUTO_PREVENT_DEFAULT&&a.preventDefault();for(var d=a.changedTouches,e=0;e<d.length;e++){var f=d[e],g=this.pool.pop();g||(g=new b.InteractionData),g.originalEvent=a,this.touches[f.identifier]=g,g.global.x=(f.clientX-c.left)*(this.target.width/c.width)/this.resolution,g.global.y=(f.clientY-c.top)*(this.target.height/c.height)/this.resolution,!navigator.isCocoonJS||c.left||c.top||a.target.style.width||a.target.style.height||(g.global.x=f.clientX,g.global.y=f.clientY);for(var h=this.interactiveItems.length,i=0;i<h;i++){var j=this.interactiveItems[i];if((j.touchstart||j.tap)&&(j.__hit=this.hitTest(j,g),j.__hit&&(j.touchstart&&j.touchstart(g),j.__isDown=!0,j.__touchData=j.__touchData||{},j.__touchData[f.identifier]=g,!j.interactiveChildren)))break}}},b.InteractionManager.prototype.onTouchEnd=function(a){this.dirty&&this.rebuildInteractiveGraph();for(var b=this.interactionDOMElement.getBoundingClientRect(),c=a.changedTouches,d=0;d<c.length;d++){var e=c[d],f=this.touches[e.identifier],g=!1;f.global.x=(e.clientX-b.left)*(this.target.width/b.width)/this.resolution,f.global.y=(e.clientY-b.top)*(this.target.height/b.height)/this.resolution,!navigator.isCocoonJS||b.left||b.top||a.target.style.width||a.target.style.height||(f.global.x=e.clientX,f.global.y=e.clientY);for(var h=this.interactiveItems.length,i=0;i<h;i++){var j=this.interactiveItems[i];j.__touchData&&j.__touchData[e.identifier]&&(j.__hit=this.hitTest(j,j.__touchData[e.identifier]),f.originalEvent=a,(j.touchend||j.tap)&&(j.__hit&&!g?(j.touchend&&j.touchend(f),j.__isDown&&j.tap&&j.tap(f),j.interactiveChildren||(g=!0)):j.__isDown&&j.touchendoutside&&j.touchendoutside(f),j.__isDown=!1),j.__touchData[e.identifier]=null)}this.pool.push(f),this.touches[e.identifier]=null}},b.Stage=function(a){b.DisplayObjectContainer.call(this),this.worldTransform=new b.Matrix,this.interactive=!0,this.interactionManager=new b.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new b.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(a)},b.Stage.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Stage.prototype.constructor=b.Stage,b.Stage.prototype.setInteractionDelegate=function(a){this.interactionManager.setTargetDomElement(a)},b.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0,b=this.children.length;a<b;a++)this.children[a].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},b.Stage.prototype.setBackgroundColor=function(a){this.backgroundColor=a||0,this.backgroundColorSplit=b.hex2rgb(this.backgroundColor);var c=this.backgroundColor.toString(16);c="000000".substr(0,6-c.length)+c,this.backgroundColorString="#"+c},b.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(a){for(var b=0,c=["ms","moz","webkit","o"],d=0;d<c.length&&!a.requestAnimationFrame;++d)a.requestAnimationFrame=a[c[d]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[c[d]+"CancelAnimationFrame"]||a[c[d]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(c){var d=(new Date).getTime(),e=Math.max(0,16-(d-b)),f=a.setTimeout(function(){c(d+e)},e);return b=d+e,f}),a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)}),a.requestAnimFrame=a.requestAnimationFrame}(this),b.hex2rgb=function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]},b.rgb2hex=function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){return function(a){function e(){for(var c=arguments.length,f=new Array(c);c--;)f[c]=arguments[c];return f=d.concat(f),b.apply(this instanceof e?this:a,f)}var b=this,c=arguments.length-1,d=[];if(c>0)for(d.length=c;c--;)d[c]=arguments[c+1];if("function"!=typeof b)throw new TypeError;return e.prototype=function a(b){if(b&&(a.prototype=b),!(this instanceof a))return new a}(b.prototype),e}}()),b.AjaxRequest=function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return!!window.XMLHttpRequest&&new window.XMLHttpRequest;for(var b=0;b<a.length;b++)try{return new window.ActiveXObject(a[b])}catch(a){}},b.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var a=document.createElement("canvas");a.width=1,a.height=1;var b=a.getContext("2d");return b.fillStyle="#000",b.fillRect(0,0,1,1),b.globalCompositeOperation="multiply",b.fillStyle="#fff",b.fillRect(0,0,1,1),0===b.getImageData(0,0,1,1).data[0]},b.getNextPowerOfTwo=function(a){if(a>0&&0===(a&a-1))return a;for(var b=1;b<a;)b<<=1;return b},b.EventTarget={call:function(c){c&&(c=c.prototype||c,b.EventTarget.mixin(c))},mixin:function(c){c.listeners=function(b){return this._listeners=this._listeners||{},this._listeners[b]?this._listeners[b].slice():[]},c.emit=c.dispatchEvent=function(c,d){if(this._listeners=this._listeners||{},"object"==typeof c&&(d=c,c=c.type),d&&d.__isEventObject===!0||(d=new b.Event(this,c,d)),this._listeners&&this._listeners[c]){var h,e=this._listeners[c],f=e.length,g=e[0];for(h=0;h<f;g=e[++h])if(g.call(this,d),d.stoppedImmediate)return this;if(d.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,c,d),this},c.on=c.addEventListener=function(b,c){return this._listeners=this._listeners||{},(this._listeners[b]=this._listeners[b]||[]).push(c),this},c.once=function(b,c){function e(){c.apply(d.off(b,e),arguments)}this._listeners=this._listeners||{};var d=this;return e._originalHandler=c,this.on(b,e)},c.off=c.removeEventListener=function(b,c){if(this._listeners=this._listeners||{},!this._listeners[b])return this;for(var d=this._listeners[b],e=c?d.length:0;e-- >0;)d[e]!==c&&d[e]._originalHandler!==c||d.splice(e,1);return 0===d.length&&delete this._listeners[b],this},c.removeAllListeners=function(b){return this._listeners=this._listeners||{},this._listeners[b]?(delete this._listeners[b],this):this}}},b.Event=function(a,b,c){this.__isEventObject=!0,this.stopped=!1,this.stoppedImmediate=!1,this.target=a,this.type=b,this.data=c,this.content=c,this.timeStamp=Date.now()},b.Event.prototype.stopPropagation=function(){this.stopped=!0},b.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0},b.autoDetectRenderer=function(a,c,d){a||(a=800),c||(c=600);var e=function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(a){return!1}}();return e?new b.WebGLRenderer(a,c,d):new b.CanvasRenderer(a,c,d)},b.autoDetectRecommendedRenderer=function(a,c,d){a||(a=800),c||(c=600);var e=function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(a){return!1}}(),f=/Android/i.test(navigator.userAgent);return e&&!f?new b.WebGLRenderer(a,c,d):new b.CanvasRenderer(a,c,d)},b.PolyK={},b.PolyK.Triangulate=function(a){var c=!0,d=a.length>>1;if(d<3)return[];for(var e=[],f=[],g=0;g<d;g++)f.push(g);g=0;for(var h=d;h>3;){var i=f[(g+0)%h],j=f[(g+1)%h],k=f[(g+2)%h],l=a[2*i],m=a[2*i+1],n=a[2*j],o=a[2*j+1],p=a[2*k],q=a[2*k+1],r=!1;if(b.PolyK._convex(l,m,n,o,p,q,c)){r=!0;for(var s=0;s<h;s++){var t=f[s];if(t!==i&&t!==j&&t!==k&&b.PolyK._PointInTriangle(a[2*t],a[2*t+1],l,m,n,o,p,q)){r=!1;break}}}if(r)e.push(i,j,k),f.splice((g+1)%h,1),h--,g=0;else if(g++>3*h){if(!c)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(e=[],f=[],g=0;g<d;g++)f.push(g);g=0,h=d,c=!1}}return e.push(f[0],f[1],f[2]),e},b.PolyK._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&u+v<1},b.PolyK._convex=function(a,b,c,d,e,f,g){return(b-d)*(e-c)+(c-a)*(f-d)>=0===g},b.initDefaultShaders=function(){},b.CompileVertexShader=function(a,c){return b._CompileShader(a,c,a.VERTEX_SHADER)},b.CompileFragmentShader=function(a,c){return b._CompileShader(a,c,a.FRAGMENT_SHADER)},b._CompileShader=function(a,b,c){var d=b.join("\n"),e=a.createShader(c);return a.shaderSource(e,d),a.compileShader(e),a.getShaderParameter(e,a.COMPILE_STATUS)?e:(window.console.log(a.getShaderInfoLog(e)),null)},b.compileProgram=function(a,c,d){var e=b.CompileFragmentShader(a,d),f=b.CompileVertexShader(a,c),g=a.createProgram();return a.attachShader(g,f),a.attachShader(g,e),a.linkProgram(g),a.getProgramParameter(g,a.LINK_STATUS)||window.console.log("Could not initialise shaders"),g},b.PixiShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()};b.PixiShader.prototype.constructor=b.PixiShader;b.PixiShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc||b.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(c),this.uSampler=a.getUniformLocation(c,"uSampler"),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.dimensions=a.getUniformLocation(c,"dimensions"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(c,"aColor"),this.colorAttribute===-1&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var d in this.uniforms)this.uniforms[d].uniformLocation=a.getUniformLocation(c,d);this.initUniforms(),this.program=c},b.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var b,a=this.gl;for(var c in this.uniforms){b=this.uniforms[c];var d=b.type;"sampler2D"===d?(b._init=!1,null!==b.value&&this.initSampler2D(b)):"mat2"===d||"mat3"===d||"mat4"===d?(b.glMatrix=!0,b.glValueLength=1,"mat2"===d?b.glFunc=a.uniformMatrix2fv:"mat3"===d?b.glFunc=a.uniformMatrix3fv:"mat4"===d&&(b.glFunc=a.uniformMatrix4fv)):(b.glFunc=a["uniform"+d],"2f"===d||"2i"===d?b.glValueLength=2:"3f"===d||"3i"===d?b.glValueLength=3:"4f"===d||"4i"===d?b.glValueLength=4:b.glValueLength=1)}},b.PixiShader.prototype.initSampler2D=function(a){if(a.value&&a.value.baseTexture&&a.value.baseTexture.hasLoaded){var b=this.gl;if(b.activeTexture(b["TEXTURE"+this.textureCount]),b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id]),a.textureData){var c=a.textureData,d=c.magFilter?c.magFilter:b.LINEAR,e=c.minFilter?c.minFilter:b.LINEAR,f=c.wrapS?c.wrapS:b.CLAMP_TO_EDGE,g=c.wrapT?c.wrapT:b.CLAMP_TO_EDGE,h=c.luminance?b.LUMINANCE:b.RGBA;if(c.repeat&&(f=b.REPEAT,g=b.REPEAT),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!!c.flipY),c.width){var i=c.width?c.width:512,j=c.height?c.height:2,k=c.border?c.border:0;b.texImage2D(b.TEXTURE_2D,0,h,i,j,k,h,b.UNSIGNED_BYTE,null)}else b.texImage2D(b.TEXTURE_2D,0,h,b.RGBA,b.UNSIGNED_BYTE,a.value.baseTexture.source);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,d),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,e),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,g)}b.uniform1i(a.uniformLocation,this.textureCount),a._init=!0,this.textureCount++}},b.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a,c=this.gl;for(var d in this.uniforms)a=this.uniforms[d],1===a.glValueLength?a.glMatrix===!0?a.glFunc.call(c,a.uniformLocation,a.transpose,a.value):a.glFunc.call(c,a.uniformLocation,a.value):2===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y):3===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y,a.value.z):4===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y,a.value.z,a.value.w):"sampler2D"===a.type&&(a._init?(c.activeTexture(c["TEXTURE"+this.textureCount]),a.value.baseTexture._dirty[c.id]?b.defaultRenderer.updateTexture(a.value.baseTexture):c.bindTexture(c.TEXTURE_2D,a.value.baseTexture._glTextures[c.id]),c.uniform1i(a.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(a))},b.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},b.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],b.PixiFastShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},b.PixiFastShader.prototype.constructor=b.PixiFastShader,b.PixiFastShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.uSampler=a.getUniformLocation(c,"uSampler"),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.dimensions=a.getUniformLocation(c,"dimensions"),this.uMatrix=a.getUniformLocation(c,"uMatrix"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.aPositionCoord=a.getAttribLocation(c,"aPositionCoord"),this.aScale=a.getAttribLocation(c,"aScale"),this.aRotation=a.getAttribLocation(c,"aRotation"),this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(c,"aColor"),this.colorAttribute===-1&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=c},b.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},b.StripShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},b.StripShader.prototype.constructor=b.StripShader,b.StripShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.uSampler=a.getUniformLocation(c,"uSampler"),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.colorAttribute=a.getAttribLocation(c,"aColor"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=a.getUniformLocation(c,"translationMatrix"),this.alpha=a.getUniformLocation(c,"alpha"),this.program=c},b.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},b.PrimitiveShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},b.PrimitiveShader.prototype.constructor=b.PrimitiveShader,b.PrimitiveShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.tintColor=a.getUniformLocation(c,"tint"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.colorAttribute=a.getAttribLocation(c,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(c,"translationMatrix"),this.alpha=a.getUniformLocation(c,"alpha"),this.program=c},b.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},b.ComplexPrimitiveShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},b.ComplexPrimitiveShader.prototype.constructor=b.ComplexPrimitiveShader,b.ComplexPrimitiveShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.tintColor=a.getUniformLocation(c,"tint"),this.color=a.getUniformLocation(c,"color"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(c,"translationMatrix"),this.alpha=a.getUniformLocation(c,"alpha"),this.program=c},b.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},b.WebGLGraphics=function(){},b.WebGLGraphics.renderGraphics=function(a,c){var h,d=c.gl,e=c.projection,f=c.offset,g=c.shaderManager.primitiveShader;a.dirty&&b.WebGLGraphics.updateGraphics(a,d);for(var i=a._webGL[d.id],j=0;j<i.data.length;j++)1===i.data[j].mode?(h=i.data[j],c.stencilManager.pushStencil(a,h,c),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(h.indices.length-4)),c.stencilManager.popStencil(a,h,c)):(h=i.data[j],c.shaderManager.setShader(g),g=c.shaderManager.primitiveShader,d.uniformMatrix3fv(g.translationMatrix,!1,a.worldTransform.toArray(!0)),d.uniform2f(g.projectionVector,e.x,-e.y),d.uniform2f(g.offsetVector,-f.x,-f.y),d.uniform3fv(g.tintColor,b.hex2rgb(a.tint)),d.uniform1f(g.alpha,a.worldAlpha),d.bindBuffer(d.ARRAY_BUFFER,h.buffer),d.vertexAttribPointer(g.aVertexPosition,2,d.FLOAT,!1,24,0),d.vertexAttribPointer(g.colorAttribute,4,d.FLOAT,!1,24,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,h.indexBuffer),d.drawElements(d.TRIANGLE_STRIP,h.indices.length,d.UNSIGNED_SHORT,0))},b.WebGLGraphics.updateGraphics=function(a,c){var d=a._webGL[c.id];d||(d=a._webGL[c.id]={lastIndex:0,data:[],gl:c}),a.dirty=!1;var e;if(a.clearDirty){for(a.clearDirty=!1,e=0;e<d.data.length;e++){var f=d.data[e];f.reset(),b.WebGLGraphics.graphicsDataPool.push(f)}d.data=[],d.lastIndex=0}var g;for(e=d.lastIndex;e<a.graphicsData.length;e++){var h=a.graphicsData[e];h.type===b.Graphics.POLY?(h.points=h.shape.points.slice(),h.shape.closed&&h.points[0]!==h.points[h.points.length-2]&&h.points[1]!==h.points[h.points.length-1]&&h.points.push(h.points[0],h.points[1]),h.fill&&h.points.length>=6&&(h.points.length>10?(g=b.WebGLGraphics.switchMode(d,1),b.WebGLGraphics.buildComplexPoly(h,g)):(g=b.WebGLGraphics.switchMode(d,0),b.WebGLGraphics.buildPoly(h,g))),h.lineWidth>0&&(g=b.WebGLGraphics.switchMode(d,0),b.WebGLGraphics.buildLine(h,g))):(g=b.WebGLGraphics.switchMode(d,0),h.type===b.Graphics.RECT?b.WebGLGraphics.buildRectangle(h,g):h.type===b.Graphics.CIRC||h.type===b.Graphics.ELIP?b.WebGLGraphics.buildCircle(h,g):h.type===b.Graphics.RREC&&b.WebGLGraphics.buildRoundedRectangle(h,g)),d.lastIndex++}for(e=0;e<d.data.length;e++)g=d.data[e],g.dirty&&g.upload()},b.WebGLGraphics.switchMode=function(a,c){var d;return a.data.length?(d=a.data[a.data.length-1],d.mode===c&&1!==c||(d=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(a.gl),d.mode=c,a.data.push(d))):(d=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(a.gl),d.mode=c,a.data.push(d)),d.dirty=!0,d},b.WebGLGraphics.buildRectangle=function(a,c){var d=a.shape,e=d.x,f=d.y,g=d.width,h=d.height;if(a.fill){var i=b.hex2rgb(a.fillColor),j=a.fillAlpha,k=i[0]*j,l=i[1]*j,m=i[2]*j,n=c.points,o=c.indices,p=n.length/6;n.push(e,f),n.push(k,l,m,j),n.push(e+g,f),n.push(k,l,m,j),n.push(e,f+h),n.push(k,l,m,j),n.push(e+g,f+h),
n.push(k,l,m,j),o.push(p,p,p+1,p+2,p+3,p+3)}if(a.lineWidth){var q=a.points;a.points=[e,f,e+g,f,e+g,f+h,e,f+h,e,f],b.WebGLGraphics.buildLine(a,c),a.points=q}},b.WebGLGraphics.buildRoundedRectangle=function(a,c){var d=a.shape.points,e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=[];if(j.push(e,f+i),j=j.concat(b.WebGLGraphics.quadraticBezierCurve(e,f+h-i,e,f+h,e+i,f+h)),j=j.concat(b.WebGLGraphics.quadraticBezierCurve(e+g-i,f+h,e+g,f+h,e+g,f+h-i)),j=j.concat(b.WebGLGraphics.quadraticBezierCurve(e+g,f+i,e+g,f,e+g-i,f)),j=j.concat(b.WebGLGraphics.quadraticBezierCurve(e+i,f,e,f,e,f+i)),a.fill){var k=b.hex2rgb(a.fillColor),l=a.fillAlpha,m=k[0]*l,n=k[1]*l,o=k[2]*l,p=c.points,q=c.indices,r=p.length/6,s=b.PolyK.Triangulate(j),t=0;for(t=0;t<s.length;t+=3)q.push(s[t]+r),q.push(s[t]+r),q.push(s[t+1]+r),q.push(s[t+2]+r),q.push(s[t+2]+r);for(t=0;t<j.length;t++)p.push(j[t],j[++t],m,n,o,l)}if(a.lineWidth){var u=a.points;a.points=j,b.WebGLGraphics.buildLine(a,c),a.points=u}},b.WebGLGraphics.quadraticBezierCurve=function(a,b,c,d,e,f){function o(a,b,c){var d=b-a;return a+d*c}for(var g,h,i,j,k,l,m=20,n=[],p=0,q=0;q<=m;q++)p=q/m,g=o(a,c,p),h=o(b,d,p),i=o(c,e,p),j=o(d,f,p),k=o(g,i,p),l=o(h,j,p),n.push(k,l);return n},b.WebGLGraphics.buildCircle=function(a,c){var g,h,d=a.shape,e=d.x,f=d.y;a.type===b.Graphics.CIRC?(g=d.radius,h=d.radius):(g=d.width,h=d.height);var i=40,j=2*Math.PI/i,k=0;if(a.fill){var l=b.hex2rgb(a.fillColor),m=a.fillAlpha,n=l[0]*m,o=l[1]*m,p=l[2]*m,q=c.points,r=c.indices,s=q.length/6;for(r.push(s),k=0;k<i+1;k++)q.push(e,f,n,o,p,m),q.push(e+Math.sin(j*k)*g,f+Math.cos(j*k)*h,n,o,p,m),r.push(s++,s++);r.push(s-1)}if(a.lineWidth){var t=a.points;for(a.points=[],k=0;k<i+1;k++)a.points.push(e+Math.sin(j*k)*g,f+Math.cos(j*k)*h);b.WebGLGraphics.buildLine(a,c),a.points=t}},b.WebGLGraphics.buildLine=function(a,c){var d=0,e=a.points;if(0!==e.length){if(a.lineWidth%2)for(d=0;d<e.length;d++)e[d]+=.5;var f=new b.Point(e[0],e[1]),g=new b.Point(e[e.length-2],e[e.length-1]);if(f.x===g.x&&f.y===g.y){e=e.slice(),e.pop(),e.pop(),g=new b.Point(e[e.length-2],e[e.length-1]);var h=g.x+.5*(f.x-g.x),i=g.y+.5*(f.y-g.y);e.unshift(h,i),e.push(h,i)}var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,j=c.points,k=c.indices,l=e.length/2,m=e.length,n=j.length/6,o=a.lineWidth/2,p=b.hex2rgb(a.lineColor),q=a.lineAlpha,r=p[0]*q,s=p[1]*q,t=p[2]*q;for(w=e[0],x=e[1],y=e[2],z=e[3],C=-(x-z),D=w-y,Q=Math.sqrt(C*C+D*D),C/=Q,D/=Q,C*=o,D*=o,j.push(w-C,x-D,r,s,t,q),j.push(w+C,x+D,r,s,t,q),d=1;d<l-1;d++)w=e[2*(d-1)],x=e[2*(d-1)+1],y=e[2*d],z=e[2*d+1],A=e[2*(d+1)],B=e[2*(d+1)+1],C=-(x-z),D=w-y,Q=Math.sqrt(C*C+D*D),C/=Q,D/=Q,C*=o,D*=o,E=-(z-B),F=y-A,Q=Math.sqrt(E*E+F*F),E/=Q,F/=Q,E*=o,F*=o,I=-D+x-(-D+z),J=-C+y-(-C+w),K=(-C+w)*(-D+z)-(-C+y)*(-D+x),L=-F+B-(-F+z),M=-E+y-(-E+A),N=(-E+A)*(-F+z)-(-E+y)*(-F+B),O=I*M-L*J,Math.abs(O)<.1?(O+=10.1,j.push(y-C,z-D,r,s,t,q),j.push(y+C,z+D,r,s,t,q)):(u=(J*N-M*K)/O,v=(L*K-I*N)/O,P=(u-y)*(u-y)+(v-z)+(v-z),P>19600?(G=C-E,H=D-F,Q=Math.sqrt(G*G+H*H),G/=Q,H/=Q,G*=o,H*=o,j.push(y-G,z-H),j.push(r,s,t,q),j.push(y+G,z+H),j.push(r,s,t,q),j.push(y-G,z-H),j.push(r,s,t,q),m++):(j.push(u,v),j.push(r,s,t,q),j.push(y-(u-y),z-(v-z)),j.push(r,s,t,q)));for(w=e[2*(l-2)],x=e[2*(l-2)+1],y=e[2*(l-1)],z=e[2*(l-1)+1],C=-(x-z),D=w-y,Q=Math.sqrt(C*C+D*D),C/=Q,D/=Q,C*=o,D*=o,j.push(y-C,z-D),j.push(r,s,t,q),j.push(y+C,z+D),j.push(r,s,t,q),k.push(n),d=0;d<m;d++)k.push(n++);k.push(n-1)}},b.WebGLGraphics.buildComplexPoly=function(a,c){var d=a.points.slice();if(!(d.length<6)){var e=c.indices;c.points=d,c.alpha=a.fillAlpha,c.color=b.hex2rgb(a.fillColor);for(var j,k,f=1/0,g=-(1/0),h=1/0,i=-(1/0),l=0;l<d.length;l+=2)j=d[l],k=d[l+1],f=j<f?j:f,g=j>g?j:g,h=k<h?k:h,i=k>i?k:i;d.push(f,h,g,h,g,i,f,i);var m=d.length/2;for(l=0;l<m;l++)e.push(l)}},b.WebGLGraphics.buildPoly=function(a,c){var d=a.points;if(!(d.length<6)){var e=c.points,f=c.indices,g=d.length/2,h=b.hex2rgb(a.fillColor),i=a.fillAlpha,j=h[0]*i,k=h[1]*i,l=h[2]*i,m=b.PolyK.Triangulate(d),n=e.length/6,o=0;for(o=0;o<m.length;o+=3)f.push(m[o]+n),f.push(m[o]+n),f.push(m[o+1]+n),f.push(m[o+2]+n),f.push(m[o+2]+n);for(o=0;o<g;o++)e.push(d[2*o],d[2*o+1],j,k,l,i)}},b.WebGLGraphics.graphicsDataPool=[],b.WebGLGraphicsData=function(a){this.gl=a,this.color=[0,0,0],this.points=[],this.indices=[],this.lastIndex=0,this.buffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},b.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[],this.lastIndex=0},b.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new Float32Array(this.points),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),a.bufferData(a.ARRAY_BUFFER,this.glPoints,a.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW),this.dirty=!1},b.glContexts=[],b.WebGLRenderer=function(a,c,d){if(d)for(var e in b.defaultRenderOptions)"undefined"==typeof d[e]&&(d[e]=b.defaultRenderOptions[e]);else d=b.defaultRenderOptions;b.defaultRenderer||(b.sayHello("webGL"),b.defaultRenderer=this),this.type=b.WEBGL_RENDERER,this.resolution=d.resolution,this.transparent=d.transparent,this.preserveDrawingBuffer=d.preserveDrawingBuffer,this.clearBeforeRender=d.clearBeforeRender,this.width=a||800,this.height=c||600,this.view=d.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:d.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},this.projection=new b.Point,this.offset=new b.Point(0,0),this.shaderManager=new b.WebGLShaderManager,this.spriteBatch=new b.WebGLSpriteBatch,this.maskManager=new b.WebGLMaskManager,this.filterManager=new b.WebGLFilterManager,this.stencilManager=new b.WebGLStencilManager,this.blendModeManager=new b.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},b.WebGLRenderer.prototype.constructor=b.WebGLRenderer,b.WebGLRenderer.prototype.initContext=function(){var a=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=a,!a)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=a.id=b.WebGLRenderer.glContextId++,b.glContexts[this.glContextId]=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),a.enable(a.BLEND),this.shaderManager.setContext(a),this.spriteBatch.setContext(a),this.maskManager.setContext(a),this.filterManager.setContext(a),this.blendModeManager.setContext(a),this.stencilManager.setContext(a),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},b.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(a.interactive&&a.interactionManager.removeEvents(),this.__stage=a),a.updateTransform();var b=this.gl;a._interactive?a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)):a._interactiveEventsAdded&&(a._interactiveEventsAdded=!1,a.interactionManager.setTarget(this)),b.viewport(0,0,this.width,this.height),b.bindFramebuffer(b.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?b.clearColor(0,0,0,0):b.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1),b.clear(b.COLOR_BUFFER_BIT)),this.renderDisplayObject(a,this.projection)}},b.WebGLRenderer.prototype.renderDisplayObject=function(a,c,d){this.renderSession.blendModeManager.setBlendMode(b.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.projection=c,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,d),a._renderWebGL(this.renderSession),this.spriteBatch.end()},b.WebGLRenderer.prototype.resize=function(a,b){this.width=a*this.resolution,this.height=b*this.resolution,this.view.width=this.width,this.view.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},b.WebGLRenderer.prototype.updateTexture=function(a){if(a.hasLoaded){var c=this.gl;return a._glTextures[c.id]||(a._glTextures[c.id]=c.createTexture()),c.bindTexture(c.TEXTURE_2D,a._glTextures[c.id]),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.source),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),a._powerOf2?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE)),a._dirty[c.id]=!1,a._glTextures[c.id]}},b.WebGLRenderer.prototype.handleContextLost=function(a){a.preventDefault(),this.contextLost=!0},b.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var a in b.TextureCache){var c=b.TextureCache[a].baseTexture;c._glTextures=[]}this.contextLost=!1},b.WebGLRenderer.prototype.destroy=function(){this.view.off("webglcontextlost",this.contextLostBound),this.view.off("webglcontextrestored",this.contextRestoredBound),b.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},b.WebGLRenderer.prototype.mapBlendModes=function(){var a=this.gl;b.blendModesWebGL||(b.blendModesWebGL=[],b.blendModesWebGL[b.blendModes.NORMAL]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.ADD]=[a.SRC_ALPHA,a.DST_ALPHA],b.blendModesWebGL[b.blendModes.MULTIPLY]=[a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SCREEN]=[a.SRC_ALPHA,a.ONE],b.blendModesWebGL[b.blendModes.OVERLAY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.DARKEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.LIGHTEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR_DODGE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR_BURN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.HARD_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SOFT_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.DIFFERENCE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.EXCLUSION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.HUE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SATURATION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.LUMINOSITY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA])},b.WebGLRenderer.glContextId=0,b.WebGLBlendModeManager=function(){this.currentBlendMode=99999},b.WebGLBlendModeManager.prototype.constructor=b.WebGLBlendModeManager,b.WebGLBlendModeManager.prototype.setContext=function(a){this.gl=a},b.WebGLBlendModeManager.prototype.setBlendMode=function(a){if(this.currentBlendMode===a)return!1;this.currentBlendMode=a;var c=b.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(c[0],c[1]),!0},b.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},b.WebGLMaskManager=function(){},b.WebGLMaskManager.prototype.constructor=b.WebGLMaskManager,b.WebGLMaskManager.prototype.setContext=function(a){this.gl=a},b.WebGLMaskManager.prototype.pushMask=function(a,c){var d=c.gl;a.dirty&&b.WebGLGraphics.updateGraphics(a,d),a._webGL[d.id].data.length&&c.stencilManager.pushStencil(a,a._webGL[d.id].data[0],c)},b.WebGLMaskManager.prototype.popMask=function(a,b){var c=this.gl;b.stencilManager.popStencil(a,a._webGL[c.id].data[0],b)},b.WebGLMaskManager.prototype.destroy=function(){this.gl=null},b.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},b.WebGLStencilManager.prototype.setContext=function(a){this.gl=a},b.WebGLStencilManager.prototype.pushStencil=function(a,b,c){var d=this.gl;this.bindGraphics(a,b,c),0===this.stencilStack.length&&(d.enable(d.STENCIL_TEST),d.clear(d.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(b);var e=this.count;d.colorMask(!1,!1,!1,!1),d.stencilFunc(d.ALWAYS,0,255),d.stencilOp(d.KEEP,d.KEEP,d.INVERT),1===b.mode?(d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?(d.stencilFunc(d.EQUAL,255-e,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,e,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(b.indices.length-4)),this.reverse?d.stencilFunc(d.EQUAL,255-(e+1),255):d.stencilFunc(d.EQUAL,e+1,255),this.reverse=!this.reverse):(this.reverse?(d.stencilFunc(d.EQUAL,e,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,255-e,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e+1,255):d.stencilFunc(d.EQUAL,255-(e+1),255)),d.colorMask(!0,!0,!0,!0),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),this.count++},b.WebGLStencilManager.prototype.bindGraphics=function(a,c,d){this._currentGraphics=a;var h,e=this.gl,f=d.projection,g=d.offset;1===c.mode?(h=d.shaderManager.complexPrimitiveShader,d.shaderManager.setShader(h),e.uniformMatrix3fv(h.translationMatrix,!1,a.worldTransform.toArray(!0)),e.uniform2f(h.projectionVector,f.x,-f.y),e.uniform2f(h.offsetVector,-g.x,-g.y),e.uniform3fv(h.tintColor,b.hex2rgb(a.tint)),e.uniform3fv(h.color,c.color),e.uniform1f(h.alpha,a.worldAlpha*c.alpha),e.bindBuffer(e.ARRAY_BUFFER,c.buffer),e.vertexAttribPointer(h.aVertexPosition,2,e.FLOAT,!1,8,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c.indexBuffer)):(h=d.shaderManager.primitiveShader,d.shaderManager.setShader(h),e.uniformMatrix3fv(h.translationMatrix,!1,a.worldTransform.toArray(!0)),e.uniform2f(h.projectionVector,f.x,-f.y),e.uniform2f(h.offsetVector,-g.x,-g.y),e.uniform3fv(h.tintColor,b.hex2rgb(a.tint)),e.uniform1f(h.alpha,a.worldAlpha),e.bindBuffer(e.ARRAY_BUFFER,c.buffer),e.vertexAttribPointer(h.aVertexPosition,2,e.FLOAT,!1,24,0),e.vertexAttribPointer(h.colorAttribute,4,e.FLOAT,!1,24,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c.indexBuffer))},b.WebGLStencilManager.prototype.popStencil=function(a,b,c){var d=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)d.disable(d.STENCIL_TEST);else{var e=this.count;this.bindGraphics(a,b,c),d.colorMask(!1,!1,!1,!1),1===b.mode?(this.reverse=!this.reverse,this.reverse?(d.stencilFunc(d.EQUAL,255-(e+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,e+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(b.indices.length-4)),d.stencilFunc(d.ALWAYS,0,255),d.stencilOp(d.KEEP,d.KEEP,d.INVERT),d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e,255):d.stencilFunc(d.EQUAL,255-e,255)):(this.reverse?(d.stencilFunc(d.EQUAL,e+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,255-(e+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e,255):d.stencilFunc(d.EQUAL,255-e,255)),d.colorMask(!0,!0,!0,!0),d.stencilOp(d.KEEP,d.KEEP,d.KEEP)}},b.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},b.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var a=0;a<this.maxAttibs;a++)this.attribState[a]=!1;this.stack=[]},b.WebGLShaderManager.prototype.constructor=b.WebGLShaderManager,b.WebGLShaderManager.prototype.setContext=function(a){this.gl=a,this.primitiveShader=new b.PrimitiveShader(a),this.complexPrimitiveShader=new b.ComplexPrimitiveShader(a),this.defaultShader=new b.PixiShader(a),this.fastShader=new b.PixiFastShader(a),this.stripShader=new b.StripShader(a),this.setShader(this.defaultShader)},b.WebGLShaderManager.prototype.setAttribs=function(a){var b;for(b=0;b<this.tempAttribState.length;b++)this.tempAttribState[b]=!1;for(b=0;b<a.length;b++){var c=a[b];this.tempAttribState[c]=!0}var d=this.gl;for(b=0;b<this.attribState.length;b++)this.attribState[b]!==this.tempAttribState[b]&&(this.attribState[b]=this.tempAttribState[b],this.tempAttribState[b]?d.enableVertexAttribArray(b):d.disableVertexAttribArray(b))},b.WebGLShaderManager.prototype.setShader=function(a){return this._currentId!==a._UID&&(this._currentId=a._UID,this.currentShader=a,this.gl.useProgram(a.program),this.setAttribs(a.attributes),!0)},b.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},b.WebGLSpriteBatch=function(){this.vertSize=6,this.size=2e3;var a=4*this.size*this.vertSize,c=6*this.size;this.vertices=new Float32Array(a),this.indices=new Uint16Array(c),this.lastIndexCount=0;for(var d=0,e=0;d<c;d+=6,e+=4)this.indices[d+0]=e+0,this.indices[d+1]=e+1,this.indices[d+2]=e+2,this.indices[d+3]=e+0,this.indices[d+4]=e+2,this.indices[d+5]=e+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new b.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},b.WebGLSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW),this.currentBlendMode=99999;var c=new b.PixiShader(a);c.fragmentSrc=this.defaultShader.fragmentSrc,c.uniforms={},c.init(),this.defaultShader.shaders[a.id]=c},b.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},b.WebGLSpriteBatch.prototype.end=function(){this.flush()},b.WebGLSpriteBatch.prototype.render=function(a){var b=a.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=b.baseTexture);var c=b._uvs;if(c){var i,j,k,l,d=a.worldAlpha,e=a.tint,f=this.vertices,g=a.anchor.x,h=a.anchor.y;if(b.trim){var m=b.trim;j=m.x-g*m.width,i=j+b.crop.width,l=m.y-h*m.height,k=l+b.crop.height}else i=b.frame.width*(1-g),j=b.frame.width*-g,k=b.frame.height*(1-h),l=b.frame.height*-h;var n=4*this.currentBatchSize*this.vertSize,o=b.baseTexture.resolution,p=a.worldTransform,q=p.a/o,r=p.b/o,s=p.c/o,t=p.d/o,u=p.tx,v=p.ty;f[n++]=q*j+s*l+u,f[n++]=t*l+r*j+v,f[n++]=c.x0,f[n++]=c.y0,f[n++]=d,f[n++]=e,f[n++]=q*i+s*l+u,f[n++]=t*l+r*i+v,f[n++]=c.x1,f[n++]=c.y1,f[n++]=d,f[n++]=e,f[n++]=q*i+s*k+u,f[n++]=t*k+r*i+v,f[n++]=c.x2,f[n++]=c.y2,f[n++]=d,f[n++]=e,f[n++]=q*j+s*k+u,f[n++]=t*k+r*j+v,f[n++]=c.x3,f[n++]=c.y3,f[n++]=d,f[n++]=e,this.sprites[this.currentBatchSize++]=a}},b.WebGLSpriteBatch.prototype.renderTilingSprite=function(a){var c=a.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=c.baseTexture),a._uvs||(a._uvs=new b.TextureUvs);var d=a._uvs;a.tilePosition.x%=c.baseTexture.width*a.tileScaleOffset.x,a.tilePosition.y%=c.baseTexture.height*a.tileScaleOffset.y;var e=a.tilePosition.x/(c.baseTexture.width*a.tileScaleOffset.x),f=a.tilePosition.y/(c.baseTexture.height*a.tileScaleOffset.y),g=a.width/c.baseTexture.width/(a.tileScale.x*a.tileScaleOffset.x),h=a.height/c.baseTexture.height/(a.tileScale.y*a.tileScaleOffset.y);d.x0=0-e,d.y0=0-f,d.x1=1*g-e,d.y1=0-f,d.x2=1*g-e,d.y2=1*h-f,d.x3=0-e,d.y3=1*h-f;var i=a.worldAlpha,j=a.tint,k=this.vertices,l=a.width,m=a.height,n=a.anchor.x,o=a.anchor.y,p=l*(1-n),q=l*-n,r=m*(1-o),s=m*-o,t=4*this.currentBatchSize*this.vertSize,u=c.baseTexture.resolution,v=a.worldTransform,w=v.a/u,x=v.b/u,y=v.c/u,z=v.d/u,A=v.tx,B=v.ty;k[t++]=w*q+y*s+A,k[t++]=z*s+x*q+B,k[t++]=d.x0,k[t++]=d.y0,k[t++]=i,k[t++]=j,k[t++]=w*p+y*s+A,k[t++]=z*s+x*p+B,k[t++]=d.x1,k[t++]=d.y1,k[t++]=i,k[t++]=j,k[t++]=w*p+y*r+A,k[t++]=z*r+x*p+B,k[t++]=d.x2,k[t++]=d.y2,k[t++]=i,k[t++]=j,k[t++]=w*q+y*r+A,k[t++]=z*r+x*q+B,k[t++]=d.x3,k[t++]=d.y3,k[t++]=i,k[t++]=j,this.sprites[this.currentBatchSize++]=a},b.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var c,a=this.gl;if(this.dirty){this.dirty=!1,a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),c=this.defaultShader.shaders[a.id];var d=4*this.vertSize;a.vertexAttribPointer(c.aVertexPosition,2,a.FLOAT,!1,d,0),a.vertexAttribPointer(c.aTextureCoord,2,a.FLOAT,!1,d,8),a.vertexAttribPointer(c.colorAttribute,2,a.FLOAT,!1,d,16)}if(this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,e)}for(var f,g,h,p,i=0,j=0,k=null,l=this.renderSession.blendModeManager.currentBlendMode,m=null,n=!1,o=!1,q=0,r=this.currentBatchSize;q<r;q++){if(p=this.sprites[q],f=p.texture.baseTexture,g=p.blendMode,h=p.shader||this.defaultShader,n=l!==g,o=m!==h,(k!==f||n||o)&&(this.renderBatch(k,i,j),j=q,i=0,k=f,n&&(l=g,this.renderSession.blendModeManager.setBlendMode(l)),o)){m=h,c=m.shaders[a.id],c||(c=new b.PixiShader(a),c.fragmentSrc=m.fragmentSrc,c.uniforms=m.uniforms,c.init(),m.shaders[a.id]=c),this.renderSession.shaderManager.setShader(c),c.dirty&&c.syncUniforms();var s=this.renderSession.projection;a.uniform2f(c.projectionVector,s.x,s.y);var t=this.renderSession.offset;a.uniform2f(c.offsetVector,t.x,t.y)}i++}this.renderBatch(k,i,j),this.currentBatchSize=0}},b.WebGLSpriteBatch.prototype.renderBatch=function(a,b,c){if(0!==b){var d=this.gl;a._dirty[d.id]?this.renderSession.renderer.updateTexture(a):d.bindTexture(d.TEXTURE_2D,a._glTextures[d.id]),d.drawElements(d.TRIANGLES,6*b,d.UNSIGNED_SHORT,6*c*2),this.renderSession.drawCount++}},b.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},b.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},b.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},b.WebGLFastSpriteBatch=function(a){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var b=4*this.size*this.vertSize,c=6*this.maxSize;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var d=0,e=0;d<c;d+=6,e+=4)this.indices[d+0]=e+0,this.indices[d+1]=e+1,this.indices[d+2]=e+2,this.indices[d+3]=e+0,this.indices[d+4]=e+2,this.indices[d+5]=e+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(a)},b.WebGLFastSpriteBatch.prototype.constructor=b.WebGLFastSpriteBatch,b.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW)},b.WebGLFastSpriteBatch.prototype.begin=function(a,b){this.renderSession=b,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=a.worldTransform.toArray(!0),this.start()},b.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},b.WebGLFastSpriteBatch.prototype.render=function(a){var b=a.children,c=b[0];if(c.texture._uvs){this.currentBaseTexture=c.texture.baseTexture,c.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(c.blendMode));for(var d=0,e=b.length;d<e;d++)this.renderSprite(b[d]);this.flush()}},b.WebGLFastSpriteBatch.prototype.renderSprite=function(a){if(a.visible&&(a.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=a.texture.baseTexture,a.texture._uvs))){var b,d,e,f,g,h,i,j,c=this.vertices;if(b=a.texture._uvs,d=a.texture.frame.width,e=a.texture.frame.height,a.texture.trim){var k=a.texture.trim;g=k.x-a.anchor.x*k.width,f=g+a.texture.crop.width,i=k.y-a.anchor.y*k.height,h=i+a.texture.crop.height}else f=a.texture.frame.width*(1-a.anchor.x),g=a.texture.frame.width*-a.anchor.x,h=a.texture.frame.height*(1-a.anchor.y),i=a.texture.frame.height*-a.anchor.y;j=4*this.currentBatchSize*this.vertSize,c[j++]=g,c[j++]=i,c[j++]=a.position.x,c[j++]=a.position.y,c[j++]=a.scale.x,c[j++]=a.scale.y,c[j++]=a.rotation,c[j++]=b.x0,c[j++]=b.y1,c[j++]=a.alpha,c[j++]=f,c[j++]=i,c[j++]=a.position.x,c[j++]=a.position.y,c[j++]=a.scale.x,c[j++]=a.scale.y,c[j++]=a.rotation,c[j++]=b.x1,c[j++]=b.y1,c[j++]=a.alpha,c[j++]=f,c[j++]=h,c[j++]=a.position.x,c[j++]=a.position.y,c[j++]=a.scale.x,c[j++]=a.scale.y,c[j++]=a.rotation,c[j++]=b.x2,c[j++]=b.y2,c[j++]=a.alpha,c[j++]=g,c[j++]=h,c[j++]=a.position.x,c[j++]=a.position.y,c[j++]=a.scale.x,c[j++]=a.scale.y,c[j++]=a.rotation,c[j++]=b.x3,c[j++]=b.y3,c[j++]=a.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},b.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var b=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,b)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},b.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},b.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,b.x,b.y),a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0),a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,c,8),a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,c,16),a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,c,24),a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,28),a.vertexAttribPointer(this.shader.colorAttribute,1,a.FLOAT,!1,c,36)},b.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},b.WebGLFilterManager.prototype.constructor=b.WebGLFilterManager,b.WebGLFilterManager.prototype.setContext=function(a){this.gl=a,this.texturePool=[],this.initShaderBuffers()},b.WebGLFilterManager.prototype.begin=function(a,b){this.renderSession=a,this.defaultShader=a.shaderManager.defaultShader;var c=this.renderSession.projection;this.width=2*c.x,this.height=2*-c.y,this.buffer=b},b.WebGLFilterManager.prototype.pushFilter=function(a){var c=this.gl,d=this.renderSession.projection,e=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds(),this.filterStack.push(a);var f=a.filterPasses[0];this.offsetX+=a._filterArea.x,this.offsetY+=a._filterArea.y;var g=this.texturePool.pop();g?g.resize(this.width,this.height):g=new b.FilterTexture(this.gl,this.width,this.height),c.bindTexture(c.TEXTURE_2D,g.texture);var h=a._filterArea,i=f.padding;h.x-=i,h.y-=i,h.width+=2*i,h.height+=2*i,h.x<0&&(h.x=0),h.width>this.width&&(h.width=this.width),h.y<0&&(h.y=0),h.height>this.height&&(h.height=this.height),c.bindFramebuffer(c.FRAMEBUFFER,g.frameBuffer),c.viewport(0,0,h.width,h.height),d.x=h.width/2,d.y=-h.height/2,e.x=-h.x,e.y=-h.y,c.colorMask(!0,!0,!0,!0),c.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT),a._glFilterTexture=g},b.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,c=this.filterStack.pop(),d=c._filterArea,e=c._glFilterTexture,f=this.renderSession.projection,g=this.renderSession.offset;if(c.filterPasses.length>1){a.viewport(0,0,d.width,d.height),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=d.height,this.vertexArray[2]=d.width,this.vertexArray[3]=d.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=d.width,this.vertexArray[7]=0,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=d.width/this.width,this.uvArray[5]=d.height/this.height,this.uvArray[6]=d.width/this.width,this.uvArray[7]=d.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var h=e,i=this.texturePool.pop();i||(i=new b.FilterTexture(this.gl,this.width,this.height)),i.resize(this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.BLEND);for(var j=0;j<c.filterPasses.length-1;j++){var k=c.filterPasses[j];a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,h.texture),this.applyFilterPass(k,d,d.width,d.height);var l=h;h=i,i=l}a.enable(a.BLEND),e=h,this.texturePool.push(i)}var m=c.filterPasses[c.filterPasses.length-1];this.offsetX-=d.x,this.offsetY-=d.y;var n=this.width,o=this.height,p=0,q=0,r=this.buffer;if(0===this.filterStack.length)a.colorMask(!0,!0,!0,!0);else{var s=this.filterStack[this.filterStack.length-1];d=s._filterArea,n=d.width,o=d.height,p=d.x,q=d.y,r=s._glFilterTexture.frameBuffer}f.x=n/2,f.y=-o/2,g.x=p,g.y=q,d=c._filterArea;var t=d.x-p,u=d.y-q;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=t,this.vertexArray[1]=u+d.height,this.vertexArray[2]=t+d.width,this.vertexArray[3]=u+d.height,this.vertexArray[4]=t,this.vertexArray[5]=u,this.vertexArray[6]=t+d.width,this.vertexArray[7]=u,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=d.width/this.width,this.uvArray[5]=d.height/this.height,this.uvArray[6]=d.width/this.width,this.uvArray[7]=d.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray),a.viewport(0,0,n,o),a.bindFramebuffer(a.FRAMEBUFFER,r),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,e.texture),this.applyFilterPass(m,d,n,o),this.texturePool.push(e),c._glFilterTexture=null},b.WebGLFilterManager.prototype.applyFilterPass=function(a,c,d,e){var f=this.gl,g=a.shaders[f.id];g||(g=new b.PixiShader(f),g.fragmentSrc=a.fragmentSrc,g.uniforms=a.uniforms,g.init(),a.shaders[f.id]=g),this.renderSession.shaderManager.setShader(g),f.uniform2f(g.projectionVector,d/2,-e/2),f.uniform2f(g.offsetVector,0,0),a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=this.width,a.uniforms.dimensions.value[1]=this.height,a.uniforms.dimensions.value[2]=this.vertexArray[0],
a.uniforms.dimensions.value[3]=this.vertexArray[5]),g.syncUniforms(),f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer),f.vertexAttribPointer(g.aVertexPosition,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer),f.vertexAttribPointer(g.aTextureCoord,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer),f.vertexAttribPointer(g.colorAttribute,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),this.renderSession.drawCount++},b.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer(),this.uvBuffer=a.createBuffer(),this.colorBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer),a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)},b.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var b=0;b<this.texturePool.length;b++)this.texturePool[b].destroy();this.texturePool=null,a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.uvBuffer),a.deleteBuffer(this.colorBuffer),a.deleteBuffer(this.indexBuffer)},b.FilterTexture=function(a,c,d,e){this.gl=a,this.frameBuffer=a.createFramebuffer(),this.texture=a.createTexture(),e=e||b.scaleModes.DEFAULT,a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e===b.scaleModes.LINEAR?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e===b.scaleModes.LINEAR?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer),a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0),this.renderBuffer=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,this.renderBuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderBuffer),this.resize(c,d)},b.FilterTexture.prototype.constructor=b.FilterTexture,b.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT)},b.FilterTexture.prototype.resize=function(a,b){if(this.width!==a||this.height!==b){this.width=a,this.height=b;var c=this.gl;c.bindTexture(c.TEXTURE_2D,this.texture),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null),c.bindRenderbuffer(c.RENDERBUFFER,this.renderBuffer),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,a,b)}},b.FilterTexture.prototype.destroy=function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer),a.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},b.CanvasBuffer=function(a,b){this.width=a,this.height=b,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=b},b.CanvasBuffer.prototype.constructor=b.CanvasBuffer,b.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},b.CanvasBuffer.prototype.resize=function(a,b){this.width=this.canvas.width=a,this.height=this.canvas.height=b},b.CanvasMaskManager=function(){},b.CanvasMaskManager.prototype.constructor=b.CanvasMaskManager,b.CanvasMaskManager.prototype.pushMask=function(a,c){var d=c.context;d.save();var e=a.alpha,f=a.worldTransform,g=c.resolution;d.setTransform(f.a*g,f.b*g,f.c*g,f.d*g,f.tx*g,f.ty*g),b.CanvasGraphics.renderGraphicsMask(a,d),d.clip(),a.worldAlpha=e},b.CanvasMaskManager.prototype.popMask=function(a){a.context.restore()},b.CanvasTinter=function(){},b.CanvasTinter.getTintedTexture=function(a,c){var d=a.texture;c=b.CanvasTinter.roundColor(c);var e="#"+("00000"+(0|c).toString(16)).substr(-6);if(d.tintCache=d.tintCache||{},d.tintCache[e])return d.tintCache[e];var f=b.CanvasTinter.canvas||document.createElement("canvas");if(b.CanvasTinter.tintMethod(d,c,f),b.CanvasTinter.convertTintToImage){var g=new Image;g.src=f.toDataURL(),d.tintCache[e]=g}else d.tintCache[e]=f,b.CanvasTinter.canvas=null;return f},b.CanvasTinter.tintWithMultiply=function(a,b,c){var d=c.getContext("2d"),e=a.crop;c.width=e.width,c.height=e.height,d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="multiply",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},b.CanvasTinter.tintWithOverlay=function(a,b,c){var d=c.getContext("2d"),e=a.crop;c.width=e.width,c.height=e.height,d.globalCompositeOperation="copy",d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},b.CanvasTinter.tintWithPerPixel=function(a,c,d){var e=d.getContext("2d"),f=a.crop;d.width=f.width,d.height=f.height,e.globalCompositeOperation="copy",e.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);for(var g=b.hex2rgb(c),h=g[0],i=g[1],j=g[2],k=e.getImageData(0,0,f.width,f.height),l=k.data,m=0;m<l.length;m+=4)l[m+0]*=h,l[m+1]*=i,l[m+2]*=j;e.putImageData(k,0,0)},b.CanvasTinter.roundColor=function(a){var c=b.CanvasTinter.cacheStepsPerColorChannel,d=b.hex2rgb(a);return d[0]=Math.min(255,d[0]/c*c),d[1]=Math.min(255,d[1]/c*c),d[2]=Math.min(255,d[2]/c*c),b.rgb2hex(d)},b.CanvasTinter.cacheStepsPerColorChannel=8,b.CanvasTinter.convertTintToImage=!1,b.CanvasTinter.canUseMultiply=b.canUseNewCanvasBlendModes(),b.CanvasTinter.tintMethod=b.CanvasTinter.canUseMultiply?b.CanvasTinter.tintWithMultiply:b.CanvasTinter.tintWithPerPixel,b.CanvasRenderer=function(a,c,d){if(d)for(var e in b.defaultRenderOptions)"undefined"==typeof d[e]&&(d[e]=b.defaultRenderOptions[e]);else d=b.defaultRenderOptions;b.defaultRenderer||(b.sayHello("Canvas"),b.defaultRenderer=this),this.type=b.CANVAS_RENDERER,this.resolution=d.resolution,this.clearBeforeRender=d.clearBeforeRender,this.transparent=d.transparent,this.width=a||800,this.height=c||600,this.width*=this.resolution,this.height*=this.resolution,this.view=d.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new b.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(a,c),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},b.CanvasRenderer.prototype.constructor=b.CanvasRenderer,b.CanvasRenderer.prototype.render=function(a){a.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=b.blendModes.NORMAL,this.context.globalCompositeOperation=b.blendModesCanvas[b.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=a.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(a),a.interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)))},b.CanvasRenderer.prototype.destroy=function(a){"undefined"==typeof a&&(a=!0),a&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},b.CanvasRenderer.prototype.resize=function(a,b){this.width=a*this.resolution,this.height=b*this.resolution,this.view.width=this.width,this.view.height=this.height,this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"},b.CanvasRenderer.prototype.renderDisplayObject=function(a,b){this.renderSession.context=b||this.context,this.renderSession.resolution=this.resolution,a._renderCanvas(this.renderSession)},b.CanvasRenderer.prototype.mapBlendModes=function(){b.blendModesCanvas||(b.blendModesCanvas=[],b.canUseNewCanvasBlendModes()?(b.blendModesCanvas[b.blendModes.NORMAL]="source-over",b.blendModesCanvas[b.blendModes.ADD]="lighter",b.blendModesCanvas[b.blendModes.MULTIPLY]="multiply",b.blendModesCanvas[b.blendModes.SCREEN]="screen",b.blendModesCanvas[b.blendModes.OVERLAY]="overlay",b.blendModesCanvas[b.blendModes.DARKEN]="darken",b.blendModesCanvas[b.blendModes.LIGHTEN]="lighten",b.blendModesCanvas[b.blendModes.COLOR_DODGE]="color-dodge",b.blendModesCanvas[b.blendModes.COLOR_BURN]="color-burn",b.blendModesCanvas[b.blendModes.HARD_LIGHT]="hard-light",b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="soft-light",b.blendModesCanvas[b.blendModes.DIFFERENCE]="difference",b.blendModesCanvas[b.blendModes.EXCLUSION]="exclusion",b.blendModesCanvas[b.blendModes.HUE]="hue",b.blendModesCanvas[b.blendModes.SATURATION]="saturation",b.blendModesCanvas[b.blendModes.COLOR]="color",b.blendModesCanvas[b.blendModes.LUMINOSITY]="luminosity"):(b.blendModesCanvas[b.blendModes.NORMAL]="source-over",b.blendModesCanvas[b.blendModes.ADD]="lighter",b.blendModesCanvas[b.blendModes.MULTIPLY]="source-over",b.blendModesCanvas[b.blendModes.SCREEN]="source-over",b.blendModesCanvas[b.blendModes.OVERLAY]="source-over",b.blendModesCanvas[b.blendModes.DARKEN]="source-over",b.blendModesCanvas[b.blendModes.LIGHTEN]="source-over",b.blendModesCanvas[b.blendModes.COLOR_DODGE]="source-over",b.blendModesCanvas[b.blendModes.COLOR_BURN]="source-over",b.blendModesCanvas[b.blendModes.HARD_LIGHT]="source-over",b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="source-over",b.blendModesCanvas[b.blendModes.DIFFERENCE]="source-over",b.blendModesCanvas[b.blendModes.EXCLUSION]="source-over",b.blendModesCanvas[b.blendModes.HUE]="source-over",b.blendModesCanvas[b.blendModes.SATURATION]="source-over",b.blendModesCanvas[b.blendModes.COLOR]="source-over",b.blendModesCanvas[b.blendModes.LUMINOSITY]="source-over"))},b.CanvasGraphics=function(){},b.CanvasGraphics.renderGraphics=function(a,c){for(var d=a.worldAlpha,e="",f=0;f<a.graphicsData.length;f++){var g=a.graphicsData[f],h=g.shape;if(c.strokeStyle=e="#"+("00000"+(0|g.lineColor).toString(16)).substr(-6),c.lineWidth=g.lineWidth,g.type===b.Graphics.POLY){c.beginPath();var i=h.points;c.moveTo(i[0],i[1]);for(var j=1;j<i.length/2;j++)c.lineTo(i[2*j],i[2*j+1]);h.closed&&c.lineTo(i[0],i[1]),i[0]===i[i.length-2]&&i[1]===i[i.length-1]&&c.closePath(),g.fill&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke())}else if(g.type===b.Graphics.RECT)(g.fillColor||0===g.fillColor)&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fillRect(h.x,h.y,h.width,h.height)),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.strokeRect(h.x,h.y,h.width,h.height));else if(g.type===b.Graphics.CIRC)c.beginPath(),c.arc(h.x,h.y,h.radius,0,2*Math.PI),c.closePath(),g.fill&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke());else if(g.type===b.Graphics.ELIP){var k=2*h.width,l=2*h.height,m=h.x-k/2,n=h.y-l/2;c.beginPath();var o=.5522848,p=k/2*o,q=l/2*o,r=m+k,s=n+l,t=m+k/2,u=n+l/2;c.moveTo(m,u),c.bezierCurveTo(m,u-q,t-p,n,t,n),c.bezierCurveTo(t+p,n,r,u-q,r,u),c.bezierCurveTo(r,u+q,t+p,s,t,s),c.bezierCurveTo(t-p,s,m,u+q,m,u),c.closePath(),g.fill&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke())}else if(g.type===b.Graphics.RREC){var v=h.points,w=v[0],x=v[1],y=v[2],z=v[3],A=v[4],B=Math.min(y,z)/2|0;A=A>B?B:A,c.beginPath(),c.moveTo(w,x+A),c.lineTo(w,x+z-A),c.quadraticCurveTo(w,x+z,w+A,x+z),c.lineTo(w+y-A,x+z),c.quadraticCurveTo(w+y,x+z,w+y,x+z-A),c.lineTo(w+y,x+A),c.quadraticCurveTo(w+y,x,w+y-A,x),c.lineTo(w+A,x),c.quadraticCurveTo(w,x,w,x+A),c.closePath(),(g.fillColor||0===g.fillColor)&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke())}}},b.CanvasGraphics.renderGraphicsMask=function(a,c){var d=a.graphicsData.length;if(0!==d){d>1&&(d=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var e=0;e<1;e++){var f=a.graphicsData[e],g=f.shape;if(f.type===b.Graphics.POLY){c.beginPath();var h=g.points;c.moveTo(h[0],h[1]);for(var i=1;i<h.length/2;i++)c.lineTo(h[2*i],h[2*i+1]);h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&c.closePath()}else if(f.type===b.Graphics.RECT)c.beginPath(),c.rect(g.x,g.y,g.width,g.height),c.closePath();else if(f.type===b.Graphics.CIRC)c.beginPath(),c.arc(g.x,g.y,g.radius,0,2*Math.PI),c.closePath();else if(f.type===b.Graphics.ELIP){var j=2*g.width,k=2*g.height,l=g.x-j/2,m=g.y-k/2;c.beginPath();var n=.5522848,o=j/2*n,p=k/2*n,q=l+j,r=m+k,s=l+j/2,t=m+k/2;c.moveTo(l,t),c.bezierCurveTo(l,t-p,s-o,m,s,m),c.bezierCurveTo(s+o,m,q,t-p,q,t),c.bezierCurveTo(q,t+p,s+o,r,s,r),c.bezierCurveTo(s-o,r,l,t+p,l,t),c.closePath()}else if(f.type===b.Graphics.RREC){var u=g.points,v=u[0],w=u[1],x=u[2],y=u[3],z=u[4],A=Math.min(x,y)/2|0;z=z>A?A:z,c.beginPath(),c.moveTo(v,w+z),c.lineTo(v,w+y-z),c.quadraticCurveTo(v,w+y,v+z,w+y),c.lineTo(v+x-z,w+y),c.quadraticCurveTo(v+x,w+y,v+x,w+y-z),c.lineTo(v+x,w+z),c.quadraticCurveTo(v+x,w,v+x-z,w),c.lineTo(v+z,w),c.quadraticCurveTo(v,w,v,w+z),c.closePath()}}}},b.Graphics=function(){b.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=b.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},b.Graphics.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Graphics.prototype.constructor=b.Graphics,Object.defineProperty(b.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap=a,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),b.Graphics.prototype.lineStyle=function(a,c,d){if(this.lineWidth=a||0,this.lineColor=c||0,this.lineAlpha=arguments.length<3?1:d,this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new b.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha}return this},b.Graphics.prototype.moveTo=function(a,c){return this.drawShape(new b.Polygon([a,c])),this},b.Graphics.prototype.lineTo=function(a,b){return this.currentPath.shape.points.push(a,b),this.dirty=!0,this},b.Graphics.prototype.quadraticCurveTo=function(a,b,c,d){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var e,f,g=20,h=this.currentPath.shape.points;0===h.length&&this.moveTo(0,0);for(var i=h[h.length-2],j=h[h.length-1],k=0,l=1;l<=g;l++)k=l/g,e=i+(a-i)*k,f=j+(b-j)*k,h.push(e+(a+(c-a)*k-e)*k,f+(b+(d-b)*k-f)*k);return this.dirty=!0,this},b.Graphics.prototype.bezierCurveTo=function(a,b,c,d,e,f){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var h,i,j,k,l,g=20,m=this.currentPath.shape.points,n=m[m.length-2],o=m[m.length-1],p=0,q=1;q<=g;q++)p=q/g,h=1-p,i=h*h,j=i*h,k=p*p,l=k*p,m.push(j*n+3*i*p*a+3*h*k*c+l*e,j*o+3*i*p*b+3*h*k*d+l*f);return this.dirty=!0,this},b.Graphics.prototype.arcTo=function(a,b,c,d,e){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[a,b]):this.moveTo(a,b),0===this.currentPath.length&&this.moveTo(a,b);var f=this.currentPath,g=f[f.length-2],h=f[f.length-1],i=h-b,j=g-a,k=d-b,l=c-a,m=Math.abs(i*l-j*k);if(m<1e-8||0===e)f.push(a,b);else{var n=i*i+j*j,o=k*k+l*l,p=i*k+j*l,q=e*Math.sqrt(n)/m,r=e*Math.sqrt(o)/m,s=q*p/n,t=r*p/o,u=q*l+r*j,v=q*k+r*i,w=j*(r+s),x=i*(r+s),y=l*(q+t),z=k*(q+t),A=Math.atan2(x-v,w-u),B=Math.atan2(z-v,y-u);this.arc(u+a,v+b,e,A,B,j*k>l*i)}return this.dirty=!0,this},b.Graphics.prototype.arc=function(a,b,c,d,e,f){var g=a+Math.cos(d)*c,h=b+Math.sin(d)*c,i=this.currentPath.shape.points;if((0!==i.length&&i[i.length-2]!==g||i[i.length-1]!==h)&&(this.moveTo(g,h),i=this.currentPath.shape.points),d===e)return this;!f&&e<=d?e+=2*Math.PI:f&&d<=e&&(d+=2*Math.PI);var j=f?(d-e)*-1:e-d,k=Math.abs(j)/(2*Math.PI)*40;if(0===j)return this;for(var l=j/(2*k),m=2*l,n=Math.cos(l),o=Math.sin(l),p=k-1,q=p%1/p,r=0;r<=p;r++){var s=r+q*r,t=l+d+m*s,u=Math.cos(t),v=-Math.sin(t);i.push((n*u+o*v)*c+a,(n*-v+o*u)*c+b)}return this.dirty=!0,this},b.Graphics.prototype.beginFill=function(a,b){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=void 0===b?1:b,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},b.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},b.Graphics.prototype.drawRect=function(a,c,d,e){return this.drawShape(new b.Rectangle(a,c,d,e)),this},b.Graphics.prototype.drawRoundedRect=function(a,c,d,e,f){return this.drawShape({points:[a,c,d,e,f],type:b.Graphics.RREC}),this},b.Graphics.prototype.drawCircle=function(a,c,d){return this.drawShape(new b.Circle(a,c,d)),this},b.Graphics.prototype.drawEllipse=function(a,c,d,e){return this.drawShape(new b.Ellipse(a,c,d,e)),this},b.Graphics.prototype.drawPolygon=function(a){return a instanceof Array||(a=Array.prototype.slice.call(arguments)),this.drawShape(new b.Polygon(a)),this},b.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},b.Graphics.prototype.generateTexture=function(a,c){a=a||1;var d=this.getBounds(),e=new b.CanvasBuffer(d.width*a,d.height*a),f=b.Texture.fromCanvas(e.canvas,c);return f.baseTexture.resolution=a,e.context.scale(a,a),e.context.translate(-d.x,-d.y),b.CanvasGraphics.renderGraphics(this,e.context),f},b.Graphics.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void b.Sprite.prototype._renderWebGL.call(this._cachedSprite,a);if(a.spriteBatch.stop(),a.blendModeManager.setBlendMode(this.blendMode),this._mask&&a.maskManager.pushMask(this._mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var c=b.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(c[0],c[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),b.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(var d=0,e=this.children.length;d<e;d++)this.children[d]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(this.mask,a),a.drawCount++,a.spriteBatch.start()}},b.Graphics.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void b.Sprite.prototype._renderCanvas.call(this._cachedSprite,a);var c=a.context,d=this.worldTransform;this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a);var e=a.resolution;c.setTransform(d.a*e,d.b*e,d.c*e,d.d*e,d.tx*e,d.ty*e),b.CanvasGraphics.renderGraphics(this,c);for(var f=0,g=this.children.length;f<g;f++)this.children[f]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}},b.Graphics.prototype.getBounds=function(a){this.dirty&&(this.updateBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var b=this._bounds,c=b.x,d=b.width+b.x,e=b.y,f=b.height+b.y,g=a||this.worldTransform,h=g.a,i=g.c,j=g.b,k=g.d,l=g.tx,m=g.ty,n=h*d+j*f+l,o=k*f+i*d+m,p=h*c+j*f+l,q=k*f+i*c+m,r=h*c+j*e+l,s=k*e+i*c+m,t=h*d+j*e+l,u=k*e+i*d+m,v=n,w=o,x=n,y=o;return x=p<x?p:x,x=r<x?r:x,x=t<x?t:x,y=q<y?q:y,y=s<y?s:y,y=u<y?u:y,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w,b.x=x,b.width=v-x,b.y=y,b.height=w-y,b},b.Graphics.prototype.updateBounds=function(){var a=1/0,c=-(1/0),d=1/0,e=-(1/0);if(this.graphicsData.length)for(var f,g,h,i,j,k,l=0;l<this.graphicsData.length;l++){var m=this.graphicsData[l],n=m.type,o=m.lineWidth;if(f=m.shape,n===b.Graphics.RECT||n===b.Graphics.RRECT)h=f.x-o/2,i=f.y-o/2,j=f.width+o,k=f.height+o,a=h<a?h:a,c=h+j>c?h+j:c,d=i<d?i:d,e=i+k>e?i+k:e;else if(n===b.Graphics.CIRC)h=f.x,i=f.y,j=f.radius+o/2,k=f.radius+o/2,a=h-j<a?h-j:a,c=h+j>c?h+j:c,d=i-k<d?i-k:d,e=i+k>e?i+k:e;else if(n===b.Graphics.ELIP)h=f.x,i=f.y,j=f.width+o/2,k=f.height+o/2,a=h-j<a?h-j:a,c=h+j>c?h+j:c,d=i-k<d?i-k:d,e=i+k>e?i+k:e;else{g=f.points;for(var p=0;p<g.length;p+=2)h=g[p],i=g[p+1],a=h-o<a?h-o:a,c=h+o>c?h+o:c,d=i-o<d?i-o:d,e=i+o>e?i+o:e}}else a=0,c=0,d=0,e=0;var q=this.boundsPadding,r=this._bounds;r.x=a-q,r.width=c-a+2*q,r.y=d-q,r.height=e-d+2*q},b.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var c=new b.CanvasBuffer(a.width,a.height),d=b.Texture.fromCanvas(c.canvas);this._cachedSprite=new b.Sprite(d),this._cachedSprite.buffer=c,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(a.x/a.width),this._cachedSprite.anchor.y=-(a.y/a.height),this._cachedSprite.buffer.context.translate(-a.x,-a.y),this.worldAlpha=1,b.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},b.Graphics.prototype.updateCachedSpriteTexture=function(){var a=this._cachedSprite,b=a.texture,c=a.buffer.canvas;b.baseTexture.width=c.width,b.baseTexture.height=c.height,b.crop.width=b.frame.width=c.width,b.crop.height=b.frame.height=c.height,a._width=c.width,a._height=c.height,b.baseTexture.dirty()},b.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},b.Graphics.prototype.drawShape=function(a){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var c=new b.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,a);return this.graphicsData.push(c),c.type===b.Graphics.POLY&&(c.shape.closed=this.filling,this.currentPath=c),this.dirty=!0,c},b.GraphicsData=function(a,b,c,d,e,f,g){this.lineWidth=a,this.lineColor=b,this.lineAlpha=c,this.fillColor=d,this.fillAlpha=e,this.fill=f,this.shape=g,this.type=g.type},b.Graphics.POLY=0,b.Graphics.RECT=1,b.Graphics.CIRC=2,b.Graphics.ELIP=3,b.Graphics.RREC=4,b.Polygon.prototype.type=b.Graphics.POLY,b.Rectangle.prototype.type=b.Graphics.RECT,b.Circle.prototype.type=b.Graphics.CIRC,b.Ellipse.prototype.type=b.Graphics.ELIP,b.Strip=function(a){b.DisplayObjectContainer.call(this),this.texture=a,this.uvs=new b.Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new b.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new b.Float32Array([1,1,1,1]),this.indices=new b.Uint16Array([0,1,2,3]),this.dirty=!0,this.padding=0},b.Strip.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Strip.prototype.constructor=b.Strip,b.Strip.prototype._renderWebGL=function(a){!this.visible||this.alpha<=0||(a.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(a),a.shaderManager.setShader(a.shaderManager.stripShader),this._renderStrip(a),a.spriteBatch.start())},b.Strip.prototype._initWebGL=function(a){var b=a.gl;this._vertexBuffer=b.createBuffer(),this._indexBuffer=b.createBuffer(),this._uvBuffer=b.createBuffer(),this._colorBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.verticies,b.DYNAMIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.bufferData(b.ARRAY_BUFFER,this.uvs,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,this._colorBuffer),b.bufferData(b.ARRAY_BUFFER,this.colors,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW)},b.Strip.prototype._renderStrip=function(a){var b=a.gl,c=a.projection,d=a.offset,e=a.shaderManager.stripShader;b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA),b.uniformMatrix3fv(e.translationMatrix,!1,this.worldTransform.toArray(!0)),b.uniform2f(e.projectionVector,c.x,-c.y),b.uniform2f(e.offsetVector,-d.x,-d.y),b.uniform1f(e.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.verticies,b.STATIC_DRAW),b.vertexAttribPointer(e.aVertexPosition,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.bufferData(b.ARRAY_BUFFER,this.uvs,b.STATIC_DRAW),b.vertexAttribPointer(e.aTextureCoord,2,b.FLOAT,!1,0,0),b.activeTexture(b.TEXTURE0),this.texture.baseTexture._dirty[b.id]?a.renderer.updateTexture(this.texture.baseTexture):b.bindTexture(b.TEXTURE_2D,this.texture.baseTexture._glTextures[b.id]),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW)):(b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferSubData(b.ARRAY_BUFFER,0,this.verticies),b.vertexAttribPointer(e.aVertexPosition,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.vertexAttribPointer(e.aTextureCoord,2,b.FLOAT,!1,0,0),b.activeTexture(b.TEXTURE0),this.texture.baseTexture._dirty[b.id]?a.renderer.updateTexture(this.texture.baseTexture):b.bindTexture(b.TEXTURE_2D,this.texture.baseTexture._glTextures[b.id]),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),b.drawElements(b.TRIANGLE_STRIP,this.indices.length,b.UNSIGNED_SHORT,0)},b.Strip.prototype._renderCanvas=function(a){var b=a.context,c=this.worldTransform;a.roundPixels?b.setTransform(c.a,c.b,c.c,c.d,0|c.tx,0|c.ty):b.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty);var d=this,e=d.verticies,f=d.uvs,g=e.length/2;this.count++;for(var h=0;h<g-2;h++){var i=2*h,j=e[i],k=e[i+2],l=e[i+4],m=e[i+1],n=e[i+3],o=e[i+5];if(this.padding>0){var p=(j+k+l)/3,q=(m+n+o)/3,r=j-p,s=m-q,t=Math.sqrt(r*r+s*s);j=p+r/t*(t+3),m=q+s/t*(t+3),r=k-p,s=n-q,t=Math.sqrt(r*r+s*s),k=p+r/t*(t+3),n=q+s/t*(t+3),r=l-p,s=o-q,t=Math.sqrt(r*r+s*s),l=p+r/t*(t+3),o=q+s/t*(t+3)}var u=f[i]*d.texture.width,v=f[i+2]*d.texture.width,w=f[i+4]*d.texture.width,x=f[i+1]*d.texture.height,y=f[i+3]*d.texture.height,z=f[i+5]*d.texture.height;b.save(),b.beginPath(),b.moveTo(j,m),b.lineTo(k,n),b.lineTo(l,o),b.closePath(),b.clip();var A=u*y+x*w+v*z-y*w-x*v-u*z,B=j*y+x*l+k*z-y*l-x*k-j*z,C=u*k+j*w+v*l-k*w-j*v-u*l,D=u*y*l+x*k*w+j*v*z-j*y*w-x*v*l-u*k*z,E=m*y+x*o+n*z-y*o-x*n-m*z,F=u*n+m*w+v*o-n*w-m*v-u*o,G=u*y*o+x*n*w+m*v*z-m*y*w-x*v*o-u*n*z;b.transform(B/A,E/A,C/A,F/A,D/A,G/A),b.drawImage(d.texture.baseTexture.source,0,0),b.restore()}},b.Strip.prototype.renderStripFlat=function(a){var b=this.context,c=a.verticies,d=c.length/2;this.count++,b.beginPath();for(var e=1;e<d-2;e++){var f=2*e,g=c[f],h=c[f+2],i=c[f+4],j=c[f+1],k=c[f+3],l=c[f+5];b.moveTo(g,j),b.lineTo(h,k),b.lineTo(i,l)}b.fillStyle="#FF0000",b.fill(),b.closePath()},b.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},b.Rope=function(a,c){b.Strip.call(this,a),this.points=c,this.verticies=new b.Float32Array(4*c.length),this.uvs=new b.Float32Array(4*c.length),this.colors=new b.Float32Array(2*c.length),this.indices=new b.Uint16Array(2*c.length),this.refresh()},b.Rope.prototype=Object.create(b.Strip.prototype),b.Rope.prototype.constructor=b.Rope,b.Rope.prototype.refresh=function(){var a=this.points;if(!(a.length<1)){var b=this.uvs,c=a[0],d=this.indices,e=this.colors;this.count-=.2,b[0]=0,b[1]=0,b[2]=0,b[3]=1,e[0]=1,e[1]=1,d[0]=0,d[1]=1;for(var g,h,i,f=a.length,j=1;j<f;j++)g=a[j],h=4*j,i=j/(f-1),j%2?(b[h]=i,b[h+1]=0,b[h+2]=i,b[h+3]=1):(b[h]=i,b[h+1]=0,b[h+2]=i,b[h+3]=1),h=2*j,e[h]=1,e[h+1]=1,h=2*j,d[h]=h,d[h+1]=h+1,c=g}},b.Rope.prototype.updateTransform=function(){var a=this.points;if(!(a.length<1)){var d,c=a[0],e={x:0,y:0};this.count-=.2;for(var h,i,j,k,l,f=this.verticies,g=a.length,m=0;m<g;m++)h=a[m],i=4*m,d=m<a.length-1?a[m+1]:h,e.y=-(d.x-c.x),e.x=d.y-c.y,j=10*(1-m/(g-1)),j>1&&(j=1),k=Math.sqrt(e.x*e.x+e.y*e.y),l=this.texture.height/2,e.x/=k,e.y/=k,e.x*=l,e.y*=l,f[i]=h.x+e.x,f[i+1]=h.y+e.y,f[i+2]=h.x-e.x,f[i+3]=h.y-e.y,c=h;b.DisplayObjectContainer.prototype.updateTransform.call(this)}},b.Rope.prototype.setTexture=function(a){this.texture=a},b.TilingSprite=function(a,c,d){b.Sprite.call(this,a),this._width=c||100,this._height=d||100,this.tileScale=new b.Point(1,1),this.tileScaleOffset=new b.Point(1,1),this.tilePosition=new b.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=b.blendModes.NORMAL},b.TilingSprite.prototype=Object.create(b.Sprite.prototype),b.TilingSprite.prototype.constructor=b.TilingSprite,Object.defineProperty(b.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}}),Object.defineProperty(b.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}}),b.TilingSprite.prototype.setTexture=function(a){this.texture!==a&&(this.texture=a,this.refreshTexture=!0,this.cachedTint=16777215)},b.TilingSprite.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha){var c,d;for(this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(b.updateWebGLTexture(this.tilingTexture.baseTexture,a.gl),this.tilingTexture.needsUpdate=!1)):a.spriteBatch.renderTilingSprite(this),c=0,d=this.children.length;c<d;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop(),this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(this._mask,a),a.spriteBatch.start()}},b.TilingSprite.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){var c=a.context;this._mask&&a.maskManager.pushMask(this._mask,c),c.globalAlpha=this.worldAlpha;var e,f,d=this.worldTransform,g=a.resolution;if(c.setTransform(d.a*g,d.c*g,d.b*g,d.d*g,d.tx*g,d.ty*g),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=c.createPattern(this.tilingTexture.baseTexture.source,"repeat");
}this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]);var h=this.tilePosition,i=this.tileScale;for(h.x%=this.tilingTexture.baseTexture.width,h.y%=this.tilingTexture.baseTexture.height,c.scale(i.x,i.y),c.translate(h.x+this.anchor.x*-this._width,h.y+this.anchor.y*-this._height),c.fillStyle=this.__tilePattern,c.fillRect(-h.x,-h.y,this._width/i.x,this._height/i.y),c.scale(1/i.x,1/i.y),c.translate(-h.x+this.anchor.x*this._width,-h.y+this.anchor.y*this._height),this._mask&&a.maskManager.popMask(a.context),e=0,f=this.children.length;e<f;e++)this.children[e]._renderCanvas(a)}},b.TilingSprite.prototype.getBounds=function(){var a=this._width,b=this._height,c=a*(1-this.anchor.x),d=a*-this.anchor.x,e=b*(1-this.anchor.y),f=b*-this.anchor.y,g=this.worldTransform,h=g.a,i=g.c,j=g.b,k=g.d,l=g.tx,m=g.ty,n=h*d+j*f+l,o=k*f+i*d+m,p=h*c+j*f+l,q=k*f+i*c+m,r=h*c+j*e+l,s=k*e+i*c+m,t=h*d+j*e+l,u=k*e+i*d+m,v=-(1/0),w=-(1/0),x=1/0,y=1/0;x=n<x?n:x,x=p<x?p:x,x=r<x?r:x,x=t<x?t:x,y=o<y?o:y,y=q<y?q:y,y=s<y?s:y,y=u<y?u:y,v=n>v?n:v,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w;var z=this._bounds;return z.x=x,z.width=v-x,z.y=y,z.height=w-y,this._currentBounds=z,z},b.TilingSprite.prototype.onTextureUpdate=function(){},b.TilingSprite.prototype.generateTilingTexture=function(a){if(this.texture.baseTexture.hasLoaded){var e,f,c=this.originalTexture||this.texture,d=c.frame,g=d.width!==c.baseTexture.width||d.height!==c.baseTexture.height,h=!1;if(a?(e=b.getNextPowerOfTwo(d.width),f=b.getNextPowerOfTwo(d.height),d.width===e&&d.height===f||(h=!0)):g&&(e=d.width,f=d.height,h=!0),h){var i;this.tilingTexture&&this.tilingTexture.isTiling?(i=this.tilingTexture.canvasBuffer,i.resize(e,f),this.tilingTexture.baseTexture.width=e,this.tilingTexture.baseTexture.height=f,this.tilingTexture.needsUpdate=!0):(i=new b.CanvasBuffer(e,f),this.tilingTexture=b.Texture.fromCanvas(i.canvas),this.tilingTexture.canvasBuffer=i,this.tilingTexture.isTiling=!0),i.context.drawImage(c.baseTexture.source,c.crop.x,c.crop.y,c.crop.width,c.crop.height,0,0,e,f),this.tileScaleOffset.x=d.width/e,this.tileScaleOffset.y=d.height/f}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=c;this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0}};var c={};c.BoneData=function(a,b){this.name=a,this.parent=b},c.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},c.SlotData=function(a,b){this.name=a,this.boneData=b},c.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},c.Bone=function(a,b){this.data=a,this.parent=b,this.setToSetupPose()},c.Bone.yDown=!1,c.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(a,b){var d=this.parent;null!=d?(this.worldX=this.x*d.m00+this.y*d.m01+d.worldX,this.worldY=this.x*d.m10+this.y*d.m11+d.worldY,this.worldScaleX=d.worldScaleX*this.scaleX,this.worldScaleY=d.worldScaleY*this.scaleY,this.worldRotation=d.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var e=this.worldRotation*Math.PI/180,f=Math.cos(e),g=Math.sin(e);this.m00=f*this.worldScaleX,this.m10=g*this.worldScaleX,this.m01=-g*this.worldScaleY,this.m11=f*this.worldScaleY,a&&(this.m00=-this.m00,this.m01=-this.m01),b&&(this.m10=-this.m10,this.m11=-this.m11),c.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var a=this.data;this.x=a.x,this.y=a.y,this.rotation=a.rotation,this.scaleX=a.scaleX,this.scaleY=a.scaleY}},c.Slot=function(a,b,c){this.data=a,this.skeleton=b,this.bone=c,this.setToSetupPose()},c.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(a){this.attachment=a,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(a){this._attachmentTime=this.skeleton.time-a},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var a=this.data;this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a;for(var b=this.skeleton.data.slots,c=0,d=b.length;c<d;c++)if(b[c]==a){this.setAttachment(a.attachmentName?this.skeleton.getAttachmentBySlotIndex(c,a.attachmentName):null);break}}},c.Skin=function(a){this.name=a,this.attachments={}},c.Skin.prototype={addAttachment:function(a,b,c){this.attachments[a+":"+b]=c},getAttachment:function(a,b){return this.attachments[a+":"+b]},_attachAll:function(a,b){for(var c in b.attachments){var d=c.indexOf(":"),e=parseInt(c.substring(0,d),10),f=c.substring(d+1),g=a.slots[e];if(g.attachment&&g.attachment.name==f){var h=this.getAttachment(e,f);h&&g.setAttachment(h)}}}},c.Animation=function(a,b,c){this.name=a,this.timelines=b,this.duration=c},c.Animation.prototype={apply:function(a,b,c){c&&this.duration&&(b%=this.duration);for(var d=this.timelines,e=0,f=d.length;e<f;e++)d[e].apply(a,b,1)},mix:function(a,b,c,d){c&&this.duration&&(b%=this.duration);for(var e=this.timelines,f=0,g=e.length;f<g;f++)e[f].apply(a,b,d)}},c.binarySearch=function(a,b,c){var d=0,e=Math.floor(a.length/c)-2;if(!e)return c;for(var f=e>>>1;;){if(a[(f+1)*c]<=b?d=f+1:e=f,d==e)return(d+1)*c;f=d+e>>>1}},c.linearSearch=function(a,b,c){for(var d=0,e=a.length-c;d<=e;d+=c)if(a[d]>b)return d;return-1},c.Curves=function(a){this.curves=[],this.curves.length=6*(a-1)},c.Curves.prototype={setLinear:function(a){this.curves[6*a]=0},setStepped:function(a){this.curves[6*a]=-1},setCurve:function(a,b,c,d,e){var f=.1,g=f*f,h=g*f,i=3*f,j=3*g,k=6*g,l=6*h,m=2*-b+d,n=2*-c+e,o=3*(b-d)+1,p=3*(c-e)+1,q=6*a,r=this.curves;r[q]=b*i+m*j+o*h,r[q+1]=c*i+n*j+p*h,r[q+2]=m*k+o*l,r[q+3]=n*k+p*l,r[q+4]=o*l,r[q+5]=p*l},getCurvePercent:function(a,b){b=b<0?0:b>1?1:b;var c=6*a,d=this.curves,e=d[c];if(!e)return b;if(e==-1)return 0;for(var f=d[c+1],g=d[c+2],h=d[c+3],i=d[c+4],j=d[c+5],k=e,l=f,m=8;;){if(k>=b){var n=k-e,o=l-f;return o+(l-o)*(b-n)/(k-n)}if(!m)break;m--,e+=g,f+=h,g+=i,h+=j,k+=e,l+=f}return l+(1-l)*(b-k)/(1-k)}},c.RotateTimeline=function(a){this.curves=new c.Curves(a),this.frames=[],this.frames.length=2*a},c.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(a,b,c){a*=2,this.frames[a]=b,this.frames[a+1]=c},apply:function(a,b,d){var f,e=this.frames;if(!(b<e[0])){var g=a.bones[this.boneIndex];if(b>=e[e.length-2]){for(f=g.data.rotation+e[e.length-1]-g.rotation;f>180;)f-=360;for(;f<-180;)f+=360;return void(g.rotation+=f*d)}var h=c.binarySearch(e,b,2),i=e[h-1],j=e[h],k=1-(b-j)/(e[h-2]-j);for(k=this.curves.getCurvePercent(h/2-1,k),f=e[h+1]-i;f>180;)f-=360;for(;f<-180;)f+=360;for(f=g.data.rotation+(i+f*k)-g.rotation;f>180;)f-=360;for(;f<-180;)f+=360;g.rotation+=f*d}}},c.TranslateTimeline=function(a){this.curves=new c.Curves(a),this.frames=[],this.frames.length=3*a},c.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d},apply:function(a,b,d){var e=this.frames;if(!(b<e[0])){var f=a.bones[this.boneIndex];if(b>=e[e.length-3])return f.x+=(f.data.x+e[e.length-2]-f.x)*d,void(f.y+=(f.data.y+e[e.length-1]-f.y)*d);var g=c.binarySearch(e,b,3),h=e[g-2],i=e[g-1],j=e[g],k=1-(b-j)/(e[g+-3]-j);k=this.curves.getCurvePercent(g/3-1,k),f.x+=(f.data.x+h+(e[g+1]-h)*k-f.x)*d,f.y+=(f.data.y+i+(e[g+2]-i)*k-f.y)*d}}},c.ScaleTimeline=function(a){this.curves=new c.Curves(a),this.frames=[],this.frames.length=3*a},c.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d},apply:function(a,b,d){var e=this.frames;if(!(b<e[0])){var f=a.bones[this.boneIndex];if(b>=e[e.length-3])return f.scaleX+=(f.data.scaleX-1+e[e.length-2]-f.scaleX)*d,void(f.scaleY+=(f.data.scaleY-1+e[e.length-1]-f.scaleY)*d);var g=c.binarySearch(e,b,3),h=e[g-2],i=e[g-1],j=e[g],k=1-(b-j)/(e[g+-3]-j);k=this.curves.getCurvePercent(g/3-1,k),f.scaleX+=(f.data.scaleX-1+h+(e[g+1]-h)*k-f.scaleX)*d,f.scaleY+=(f.data.scaleY-1+i+(e[g+2]-i)*k-f.scaleY)*d}}},c.ColorTimeline=function(a){this.curves=new c.Curves(a),this.frames=[],this.frames.length=5*a},c.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(a,b,c,d,e,f){a*=5,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d,this.frames[a+3]=e,this.frames[a+4]=f},apply:function(a,b,d){var e=this.frames;if(!(b<e[0])){var f=a.slots[this.slotIndex];if(b>=e[e.length-5]){var g=e.length-1;return f.r=e[g-3],f.g=e[g-2],f.b=e[g-1],void(f.a=e[g])}var h=c.binarySearch(e,b,5),i=e[h-4],j=e[h-3],k=e[h-2],l=e[h-1],m=e[h],n=1-(b-m)/(e[h-5]-m);n=this.curves.getCurvePercent(h/5-1,n);var o=i+(e[h+1]-i)*n,p=j+(e[h+2]-j)*n,q=k+(e[h+3]-k)*n,r=l+(e[h+4]-l)*n;d<1?(f.r+=(o-f.r)*d,f.g+=(p-f.g)*d,f.b+=(q-f.b)*d,f.a+=(r-f.a)*d):(f.r=o,f.g=p,f.b=q,f.a=r)}}},c.AttachmentTimeline=function(a){this.curves=new c.Curves(a),this.frames=[],this.frames.length=a,this.attachmentNames=[],this.attachmentNames.length=a},c.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(a,b,c){this.frames[a]=b,this.attachmentNames[a]=c},apply:function(a,b,d){var e=this.frames;if(!(b<e[0])){var f;f=b>=e[e.length-1]?e.length-1:c.binarySearch(e,b,1)-1;var g=this.attachmentNames[f];a.slots[this.slotIndex].setAttachment(g?a.getAttachmentBySlotIndex(this.slotIndex,g):null)}}},c.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},c.SkeletonData.prototype={defaultSkin:null,findBone:function(a){for(var b=this.bones,c=0,d=b.length;c<d;c++)if(b[c].name==a)return b[c];return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;c<d;c++)if(b[c].name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;c<d;c++)if(b[c].name==a)return slot[c];return null},findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;c<d;c++)if(b[c].name==a)return c;return-1},findSkin:function(a){for(var b=this.skins,c=0,d=b.length;c<d;c++)if(b[c].name==a)return b[c];return null},findAnimation:function(a){for(var b=this.animations,c=0,d=b.length;c<d;c++)if(b[c].name==a)return b[c];return null}},c.Skeleton=function(a){this.data=a,this.bones=[];for(var b=0,d=a.bones.length;b<d;b++){var e=a.bones[b],f=e.parent?this.bones[a.bones.indexOf(e.parent)]:null;this.bones.push(new c.Bone(e,f))}for(this.slots=[],this.drawOrder=[],b=0,d=a.slots.length;b<d;b++){var g=a.slots[b],h=this.bones[a.bones.indexOf(g.boneData)],i=new c.Slot(g,this,h);this.slots.push(i),this.drawOrder.push(i)}},c.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var a=this.flipX,b=this.flipY,c=this.bones,d=0,e=c.length;d<e;d++)c[d].updateWorldTransform(a,b)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var a=this.bones,b=0,c=a.length;b<c;b++)a[b].setToSetupPose()},setSlotsToSetupPose:function(){for(var a=this.slots,b=0,c=a.length;b<c;b++)a[b].setToSetupPose(b)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(a){for(var b=this.bones,c=0,d=b.length;c<d;c++)if(b[c].data.name==a)return b[c];return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;c<d;c++)if(b[c].data.name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;c<d;c++)if(b[c].data.name==a)return b[c];return null},findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;c<d;c++)if(b[c].data.name==a)return c;return-1},setSkinByName:function(a){var b=this.data.findSkin(a);if(!b)throw"Skin not found: "+a;this.setSkin(b)},setSkin:function(a){this.skin&&a&&a._attachAll(this,this.skin),this.skin=a},getAttachmentBySlotName:function(a,b){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(a),b)},getAttachmentBySlotIndex:function(a,b){if(this.skin){var c=this.skin.getAttachment(a,b);if(c)return c}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(a,b):null},setAttachment:function(a,b){for(var c=this.slots,d=0,e=c.size;d<e;d++){var f=c[d];if(f.data.name==a){var g=null;if(b&&(g=this.getAttachment(d,b),null==g))throw"Attachment not found: "+b+", for slot: "+a;return void f.setAttachment(g)}}throw"Slot not found: "+a},update:function(a){time+=a}},c.AttachmentType={region:0},c.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},c.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(a,b,c,d,e){var f=this.uvs;e?(f[2]=a,f[3]=d,f[4]=a,f[5]=b,f[6]=c,f[7]=b,f[0]=c,f[1]=d):(f[0]=a,f[1]=d,f[2]=a,f[3]=b,f[4]=c,f[5]=b,f[6]=c,f[7]=d)},updateOffset:function(){var a=this.width/this.regionOriginalWidth*this.scaleX,b=this.height/this.regionOriginalHeight*this.scaleY,c=-this.width/2*this.scaleX+this.regionOffsetX*a,d=-this.height/2*this.scaleY+this.regionOffsetY*b,e=c+this.regionWidth*a,f=d+this.regionHeight*b,g=this.rotation*Math.PI/180,h=Math.cos(g),i=Math.sin(g),j=c*h+this.x,k=c*i,l=d*h+this.y,m=d*i,n=e*h+this.x,o=e*i,p=f*h+this.y,q=f*i,r=this.offset;r[0]=j-m,r[1]=l+k,r[2]=j-q,r[3]=p+k,r[4]=n-q,r[5]=p+o,r[6]=n-m,r[7]=l+o},computeVertices:function(a,b,c,d){a+=c.worldX,b+=c.worldY;var e=c.m00,f=c.m01,g=c.m10,h=c.m11,i=this.offset;d[0]=i[0]*e+i[1]*f+a,d[1]=i[0]*g+i[1]*h+b,d[2]=i[2]*e+i[3]*f+a,d[3]=i[2]*g+i[3]*h+b,d[4]=i[4]*e+i[5]*f+a,d[5]=i[4]*g+i[5]*h+b,d[6]=i[6]*e+i[7]*f+a,d[7]=i[6]*g+i[7]*h+b}},c.AnimationStateData=function(a){this.skeletonData=a,this.animationToMixTime={}},c.AnimationStateData.prototype={defaultMix:0,setMixByName:function(a,b,c){var d=this.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;var e=this.skeletonData.findAnimation(b);if(!e)throw"Animation not found: "+b;this.setMix(d,e,c)},setMix:function(a,b,c){this.animationToMixTime[a.name+":"+b.name]=c},getMix:function(a,b){var c=this.animationToMixTime[a.name+":"+b.name];return c?c:this.defaultMix}},c.AnimationState=function(a){this.data=a,this.queue=[]},c.AnimationState.prototype={animationSpeed:1,current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(a){if(this.currentTime+=a*this.animationSpeed,this.previousTime+=a,this.mixTime+=a,this.queue.length>0){var b=this.queue[0];this.currentTime>=b.delay&&(this._setAnimation(b.animation,b.loop),this.queue.shift())}},apply:function(a){if(this.current)if(this.previous){this.previous.apply(a,this.previousTime,this.previousLoop);var b=this.mixTime/this.mixDuration;b>=1&&(b=1,this.previous=null),this.current.mix(a,this.currentTime,this.currentLoop,b)}else this.current.apply(a,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(a,b){this.previous=null,a&&this.current&&(this.mixDuration=this.data.getMix(this.current,a),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=a,this.currentLoop=b,this.currentTime=0},setAnimationByName:function(a,b){var c=this.data.skeletonData.findAnimation(a);if(!c)throw"Animation not found: "+a;this.setAnimation(c,b)},setAnimation:function(a,b){this.queue.length=0,this._setAnimation(a,b)},addAnimationByName:function(a,b,c){var d=this.data.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;this.addAnimation(d,b,c)},addAnimation:function(a,b,c){var d={};if(d.animation=a,d.loop=b,!c||c<=0){var e=this.queue.length?this.queue[this.queue.length-1].animation:this.current;c=null!=e?e.duration-this.data.getMix(e,a)+(c||0):0}d.delay=c,this.queue.push(d)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},c.SkeletonJson=function(a){this.attachmentLoader=a},c.SkeletonJson.prototype={scale:1,readSkeletonData:function(a){for(var d,b=new c.SkeletonData,e=a.bones,f=0,g=e.length;f<g;f++){var h=e[f],i=null;if(h.parent&&(i=b.findBone(h.parent),!i))throw"Parent bone not found: "+h.parent;d=new c.BoneData(h.name,i),d.length=(h.length||0)*this.scale,d.x=(h.x||0)*this.scale,d.y=(h.y||0)*this.scale,d.rotation=h.rotation||0,d.scaleX=h.scaleX||1,d.scaleY=h.scaleY||1,b.bones.push(d)}var j=a.slots;for(f=0,g=j.length;f<g;f++){var k=j[f];if(d=b.findBone(k.bone),!d)throw"Slot bone not found: "+k.bone;var l=new c.SlotData(k.name,d),m=k.color;m&&(l.r=c.SkeletonJson.toColor(m,0),l.g=c.SkeletonJson.toColor(m,1),l.b=c.SkeletonJson.toColor(m,2),l.a=c.SkeletonJson.toColor(m,3)),l.attachmentName=k.attachment,b.slots.push(l)}var n=a.skins;for(var o in n)if(n.hasOwnProperty(o)){var p=n[o],q=new c.Skin(o);for(var r in p)if(p.hasOwnProperty(r)){var s=b.findSlotIndex(r),t=p[r];for(var u in t)if(t.hasOwnProperty(u)){var v=this.readAttachment(q,u,t[u]);null!=v&&q.addAttachment(s,u,v)}}b.skins.push(q),"default"==q.name&&(b.defaultSkin=q)}var w=a.animations;for(var x in w)w.hasOwnProperty(x)&&this.readAnimation(x,w[x],b);return b},readAttachment:function(a,b,d){b=d.name||b;var e=c.AttachmentType[d.type||"region"];if(e==c.AttachmentType.region){var f=new c.RegionAttachment;return f.x=(d.x||0)*this.scale,f.y=(d.y||0)*this.scale,f.scaleX=d.scaleX||1,f.scaleY=d.scaleY||1,f.rotation=d.rotation||0,f.width=(d.width||32)*this.scale,f.height=(d.height||32)*this.scale,f.updateOffset(),f.rendererObject={},f.rendererObject.name=b,f.rendererObject.scale={},f.rendererObject.scale.x=f.scaleX,f.rendererObject.scale.y=f.scaleY,f.rendererObject.rotation=-f.rotation*Math.PI/180,f}throw"Unknown attachment type: "+e},readAnimation:function(a,b,d){var g,h,i,j,k,l,m,e=[],f=0,n=b.bones;for(var o in n)if(n.hasOwnProperty(o)){var p=d.findBoneIndex(o);if(p==-1)throw"Bone not found: "+o;var q=n[o];for(i in q)if(q.hasOwnProperty(i))if(k=q[i],"rotate"==i){for(h=new c.RotateTimeline(k.length),h.boneIndex=p,g=0,l=0,m=k.length;l<m;l++)j=k[l],h.setFrame(g,j.time,j.angle),c.SkeletonJson.readCurve(h,g,j),g++;e.push(h),f=Math.max(f,h.frames[2*h.getFrameCount()-2])}else{if("translate"!=i&&"scale"!=i)throw"Invalid timeline type for a bone: "+i+" ("+o+")";var r=1;for("scale"==i?h=new c.ScaleTimeline(k.length):(h=new c.TranslateTimeline(k.length),r=this.scale),h.boneIndex=p,g=0,l=0,m=k.length;l<m;l++){j=k[l];var s=(j.x||0)*r,t=(j.y||0)*r;h.setFrame(g,j.time,s,t),c.SkeletonJson.readCurve(h,g,j),g++}e.push(h),f=Math.max(f,h.frames[3*h.getFrameCount()-3])}}var u=b.slots;for(var v in u)if(u.hasOwnProperty(v)){var w=u[v],x=d.findSlotIndex(v);for(i in w)if(w.hasOwnProperty(i))if(k=w[i],"color"==i){for(h=new c.ColorTimeline(k.length),h.slotIndex=x,g=0,l=0,m=k.length;l<m;l++){j=k[l];var y=j.color,z=c.SkeletonJson.toColor(y,0),A=c.SkeletonJson.toColor(y,1),B=c.SkeletonJson.toColor(y,2),C=c.SkeletonJson.toColor(y,3);h.setFrame(g,j.time,z,A,B,C),c.SkeletonJson.readCurve(h,g,j),g++}e.push(h),f=Math.max(f,h.frames[5*h.getFrameCount()-5])}else{if("attachment"!=i)throw"Invalid timeline type for a slot: "+i+" ("+v+")";for(h=new c.AttachmentTimeline(k.length),h.slotIndex=x,g=0,l=0,m=k.length;l<m;l++)j=k[l],h.setFrame(g++,j.time,j.name);e.push(h),f=Math.max(f,h.frames[h.getFrameCount()-1])}}d.animations.push(new c.Animation(a,e,f))}},c.SkeletonJson.readCurve=function(a,b,c){var d=c.curve;d&&("stepped"==d?a.curves.setStepped(b):d instanceof Array&&a.curves.setCurve(b,d[0],d[1],d[2],d[3]))},c.SkeletonJson.toColor=function(a,b){if(8!=a.length)throw"Color hexidecimal length must be 8, recieved: "+a;return parseInt(a.substr(2*b,2),16)/255},c.Atlas=function(a,b){this.textureLoader=b,this.pages=[],this.regions=[];var d=new c.AtlasReader(a),e=[];e.length=4;for(var f=null;;){var g=d.readLine();if(null==g)break;if(g=d.trim(g),g.length)if(f){var i=new c.AtlasRegion;i.name=g,i.page=f,i.rotate="true"==d.readValue(),d.readTuple(e);var j=parseInt(e[0],10),k=parseInt(e[1],10);d.readTuple(e);var l=parseInt(e[0],10),m=parseInt(e[1],10);i.u=j/f.width,i.v=k/f.height,i.rotate?(i.u2=(j+m)/f.width,i.v2=(k+l)/f.height):(i.u2=(j+l)/f.width,i.v2=(k+m)/f.height),i.x=j,i.y=k,i.width=Math.abs(l),i.height=Math.abs(m),4==d.readTuple(e)&&(i.splits=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10)],4==d.readTuple(e)&&(i.pads=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10)],d.readTuple(e))),i.originalWidth=parseInt(e[0],10),i.originalHeight=parseInt(e[1],10),d.readTuple(e),i.offsetX=parseInt(e[0],10),i.offsetY=parseInt(e[1],10),i.index=parseInt(d.readValue(),10),this.regions.push(i)}else{f=new c.AtlasPage,f.name=g,f.format=c.Atlas.Format[d.readValue()],d.readTuple(e),f.minFilter=c.Atlas.TextureFilter[e[0]],f.magFilter=c.Atlas.TextureFilter[e[1]];var h=d.readValue();f.uWrap=c.Atlas.TextureWrap.clampToEdge,f.vWrap=c.Atlas.TextureWrap.clampToEdge,"x"==h?f.uWrap=c.Atlas.TextureWrap.repeat:"y"==h?f.vWrap=c.Atlas.TextureWrap.repeat:"xy"==h&&(f.uWrap=f.vWrap=c.Atlas.TextureWrap.repeat),b.load(f,g),this.pages.push(f)}else f=null}},c.Atlas.prototype={findRegion:function(a){for(var b=this.regions,c=0,d=b.length;c<d;c++)if(b[c].name==a)return b[c];return null},dispose:function(){for(var a=this.pages,b=0,c=a.length;b<c;b++)this.textureLoader.unload(a[b].rendererObject)},updateUVs:function(a){for(var b=this.regions,c=0,d=b.length;c<d;c++){var e=b[c];e.page==a&&(e.u=e.x/a.width,e.v=e.y/a.height,e.rotate?(e.u2=(e.x+e.height)/a.width,e.v2=(e.y+e.width)/a.height):(e.u2=(e.x+e.width)/a.width,e.v2=(e.y+e.height)/a.height))}}},c.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},c.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},c.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},c.AtlasPage=function(){},c.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},c.AtlasRegion=function(){},c.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},c.AtlasReader=function(a){this.lines=a.split(/\r\n|\r|\n/)},c.AtlasReader.prototype={index:0,trim:function(a){return a.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var a=this.readLine(),b=a.indexOf(":");if(b==-1)throw"Invalid line: "+a;return this.trim(a.substring(b+1))},readTuple:function(a){var b=this.readLine(),c=b.indexOf(":");if(c==-1)throw"Invalid line: "+b;for(var d=0,e=c+1;d<3;d++){var f=b.indexOf(",",e);if(f==-1){if(!d)throw"Invalid line: "+b;break}a[d]=this.trim(b.substr(e,f-e)),e=f+1}return a[d]=this.trim(b.substring(e)),d+1}},c.AtlasAttachmentLoader=function(a){this.atlas=a},c.AtlasAttachmentLoader.prototype={newAttachment:function(a,b,d){switch(b){case c.AttachmentType.region:var e=this.atlas.findRegion(d);if(!e)throw"Region not found in atlas: "+d+" ("+b+")";var f=new c.RegionAttachment(d);return f.rendererObject=e,f.setUVs(e.u,e.v,e.u2,e.v2,e.rotate),f.regionOffsetX=e.offsetX,f.regionOffsetY=e.offsetY,f.regionWidth=e.width,f.regionHeight=e.height,f.regionOriginalWidth=e.originalWidth,f.regionOriginalHeight=e.originalHeight,f}throw"Unknown attachment type: "+b}},c.Bone.yDown=!0,b.AnimCache={},b.Spine=function(a){if(b.DisplayObjectContainer.call(this),this.spineData=b.AnimCache[a],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+a);this.skeleton=new c.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new c.AnimationStateData(this.spineData),this.state=new c.AnimationState(this.stateData),this.slotContainers=[];for(var d=0,e=this.skeleton.drawOrder.length;d<e;d++){var f=this.skeleton.drawOrder[d],g=f.attachment,h=new b.DisplayObjectContainer;if(this.slotContainers.push(h),this.addChild(h),g instanceof c.RegionAttachment){var i=g.rendererObject.name,j=this.createSprite(f,g.rendererObject);f.currentSprite=j,f.currentSpriteName=i,h.addChild(j)}}},b.Spine.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Spine.prototype.constructor=b.Spine,b.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var a=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(a),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var d=this.skeleton.drawOrder,e=0,f=d.length;e<f;e++){var g=d[e],h=g.attachment,i=this.slotContainers[e];if(h instanceof c.RegionAttachment){if(h.rendererObject&&(!g.currentSpriteName||g.currentSpriteName!=h.name)){var j=h.rendererObject.name;if(void 0!==g.currentSprite&&(g.currentSprite.visible=!1),g.sprites=g.sprites||{},void 0!==g.sprites[j])g.sprites[j].visible=!0;else{var k=this.createSprite(g,h.rendererObject);i.addChild(k)}g.currentSprite=g.sprites[j],g.currentSpriteName=j}i.visible=!0;var l=g.bone;i.position.x=l.worldX+h.x*l.m00+h.y*l.m01,i.position.y=l.worldY+h.x*l.m10+h.y*l.m11,i.scale.x=l.worldScaleX,i.scale.y=l.worldScaleY,i.rotation=-(g.bone.worldRotation*Math.PI/180),i.alpha=g.a,g.currentSprite.tint=b.rgb2hex([g.r,g.g,g.b])}else i.visible=!1}b.DisplayObjectContainer.prototype.updateTransform.call(this)},b.Spine.prototype.createSprite=function(a,c){var d=b.TextureCache[c.name]?c.name:c.name+".png",e=new b.Sprite(b.Texture.fromFrame(d));return e.scale=c.scale,e.rotation=c.rotation,e.anchor.x=e.anchor.y=.5,a.sprites=a.sprites||{},a.sprites[c.name]=e,e},b.BaseTextureCache={},b.BaseTextureCacheIdGenerator=0,b.BaseTexture=function(a,c){if(this.resolution=1,this.width=100,this.height=100,this.scaleMode=c||b.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=a,this._UID=b._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[!0,!0,!0,!0],a){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var d=this;this.source.onload=function(){d.hasLoaded=!0,d.width=d.source.naturalWidth||d.source.width,d.height=d.source.naturalHeight||d.source.height,d.dirty(),d.dispatchEvent({type:"loaded",content:d})},this.source.onerror=function(){d.dispatchEvent({type:"error",content:d})}}this.imageUrl=null,this._powerOf2=!1}},b.BaseTexture.prototype.constructor=b.BaseTexture,b.EventTarget.mixin(b.BaseTexture.prototype),b.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete b.BaseTextureCache[this.imageUrl],delete b.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=""):this.source&&this.source._pixiId&&delete b.BaseTextureCache[this.source._pixiId],this.source=null;for(var a=this._glTextures.length-1;a>=0;a--){var c=this._glTextures[a],d=b.glContexts[a];d&&c&&d.deleteTexture(c)}this._glTextures.length=0},b.BaseTexture.prototype.updateSourceImage=function(a){this.hasLoaded=!1,this.source.src=null,this.source.src=a},b.BaseTexture.prototype.dirty=function(){for(var a=0;a<this._glTextures.length;a++)this._dirty[a]=!0},b.BaseTexture.fromImage=function(a,c,d){var e=b.BaseTextureCache[a];if(void 0===c&&a.indexOf("data:")===-1&&(c=!0),!e){var f=new Image;c&&(f.crossOrigin=""),f.src=a,e=new b.BaseTexture(f,d),e.imageUrl=a,b.BaseTextureCache[a]=e,a.indexOf(b.RETINA_PREFIX+".")!==-1&&(e.resolution=2)}return e},b.BaseTexture.fromCanvas=function(a,c){a._pixiId||(a._pixiId="canvas_"+b.TextureCacheIdGenerator++);var d=b.BaseTextureCache[a._pixiId];return d||(d=new b.BaseTexture(a,c),b.BaseTextureCache[a._pixiId]=d),d},b.TextureCache={},b.FrameCache={},b.TextureCacheIdGenerator=0,b.Texture=function(a,c,d,e){this.noFrame=!1,c||(this.noFrame=!0,c=new b.Rectangle(0,0,1,1)),a instanceof b.Texture&&(a=a.baseTexture),this.baseTexture=a,this.frame=c,this.trim=e,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=d||new b.Rectangle(0,0,1,1),a.hasLoaded?(this.noFrame&&(c=new b.Rectangle(0,0,a.width,a.height)),this.setFrame(c)):a.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))},b.Texture.prototype.constructor=b.Texture,b.EventTarget.mixin(b.Texture.prototype),b.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;a.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new b.Rectangle(0,0,a.width,a.height)),this.setFrame(this.frame),this.dispatchEvent({type:"update",content:this})},b.Texture.prototype.destroy=function(a){a&&this.baseTexture.destroy(),this.valid=!1},b.Texture.prototype.setFrame=function(a){if(this.noFrame=!1,this.frame=a,this.width=a.width,this.height=a.height,this.crop.x=a.x,this.crop.y=a.y,this.crop.width=a.width,this.crop.height=a.height,!this.trim&&(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=a&&a.width&&a.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},b.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new b.TextureUvs);var a=this.crop,c=this.baseTexture.width,d=this.baseTexture.height;this._uvs.x0=a.x/c,this._uvs.y0=a.y/d,this._uvs.x1=(a.x+a.width)/c,this._uvs.y1=a.y/d,this._uvs.x2=(a.x+a.width)/c,this._uvs.y2=(a.y+a.height)/d,this._uvs.x3=a.x/c,this._uvs.y3=(a.y+a.height)/d},b.Texture.fromImage=function(a,c,d){var e=b.TextureCache[a];return e||(e=new b.Texture(b.BaseTexture.fromImage(a,c,d)),b.TextureCache[a]=e),e},b.Texture.fromFrame=function(a){var c=b.TextureCache[a];if(!c)throw new Error('The frameId "'+a+'" does not exist in the texture cache ');return c},b.Texture.fromCanvas=function(a,c){var d=b.BaseTexture.fromCanvas(a,c);return new b.Texture(d)},b.Texture.addTextureToCache=function(a,c){b.TextureCache[c]=a},b.Texture.removeTextureFromCache=function(a){var c=b.TextureCache[a];return delete b.TextureCache[a],delete b.BaseTextureCache[a],c},b.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},b.RenderTexture=function(a,c,d,e,f){if(this.width=a||100,this.height=c||100,this.resolution=f||1,this.frame=new b.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new b.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new b.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=e||b.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,b.Texture.call(this,this.baseTexture,new b.Rectangle(0,0,this.width,this.height)),this.renderer=d||b.defaultRenderer,this.renderer.type===b.WEBGL_RENDERER){var g=this.renderer.gl;this.baseTexture._dirty[g.id]=!1,this.textureBuffer=new b.FilterTexture(g,this.width*this.resolution,this.height*this.resolution,this.baseTexture.scaleMode),this.baseTexture._glTextures[g.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new b.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new b.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},b.RenderTexture.prototype=Object.create(b.Texture.prototype),b.RenderTexture.prototype.constructor=b.RenderTexture,b.RenderTexture.prototype.resize=function(a,c,d){a===this.width&&c===this.height||(this.valid=a>0&&c>0,
this.width=this.frame.width=this.crop.width=a,this.height=this.frame.height=this.crop.height=c,d&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===b.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width*this.resolution,this.height*this.resolution))},b.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===b.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},b.RenderTexture.prototype.renderWebGL=function(a,b,c){if(this.valid){var d=a.worldTransform;d.identity(),d.translate(0,2*this.projection.y),b&&d.append(b),d.scale(1,-1),a.worldAlpha=1;for(var e=a.children,f=0,g=e.length;f<g;f++)e[f].updateTransform();var h=this.renderer.gl;h.viewport(0,0,this.width*this.resolution,this.height*this.resolution),h.bindFramebuffer(h.FRAMEBUFFER,this.textureBuffer.frameBuffer),c&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0}},b.RenderTexture.prototype.renderCanvas=function(a,b,c){if(this.valid){var d=a.worldTransform;d.identity(),b&&d.append(b);for(var e=a.children,f=0,g=e.length;f<g;f++)e[f].updateTransform();c&&this.textureBuffer.clear();var h=this.textureBuffer.context,i=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(a,h),this.renderer.resolution=i}},b.RenderTexture.prototype.getImage=function(){var a=new Image;return a.src=this.getBase64(),a},b.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},b.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===b.WEBGL_RENDERER){var a=this.renderer.gl,c=this.textureBuffer.width,d=this.textureBuffer.height,e=new Uint8Array(4*c*d);a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer),a.readPixels(0,0,c,d,a.RGBA,a.UNSIGNED_BYTE,e),a.bindFramebuffer(a.FRAMEBUFFER,null);for(var f=new b.CanvasBuffer(c,d),g=f.context.getImageData(0,0,c,d),h=g.data,i=0;i<e.length;i+=4){var j=e[i+3];h[i]=e[i]*j,h[i+1]=e[i+1]*j,h[i+2]=e[i+2]*j,h[i+3]=j}return f.context.putImageData(g,0,0),f.canvas}return this.textureBuffer.canvas},b.RenderTexture.tempMatrix=new b.Matrix,b.AssetLoader=function(a,c){this.assetURLs=a,this.crossorigin=c,this.loadersByType={jpg:b.ImageLoader,jpeg:b.ImageLoader,png:b.ImageLoader,gif:b.ImageLoader,webp:b.ImageLoader,json:b.JsonLoader,atlas:b.AtlasLoader,anim:b.SpineLoader,xml:b.BitmapFontLoader,fnt:b.BitmapFontLoader}},b.EventTarget.mixin(b.AssetLoader.prototype),b.AssetLoader.prototype.constructor=b.AssetLoader,b.AssetLoader.prototype._getDataType=function(a){var b="data:",c=a.slice(0,b.length).toLowerCase();if(c===b){var d=a.slice(b.length),e=d.indexOf(",");if(e===-1)return null;var f=d.slice(0,e).split(";")[0];return f&&"text/plain"!==f.toLowerCase()?f.split("/").pop().toLowerCase():"txt"}return null},b.AssetLoader.prototype.load=function(){function b(b){a.onAssetLoaded(b.data.content)}var a=this;this.loadCount=this.assetURLs.length;for(var c=0;c<this.assetURLs.length;c++){var d=this.assetURLs[c],e=this._getDataType(d);e||(e=d.split("?").shift().split(".").pop().toLowerCase());var f=this.loadersByType[e];if(!f)throw new Error(e+" is an unsupported file type");var g=new f(d,this.crossorigin);g.on("loaded",b),g.load()}},b.AssetLoader.prototype.onAssetLoaded=function(a){this.loadCount--,this.emit("onProgress",{content:this,loader:a}),this.onProgress&&this.onProgress(a),this.loadCount||(this.emit("onComplete",{content:this}),this.onComplete&&this.onComplete())},b.JsonLoader=function(a,b){this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.loaded=!1},b.JsonLoader.prototype.constructor=b.JsonLoader,b.EventTarget.mixin(b.JsonLoader.prototype),b.JsonLoader.prototype.load=function(){window.XDomainRequest&&this.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=this.onError.bind(this),this.ajaxRequest.ontimeout=this.onError.bind(this),this.ajaxRequest.onprogress=function(){}):window.XMLHttpRequest?this.ajaxRequest=new window.XMLHttpRequest:this.ajaxRequest=new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onload=this.onJSONLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},b.JsonLoader.prototype.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return void this.onError();if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var a=this.baseUrl+this.json.meta.image,d=new b.ImageLoader(a,this.crossorigin),e=this.json.frames;this.texture=d.texture.baseTexture,d.addEventListener("loaded",this.onLoaded.bind(this));for(var f in e){var g=e[f].frame;if(g){var h=new b.Rectangle(g.x,g.y,g.w,g.h),i=h.clone(),j=null;if(e[f].trimmed){var k=e[f].sourceSize,l=e[f].spriteSourceSize;j=new b.Rectangle(l.x,l.y,k.w,k.h)}b.TextureCache[f]=new b.Texture(this.texture,h,i,j)}}d.load()}else if(this.json.bones){var m=new c.SkeletonJson,n=m.readSkeletonData(this.json);b.AnimCache[this.url]=n,this.onLoaded()}else this.onLoaded()},b.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},b.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},b.AtlasLoader=function(a,b){this.url=a,this.baseUrl=a.replace(/[^\/]*$/,""),this.crossorigin=b,this.loaded=!1},b.AtlasLoader.constructor=b.AtlasLoader,b.EventTarget.mixin(b.AtlasLoader.prototype),b.AtlasLoader.prototype.load=function(){this.ajaxRequest=new b.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},b.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||window.location.href.indexOf("http")===-1){this.atlas={meta:{image:[]},frames:[]};var a=this.ajaxRequest.responseText.split(/\r?\n/),c=-3,d=0,e=null,f=!1,g=0,h=0,i=this.onLoaded.bind(this);for(g=0;g<a.length;g++)if(a[g]=a[g].replace(/^\s+|\s+$/g,""),""===a[g]&&(f=g+1),a[g].length>0){if(f===g)this.atlas.meta.image.push(a[g]),d=this.atlas.meta.image.length-1,this.atlas.frames.push({}),c=-3;else if(c>0)if(c%7===1)null!=e&&(this.atlas.frames[d][e.name]=e),e={name:a[g],frame:{}};else{var j=a[g].split(" ");if(c%7===3)e.frame.x=Number(j[1].replace(",","")),e.frame.y=Number(j[2]);else if(c%7===4)e.frame.w=Number(j[1].replace(",","")),e.frame.h=Number(j[2]);else if(c%7===5){var k={x:0,y:0,w:Number(j[1].replace(",","")),h:Number(j[2])};k.w>e.frame.w||k.h>e.frame.h?(e.trimmed=!0,e.realSize=k):e.trimmed=!1}}c++}if(null!=e&&(this.atlas.frames[d][e.name]=e),this.atlas.meta.image.length>0){for(this.images=[],h=0;h<this.atlas.meta.image.length;h++){var l=this.baseUrl+this.atlas.meta.image[h],m=this.atlas.frames[h];this.images.push(new b.ImageLoader(l,this.crossorigin));for(g in m){var n=m[g].frame;n&&(b.TextureCache[g]=new b.Texture(this.images[h].texture.baseTexture,{x:n.x,y:n.y,width:n.w,height:n.h}),m[g].trimmed&&(b.TextureCache[g].realSize=m[g].realSize,b.TextureCache[g].trim.x=0,b.TextureCache[g].trim.y=0))}}for(this.currentImageId=0,h=0;h<this.images.length;h++)this.images[h].on("loaded",i);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},b.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.emit("loaded",{content:this}))},b.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})},b.SpriteSheetLoader=function(a,b){this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},b.SpriteSheetLoader.prototype.constructor=b.SpriteSheetLoader,b.EventTarget.mixin(b.SpriteSheetLoader.prototype),b.SpriteSheetLoader.prototype.load=function(){var a=this,c=new b.JsonLoader(this.url,this.crossorigin);c.on("loaded",function(b){a.json=b.data.content.json,a.onLoaded()}),c.load()},b.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},b.ImageLoader=function(a,c){this.texture=b.Texture.fromImage(a,c),this.frames=[]},b.ImageLoader.prototype.constructor=b.ImageLoader,b.EventTarget.mixin(b.ImageLoader.prototype),b.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))},b.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},b.ImageLoader.prototype.loadFramedSpriteSheet=function(a,c,d){this.frames=[];for(var e=Math.floor(this.texture.width/a),f=Math.floor(this.texture.height/c),g=0,h=0;h<f;h++)for(var i=0;i<e;i++,g++){var j=new b.Texture(this.texture.baseTexture,{x:i*a,y:h*c,width:a,height:c});this.frames.push(j),d&&(b.TextureCache[d+"-"+g]=j)}this.load()},b.BitmapFontLoader=function(a,b){this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.texture=null},b.BitmapFontLoader.prototype.constructor=b.BitmapFontLoader,b.EventTarget.mixin(b.BitmapFontLoader.prototype),b.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new b.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},b.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||window.location.protocol.indexOf("http")===-1)){var a=this.ajaxRequest.responseXML;if(!a||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var c=new DOMParser;a=c.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var d=document.createElement("div");d.innerHTML=this.ajaxRequest.responseText,a=d}var e=this.baseUrl+a.getElementsByTagName("page")[0].getAttribute("file"),f=new b.ImageLoader(e,this.crossorigin);this.texture=f.texture.baseTexture;var g={},h=a.getElementsByTagName("info")[0],i=a.getElementsByTagName("common")[0];g.font=h.getAttribute("face"),g.size=parseInt(h.getAttribute("size"),10),g.lineHeight=parseInt(i.getAttribute("lineHeight"),10),g.chars={};for(var j=a.getElementsByTagName("char"),k=0;k<j.length;k++){var l=parseInt(j[k].getAttribute("id"),10),m=new b.Rectangle(parseInt(j[k].getAttribute("x"),10),parseInt(j[k].getAttribute("y"),10),parseInt(j[k].getAttribute("width"),10),parseInt(j[k].getAttribute("height"),10));g.chars[l]={xOffset:parseInt(j[k].getAttribute("xoffset"),10),yOffset:parseInt(j[k].getAttribute("yoffset"),10),xAdvance:parseInt(j[k].getAttribute("xadvance"),10),kerning:{},texture:b.TextureCache[l]=new b.Texture(this.texture,m)}}var n=a.getElementsByTagName("kerning");for(k=0;k<n.length;k++){var o=parseInt(n[k].getAttribute("first"),10),p=parseInt(n[k].getAttribute("second"),10),q=parseInt(n[k].getAttribute("amount"),10);g.chars[p].kerning[o]=q}b.BitmapText.fonts[g.font]=g,f.addEventListener("loaded",this.onLoaded.bind(this)),f.load()}},b.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},b.SpineLoader=function(a,b){this.url=a,this.crossorigin=b,this.loaded=!1},b.SpineLoader.prototype.constructor=b.SpineLoader,b.EventTarget.mixin(b.SpineLoader.prototype),b.SpineLoader.prototype.load=function(){var a=this,c=new b.JsonLoader(this.url,this.crossorigin);c.on("loaded",function(b){a.json=b.data.content.json,a.onLoaded()}),c.load()},b.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.emit("loaded",{content:this})},b.AbstractFilter=function(a,b){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=b||{},this.fragmentSrc=a||[]},b.AbstractFilter.prototype.constructor=b.AbstractFilter,b.AbstractFilter.prototype.syncUniforms=function(){for(var a=0,b=this.shaders.length;a<b;a++)this.shaders[a].dirty=!0},b.AlphaMaskFilter=function(a){b.AbstractFilter.call(this),this.passes=[this],a.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:a},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},a.baseTexture.hasLoaded?(this.uniforms.mask.value.x=a.width,this.uniforms.mask.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},b.AlphaMaskFilter.prototype=Object.create(b.AbstractFilter.prototype),b.AlphaMaskFilter.prototype.constructor=b.AlphaMaskFilter,b.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(b.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(a){this.uniforms.mask.value=a}}),b.ColorMatrixFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},b.ColorMatrixFilter.prototype=Object.create(b.AbstractFilter.prototype),b.ColorMatrixFilter.prototype.constructor=b.ColorMatrixFilter,Object.defineProperty(b.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(a){this.uniforms.matrix.value=a}}),b.GrayFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},b.GrayFilter.prototype=Object.create(b.AbstractFilter.prototype),b.GrayFilter.prototype.constructor=b.GrayFilter,Object.defineProperty(b.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(a){this.uniforms.gray.value=a}}),b.DisplacementFilter=function(a){b.AbstractFilter.call(this),this.passes=[this],a.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:a},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},a.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=a.width,this.uniforms.mapDimensions.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},b.DisplacementFilter.prototype=Object.create(b.AbstractFilter.prototype),b.DisplacementFilter.prototype.constructor=b.DisplacementFilter,b.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(b.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(a){this.uniforms.displacementMap.value=a}}),Object.defineProperty(b.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.uniforms.scale.value=a}}),Object.defineProperty(b.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.uniforms.offset.value=a}}),b.PixelateFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},b.PixelateFilter.prototype=Object.create(b.AbstractFilter.prototype),b.PixelateFilter.prototype.constructor=b.PixelateFilter,Object.defineProperty(b.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(a){this.dirty=!0,this.uniforms.pixelSize.value=a}}),b.BlurXFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},b.BlurXFilter.prototype=Object.create(b.AbstractFilter.prototype),b.BlurXFilter.prototype.constructor=b.BlurXFilter,Object.defineProperty(b.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.dirty=!0,this.uniforms.blur.value=1/7e3*a}}),b.BlurYFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},b.BlurYFilter.prototype=Object.create(b.AbstractFilter.prototype),b.BlurYFilter.prototype.constructor=b.BlurYFilter,Object.defineProperty(b.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),b.BlurFilter=function(){this.blurXFilter=new b.BlurXFilter,this.blurYFilter=new b.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},b.BlurFilter.prototype=Object.create(b.AbstractFilter.prototype),b.BlurFilter.prototype.constructor=b.BlurFilter,Object.defineProperty(b.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=this.blurYFilter.blur=a}}),Object.defineProperty(b.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=a}}),Object.defineProperty(b.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(a){this.blurYFilter.blur=a}}),b.InvertFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},b.InvertFilter.prototype=Object.create(b.AbstractFilter.prototype),b.InvertFilter.prototype.constructor=b.InvertFilter,Object.defineProperty(b.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(a){this.uniforms.invert.value=a}}),b.SepiaFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},b.SepiaFilter.prototype=Object.create(b.AbstractFilter.prototype),b.SepiaFilter.prototype.constructor=b.SepiaFilter,Object.defineProperty(b.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(a){this.uniforms.sepia.value=a}}),b.TwistFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},b.TwistFilter.prototype=Object.create(b.AbstractFilter.prototype),b.TwistFilter.prototype.constructor=b.TwistFilter,Object.defineProperty(b.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.dirty=!0,this.uniforms.offset.value=a}}),Object.defineProperty(b.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(a){this.dirty=!0,this.uniforms.radius.value=a}}),Object.defineProperty(b.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0,this.uniforms.angle.value=a}}),b.ColorStepFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},b.ColorStepFilter.prototype=Object.create(b.AbstractFilter.prototype),b.ColorStepFilter.prototype.constructor=b.ColorStepFilter,Object.defineProperty(b.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(a){this.uniforms.step.value=a}});b.DotScreenFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]};b.DotScreenFilter.prototype=Object.create(b.AbstractFilter.prototype),b.DotScreenFilter.prototype.constructor=b.DotScreenFilter,Object.defineProperty(b.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.dirty=!0,this.uniforms.scale.value=a}}),Object.defineProperty(b.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0,this.uniforms.angle.value=a}}),b.CrossHatchFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},b.CrossHatchFilter.prototype=Object.create(b.AbstractFilter.prototype),b.CrossHatchFilter.prototype.constructor=b.CrossHatchFilter,Object.defineProperty(b.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),b.RGBSplitFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},b.RGBSplitFilter.prototype=Object.create(b.AbstractFilter.prototype),b.RGBSplitFilter.prototype.constructor=b.RGBSplitFilter,Object.defineProperty(b.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(a){this.uniforms.red.value=a}}),Object.defineProperty(b.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(a){this.uniforms.green.value=a}}),Object.defineProperty(b.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(a){this.uniforms.blue.value=a}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.PIXI=b):"undefined"!=typeof define&&define.amd?define(b):a.PIXI=b}.call(this),function(a,b){var c={},d=null,e=null,f=null,g=document.createElement("span"),h=!!window.getComputedStyle,i=!!document.documentElement.currentStyle,j=!!g.getBoundingClientRect,k=[],l=0,n=";display:none !important;",o=";overflow:hidden; position:relative;",p=function(){var a={},c={},d=["Webkit","O","Moz","ms"],e=h&&g.ownerDocument.defaultView.getComputedStyle(g,null)||g.currentStyle;return function(f,g){if(!h&&!i)return f;if(a[f]===b){for(var j=f.split("-"),k=j[0],l=1;l<j.length;l++)k+=j[l].charAt(0).toUpperCase()+j[l].slice(1);if(a[f]=f+"",c[f]=k+"",!(f in e)){k=k.charAt(0).toUpperCase()+k.slice(1);for(var l=0;l<d.length;l++)if(d[l]+k in e){a[f]="-"+d[l].toLowerCase()+"-"+f,c[f]=d[l]+k;break}}}return g?c[f]:a[f]}}(),q=p("transform",!0),r=p("transform-origin",!0),s=p("box-sizing",!0),t=function(a,b){return{baseTexture:{hasLoaded:!0},frame:{width:a,height:b}}},u=function(b,c){var d=document.createElement("canvas"),e=d.getContext("2d");return d.width=b,d.height=c,e.fillStyle="#fff",e.fillRect(0,0,b,c),e.translate(.5,.5),e.beginPath(),e.lineWidth=1,e.strokeStyle="#f00",e.moveTo(0,c-1),e.lineTo(0,0),e.lineTo(b-1,0),e.lineTo(b-1,c-1),e.lineTo(0,c-1),e.lineTo(b-1,0),e.stroke(),e.closePath(),a.Texture.fromCanvas(d)},v=function(a){return"string"!=typeof a?a:"#"===a.charAt(0)?document.getElementById(a.slice(1)):"<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?(g.innerHTML=a,g.firstChild):document.createElement(a)},w=function(a){return!a.visible||a.alpha<=0||a.stage!==a&&(!a.parent||w(a.parent))};c.Setup=function(a,c,d){if(e=a,f=!!d,(c===b||c)&&a.view.parentNode){var g=document.createElement("div");g.style.cssText+=o,g.style.width=a.view.width+"px",g.style.height=a.view.height+"px";var h=a.resize;a.resize=function(b,c){h.call(a,b,c),g.style.width=a.view.width+"px",g.style.height=a.view.height+"px"},a.view.parentNode.appendChild(g),a.view.parentNode.removeChild(a.view),g.appendChild(a.view),this.setDomContainer(g)}},c.setDomContainer=function(a){d=a},c.Sprite=function(c,e){e=e||{},this.domElement=v(c),this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),
(d||document.body||document.documentElement).appendChild(this.domElement);for(var g in e)"style"!==g?"class"!==g&&"className"!==g?"css"!==g&&"x"!==g&&"y"!==g&&(this.domElement[g]=e[g]):this.domElement.className+=" "+e[g]:this.domElement.style.cssText+=";"+e.style;if(this.domElement.style[s]="border-box",this.domElement.style[r]="0% 0%",f&&(this.domElement.style.opacity=.8),e.css)for(var g in e.css)this.domElement.style[p(g,!0)]="number"==typeof e.css[g]?e.css[g]+"px":e.css[g];var m=null,o=null;!m&&h&&(m=this.domElement.ownerDocument.defaultView.getComputedStyle(this.domElement,null)),!m&&i&&(m=this.domElement.currentStyle),!m&&j?(m=this.domElement.getBoundingClientRect(),m.width=m.right-m.left,m.height=m.bottom-m.top,m.getPropertyValue=function(a){return m[a]||null}):j&&(o=this.domElement.getBoundingClientRect(),o.width=o.right-o.left,o.height=o.bottom-o.top);var q=parseInt(m&&(m.getPropertyValue("width")||m.width)||e.css&&e.css.width||e.width||100)||100,w=parseInt(m&&(m.getPropertyValue("height")||m.height)||e.css&&e.css.height||e.height||30)||30;if(o&&(q<o.width&&(q=o.width),w<o.height&&(w=o.height)),this._anchor=new a.Point(0,0),this._mat="",a.Sprite.call(this,f?u(q,w):t(q,w)),this.width=q,this.height=w,this.position.x=e.x!==b?e.x:parseInt(m&&(m.getPropertyValue("left")||m.left)||e.css&&e.css.left||0)||0,this.position.y=e.y!==b?e.y:parseInt(m&&(m.getPropertyValue("top")||m.top)||e.css&&e.css.top||0)||0,this.domElement.parentNode.removeChild(this.domElement),this.isHidden=!0,this.oldCssText="",this.oldCssText=this.domElement.style.cssText+"",this.domElement.style.cssText=n,k.push(this),l++,e.events){var x=this;for(var g in e.events)this.domElement.addEventListener(g,function(a){return function(){x.isHidden||e.events[a]()}}(g),!1)}},c.Sprite.prototype=Object.create(a.Sprite.prototype),c.Sprite.prototype.constructor=c.Sprite,c.Sprite.prototype._renderDOM=function(){if(!this.isHidden){this._anchor.x===this.anchor.x&&this._anchor.y===this.anchor.y||(this._anchor.x=this.anchor.x,this._anchor.y=this.anchor.y,this.domElement.style[r]=100*this.anchor.y+"% "+100*this.anchor.x+"%");var a="matrix("+this.worldTransform.a+","+this.worldTransform.b+","+this.worldTransform.c+","+this.worldTransform.d+","+this.worldTransform.tx+","+this.worldTransform.ty+")";this._mat!==a&&(this._mat=a,this.domElement.style[q]=a)}},c.Sprite.prototype._oldRenderCanvas=c.Sprite.prototype._renderCanvas,c.Sprite.prototype._renderCanvas=function(a){if(f)return void this._oldRenderCanvas(a);if(this.visible&&!(this.alpha<=0))for(var b=0,c=this.children.length;b<c;b++)this.children[b]._renderCanvas(a)},c.Sprite.prototype._oldRenderWebGL=c.Sprite.prototype._renderWebGL,c.Sprite.prototype._renderWebGL=function(a){if(f)return void this._oldRenderWebGL(a);if(this.visible&&!(this.alpha<=0))for(var b=0,c=this.children.length;b<c;b++)this.children[b]._renderWebGL(a)},c.Sprite.prototype.destroy=function(a){var b=k.indexOf(this);b!==-1&&(k.splice(b,1),l--),this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.parent&&this.parent.removeChild(this),this.texture.destroy&&this.texture.destroy(!!a)};var x=function(){d||c.setDomContainer(document.body);for(var a=0;a<l;a++){var b=k[a],e=b.domElement;b.parent?(b.parent&&!e.parentNode&&d.appendChild(e),w(b)?b.isHidden||(b.oldCssText=e.style.cssText+"",e.style.cssText=n,b.isHidden=!0):(b.isHidden&&(e.style.cssText=b.oldCssText,b.isHidden=!1),b._renderDOM())):e.parentNode&&e.parentNode.removeChild(e)}};a.WebGLRenderer.prototype.oldRender=a.WebGLRenderer.prototype.render,a.WebGLRenderer.prototype.render=function(a){this.oldRender(a),x()},a.CanvasRenderer.prototype.oldRender=a.CanvasRenderer.prototype.render,a.CanvasRenderer.prototype.render=function(a){this.oldRender(a),x()},a.DOM=c,a.DOMSprite=c.Sprite}(PIXI),function(){var a={},b=null,c=!0,d=!1;try{"undefined"!=typeof window.AudioContext?b=new AudioContext:"undefined"!=typeof window.webkitAudioContext?b=new webkitAudioContext:c=("undefined"!=typeof Audio,!1)}catch(a){c=!1}if(!c)if("undefined"!=typeof Audio)try{new Audio}catch(a){d=!0}else d=!0;if(c){var e="undefined"==typeof b.createGain?b.createGainNode():b.createGain();e.gain.value=1,e.connect(b.destination)}var f=function(a){this._volume=1,this._muted=!1,this.usingWebAudio=c,this.ctx=b,this.noAudio=d,this._howls=[],this._codecs=a,this.iOSAutoEnable=!0};f.prototype={volume:function(a){var b=this;if(a=parseFloat(a),a>=0&&a<=1){b._volume=a,c&&(e.gain.value=a);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var f=0;f<b._howls[d]._audioNode.length;f++)b._howls[d]._audioNode[f].volume=b._howls[d]._volume*b._volume;return b}return c?e.gain.value:b._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(a){var b=this;b._muted=a,c&&(e.gain.value=a?0:b._volume);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var f=0;f<b._howls[d]._audioNode.length;f++)b._howls[d]._audioNode[f].muted=a},codecs:function(a){return this._codecs[a]},_enableiOSAudio:function(){var a=this;if(!b||!a._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){a._iOSEnabled=!1;var c=function(){var d=b.createBuffer(1,1,22050),e=b.createBufferSource();e.buffer=d,e.connect(b.destination),"undefined"==typeof e.start?e.noteOn(0):e.start(0),setTimeout(function(){e.playbackState!==e.PLAYING_STATE&&e.playbackState!==e.FINISHED_STATE||(a._iOSEnabled=!0,a.iOSAutoEnable=!1,window.removeEventListener("touchstart",c,!1))},0)};return window.addEventListener("touchstart",c,!1),a}}};var g=null,h={};d||(g=new Audio,h={mp3:!!g.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!g.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!g.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!g.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!g.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(g.canPlayType("audio/x-m4a;")||g.canPlayType("audio/m4a;")||g.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(g.canPlayType("audio/x-mp4;")||g.canPlayType("audio/mp4;")||g.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!g.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var i=new f(h),j=function(a){var d=this;d._autoplay=a.autoplay||!1,d._buffer=a.buffer||!1,d._duration=a.duration||0,d._format=a.format||null,d._loop=a.loop||!1,d._loaded=!1,d._sprite=a.sprite||{},d._src=a.src||"",d._pos3d=a.pos3d||[0,0,-.5],d._volume=void 0!==a.volume?a.volume:1,d._urls=a.urls||[],d._rate=a.rate||1,d._model=a.model||null,d._onload=[a.onload||function(){}],d._onloaderror=[a.onloaderror||function(){}],d._onend=[a.onend||function(){}],d._onpause=[a.onpause||function(){}],d._onplay=[a.onplay||function(){}],d._onendTimer=[],d._webAudio=c&&!d._buffer,d._audioNode=[],d._webAudio&&d._setupAudioNode(),"undefined"!=typeof b&&b&&i.iOSAutoEnable&&i._enableiOSAudio(),i._howls.push(d),d.load()};if(j.prototype={load:function(){var a=this,b=null;if(d)return void a.on("loaderror");for(var c=0;c<a._urls.length;c++){var e,g;if(a._format)e=a._format;else{if(g=a._urls[c],e=/^data:audio\/([^;,]+);/i.exec(g),!e){var j=/MSIE 9/i.test(navigator.userAgent),l=/MSIE 10/i.test(navigator.userAgent),m=/rv:11.0/i.test(navigator.userAgent),n=/rv:12.0/i.test(navigator.userAgent),o=/rv:13.0/i.test(navigator.userAgent);e=j||l||m||n||o?["skipme","skipme"]:/\.([^.]+)$/.exec(g.split("?",1)[0])}if(!e)return void a.on("loaderror");e=e[1].toLowerCase()}if(h[e]){b=a._urls[c];break}}if(!b)return void a.on("loaderror");if(a._src=b,a._webAudio)k(a,b);else{var p=new Audio;p.addEventListener("error",function(){p.error&&4===p.error.code&&(f.noAudio=!0),a.on("loaderror",{type:p.error?p.error.code:0})},!1),a._audioNode.push(p),p.src=b,p._pos=0,p.preload="auto",p.volume=i._muted?0:a._volume*i.volume();var q=function(){a._duration=Math.ceil(10*p.duration)/10,0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1e3*a._duration]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play(),p.removeEventListener("canplaythrough",q,!1)};p.addEventListener("canplaythrough",q,!1),p.load()}return a},urls:function(a){var b=this;return a?(b.stop(),b._urls="string"==typeof a?[a]:a,b._loaded=!1,b.load(),b):b._urls},play:function(a,c){var d=this;return"function"==typeof a&&(c=a),a&&"function"!=typeof a||(a="_default"),d._loaded?d._sprite[a]?(d._inactiveNode(function(e){e._sprite=a;var f=e._pos>0?e._pos:d._sprite[a][0]/1e3,g=0;d._webAudio?(g=d._sprite[a][1]/1e3-e._pos,e._pos>0&&(f=d._sprite[a][0]/1e3+f)):g=d._sprite[a][1]/1e3-(f-d._sprite[a][0]/1e3);var k,h=!(!d._loop&&!d._sprite[a][2]),j="string"==typeof c?c:Math.round(Date.now()*Math.random())+"";if(function(){var b={id:j,sprite:a,loop:h};k=setTimeout(function(){!d._webAudio&&h&&d.stop(b.id).play(a,b.id),d._webAudio&&!h&&(d._nodeById(b.id).paused=!0,d._nodeById(b.id)._pos=0,d._clearEndTimer(b.id)),d._webAudio||h||d.stop(b.id),d.on("end",j)},1e3*g),d._onendTimer.push({timer:k,id:b.id})}(),d._webAudio){var l=d._sprite[a][0]/1e3,m=d._sprite[a][1]/1e3;e.id=j,e.paused=!1,n(d,[h,l,m],j),d._playStart=b.currentTime,e.gain.value=d._volume,"undefined"==typeof e.bufferSource.start?e.bufferSource.noteGrainOn(0,f,g):e.bufferSource.start(0,f,g)}else{if(4!==e.readyState&&(e.readyState||!navigator.isCocoonJS))return d._clearEndTimer(j),function(){var b=d,f=a,g=c,h=e,i=function(){b.play(f,g),h.removeEventListener("canplaythrough",i,!1)};h.addEventListener("canplaythrough",i,!1)}(),d;e.readyState=4,e.id=j,e.currentTime=f,e.muted=i._muted||e.muted,e.volume=d._volume*i.volume(),setTimeout(function(){e.play()},0)}return d.on("play"),"function"==typeof c&&c(j),d}),d):("function"==typeof c&&c(),d):(d.on("load",function(){d.play(a,c)}),d)},pause:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.pause(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):b._activeNode();if(c)if(c._pos=b.pos(null,a),b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0,"undefined"==typeof c.bufferSource.stop?c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else c.pause();return b.on("pause"),b},stop:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.stop(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):b._activeNode();if(c)if(c._pos=0,b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0,"undefined"==typeof c.bufferSource.stop?c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else isNaN(c.duration)||(c.pause(),c.currentTime=0);return b},mute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.mute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=0:c.muted=!0),b},unmute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.unmute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=b._volume:c.muted=!1),b},volume:function(a,b){var c=this;if(a=parseFloat(a),a>=0&&a<=1){if(c._volume=a,!c._loaded)return c.on("play",function(){c.volume(a,b)}),c;var d=b?c._nodeById(b):c._activeNode();return d&&(c._webAudio?d.gain.value=a:d.volume=a*i.volume()),c}return c._volume},loop:function(a){var b=this;return"boolean"==typeof a?(b._loop=a,b):b._loop},sprite:function(a){var b=this;return"object"==typeof a?(b._sprite=a,b):b._sprite},pos:function(a,c){var d=this;if(!d._loaded)return d.on("load",function(){d.pos(a)}),"number"==typeof a?d:d._pos||0;a=parseFloat(a);var e=c?d._nodeById(c):d._activeNode();if(e)return a>=0?(d.pause(c),e._pos=a,d.play(e._sprite,c),d):d._webAudio?e._pos+(b.currentTime-d._playStart):e.currentTime;if(a>=0)return d;for(var f=0;f<d._audioNode.length;f++)if(d._audioNode[f].paused&&4===d._audioNode[f].readyState)return d._webAudio?d._audioNode[f]._pos:d._audioNode[f].currentTime},pos3d:function(a,b,c,d){var e=this;if(b="undefined"!=typeof b&&b?b:0,c="undefined"!=typeof c&&c?c:-.5,!e._loaded)return e.on("play",function(){e.pos3d(a,b,c,d)}),e;if(!(a>=0||a<0))return e._pos3d;if(e._webAudio){var f=d?e._nodeById(d):e._activeNode();f&&(e._pos3d=[a,b,c],f.panner.setPosition(a,b,c),f.panner.panningModel=e._model||"HRTF")}return e},fade:function(a,b,c,d,e){var f=this,g=Math.abs(a-b),h=a>b?"down":"up",i=g/.01,j=c/i;if(!f._loaded)return f.on("load",function(){f.fade(a,b,c,d,e)}),f;f.volume(a,e);for(var k=1;k<=i;k++)!function(){var a=f._volume+("up"===h?.01:-.01)*k,c=Math.round(1e3*a)/1e3,g=b;setTimeout(function(){f.volume(c,e),c===g&&d&&d()},j*k)}()},fadeIn:function(a,b,c){return this.volume(0).play().fade(0,a,b,c)},fadeOut:function(a,b,c,d){var e=this;return e.fade(e._volume,a,b,function(){c&&c(),e.pause(d),e.on("end")},d)},_nodeById:function(a){for(var b=this,c=b._audioNode[0],d=0;d<b._audioNode.length;d++)if(b._audioNode[d].id===a){c=b._audioNode[d];break}return c},_activeNode:function(){for(var a=this,b=null,c=0;c<a._audioNode.length;c++)if(!a._audioNode[c].paused){b=a._audioNode[c];break}return a._drainPool(),b},_inactiveNode:function(a){for(var b=this,c=null,d=0;d<b._audioNode.length;d++)if(b._audioNode[d].paused&&4===b._audioNode[d].readyState){a(b._audioNode[d]),c=!0;break}if(b._drainPool(),!c){var e;if(b._webAudio)e=b._setupAudioNode(),a(e);else{b.load(),e=b._audioNode[b._audioNode.length-1];var f=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",g=function(){e.removeEventListener(f,g,!1),a(e)};e.addEventListener(f,g,!1)}}},_drainPool:function(){var c,a=this,b=0;for(c=0;c<a._audioNode.length;c++)a._audioNode[c].paused&&b++;for(c=a._audioNode.length-1;c>=0&&!(b<=5);c--)a._audioNode[c].paused&&(a._webAudio&&a._audioNode[c].disconnect(0),b--,a._audioNode.splice(c,1))},_clearEndTimer:function(a){for(var b=this,c=0,d=0;d<b._onendTimer.length;d++)if(b._onendTimer[d].id===a){c=d;break}var e=b._onendTimer[c];e&&(clearTimeout(e.timer),b._onendTimer.splice(c,1))},_setupAudioNode:function(){var a=this,c=a._audioNode,d=a._audioNode.length;return c[d]="undefined"==typeof b.createGain?b.createGainNode():b.createGain(),c[d].gain.value=a._volume,c[d].paused=!0,c[d]._pos=0,c[d].readyState=4,c[d].connect(e),c[d].panner=b.createPanner(),c[d].panner.panningModel=a._model||"equalpower",c[d].panner.setPosition(a._pos3d[0],a._pos3d[1],a._pos3d[2]),c[d].panner.connect(c[d]),c[d]},on:function(a,b){var c=this,d=c["_on"+a];if("function"==typeof b)d.push(b);else for(var e=0;e<d.length;e++)b?d[e].call(c,b):d[e].call(c);return c},off:function(a,b){var c=this,d=c["_on"+a],e=b?b.toString():null;if(e){for(var f=0;f<d.length;f++)if(e===d[f].toString()){d.splice(f,1);break}}else c["_on"+a]=[];return c},unload:function(){for(var b=this,c=b._audioNode,d=0;d<b._audioNode.length;d++)c[d].paused||(b.stop(c[d].id),b.on("end",c[d].id)),b._webAudio?c[d].disconnect(0):c[d].src="";for(d=0;d<b._onendTimer.length;d++)clearTimeout(b._onendTimer[d].timer);var e=i._howls.indexOf(b);null!==e&&e>=0&&i._howls.splice(e,1),delete a[b._src],b=null}},c)var k=function(b,c){if(c in a)return b._duration=a[c].duration,void m(b);if(/^data:[^;]+;base64,/.test(c)){for(var d=atob(c.split(",")[1]),e=new Uint8Array(d.length),f=0;f<d.length;++f)e[f]=d.charCodeAt(f);l(e.buffer,b,c)}else{var g=new XMLHttpRequest;g.open("GET",c,!0),g.responseType="arraybuffer",g.onload=function(){l(g.response,b,c)},g.onerror=function(){b._webAudio&&(b._buffer=!0,b._webAudio=!1,b._audioNode=[],delete b._gainNode,delete a[c],b.load())};try{g.send()}catch(a){g.onerror()}}},l=function(c,d,e){b.decodeAudioData(c,function(b){b&&(a[e]=b,m(d,b))},function(a){d.on("loaderror")})},m=function(a,b){a._duration=b?b.duration:a._duration,0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1e3*a._duration]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play()},n=function(c,d,e){var f=c._nodeById(e);f.bufferSource=b.createBufferSource(),f.bufferSource.buffer=a[c._src],f.bufferSource.connect(f.panner),f.bufferSource.loop=d[0],d[0]&&(f.bufferSource.loopStart=d[1],f.bufferSource.loopEnd=d[1]+d[2]),f.bufferSource.playbackRate.value=c._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:i,Howl:j}}),"undefined"!=typeof exports&&(exports.Howler=i,exports.Howl=j),"undefined"!=typeof window&&(window.Howler=i,window.Howl=j)}();var Stats=function(){var a=Date.now(),b=a,c=0,d=1/0,e=0,f=0,g=1/0,h=0,i=0,j=0,k=document.createElement("div");k.id="stats",k.addEventListener("mousedown",function(a){a.preventDefault(),s(++j%2)},!1),k.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",k.appendChild(l);var m=document.createElement("div");m.id="fpsText",m.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="FPS",l.appendChild(m);var n=document.createElement("div");for(n.id="fpsGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(n);74>n.children.length;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#113",n.appendChild(o)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",k.appendChild(p);var q=document.createElement("div");q.id="msText",q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",q.innerHTML="MS",p.appendChild(q);var r=document.createElement("div");for(r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(r);74>r.children.length;)o=document.createElement("span"),o.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(o);var s=function(a){switch(j=a){case 0:l.style.display="block",p.style.display="none";break;case 1:l.style.display="none",p.style.display="block"}};return{REVISION:12,domElement:k,setMode:s,begin:function(){a=Date.now()},end:function(){var j=Date.now();c=j-a,d=Math.min(d,c),e=Math.max(e,c),q.textContent=c+" MS ("+d+"-"+e+")";var k=Math.min(30,30-30*(c/200));return r.appendChild(r.firstChild).style.height=k+"px",i++,j>b+1e3&&(f=Math.round(1e3*i/(j-b)),g=Math.min(g,f),h=Math.max(h,f),m.textContent=f+" FPS ("+g+"-"+h+")",k=Math.min(30,30-30*(f/100)),n.appendChild(n.firstChild).style.height=k+"px",b=j,i=0),j},update:function(){a=this.end()}}};"object"==typeof module&&(module.exports=Stats),function(a,b,c){function g(a){return function(){return this[a]}}function i(a,b){var c=a.split("."),d=h;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d=d[e]?d[e]:d[e]={}:d[e]=b}function j(a,b,c){return a.call.apply(a.bind,arguments)}function k(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function l(a,b,c){return l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?j:k,l.apply(e,arguments)}function n(a,b){this.G=a,this.v=b||a,this.z=this.v.document}function o(a,c,d){a=a.z.getElementsByTagName(c)[0],a||(a=b.documentElement),a&&a.lastChild&&a.insertBefore(d,a.lastChild)}function p(a,b,c){b=b||[],c=c||[];for(var e=a.className.split(/\s+/),g=0;g<b.length;g+=1){for(var h=f,i=0;i<e.length;i+=1)if(b[g]===e[i]){h=d;break}h||e.push(b[g])}for(b=[],g=0;g<e.length;g+=1){for(h=f,i=0;i<c.length;i+=1)if(e[g]===c[i]){h=d;break}h||b.push(e[g])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function q(a,b){for(var c=a.className.split(/\s+/),e=0,g=c.length;e<g;e++)if(c[e]==b)return d;return f}function r(a){var b=a.v.location.protocol;return"about:"==b&&(b=a.G.location.protocol),"https:"==b?"https:":"http:"}function s(a,b){var c=a.createElement("link",{rel:"stylesheet",href:b}),e=f;c.onload=function(){e||(e=d)},c.onerror=function(){e||(e=d)},o(a,"head",c)}function t(b,c,g,h){var i=b.z.getElementsByTagName("head")[0];if(i){var j=b.createElement("script",{src:c}),k=f;return j.onload=j.onreadystatechange=function(){k||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(k=d,g&&g(e),j.onload=j.onreadystatechange=e,"HEAD"==j.parentNode.tagName&&i.removeChild(j))},i.appendChild(j),a.setTimeout(function(){k||(k=d,g&&g(Error("Script load timeout")))},h||5e3),j}return e}function u(a,b,c){this.M=a,this.U=b,this.Aa=c}function v(a,b,c,d){this.d=a!=e?a:e,this.o=b!=e?b:e,this.aa=c!=e?c:e,this.f=d!=e?d:e}function x(a){a=w.exec(a);var b=e,c=e,d=e,f=e;return a&&(a[1]!==e&&a[1]&&(b=parseInt(a[1],10)),a[2]!==e&&a[2]&&(c=parseInt(a[2],10)),a[3]!==e&&a[3]&&(d=parseInt(a[3],10)),a[4]!==e&&a[4]&&(f=/^[0-9]+$/.test(a[4])?parseInt(a[4],10):a[4])),new v(b,c,d,f)}function y(a,b,c,d,e,f,g,h,i,j,k){this.K=a,this.Ga=b,this.za=c,this.fa=d,this.Ea=e,this.ea=f,this.wa=g,this.Fa=h,this.va=i,this.da=j,this.j=k}function z(a,b){this.a=a,this.I=b}function B(a){var b=E(a.a,/(iPod|iPad|iPhone|Android|Windows Phone|BB\d{2}|BlackBerry)/,1);return""!=b?(/BB\d{2}/.test(b)&&(b="BlackBerry"),b):(a=E(a.a,/(Linux|Mac_PowerPC|Macintosh|Windows|CrOS)/,1),""!=a?("Mac_PowerPC"==a&&(a="Macintosh"),a):"Unknown")}function C(a){var b=E(a.a,/(OS X|Windows NT|Android) ([^;)]+)/,2);if(b||(b=E(a.a,/Windows Phone( OS)? ([^;)]+)/,2))||(b=E(a.a,/(iPhone )?OS ([\d_]+)/,2)))return b;if(b=E(a.a,/(?:Linux|CrOS) ([^;)]+)/,1))for(var b=b.split(/\s/),c=0;c<b.length;c+=1)if(/^[\d\._]+$/.test(b[c]))return b[c];return(a=E(a.a,/(BB\d{2}|BlackBerry).*?Version\/([^\s]*)/,2))?a:"Unknown"}function D(a){var b=B(a),c=C(a),d=x(c),e=E(a.a,/AppleWeb(?:K|k)it\/([\d\.\+]+)/,1),g=x(e),h="Unknown",i=new v,j="Unknown",k=f;return/OPR\/[\d.]+/.test(a.a)?h="Opera":-1!=a.a.indexOf("Chrome")||-1!=a.a.indexOf("CrMo")||-1!=a.a.indexOf("CriOS")?h="Chrome":/Silk\/\d/.test(a.a)?h="Silk":"BlackBerry"==b||"Android"==b?h="BuiltinBrowser":-1!=a.a.indexOf("PhantomJS")?h="PhantomJS":-1!=a.a.indexOf("Safari")?h="Safari":-1!=a.a.indexOf("AdobeAIR")&&(h="AdobeAIR"),"BuiltinBrowser"==h?j="Unknown":"Silk"==h?j=E(a.a,/Silk\/([\d\._]+)/,1):"Chrome"==h?j=E(a.a,/(Chrome|CrMo|CriOS)\/([\d\.]+)/,2):-1!=a.a.indexOf("Version/")?j=E(a.a,/Version\/([\d\.\w]+)/,1):"AdobeAIR"==h?j=E(a.a,/AdobeAIR\/([\d\.]+)/,1):"Opera"==h?j=E(a.a,/OPR\/([\d.]+)/,1):"PhantomJS"==h&&(j=E(a.a,/PhantomJS\/([\d.]+)/,1)),i=x(j),k="AdobeAIR"==h?2<i.d||2==i.d&&5<=i.o:"BlackBerry"==b?10<=d.d:"Android"==b?2<d.d||2==d.d&&1<d.o:526<=g.d||525<=g.d&&13<=g.o,new y(h,i,j,"AppleWebKit",g,e,b,d,c,F(a.I),new u(k,536>g.d||536==g.d&&11>g.o,"iPhone"==b||"iPad"==b||"iPod"==b||"Macintosh"==b))}function E(a,b,c){return(a=a.match(b))&&a[c]?a[c]:""}function F(a){if(a.documentMode)return a.documentMode}function G(a){this.ua=a||"-"}function H(a,b){this.K=a,this.V=4,this.L="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.L=c[1],this.V=parseInt(c[2],10))}function I(a){return a.L+a.V}function J(a){var b=4,c="n",d=e;return a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10)))),c+b}function K(a,b,c){this.c=a,this.m=b,this.O=c,this.h="wf",this.g=new G("-")}function L(a){var b=q(a.m,a.g.f(a.h,"active")),c=[],d=[a.g.f(a.h,"loading")];b||c.push(a.g.f(a.h,"inactive")),p(a.m,c,d),M(a,"inactive")}function M(a,b,c){a.O[b]&&(c?a.O[b](c.getName(),I(c)):a.O[b]())}function N(){this.w={}}function O(a,b){this.c=a,this.C=b,this.s=this.c.createElement("span",{"aria-hidden":"true"},this.C)}function P(a,b){var c;c=[];for(var d=b.K.split(/,\s*/),e=0;e<d.length;e++){var f=d[e].replace(/['"]/g,"");-1==f.indexOf(" ")?c.push(f):c.push("'"+f+"'")}c=c.join(","),d="normal",e=b.V+"00","o"===b.L?d="oblique":"i"===b.L&&(d="italic"),a.s.style.cssText="display:block;position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+c+";"+("font-style:"+d+";font-weight:"+e+";")}function Q(a){o(a.c,"body",a.s)}function R(a,b,c,d,f,g,h,i){this.W=a,this.sa=b,this.c=c,this.q=d,this.C=i||"BESbswy",this.j=f,this.F={},this.T=g||5e3,this.Z=h||e,this.B=this.A=e,a=new O(this.c,this.C),Q(a);for(var j in S)S.hasOwnProperty(j)&&(P(a,new H(S[j],I(this.q))),this.F[S[j]]=a.s.offsetWidth);a.remove()}function T(a,b,c){for(var e in S)if(S.hasOwnProperty(e)&&b===a.F[S[e]]&&c===a.F[S[e]])return d;return f}function U(a){var b=a.A.s.offsetWidth,c=a.B.s.offsetWidth;b===a.F.serif&&c===a.F["sans-serif"]||a.j.U&&T(a,b,c)?m()-a.xa>=a.T?a.j.U&&T(a,b,c)&&(a.Z===e||a.Z.hasOwnProperty(a.q.getName()))?V(a,a.W):V(a,a.sa):setTimeout(l(function(){U(this)},a),25):V(a,a.W)}function V(a,b){a.A.remove(),a.B.remove(),b(a.q)}function W(a,b,c,d){this.c=b,this.t=c,this.P=0,this.ba=this.Y=f,this.T=d,this.j=a.j}function X(a,b,c,d,e){if(0===b.length&&e)L(a.t);else for(a.P+=b.length,e&&(a.Y=e),e=0;e<b.length;e++){var f=b[e],g=c[f.getName()],h=a.t,i=f;p(h.m,[h.g.f(h.h,i.getName(),I(i).toString(),"loading")]),M(h,"fontloading",i),new R(l(a.ga,a),l(a.ha,a),a.c,f,a.j,a.T,d,g).start()}}function Y(a){0==--a.P&&a.Y&&(a.ba?(a=a.t,p(a.m,[a.g.f(a.h,"active")],[a.g.f(a.h,"loading"),a.g.f(a.h,"inactive")]),M(a,"active")):L(a.t))}function Z(a){this.G=a,this.u=new N,this.ya=new z(a.navigator.userAgent,a.document),this.a=this.ya.parse(),this.Q=this.R=0}function $(a,b){this.c=a,this.e=b,this.k=[]}function _(a,b){this.c=a,this.e=b,this.k=[]}function aa(a,b){this.c=a,this.e=b}function ba(a,b,c){this.N=a?a:b+ca,this.p=[],this.S=[],this.ca=c||""}function da(a){this.p=a,this.$=[],this.J={}}function ia(a,c){this.a=new z(navigator.userAgent,b).parse(),this.c=a,this.e=c}function ka(a,b){this.c=a,this.e=b,this.k=[]}var d=!0,e=null,f=!1,h=this,m=Date.now||function(){return+new Date};n.prototype.createElement=function(a,b,c){if(a=this.z.createElement(a),b)for(var d in b)b.hasOwnProperty(d)&&("style"==d?a.style.cssText=b[d]:a.setAttribute(d,b[d]));return c&&a.appendChild(this.z.createTextNode(c)),a},i("webfont.BrowserInfo",u),u.prototype.pa=g("M"),u.prototype.hasWebFontSupport=u.prototype.pa,u.prototype.qa=g("U"),u.prototype.hasWebKitFallbackBug=u.prototype.qa,u.prototype.ra=g("Aa"),u.prototype.hasWebKitMetricsBug=u.prototype.ra;var w=/^([0-9]+)(?:[\._-]([0-9]+))?(?:[\._-]([0-9]+))?(?:[\._+-]?(.*))?$/;v.prototype.toString=function(){return[this.d,this.o||"",this.aa||"",this.f||""].join("")},i("webfont.UserAgent",y),y.prototype.getName=g("K"),y.prototype.getName=y.prototype.getName,y.prototype.oa=g("za"),y.prototype.getVersion=y.prototype.oa,y.prototype.ka=g("fa"),y.prototype.getEngine=y.prototype.ka,y.prototype.la=g("ea"),y.prototype.getEngineVersion=y.prototype.la,y.prototype.ma=g("wa"),y.prototype.getPlatform=y.prototype.ma,y.prototype.na=g("va"),y.prototype.getPlatformVersion=y.prototype.na,y.prototype.ja=g("da"),y.prototype.getDocumentMode=y.prototype.ja,y.prototype.ia=g("j"),y.prototype.getBrowserInfo=y.prototype.ia;var A=new y("Unknown",new v,"Unknown","Unknown",new v,"Unknown","Unknown",new v,"Unknown",(void 0),new u(f,f,f));z.prototype.parse=function(){var a;if(-1!=this.a.indexOf("MSIE")||-1!=this.a.indexOf("Trident/")){a=B(this);var b=C(this),c=x(b),d=e,g=e,h=e,i=e,j=E(this.a,/Trident\/([\d\w\.]+)/,1),k=F(this.I),d=-1!=this.a.indexOf("MSIE")?E(this.a,/MSIE ([\d\w\.]+)/,1):E(this.a,/rv:([\d\w\.]+)/,1),g=x(d);""!=j?(h="Trident",i=x(j)):(h="Unknown",i=new v,j="Unknown"),a=new y("MSIE",g,d,h,i,j,a,c,b,k,new u("Windows"==a&&6<=g.d||"Windows Phone"==a&&8<=c.d,f,f))}else if(-1!=this.a.indexOf("Opera"))a:if(a="Unknown",b=E(this.a,/Presto\/([\d\w\.]+)/,1),c=x(b),d=C(this),g=x(d),h=F(this.I),c.d!==e?a="Presto":(-1!=this.a.indexOf("Gecko")&&(a="Gecko"),b=E(this.a,/rv:([^\)]+)/,1),c=x(b)),-1!=this.a.indexOf("Opera Mini/"))i=E(this.a,/Opera Mini\/([\d\.]+)/,1),j=x(i),a=new y("OperaMini",j,i,a,c,b,B(this),g,d,h,new u(f,f,f));else{if(-1!=this.a.indexOf("Version/")&&(i=E(this.a,/Version\/([\d\.]+)/,1),j=x(i),j.d!==e)){a=new y("Opera",j,i,a,c,b,B(this),g,d,h,new u(10<=j.d,f,f));break a}i=E(this.a,/Opera[\/ ]([\d\.]+)/,1),j=x(i),a=j.d!==e?new y("Opera",j,i,a,c,b,B(this),g,d,h,new u(10<=j.d,f,f)):new y("Opera",new v,"Unknown",a,c,b,B(this),g,d,h,new u(f,f,f))}else/OPR\/[\d.]+/.test(this.a)?a=D(this):/AppleWeb(K|k)it/.test(this.a)?a=D(this):-1!=this.a.indexOf("Gecko")?(a="Unknown",b=new v,c="Unknown",d=C(this),g=x(d),h=f,-1!=this.a.indexOf("Firefox")?(a="Firefox",c=E(this.a,/Firefox\/([\d\w\.]+)/,1),b=x(c),h=3<=b.d&&5<=b.o):-1!=this.a.indexOf("Mozilla")&&(a="Mozilla"),i=E(this.a,/rv:([^\)]+)/,1),j=x(i),h||(h=1<j.d||1==j.d&&9<j.o||1==j.d&&9==j.o&&2<=j.aa||i.match(/1\.9\.1b[123]/)!=e||i.match(/1\.9\.1\.[\d\.]+/)!=e),a=new y(a,b,c,"Gecko",j,i,B(this),g,d,F(this.I),new u(h,f,f))):a=A;return a},G.prototype.f=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.ua)},H.prototype.getName=g("K"),O.prototype.remove=function(){var a=this.s;a.parentNode&&a.parentNode.removeChild(a)};var S={Da:"serif",Ca:"sans-serif",Ba:"monospace"};R.prototype.start=function(){this.A=new O(this.c,this.C),Q(this.A),this.B=new O(this.c,this.C),Q(this.B),this.xa=m(),P(this.A,new H(this.q.getName()+",serif",I(this.q))),P(this.B,new H(this.q.getName()+",sans-serif",I(this.q))),U(this)},W.prototype.ga=function(a){var b=this.t;p(b.m,[b.g.f(b.h,a.getName(),I(a).toString(),"active")],[b.g.f(b.h,a.getName(),I(a).toString(),"loading"),b.g.f(b.h,a.getName(),I(a).toString(),"inactive")]),M(b,"fontactive",a),this.ba=d,Y(this)},W.prototype.ha=function(a){var b=this.t,c=q(b.m,b.g.f(b.h,a.getName(),I(a).toString(),"active")),d=[],e=[b.g.f(b.h,a.getName(),I(a).toString(),"loading")];c||d.push(b.g.f(b.h,a.getName(),I(a).toString(),"inactive")),p(b.m,d,e),M(b,"fontinactive",a),Y(this)},Z.prototype.load=function(a){var b=a.context||this.G;this.c=new n(this.G,b);var b=new K(this.c,b.document.documentElement,a),c=[],d=a.timeout;p(b.m,[b.g.f(b.h,"loading")]),M(b,"loading");var g,c=this.u,e=this.c,f=[];for(g in a)if(a.hasOwnProperty(g)){var h=c.w[g];h&&f.push(h(a[g],e))}for(c=f,this.Q=this.R=c.length,a=new W(this.a,this.c,b,d),g=0,d=c.length;g<d;g++)e=c[g],e.H(this.a,l(this.ta,this,e,b,a))},Z.prototype.ta=function(a,b,c,d){var f=this;d?a.load(function(a,b,d){var g=0==--f.R;setTimeout(function(){X(c,a,b||{},d||e,g)},0)}):(a=0==--this.R,this.Q--,a&&0==this.Q&&L(b),X(c,[],{},e,a))},$.prototype.D=function(a){return r(this.c)+(this.e.api||"//f.fontdeck.com/s/css/js/")+(this.c.v.location.hostname||this.c.G.location.hostname)+"/"+a+".js"},$.prototype.H=function(a,b){var c=this.e.id,d=this.c.v,e=this;c?(d.__webfontfontdeckmodule__||(d.__webfontfontdeckmodule__={}),d.__webfontfontdeckmodule__[c]=function(a,c){for(var d=0,f=c.fonts.length;d<f;++d){var g=c.fonts[d];e.k.push(new H(g.name,J("font-weight:"+g.weight+";font-style:"+g.style)))}b(a)},t(this.c,this.D(c),function(a){a&&b(f)})):b(f)},$.prototype.load=function(a){a(this.k)},_.prototype.D=function(a){var b=r(this.c);return(this.e.api||b+"//use.typekit.net")+"/"+a+".js"},_.prototype.H=function(a,b){var c=this.e.id,d=this.e,e=this.c.v,g=this;c?(e.__webfonttypekitmodule__||(e.__webfonttypekitmodule__={}),e.__webfonttypekitmodule__[c]=function(c){c(a,d,function(a,c,d){for(var e=0;e<c.length;e+=1){var f=d[c[e]];if(f)for(var h=0;h<f.length;h+=1)g.k.push(new H(c[e],f[h]));else g.k.push(new H(c[e]))}b(a)})},t(this.c,this.D(c),function(a){a&&b(f)},2e3)):b(f)},_.prototype.load=function(a){a(this.k)},aa.prototype.load=function(a){var b,c,d=this.e.urls||[],e=this.e.families||[],f=this.e.testStrings||{};for(b=0,c=d.length;b<c;b++)s(this.c,d[b]);for(d=[],b=0,c=e.length;b<c;b++){var g=e[b].split(":");if(g[1])for(var h=g[1].split(","),i=0;i<h.length;i+=1)d.push(new H(g[0],h[i]));else d.push(new H(g[0]))}a(d,f)},aa.prototype.H=function(a,b){return b(a.j.M)};var ca="//fonts.googleapis.com/css";ba.prototype.f=function(){if(0==this.p.length)throw Error("No fonts to load!");if(-1!=this.N.indexOf("kit="))return this.N;
for(var a=this.p.length,b=[],c=0;c<a;c++)b.push(this.p[c].replace(/ /g,"+"));return a=this.N+"?family="+b.join("%7C"),0<this.S.length&&(a+="&subset="+this.S.join(",")),0<this.ca.length&&(a+="&text="+encodeURIComponent(this.ca)),a};var ea={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},fa={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},ga={i:"i",italic:"i",n:"n",normal:"n"},ha=RegExp("^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$");da.prototype.parse=function(){for(var a=this.p.length,b=0;b<a;b++){var c=this.p[b].split(":"),d=c[0].replace(/\+/g," "),f=["n4"];if(2<=c.length){var g,h=c[1];if(g=[],h)for(var h=h.split(","),i=h.length,j=0;j<i;j++){var k;if(k=h[j],k.match(/^[\w-]+$/)){k=ha.exec(k.toLowerCase());var l=void 0;if(k==e)l="";else{if(l=void 0,l=k[1],l==e||""==l)l="4";else var m=fa[l],l=m?m:isNaN(l)?"4":l.substr(0,1);l=[k[2]==e||""==k[2]?"n":ga[k[2]],l].join("")}k=l}else k="";k&&g.push(k)}0<g.length&&(f=g),3==c.length&&(c=c[2],g=[],c=c?c.split(","):g,0<c.length&&(c=ea[c[0]])&&(this.J[d]=c))}for(this.J[d]||(c=ea[d])&&(this.J[d]=c),c=0;c<f.length;c+=1)this.$.push(new H(d,f[c]))}};var ja={Arimo:d,Cousine:d,Tinos:d};ia.prototype.H=function(a,b){b(a.j.M)},ia.prototype.load=function(a){var b=this.c;if("MSIE"==this.a.getName()&&this.e.blocking!=d){var c=l(this.X,this,a),e=function(){b.z.body?c():setTimeout(e,0)};e()}else this.X(a)},ia.prototype.X=function(a){for(var b=this.c,c=new ba(this.e.api,r(b),this.e.text),d=this.e.families,e=d.length,f=0;f<e;f++){var g=d[f].split(":");3==g.length&&c.S.push(g.pop());var h="";2==g.length&&""!=g[1]&&(h=":"),c.p.push(g.join(h))}d=new da(d),d.parse(),s(b,c.f()),a(d.$,d.J,ja)},ka.prototype.H=function(a,b){var c=this,d=c.e.projectId,e=c.e.version;if(d){var g=c.c.v;t(this.c,c.D(d,e),function(e){if(e)b(f);else{if(g["__mti_fntLst"+d]&&(e=g["__mti_fntLst"+d]()))for(var h=0;h<e.length;h++)c.k.push(new H(e[h].fontfamily));b(a.j.M)}}).id="__MonotypeAPIScript__"+d}else b(f)},ka.prototype.D=function(a,b){var c=r(this.c),d=(this.e.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return c+"//"+d+"/"+a+".js"+(b?"?v="+b:"")},ka.prototype.load=function(a){a(this.k)};var la=new Z(h);la.u.w.custom=function(a,b){return new aa(b,a)},la.u.w.fontdeck=function(a,b){return new $(b,a)},la.u.w.monotype=function(a,b){return new ka(b,a)},la.u.w.typekit=function(a,b){return new _(b,a)},la.u.w.google=function(a,b){return new ia(b,a)},h.WebFont||(h.WebFont={},h.WebFont.load=l(la.load,la),h.WebFontConfig&&la.load(h.WebFontConfig))}(this,document);var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(a){var b=a.length/4*3,c=new ArrayBuffer(b);return this.decode(a,c),c},decode:function(a,b){var c=this._keyStr.indexOf(a.charAt(a.length-1)),d=this._keyStr.indexOf(a.charAt(a.length-2)),e=a.length/4*3;64==c&&e--,64==d&&e--;var f,g,h,i,j,k,l,m,n=0,o=0;for(f=b?new Uint8Array(b):new Uint8Array(e),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,""),n=0;n<e;n+=3)j=this._keyStr.indexOf(a.charAt(o++)),k=this._keyStr.indexOf(a.charAt(o++)),l=this._keyStr.indexOf(a.charAt(o++)),m=this._keyStr.indexOf(a.charAt(o++)),g=j<<2|k>>4,h=(15&k)<<4|l>>2,i=(3&l)<<6|m,f[n]=g,64!=l&&(f[n+1]=h),64!=m&&(f[n+2]=i);return f}};!function(a){"use strict";window.cloudkid=window.cloudkid||{};var b={},c=b.DEG_TO_RADS=Math.PI/180;b.rotatePoint=function(a,b){if(a){a*=c;var d=Math.sin(a),e=Math.cos(a),f=b.x*e-b.y*d,g=b.x*d+b.y*e;b.x=f,b.y=g}},b.combineRGBComponents=function(a,b,c){return a<<16|b<<8|c},b.normalize=function(a){var c=1/b.length(a);a.x*=c,a.y*=c},b.scaleBy=function(a,b){a.x*=b,a.y*=b},b.length=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},b.hexToRGB=function(a,b){b?b.length=0:b=[],"#"==a.charAt(0)?a=a.substr(1):0===a.indexOf("0x")&&(a=a.substr(2));var c;return 8==a.length&&(c=a.substr(0,2),a=a.substr(2)),b.push(parseInt(a.substr(0,2),16)),b.push(parseInt(a.substr(2,2),16)),b.push(parseInt(a.substr(4,2),16)),c&&b.push(parseInt(c,16)),b},b.generateEase=function(a){var b=a.length,c=1/b,d=function(d){var e,f,g=b*d|0;return e=(d-g*c)*b,f=a[g]||a[b-1],f.s+e*(2*(1-e)*(f.cp-f.s)+e*(f.e-f.s))};return d},b.getBlendMode=function(a){if(!a)return PIXI.blendModes.NORMAL;for(a=a.toUpperCase();a.indexOf(" ")>=0;)a=a.replace(" ","_");return PIXI.blendModes[a]||PIXI.blendModes.NORMAL},cloudkid.ParticleUtils=b,Array.prototype.shuffle||Object.defineProperty(Array.prototype,"shuffle",{enumerable:!1,writable:!1,value:function(){for(var a,b,c=this.length;c;a=Math.floor(Math.random()*c),b=this[--c],this[c]=this[a],this[a]=b);return this}}),Array.prototype.random||Object.defineProperty(Array.prototype,"random",{enumerable:!1,writable:!1,value:function(){return this[Math.floor(Math.random()*this.length)]}})}(),function(a,b){"use strict";var c=a.ParticleUtils,d=function(a){var b=a.particleImages[0]instanceof PIXI.Texture?[a.particleImages[0]]:a.particleImages[0];PIXI.MovieClip.call(this,b),this.emitter=a,this.anchor.x=this.anchor.y=.5,this.velocity=new PIXI.Point,this.maxLife=0,this.age=0,this.ease=null,this.extraData=null,this.startAlpha=0,this.endAlpha=0,this.startSpeed=0,this.endSpeed=0,this.acceleration=null,this.startScale=0,this.endScale=0,this.startColor=null,this._sR=0,this._sG=0,this._sB=0,this.endColor=null,this._eR=0,this._eG=0,this._eB=0,this._doAlpha=!1,this._doScale=!1,this._doSpeed=!1,this._doColor=!1,this._oneOverLife=0},e=d.prototype=Object.create(PIXI.MovieClip.prototype);e.init=function(){this.age=0,this.velocity.x=this.startSpeed,this.velocity.y=0,c.rotatePoint(this.rotation,this.velocity),this.rotation*=c.DEG_TO_RADS,this.rotationSpeed*=c.DEG_TO_RADS,this.alpha=this.startAlpha,this.scale.x=this.scale.y=this.startScale,this.startColor&&(this._sR=this.startColor[0],this._sG=this.startColor[1],this._sB=this.startColor[2],this.endColor&&(this._eR=this.endColor[0],this._eG=this.endColor[1],this._eB=this.endColor[2])),this._doAlpha=this.startAlpha!=this.endAlpha,this._doSpeed=this.startSpeed!=this.endSpeed,this._doScale=this.startScale!=this.endScale,this._doColor=!!this.endColor,this._oneOverLife=1/this.maxLife,this.tint=c.combineRGBComponents(this._sR,this._sG,this._sB)},e.applyArt=function(a){this.setTexture(a)},e.update=function(a){if(this.age+=a,this.age>=this.maxLife)return void this.kill();var b=this.age*this._oneOverLife;if(this.ease&&(b=this.ease(b)),this._doAlpha&&(this.alpha=(this.endAlpha-this.startAlpha)*b+this.startAlpha),this._doScale){var d=(this.endScale-this.startScale)*b+this.startScale;this.scale.x=this.scale.y=d}if(this._doSpeed||0!==this.startSpeed||this.acceleration){if(this._doSpeed){var e=(this.endSpeed-this.startSpeed)*b+this.startSpeed;c.normalize(this.velocity),c.scaleBy(this.velocity,e)}else this.acceleration&&(this.velocity.x+=this.acceleration.x*a,this.velocity.y+=this.acceleration.y*a);this.position.x+=this.velocity.x*a,this.position.y+=this.velocity.y*a}if(this._doColor){var f=(this._eR-this._sR)*b+this._sR,g=(this._eG-this._sG)*b+this._sG,h=(this._eB-this._sB)*b+this._sB;this.tint=c.combineRGBComponents(f,g,h)}0!==this.rotationSpeed?this.rotation+=this.rotationSpeed*a:this.acceleration&&(this.rotation=Math.atan2(this.velocity.y,this.velocity.x))},e.kill=function(){this.emitter.recycle(this)},e.destroy=function(){this.emitter=null,this.velocity=null,this.startColor=this.endColor=null,this.ease=null},a.Particle=d}(cloudkid),function(a,b){"use strict";var c=a.ParticleUtils,d=a.Particle,e=function(a,b,c){this._particleConstructor=d,this.particleImages=null,this.startAlpha=1,this.endAlpha=1,this.startSpeed=0,this.endSpeed=0,this.acceleration=null,this.startScale=1,this.endScale=1,this.minimumScaleMultiplier=1,this.startColor=null,this.endColor=null,this.minLifetime=0,this.maxLifetime=0,this.minStartRotation=0,this.maxStartRotation=0,this.minRotationSpeed=0,this.maxRotationSpeed=0,this.particleBlendMode=0,this.customEase=null,this.extraData=null,this.frequency=0,this.maxParticles=1e3,this.emitterLifetime=-1,this.spawnPos=null,this.spawnType=null,this._spawnFunc=null,this.spawnRect=null,this.spawnCircle=null,this.particlesPerWave=1,this.particleSpacing=0,this.angleStart=0,this.rotation=0,this.ownerPos=null,this._prevEmitterPos=null,this._prevPosIsValid=!1,this._posChanged=!1,this.parent=a,this.addAtBack=!1,this._emit=!1,this._spawnTimer=0,this._emitterLife=-1,this._activeParticles=[],this._pool=[],b&&c&&this.init(b,c)},f=e.prototype={},g=new PIXI.Point;Object.defineProperty(f,"particleConstructor",{get:function(){return this._particleConstructor},set:function(a){a!=this._particleConstructor&&(this._particleConstructor=a,this._activeParticles.length&&(this._activeParticles.length=0),this._pool.length&&(this._pool.length=0))}}),f.init=function(a,b){if(a&&b){if(this.cleanup(),this.particleImages=a instanceof PIXI.Texture?[a]:a,this.particleImages.length>1)for(var d=this.particleImages.length-1;d>0;--d)this.particleImages[d].baseTexture!=this.particleImages[d-1].baseTexture;b.alpha?(this.startAlpha=b.alpha.start,this.endAlpha=b.alpha.end):this.startAlpha=this.endAlpha=1,b.speed?(this.startSpeed=b.speed.start,this.endSpeed=b.speed.end):this.startSpeed=this.endSpeed=0;var e=b.acceleration;switch(e&&(e.x||e.y)?(this.endSpeed=this.startSpeed,this.acceleration=new PIXI.Point(e.x,e.y)):this.acceleration=null,b.scale?(this.startScale=b.scale.start,this.endScale=b.scale.end,this.minimumScaleMultiplier=b.scale.minimumScaleMultiplier||1):this.startScale=this.endScale=this.minimumScaleMultiplier=1,b.color&&(this.startColor=c.hexToRGB(b.color.start),b.color.start!=b.color.end?this.endColor=c.hexToRGB(b.color.end):this.endColor=null),b.startRotation?(this.minStartRotation=b.startRotation.min,this.maxStartRotation=b.startRotation.max):this.minStartRotation=this.maxStartRotation=0,b.rotationSpeed?(this.minRotationSpeed=b.rotationSpeed.min,this.maxRotationSpeed=b.rotationSpeed.max):this.minRotationSpeed=this.maxRotationSpeed=0,this.minLifetime=b.lifetime.min,this.maxLifetime=b.lifetime.max,this.particleBlendMode=c.getBlendMode(b.blendMode),b.ease&&(this.customEase="function"==typeof b.ease?b.ease:c.generateEase(b.ease)),this.extraData=b.extraData||null,this.minAngle=this.maxAngle=0,this.spawnRect=this.spawnCircle=null,this.particlesPerWave=1,this.particleSpacing=0,this.angleStart=0,b.spawnType){case"rect":this.spawnType="rect",this._spawnFunc=this._spawnRect;var f=b.spawnRect;this.spawnRect=new PIXI.Rectangle(f.x,f.y,f.w,f.h);break;case"circle":this.spawnType="circle",this._spawnFunc=this._spawnCircle;var g=b.spawnCircle;this.spawnCircle=new PIXI.Circle(g.x,g.y,g.r);break;case"arc":this.spawnType="arc",this._spawnFunc=this._spawnArc,this.minAngle=b.angle.min,this.maxAngle=b.angle.max;break;case"burst":this.spawnType="burst",this._spawnFunc=this._spawnBurst,this.particlesPerWave=b.particlesPerWave,this.particleSpacing=b.particleSpacing,this.angleStart=b.angleStart?b.angleStart:0;break;case"point":this.spawnType="point",this._spawnFunc=this._spawnPoint;break;default:this.spawnType="point",this._spawnFunc=this._spawnPoint}this.frequency=b.frequency,this.emitterLifetime=b.emitterLifetime||-1,this.maxParticles=b.maxParticles>0?b.maxParticles:1e3,this.addAtBack=!!b.addAtBack,this.rotation=0,this.ownerPos=new PIXI.Point,this.spawnPos=new PIXI.Point(b.pos.x,b.pos.y),this._prevEmitterPos=this.spawnPos.clone(),this._prevPosIsValid=!1,this._spawnTimer=0,this.emit=!0}},f.recycle=function(a){var b=this._activeParticles.indexOf(a);b<this._activeParticles.length-1&&(this._activeParticles[b]=this._activeParticles[this._activeParticles.length-1]),this._activeParticles.pop(),this._pool.push(a),a.parent&&a.parent.removeChild(a)},f.rotate=function(a){if(this.rotation!=a){var b=a-this.rotation;this.rotation=a,c.rotatePoint(b,this.spawnPos),this._posChanged=!0}},f.updateSpawnPos=function(a,b){this._posChanged=!0,this.spawnPos.x=a,this.spawnPos.y=b},f.updateOwnerPos=function(a,b){this._posChanged=!0,this.ownerPos.x=a,this.ownerPos.y=b},f.resetPositionTracking=function(){this._prevPosIsValid=!1},Object.defineProperty(f,"emit",{get:function(){return this._emit},set:function(a){this._emit=!!a,this._emitterLife=this.emitterLifetime}}),f.update=function(a){var b;for(b=this._activeParticles.length-1;b>=0;--b)this._activeParticles[b].update(a);var c,d;this._prevPosIsValid&&(c=this._prevEmitterPos.x,d=this._prevEmitterPos.y);var e=this.ownerPos.x+this.spawnPos.x,f=this.ownerPos.y+this.spawnPos.y;if(this.emit)for(this._spawnTimer-=a;this._spawnTimer<=0;){if(this._emitterLife>0&&(this._emitterLife-=this.frequency,this._emitterLife<=0)){this._spawnTimer=0,this._emitterLife=0,this.emit=!1;break}if(this._activeParticles.length>=this.maxParticles)this._spawnTimer+=this.frequency;else{var g;if(g=this.minLifetime==this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,-this._spawnTimer<g){var h,i;if(this._prevPosIsValid&&this._posChanged){var j=1+this._spawnTimer/a;h=(e-c)*j+c,i=(f-d)*j+d}else h=e,i=f;b=0;for(var k=Math.min(this.particlesPerWave,this.maxParticles-this._activeParticles.length);b<k;++b){var l=this._pool.length?this._pool.pop():new this.particleConstructor(this);if(this.particleImages.length>1?l.applyArt(this.particleImages.random()):l.applyArt(this.particleImages[0]),l.startAlpha=this.startAlpha,l.endAlpha=this.endAlpha,l.startSpeed=this.startSpeed,l.endSpeed=this.endSpeed,l.acceleration=this.acceleration,1!=this.minimumScaleMultiplier){var m=Math.random()*(1-this.minimumScaleMultiplier)+this.minimumScaleMultiplier;l.startScale=this.startScale*m,l.endScale=this.endScale*m}else l.startScale=this.startScale,l.endScale=this.endScale;l.startColor=this.startColor,l.endColor=this.endColor,this.minRotationSpeed==this.maxRotationSpeed?l.rotationSpeed=this.minRotationSpeed:l.rotationSpeed=Math.random()*(this.maxRotationSpeed-this.minRotationSpeed)+this.minRotationSpeed,l.maxLife=g,l.blendMode=this.particleBlendMode,l.ease=this.customEase,l.extraData=this.extraData,this._spawnFunc(l,h,i,b),l.init(),l.update(-this._spawnTimer),this.addAtBack?this.parent.addChildAt(l,0):this.parent.addChild(l),this._activeParticles.push(l)}}this._spawnTimer+=this.frequency}}this._posChanged&&(this._prevEmitterPos.x=e,this._prevEmitterPos.y=f,this._prevPosIsValid=!0,this._posChanged=!1)},f._spawnPoint=function(a,b,c,d){this.minStartRotation==this.maxStartRotation?a.rotation=this.minStartRotation+this.rotation:a.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,a.position.x=b,a.position.y=c},f._spawnRect=function(a,b,d,e){this.minStartRotation==this.maxStartRotation?a.rotation=this.minStartRotation+this.rotation:a.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,g.x=Math.random()*this.spawnRect.width+this.spawnRect.x,g.y=Math.random()*this.spawnRect.height+this.spawnRect.y,0!==this.rotation&&c.rotatePoint(this.rotation,g),a.position.x=b+g.x,a.position.y=d+g.y},f._spawnCircle=function(a,b,d,e){this.minStartRotation==this.maxStartRotation?a.rotation=this.minStartRotation+this.rotation:a.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,g.x=Math.random()*this.spawnCircle.radius,g.y=0,c.rotatePoint(360*Math.random(),g),g.x+=this.spawnCircle.x,g.y+=this.spawnCircle.y,0!==this.rotation&&c.rotatePoint(this.rotation,g),a.position.x=b+g.x,a.position.y=d+g.y},f._spawnBurst=function(a,b,c,d){0===this.particleSpacing?a.rotation=360*Math.random():a.rotation=this.angleStart+this.particleSpacing*d+this.rotation,a.position.x=b,a.position.y=c},f.cleanup=function(){for(var a=this._activeParticles.length-1;a>=0;--a)this.recycle(this._activeParticles[a])},f.destroy=function(){this.cleanup();for(var a=this._pool.length-1;a>=0;--a)this._pool[a].destroy();this._pool=null,this._activeParticles=null,this.parent=null,this.particleImages=null,this.spawnPos=null,this.ownerPos=null,this.startColor=null,this.endColor=null,this.customEase=null},a.Emitter=e}(cloudkid);var Box2D={};!function(a,b){function c(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(a,b,c){c.get instanceof Function&&a.__defineGetter__(b,c.get),c.set instanceof Function&&a.__defineSetter__(b,c.set)}),a.inherit=function(a,b){var d=a;c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=d},a.generateCallback=function(b,c){return function(){c.apply(b,arguments)}},a.NVector=function(c){c===b&&(c=0);for(var d=new Array(c||0),e=0;e<c;++e)d[e]=0;return d},a.is=function(c,d){return null!==c&&(d instanceof Function&&c instanceof d||!(c.constructor.__implements==b||!c.constructor.__implements[d]))},a.parseUInt=function(a){return Math.abs(parseInt(a))}}(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;"undefined"==typeof Box2D&&(Box2D={}),"undefined"==typeof Box2D.Collision&&(Box2D.Collision={}),"undefined"==typeof Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={}),"undefined"==typeof Box2D.Common&&(Box2D.Common={}),"undefined"==typeof Box2D.Common.Math&&(Box2D.Common.Math={}),"undefined"==typeof Box2D.Dynamics&&(Box2D.Dynamics={}),"undefined"==typeof Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={}),"undefined"==typeof Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={}),"undefined"==typeof Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={}),function(){function a(){a.b2AABB.apply(this,arguments)}function b(){b.b2Bound.apply(this,arguments)}function c(){c.b2BoundValues.apply(this,arguments),this.constructor===c&&this.b2BoundValues.apply(this,arguments)}function d(){d.b2Collision.apply(this,arguments)}function e(){e.b2ContactID.apply(this,arguments),this.constructor===e&&this.b2ContactID.apply(this,arguments)}function f(){f.b2ContactPoint.apply(this,arguments)}function g(){g.b2Distance.apply(this,arguments)}function h(){h.b2DistanceInput.apply(this,arguments)}function i(){i.b2DistanceOutput.apply(this,arguments)}function j(){j.b2DistanceProxy.apply(this,arguments)}function k(){k.b2DynamicTree.apply(this,arguments),this.constructor===k&&this.b2DynamicTree.apply(this,arguments)}function l(){l.b2DynamicTreeBroadPhase.apply(this,arguments)}function m(){m.b2DynamicTreeNode.apply(this,arguments)}function n(){n.b2DynamicTreePair.apply(this,arguments)}function o(){o.b2Manifold.apply(this,arguments),this.constructor===o&&this.b2Manifold.apply(this,arguments)}function p(){p.b2ManifoldPoint.apply(this,arguments),this.constructor===p&&this.b2ManifoldPoint.apply(this,arguments)}function q(){q.b2Point.apply(this,arguments)}function r(){r.b2RayCastInput.apply(this,arguments),this.constructor===r&&this.b2RayCastInput.apply(this,arguments)}function s(){s.b2RayCastOutput.apply(this,arguments)}function t(){t.b2Segment.apply(this,arguments)}function u(){u.b2SeparationFunction.apply(this,arguments)}function v(){v.b2Simplex.apply(this,arguments),this.constructor===v&&this.b2Simplex.apply(this,arguments)}function w(){w.b2SimplexCache.apply(this,arguments)}function x(){x.b2SimplexVertex.apply(this,arguments)}function y(){y.b2TimeOfImpact.apply(this,arguments)}function z(){z.b2TOIInput.apply(this,arguments)}function A(){A.b2WorldManifold.apply(this,arguments),this.constructor===A&&this.b2WorldManifold.apply(this,arguments)}function B(){B.ClipVertex.apply(this,arguments)}function C(){C.Features.apply(this,arguments)}function D(){D.b2CircleShape.apply(this,arguments),this.constructor===D&&this.b2CircleShape.apply(this,arguments)}function E(){E.b2EdgeChainDef.apply(this,arguments),this.constructor===E&&this.b2EdgeChainDef.apply(this,arguments)}function F(){F.b2EdgeShape.apply(this,arguments),this.constructor===F&&this.b2EdgeShape.apply(this,arguments)}function G(){G.b2MassData.apply(this,arguments)}function H(){H.b2PolygonShape.apply(this,arguments),this.constructor===H&&this.b2PolygonShape.apply(this,arguments)}function I(){I.b2Shape.apply(this,arguments),this.constructor===I&&this.b2Shape.apply(this,arguments)}function J(){J.b2Color.apply(this,arguments),this.constructor===J&&this.b2Color.apply(this,arguments)}function K(){K.b2Settings.apply(this,arguments)}function L(){L.b2Mat22.apply(this,arguments),this.constructor===L&&this.b2Mat22.apply(this,arguments)}function M(){M.b2Mat33.apply(this,arguments),this.constructor===M&&this.b2Mat33.apply(this,arguments)}function N(){N.b2Math.apply(this,arguments)}function O(){O.b2Sweep.apply(this,arguments)}function P(){P.b2Transform.apply(this,arguments),this.constructor===P&&this.b2Transform.apply(this,arguments)}function Q(){Q.b2Vec2.apply(this,arguments),this.constructor===Q&&this.b2Vec2.apply(this,arguments)}function R(){R.b2Vec3.apply(this,arguments),this.constructor===R&&this.b2Vec3.apply(this,arguments)}function S(){S.b2Body.apply(this,arguments),this.constructor===S&&this.b2Body.apply(this,arguments)}function T(){T.b2BodyDef.apply(this,arguments),this.constructor===T&&this.b2BodyDef.apply(this,arguments)}function U(){U.b2ContactFilter.apply(this,arguments)}function V(){V.b2ContactImpulse.apply(this,arguments)}function W(){W.b2ContactListener.apply(this,arguments)}function X(){X.b2ContactManager.apply(this,arguments),this.constructor===X&&this.b2ContactManager.apply(this,arguments)}function Y(){Y.b2DebugDraw.apply(this,arguments),this.constructor===Y&&this.b2DebugDraw.apply(this,arguments)}function Z(){Z.b2DestructionListener.apply(this,arguments)}function $(){$.b2FilterData.apply(this,arguments)}function _(){_.b2Fixture.apply(this,arguments),this.constructor===_&&this.b2Fixture.apply(this,arguments)}function aa(){aa.b2FixtureDef.apply(this,arguments),this.constructor===aa&&this.b2FixtureDef.apply(this,arguments)}function ba(){ba.b2Island.apply(this,arguments),this.constructor===ba&&this.b2Island.apply(this,arguments)}function ca(){ca.b2TimeStep.apply(this,arguments)}function da(){da.b2World.apply(this,arguments),this.constructor===da&&this.b2World.apply(this,arguments)}function ea(){ea.b2CircleContact.apply(this,arguments)}function fa(){fa.b2Contact.apply(this,arguments),this.constructor===fa&&this.b2Contact.apply(this,arguments)}function ga(){ga.b2ContactConstraint.apply(this,arguments),this.constructor===ga&&this.b2ContactConstraint.apply(this,arguments)}function ha(){ha.b2ContactConstraintPoint.apply(this,arguments)}function ia(){ia.b2ContactEdge.apply(this,arguments)}function ja(){ja.b2ContactFactory.apply(this,arguments),this.constructor===ja&&this.b2ContactFactory.apply(this,arguments)}function ka(){ka.b2ContactRegister.apply(this,arguments)}function la(){la.b2ContactResult.apply(this,arguments)}function ma(){ma.b2ContactSolver.apply(this,arguments),this.constructor===ma&&this.b2ContactSolver.apply(this,arguments)}function na(){na.b2EdgeAndCircleContact.apply(this,arguments)}function oa(){oa.b2NullContact.apply(this,arguments),this.constructor===oa&&this.b2NullContact.apply(this,arguments)}function pa(){pa.b2PolyAndCircleContact.apply(this,arguments)}function qa(){qa.b2PolyAndEdgeContact.apply(this,arguments)}function ra(){ra.b2PolygonContact.apply(this,arguments)}function sa(){sa.b2PositionSolverManifold.apply(this,arguments),this.constructor===sa&&this.b2PositionSolverManifold.apply(this,arguments)}function ta(){ta.b2BuoyancyController.apply(this,arguments)}function ua(){ua.b2ConstantAccelController.apply(this,arguments)}function va(){va.b2ConstantForceController.apply(this,arguments)}function wa(){wa.b2Controller.apply(this,arguments)}function xa(){xa.b2ControllerEdge.apply(this,arguments)}function ya(){ya.b2GravityController.apply(this,arguments)}function za(){za.b2TensorDampingController.apply(this,arguments)}function Aa(){Aa.b2DistanceJoint.apply(this,arguments),this.constructor===Aa&&this.b2DistanceJoint.apply(this,arguments)}function Ba(){Ba.b2DistanceJointDef.apply(this,arguments),this.constructor===Ba&&this.b2DistanceJointDef.apply(this,arguments)}function Ca(){Ca.b2FrictionJoint.apply(this,arguments),this.constructor===Ca&&this.b2FrictionJoint.apply(this,arguments)}function Da(){Da.b2FrictionJointDef.apply(this,arguments),this.constructor===Da&&this.b2FrictionJointDef.apply(this,arguments)}function Ea(){Ea.b2GearJoint.apply(this,arguments),this.constructor===Ea&&this.b2GearJoint.apply(this,arguments)}function Fa(){Fa.b2GearJointDef.apply(this,arguments),this.constructor===Fa&&this.b2GearJointDef.apply(this,arguments)}function Ga(){Ga.b2Jacobian.apply(this,arguments)}function Ha(){Ha.b2Joint.apply(this,arguments),this.constructor===Ha&&this.b2Joint.apply(this,arguments)}function Ia(){Ia.b2JointDef.apply(this,arguments),this.constructor===Ia&&this.b2JointDef.apply(this,arguments)}function Ja(){Ja.b2JointEdge.apply(this,arguments)}function Ka(){Ka.b2LineJoint.apply(this,arguments),this.constructor===Ka&&this.b2LineJoint.apply(this,arguments)}function La(){La.b2LineJointDef.apply(this,arguments),this.constructor===La&&this.b2LineJointDef.apply(this,arguments)}function Ma(){Ma.b2MouseJoint.apply(this,arguments),this.constructor===Ma&&this.b2MouseJoint.apply(this,arguments)}function Na(){Na.b2MouseJointDef.apply(this,arguments),this.constructor===Na&&this.b2MouseJointDef.apply(this,arguments)}function Oa(){Oa.b2PrismaticJoint.apply(this,arguments),this.constructor===Oa&&this.b2PrismaticJoint.apply(this,arguments)}function Pa(){Pa.b2PrismaticJointDef.apply(this,arguments),this.constructor===Pa&&this.b2PrismaticJointDef.apply(this,arguments)}function Qa(){Qa.b2PulleyJoint.apply(this,arguments),this.constructor===Qa&&this.b2PulleyJoint.apply(this,arguments)}function Ra(){Ra.b2PulleyJointDef.apply(this,arguments),this.constructor===Ra&&this.b2PulleyJointDef.apply(this,arguments)}function Sa(){Sa.b2RevoluteJoint.apply(this,arguments),this.constructor===Sa&&this.b2RevoluteJoint.apply(this,arguments)}function Ta(){Ta.b2RevoluteJointDef.apply(this,arguments),this.constructor===Ta&&this.b2RevoluteJointDef.apply(this,arguments)}function Ua(){Ua.b2WeldJoint.apply(this,arguments),this.constructor===Ua&&this.b2WeldJoint.apply(this,arguments)}function Va(){Va.b2WeldJointDef.apply(this,arguments),this.constructor===Va&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=a,Box2D.Collision.b2Bound=b,Box2D.Collision.b2BoundValues=c,Box2D.Collision.b2Collision=d,Box2D.Collision.b2ContactID=e,Box2D.Collision.b2ContactPoint=f,Box2D.Collision.b2Distance=g,Box2D.Collision.b2DistanceInput=h,Box2D.Collision.b2DistanceOutput=i,Box2D.Collision.b2DistanceProxy=j,Box2D.Collision.b2DynamicTree=k,Box2D.Collision.b2DynamicTreeBroadPhase=l,Box2D.Collision.b2DynamicTreeNode=m,Box2D.Collision.b2DynamicTreePair=n,Box2D.Collision.b2Manifold=o,Box2D.Collision.b2ManifoldPoint=p,Box2D.Collision.b2Point=q,Box2D.Collision.b2RayCastInput=r,Box2D.Collision.b2RayCastOutput=s,Box2D.Collision.b2Segment=t,Box2D.Collision.b2SeparationFunction=u,Box2D.Collision.b2Simplex=v,Box2D.Collision.b2SimplexCache=w,Box2D.Collision.b2SimplexVertex=x,Box2D.Collision.b2TimeOfImpact=y,Box2D.Collision.b2TOIInput=z,Box2D.Collision.b2WorldManifold=A,Box2D.Collision.ClipVertex=B,Box2D.Collision.Features=C,Box2D.Collision.Shapes.b2CircleShape=D,Box2D.Collision.Shapes.b2EdgeChainDef=E,Box2D.Collision.Shapes.b2EdgeShape=F,Box2D.Collision.Shapes.b2MassData=G,Box2D.Collision.Shapes.b2PolygonShape=H,Box2D.Collision.Shapes.b2Shape=I,Box2D.Common.b2internal="Box2D.Common.b2internal",Box2D.Common.b2Color=J,Box2D.Common.b2Settings=K,Box2D.Common.Math.b2Mat22=L,Box2D.Common.Math.b2Mat33=M,Box2D.Common.Math.b2Math=N,Box2D.Common.Math.b2Sweep=O,Box2D.Common.Math.b2Transform=P,Box2D.Common.Math.b2Vec2=Q,Box2D.Common.Math.b2Vec3=R,Box2D.Dynamics.b2Body=S,Box2D.Dynamics.b2BodyDef=T,Box2D.Dynamics.b2ContactFilter=U,Box2D.Dynamics.b2ContactImpulse=V,Box2D.Dynamics.b2ContactListener=W,Box2D.Dynamics.b2ContactManager=X,Box2D.Dynamics.b2DebugDraw=Y,Box2D.Dynamics.b2DestructionListener=Z,Box2D.Dynamics.b2FilterData=$,Box2D.Dynamics.b2Fixture=_,Box2D.Dynamics.b2FixtureDef=aa,Box2D.Dynamics.b2Island=ba,Box2D.Dynamics.b2TimeStep=ca,Box2D.Dynamics.b2World=da,Box2D.Dynamics.Contacts.b2CircleContact=ea,Box2D.Dynamics.Contacts.b2Contact=fa,Box2D.Dynamics.Contacts.b2ContactConstraint=ga,Box2D.Dynamics.Contacts.b2ContactConstraintPoint=ha,Box2D.Dynamics.Contacts.b2ContactEdge=ia,Box2D.Dynamics.Contacts.b2ContactFactory=ja,Box2D.Dynamics.Contacts.b2ContactRegister=ka,Box2D.Dynamics.Contacts.b2ContactResult=la,Box2D.Dynamics.Contacts.b2ContactSolver=ma,Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=na,Box2D.Dynamics.Contacts.b2NullContact=oa,Box2D.Dynamics.Contacts.b2PolyAndCircleContact=pa,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=qa,Box2D.Dynamics.Contacts.b2PolygonContact=ra,Box2D.Dynamics.Contacts.b2PositionSolverManifold=sa,Box2D.Dynamics.Controllers.b2BuoyancyController=ta,Box2D.Dynamics.Controllers.b2ConstantAccelController=ua,Box2D.Dynamics.Controllers.b2ConstantForceController=va,Box2D.Dynamics.Controllers.b2Controller=wa,Box2D.Dynamics.Controllers.b2ControllerEdge=xa,Box2D.Dynamics.Controllers.b2GravityController=ya,Box2D.Dynamics.Controllers.b2TensorDampingController=za,Box2D.Dynamics.Joints.b2DistanceJoint=Aa,Box2D.Dynamics.Joints.b2DistanceJointDef=Ba,Box2D.Dynamics.Joints.b2FrictionJoint=Ca,Box2D.Dynamics.Joints.b2FrictionJointDef=Da,Box2D.Dynamics.Joints.b2GearJoint=Ea,Box2D.Dynamics.Joints.b2GearJointDef=Fa,Box2D.Dynamics.Joints.b2Jacobian=Ga,Box2D.Dynamics.Joints.b2Joint=Ha,Box2D.Dynamics.Joints.b2JointDef=Ia,Box2D.Dynamics.Joints.b2JointEdge=Ja,Box2D.Dynamics.Joints.b2LineJoint=Ka,Box2D.Dynamics.Joints.b2LineJointDef=La,Box2D.Dynamics.Joints.b2MouseJoint=Ma,Box2D.Dynamics.Joints.b2MouseJointDef=Na,Box2D.Dynamics.Joints.b2PrismaticJoint=Oa,Box2D.Dynamics.Joints.b2PrismaticJointDef=Pa,Box2D.Dynamics.Joints.b2PulleyJoint=Qa,Box2D.Dynamics.Joints.b2PulleyJointDef=Ra,Box2D.Dynamics.Joints.b2RevoluteJoint=Sa,Box2D.Dynamics.Joints.b2RevoluteJointDef=Ta,Box2D.Dynamics.Joints.b2WeldJoint=Ua,Box2D.Dynamics.Joints.b2WeldJointDef=Va}(),Box2D.postDefs=[],function(){var a=Box2D.Collision.Shapes.b2CircleShape,e=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),f=Box2D.Collision.Shapes.b2Shape,i=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),l=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),m=Box2D.Common.Math.b2Sweep,n=Box2D.Common.Math.b2Transform,o=Box2D.Common.Math.b2Vec2,q=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB),r=Box2D.Collision.b2Bound,s=Box2D.Collision.b2BoundValues,t=Box2D.Collision.b2Collision,u=Box2D.Collision.b2ContactID,v=Box2D.Collision.b2ContactPoint,w=Box2D.Collision.b2Distance,x=Box2D.Collision.b2DistanceInput,y=Box2D.Collision.b2DistanceOutput,z=Box2D.Collision.b2DistanceProxy,A=Box2D.Collision.b2DynamicTree,B=Box2D.Collision.b2DynamicTreeBroadPhase,C=Box2D.Collision.b2DynamicTreeNode,D=Box2D.Collision.b2DynamicTreePair,E=Box2D.Collision.b2Manifold,F=Box2D.Collision.b2ManifoldPoint,G=Box2D.Collision.b2Point,H=Box2D.Collision.b2RayCastInput,I=Box2D.Collision.b2RayCastOutput,J=Box2D.Collision.b2Segment,K=Box2D.Collision.b2SeparationFunction,L=Box2D.Collision.b2Simplex,M=Box2D.Collision.b2SimplexCache,N=Box2D.Collision.b2SimplexVertex,O=Box2D.Collision.b2TimeOfImpact,P=Box2D.Collision.b2TOIInput,Q=Box2D.Collision.b2WorldManifold,R=Box2D.Collision.ClipVertex,S=Box2D.Collision.Features,T=Box2D.Collision.IBroadPhase;q.b2AABB=function(){this.lowerBound=new o,this.upperBound=new o},q.prototype.IsValid=function(){var a=this.upperBound.x-this.lowerBound.x,b=this.upperBound.y-this.lowerBound.y,c=a>=0&&b>=0;
return c=c&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},q.prototype.GetCenter=function(){return new o((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},q.prototype.GetExtents=function(){return new o((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},q.prototype.Contains=function(a){var b=!0;return b=b&&this.lowerBound.x<=a.lowerBound.x,b=b&&this.lowerBound.y<=a.lowerBound.y,b=b&&a.upperBound.x<=this.upperBound.x,b=b&&a.upperBound.y<=this.upperBound.y},q.prototype.RayCast=function(a,b){var c=-Number.MAX_VALUE,d=Number.MAX_VALUE,e=b.p1.x,f=b.p1.y,g=b.p2.x-b.p1.x,h=b.p2.y-b.p1.y,i=Math.abs(g),j=Math.abs(h),k=a.normal,l=0,m=0,n=0,o=0,p=0;if(i<Number.MIN_VALUE){if(e<this.lowerBound.x||this.upperBound.x<e)return!1}else if(l=1/g,m=(this.lowerBound.x-e)*l,n=(this.upperBound.x-e)*l,p=-1,m>n&&(o=m,m=n,n=o,p=1),m>c&&(k.x=p,k.y=0,c=m),d=Math.min(d,n),c>d)return!1;if(j<Number.MIN_VALUE){if(f<this.lowerBound.y||this.upperBound.y<f)return!1}else if(l=1/h,m=(this.lowerBound.y-f)*l,n=(this.upperBound.y-f)*l,p=-1,m>n&&(o=m,m=n,n=o,p=1),m>c&&(k.y=p,k.x=0,c=m),d=Math.min(d,n),c>d)return!1;return a.fraction=c,!0},q.prototype.TestOverlap=function(a){var b=a.lowerBound.x-this.upperBound.x,c=a.lowerBound.y-this.upperBound.y,d=this.lowerBound.x-a.upperBound.x,e=this.lowerBound.y-a.upperBound.y;return!(b>0||c>0)&&!(d>0||e>0)},q.Combine=function(a,b){var c=new q;return c.Combine(a,b),c},q.prototype.Combine=function(a,b){this.lowerBound.x=Math.min(a.lowerBound.x,b.lowerBound.x),this.lowerBound.y=Math.min(a.lowerBound.y,b.lowerBound.y),this.upperBound.x=Math.max(a.upperBound.x,b.upperBound.x),this.upperBound.y=Math.max(a.upperBound.y,b.upperBound.y)},r.b2Bound=function(){},r.prototype.IsLower=function(){return 0==(1&this.value)},r.prototype.IsUpper=function(){return 1==(1&this.value)},r.prototype.Swap=function(a){var b=this.value,c=this.proxy,d=this.stabbingCount;this.value=a.value,this.proxy=a.proxy,this.stabbingCount=a.stabbingCount,a.value=b,a.proxy=c,a.stabbingCount=d},s.b2BoundValues=function(){},s.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},t.b2Collision=function(){},t.ClipSegmentToLine=function(a,b,c,d){void 0===d&&(d=0);var e,f=0;e=b[0];var g=e.v;e=b[1];var h=e.v,i=c.x*g.x+c.y*g.y-d,j=c.x*h.x+c.y*h.y-d;if(i<=0&&a[f++].Set(b[0]),j<=0&&a[f++].Set(b[1]),i*j<0){var k=i/(i-j);e=a[f];var l=e.v;l.x=g.x+k*(h.x-g.x),l.y=g.y+k*(h.y-g.y),e=a[f];var m;i>0?(m=b[0],e.id=m.id):(m=b[1],e.id=m.id),++f}return f},t.EdgeSeparation=function(a,b,c,d,e){void 0===c&&(c=0);var k,l,g=(parseInt(a.m_vertexCount),a.m_vertices),h=a.m_normals,i=parseInt(d.m_vertexCount),j=d.m_vertices;k=b.R,l=h[c];var m=k.col1.x*l.x+k.col2.x*l.y,n=k.col1.y*l.x+k.col2.y*l.y;k=e.R;for(var o=k.col1.x*m+k.col1.y*n,p=k.col2.x*m+k.col2.y*n,q=0,r=Number.MAX_VALUE,s=0;s<i;++s){l=j[s];var t=l.x*o+l.y*p;t<r&&(r=t,q=s)}l=g[c],k=b.R;var u=b.position.x+(k.col1.x*l.x+k.col2.x*l.y),v=b.position.y+(k.col1.y*l.x+k.col2.y*l.y);l=j[q],k=e.R;var w=e.position.x+(k.col1.x*l.x+k.col2.x*l.y),x=e.position.y+(k.col1.y*l.x+k.col2.y*l.y);w-=u,x-=v;var y=w*m+x*n;return y},t.FindMaxSeparation=function(a,b,c,d,e){var h,i,f=parseInt(b.m_vertexCount),g=b.m_normals;i=e.R,h=d.m_centroid;var j=e.position.x+(i.col1.x*h.x+i.col2.x*h.y),k=e.position.y+(i.col1.y*h.x+i.col2.y*h.y);i=c.R,h=b.m_centroid,j-=c.position.x+(i.col1.x*h.x+i.col2.x*h.y),k-=c.position.y+(i.col1.y*h.x+i.col2.y*h.y);for(var l=j*c.R.col1.x+k*c.R.col1.y,m=j*c.R.col2.x+k*c.R.col2.y,n=0,o=-Number.MAX_VALUE,p=0;p<f;++p){h=g[p];var q=h.x*l+h.y*m;q>o&&(o=q,n=p)}var r=t.EdgeSeparation(b,c,n,d,e),s=parseInt(n-1>=0?n-1:f-1),u=t.EdgeSeparation(b,c,s,d,e),v=parseInt(n+1<f?n+1:0),w=t.EdgeSeparation(b,c,v,d,e),x=0,y=0,z=0;if(u>r&&u>w)z=-1,x=s,y=u;else{if(!(w>r))return a[0]=n,r;z=1,x=v,y=w}for(;;){if(n=z==-1?x-1>=0?x-1:f-1:x+1<f?x+1:0,r=t.EdgeSeparation(b,c,n,d,e),!(r>y))break;x=n,y=r}return a[0]=x,y},t.FindIncidentEdge=function(a,b,c,d,e,f){void 0===d&&(d=0);var l,m,h=(parseInt(b.m_vertexCount),b.m_normals),i=parseInt(e.m_vertexCount),j=e.m_vertices,k=e.m_normals;l=c.R,m=h[d];var n=l.col1.x*m.x+l.col2.x*m.y,o=l.col1.y*m.x+l.col2.y*m.y;l=f.R;var p=l.col1.x*n+l.col1.y*o;o=l.col2.x*n+l.col2.y*o,n=p;for(var q=0,r=Number.MAX_VALUE,s=0;s<i;++s){m=k[s];var t=n*m.x+o*m.y;t<r&&(r=t,q=s)}var u,v=parseInt(q),w=parseInt(v+1<i?v+1:0);u=a[0],m=j[v],l=f.R,u.v.x=f.position.x+(l.col1.x*m.x+l.col2.x*m.y),u.v.y=f.position.y+(l.col1.y*m.x+l.col2.y*m.y),u.id.features.referenceEdge=d,u.id.features.incidentEdge=v,u.id.features.incidentVertex=0,u=a[1],m=j[w],l=f.R,u.v.x=f.position.x+(l.col1.x*m.x+l.col2.x*m.y),u.v.y=f.position.y+(l.col1.y*m.x+l.col2.y*m.y),u.id.features.referenceEdge=d,u.id.features.incidentEdge=w,u.id.features.incidentVertex=1},t.MakeClipPointVector=function(){var a=new Vector(2);return a[0]=new R,a[1]=new R,a},t.CollidePolygons=function(a,b,c,d,e){var f;a.m_pointCount=0;var g=b.m_radius+d.m_radius,h=0;t.s_edgeAO[0]=h;var j=t.FindMaxSeparation(t.s_edgeAO,b,c,d,e);if(h=t.s_edgeAO[0],!(j>g)){var k=0;t.s_edgeBO[0]=k;var l=t.FindMaxSeparation(t.s_edgeBO,d,e,b,c);if(k=t.s_edgeBO[0],!(l>g)){var m,n,o,p,v,q=0,r=0,s=.98,u=.001;l>s*j+u?(m=d,n=b,o=e,p=c,q=k,a.m_type=E.e_faceB,r=1):(m=b,n=d,o=c,p=e,q=h,a.m_type=E.e_faceA,r=0);var w=t.s_incidentEdge;t.FindIncidentEdge(w,m,o,q,n,p);var A,x=parseInt(m.m_vertexCount),y=m.m_vertices,z=y[q];A=q+1<x?y[parseInt(q+1)]:y[0];var B=t.s_localTangent;B.Set(A.x-z.x,A.y-z.y),B.Normalize();var C=t.s_localNormal;C.x=B.y,C.y=-B.x;var D=t.s_planePoint;D.Set(.5*(z.x+A.x),.5*(z.y+A.y));var F=t.s_tangent;v=o.R,F.x=v.col1.x*B.x+v.col2.x*B.y,F.y=v.col1.y*B.x+v.col2.y*B.y;var G=t.s_tangent2;G.x=-F.x,G.y=-F.y;var H=t.s_normal;H.x=F.y,H.y=-F.x;var I=t.s_v11,J=t.s_v12;I.x=o.position.x+(v.col1.x*z.x+v.col2.x*z.y),I.y=o.position.y+(v.col1.y*z.x+v.col2.y*z.y),J.x=o.position.x+(v.col1.x*A.x+v.col2.x*A.y),J.y=o.position.y+(v.col1.y*A.x+v.col2.y*A.y);var K=H.x*I.x+H.y*I.y,L=-F.x*I.x-F.y*I.y+g,M=F.x*J.x+F.y*J.y+g,N=t.s_clipPoints1,O=t.s_clipPoints2,P=0;if(P=t.ClipSegmentToLine(N,w,G,L),!(P<2||(P=t.ClipSegmentToLine(O,N,F,M),P<2))){a.m_localPlaneNormal.SetV(C),a.m_localPoint.SetV(D);for(var Q=0,R=0;R<i.b2_maxManifoldPoints;++R){f=O[R];var S=H.x*f.v.x+H.y*f.v.y-K;if(S<=g){var T=a.m_points[Q];v=p.R;var U=f.v.x-p.position.x,V=f.v.y-p.position.y;T.m_localPoint.x=U*v.col1.x+V*v.col1.y,T.m_localPoint.y=U*v.col2.x+V*v.col2.y,T.m_id.Set(f.id),T.m_id.features.flip=r,++Q}}a.m_pointCount=Q}}}},t.CollideCircles=function(a,b,c,d,e){a.m_pointCount=0;var f,g;f=c.R,g=b.m_p;var h=c.position.x+(f.col1.x*g.x+f.col2.x*g.y),i=c.position.y+(f.col1.y*g.x+f.col2.y*g.y);f=e.R,g=d.m_p;var j=e.position.x+(f.col1.x*g.x+f.col2.x*g.y),k=e.position.y+(f.col1.y*g.x+f.col2.y*g.y),l=j-h,m=k-i,n=l*l+m*m,o=b.m_radius+d.m_radius;n>o*o||(a.m_type=E.e_circles,a.m_localPoint.SetV(b.m_p),a.m_localPlaneNormal.SetZero(),a.m_pointCount=1,a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0)},t.CollidePolygonAndCircle=function(a,b,c,d,e){a.m_pointCount=0;var k,l,g=0,h=0;l=e.R,k=d.m_p;var m=e.position.x+(l.col1.x*k.x+l.col2.x*k.y),n=e.position.y+(l.col1.y*k.x+l.col2.y*k.y);g=m-c.position.x,h=n-c.position.y,l=c.R;for(var o=g*l.col1.x+h*l.col1.y,p=g*l.col2.x+h*l.col2.y,r=0,s=-Number.MAX_VALUE,t=b.m_radius+d.m_radius,u=parseInt(b.m_vertexCount),v=b.m_vertices,w=b.m_normals,x=0;x<u;++x){k=v[x],g=o-k.x,h=p-k.y,k=w[x];var y=k.x*g+k.y*h;if(y>t)return;y>s&&(s=y,r=x)}var z=parseInt(r),A=parseInt(z+1<u?z+1:0),B=v[z],C=v[A];if(s<Number.MIN_VALUE)return a.m_pointCount=1,a.m_type=E.e_faceA,a.m_localPlaneNormal.SetV(w[r]),a.m_localPoint.x=.5*(B.x+C.x),a.m_localPoint.y=.5*(B.y+C.y),a.m_points[0].m_localPoint.SetV(d.m_p),void(a.m_points[0].m_id.key=0);var D=(o-B.x)*(C.x-B.x)+(p-B.y)*(C.y-B.y),F=(o-C.x)*(B.x-C.x)+(p-C.y)*(B.y-C.y);if(D<=0){if((o-B.x)*(o-B.x)+(p-B.y)*(p-B.y)>t*t)return;a.m_pointCount=1,a.m_type=E.e_faceA,a.m_localPlaneNormal.x=o-B.x,a.m_localPlaneNormal.y=p-B.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(B),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}else if(F<=0){if((o-C.x)*(o-C.x)+(p-C.y)*(p-C.y)>t*t)return;a.m_pointCount=1,a.m_type=E.e_faceA,a.m_localPlaneNormal.x=o-C.x,a.m_localPlaneNormal.y=p-C.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(C),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}else{var G=.5*(B.x+C.x),H=.5*(B.y+C.y);if(s=(o-G)*w[z].x+(p-H)*w[z].y,s>t)return;a.m_pointCount=1,a.m_type=E.e_faceA,a.m_localPlaneNormal.x=w[z].x,a.m_localPlaneNormal.y=w[z].y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.Set(G,H),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}},t.TestOverlap=function(a,b){var c=b.lowerBound,d=a.upperBound,e=c.x-d.x,f=c.y-d.y;c=a.lowerBound,d=b.upperBound;var g=c.x-d.x,h=c.y-d.y;return!(e>0||f>0)&&!(g>0||h>0)},Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=t.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=t.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=t.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new o,Box2D.Collision.b2Collision.s_localNormal=new o,Box2D.Collision.b2Collision.s_planePoint=new o,Box2D.Collision.b2Collision.s_normal=new o,Box2D.Collision.b2Collision.s_tangent=new o,Box2D.Collision.b2Collision.s_tangent2=new o,Box2D.Collision.b2Collision.s_v11=new o,Box2D.Collision.b2Collision.s_v12=new o,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new o,Box2D.Collision.b2Collision.b2_nullFeature=255}),u.b2ContactID=function(){this.features=new S},u.prototype.b2ContactID=function(){this.features._m_id=this},u.prototype.Set=function(a){this.key=a._key},u.prototype.Copy=function(){var a=new u;return a.key=this.key,a},Object.defineProperty(u.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(u.prototype,"key",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._key=a,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}}),v.b2ContactPoint=function(){this.position=new o,this.velocity=new o,this.normal=new o,this.id=new u},w.b2Distance=function(){},w.Distance=function(a,b,c){++w.b2_gjkCalls;var d=c.proxyA,e=c.proxyB,f=c.transformA,g=c.transformB,h=w.s_simplex;h.ReadCache(b,d,f,e,g);for(var u,j=h.m_vertices,k=20,m=w.s_saveA,n=w.s_saveB,p=0,q=h.GetClosestPoint(),r=q.LengthSquared(),s=r,t=0,v=0;v<k;){for(p=h.m_count,t=0;t<p;t++)m[t]=j[t].indexA,n[t]=j[t].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3();break;default:i.b2Assert(!1)}if(3==h.m_count)break;u=h.GetClosestPoint(),s=u.LengthSquared(),r=s;var x=h.GetSearchDirection();if(x.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var y=j[h.m_count];y.indexA=d.GetSupport(l.MulTMV(f.R,x.GetNegative())),y.wA=l.MulX(f,d.GetVertex(y.indexA)),y.indexB=e.GetSupport(l.MulTMV(g.R,x)),y.wB=l.MulX(g,e.GetVertex(y.indexB)),y.w=l.SubtractVV(y.wB,y.wA),++v,++w.b2_gjkIters;var z=!1;for(t=0;t<p;t++)if(y.indexA==m[t]&&y.indexB==n[t]){z=!0;break}if(z)break;++h.m_count}if(w.b2_gjkMaxIters=l.Max(w.b2_gjkMaxIters,v),h.GetWitnessPoints(a.pointA,a.pointB),a.distance=l.SubtractVV(a.pointA,a.pointB).Length(),a.iterations=v,h.WriteCache(b),c.useRadii){var A=d.m_radius,B=e.m_radius;if(a.distance>A+B&&a.distance>Number.MIN_VALUE){a.distance-=A+B;var C=l.SubtractVV(a.pointB,a.pointA);C.Normalize(),a.pointA.x+=A*C.x,a.pointA.y+=A*C.y,a.pointB.x-=B*C.x,a.pointB.y-=B*C.y}else u=new o,u.x=.5*(a.pointA.x+a.pointB.x),u.y=.5*(a.pointA.y+a.pointB.y),a.pointA.x=a.pointB.x=u.x,a.pointA.y=a.pointB.y=u.y,a.distance=0}},Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new L,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),x.b2DistanceInput=function(){},y.b2DistanceOutput=function(){this.pointA=new o,this.pointB=new o},z.b2DistanceProxy=function(){},z.prototype.Set=function(b){switch(b.GetType()){case f.e_circleShape:var c=b instanceof a?b:null;this.m_vertices=new Vector(1,(!0)),this.m_vertices[0]=c.m_p,this.m_count=1,this.m_radius=c.m_radius;break;case f.e_polygonShape:var d=b instanceof e?b:null;this.m_vertices=d.m_vertices,this.m_count=d.m_vertexCount,this.m_radius=d.m_radius;break;default:i.b2Assert(!1)}},z.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},z.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},z.prototype.GetVertexCount=function(){return this.m_count},z.prototype.GetVertex=function(a){return void 0===a&&(a=0),i.b2Assert(0<=a&&a<this.m_count),this.m_vertices[a]},A.b2DynamicTree=function(){},A.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},A.prototype.CreateProxy=function(a,b){var c=this.AllocateNode(),d=i.b2_aabbExtension,e=i.b2_aabbExtension;return c.aabb.lowerBound.x=a.lowerBound.x-d,c.aabb.lowerBound.y=a.lowerBound.y-e,c.aabb.upperBound.x=a.upperBound.x+d,c.aabb.upperBound.y=a.upperBound.y+e,c.userData=b,this.InsertLeaf(c),c},A.prototype.DestroyProxy=function(a){this.RemoveLeaf(a),this.FreeNode(a)},A.prototype.MoveProxy=function(a,b,c){if(i.b2Assert(a.IsLeaf()),a.aabb.Contains(b))return!1;this.RemoveLeaf(a);var d=i.b2_aabbExtension+i.b2_aabbMultiplier*(c.x>0?c.x:-c.x),e=i.b2_aabbExtension+i.b2_aabbMultiplier*(c.y>0?c.y:-c.y);return a.aabb.lowerBound.x=b.lowerBound.x-d,a.aabb.lowerBound.y=b.lowerBound.y-e,a.aabb.upperBound.x=b.upperBound.x+d,a.aabb.upperBound.y=b.upperBound.y+e,this.InsertLeaf(a),!0},A.prototype.Rebalance=function(a){if(void 0===a&&(a=0),null!=this.m_root)for(var b=0;b<a;b++){for(var c=this.m_root,d=0;0==c.IsLeaf();)c=this.m_path>>d&1?c.child2:c.child1,d=d+1&31;++this.m_path,this.RemoveLeaf(c),this.InsertLeaf(c)}},A.prototype.GetFatAABB=function(a){return a.aabb},A.prototype.GetUserData=function(a){return a.userData},A.prototype.Query=function(a,b){if(null!=this.m_root){var c=new Vector,d=0;for(c[d++]=this.m_root;d>0;){var e=c[--d];if(e.aabb.TestOverlap(b))if(e.IsLeaf()){var f=a(e);if(!f)return}else c[d++]=e.child1,c[d++]=e.child2}}},A.prototype.RayCast=function(a,b){if(null!=this.m_root){var c=b.p1,d=b.p2,e=l.SubtractVV(c,d);e.Normalize();var f=l.CrossFV(1,e),g=l.AbsV(f),h=b.maxFraction,i=new q,j=0,k=0;j=c.x+h*(d.x-c.x),k=c.y+h*(d.y-c.y),i.lowerBound.x=Math.min(c.x,j),i.lowerBound.y=Math.min(c.y,k),i.upperBound.x=Math.max(c.x,j),i.upperBound.y=Math.max(c.y,k);var m=new Vector,n=0;for(m[n++]=this.m_root;n>0;){var o=m[--n];if(0!=o.aabb.TestOverlap(i)){var p=o.aabb.GetCenter(),r=o.aabb.GetExtents(),s=Math.abs(f.x*(c.x-p.x)+f.y*(c.y-p.y))-g.x*r.x-g.y*r.y;if(!(s>0))if(o.IsLeaf()){var t=new H;if(t.p1=b.p1,t.p2=b.p2,t.maxFraction=b.maxFraction,h=a(t,o),0==h)return;h>0&&(j=c.x+h*(d.x-c.x),k=c.y+h*(d.y-c.y),i.lowerBound.x=Math.min(c.x,j),i.lowerBound.y=Math.min(c.y,k),i.upperBound.x=Math.max(c.x,j),i.upperBound.y=Math.max(c.y,k))}else m[n++]=o.child1,m[n++]=o.child2}}}},A.prototype.AllocateNode=function(){if(this.m_freeList){var a=this.m_freeList;return this.m_freeList=a.parent,a.parent=null,a.child1=null,a.child2=null,a}return new C},A.prototype.FreeNode=function(a){a.parent=this.m_freeList,this.m_freeList=a},A.prototype.InsertLeaf=function(a){if(++this.m_insertionCount,null==this.m_root)return this.m_root=a,void(this.m_root.parent=null);var b=a.aabb.GetCenter(),c=this.m_root;if(0==c.IsLeaf())do{var d=c.child1,e=c.child2,f=Math.abs((d.aabb.lowerBound.x+d.aabb.upperBound.x)/2-b.x)+Math.abs((d.aabb.lowerBound.y+d.aabb.upperBound.y)/2-b.y),g=Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-b.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-b.y);c=f<g?d:e}while(0==c.IsLeaf());var h=c.parent,i=this.AllocateNode();if(i.parent=h,i.userData=null,i.aabb.Combine(a.aabb,c.aabb),h){c.parent.child1==c?h.child1=i:h.child2=i,i.child1=c,i.child2=a,c.parent=i,a.parent=i;do{if(h.aabb.Contains(i.aabb))break;h.aabb.Combine(h.child1.aabb,h.child2.aabb),i=h,h=h.parent}while(h)}else i.child1=c,i.child2=a,c.parent=i,a.parent=i,this.m_root=i},A.prototype.RemoveLeaf=function(a){if(a==this.m_root)return void(this.m_root=null);var d,b=a.parent,c=b.parent;if(d=b.child1==a?b.child2:b.child1,c)for(c.child1==b?c.child1=d:c.child2=d,d.parent=c,this.FreeNode(b);c;){var e=c.aabb;if(c.aabb=q.Combine(c.child1.aabb,c.child2.aabb),e.Contains(c.aabb))break;c=c.parent}else this.m_root=d,d.parent=null,this.FreeNode(b)},B.b2DynamicTreeBroadPhase=function(){this.m_tree=new A,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},B.prototype.CreateProxy=function(a,b){var c=this.m_tree.CreateProxy(a,b);return++this.m_proxyCount,this.BufferMove(c),c},B.prototype.DestroyProxy=function(a){this.UnBufferMove(a),--this.m_proxyCount,this.m_tree.DestroyProxy(a)},B.prototype.MoveProxy=function(a,b,c){var d=this.m_tree.MoveProxy(a,b,c);d&&this.BufferMove(a)},B.prototype.TestOverlap=function(a,b){var c=this.m_tree.GetFatAABB(a),d=this.m_tree.GetFatAABB(b);return c.TestOverlap(d)},B.prototype.GetUserData=function(a){return this.m_tree.GetUserData(a)},B.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)},B.prototype.GetProxyCount=function(){return this.m_proxyCount},B.prototype.UpdatePairs=function(a){function e(a){if(a==d)return!0;b.m_pairCount==b.m_pairBuffer.length&&(b.m_pairBuffer[b.m_pairCount]=new D);var c=b.m_pairBuffer[b.m_pairCount];return c.proxyA=a<d?a:d,c.proxyB=a>=d?a:d,++b.m_pairCount,!0}var b=this;b.m_pairCount=0;var d,c=0;for(c=0;c<b.m_moveBuffer.length;++c){d=b.m_moveBuffer[c];var f=b.m_tree.GetFatAABB(d);b.m_tree.Query(e,f)}b.m_moveBuffer.length=0;for(var c=0;c<b.m_pairCount;){var g=b.m_pairBuffer[c],h=b.m_tree.GetUserData(g.proxyA),i=b.m_tree.GetUserData(g.proxyB);for(a(h,i),++c;c<b.m_pairCount;){var j=b.m_pairBuffer[c];if(j.proxyA!=g.proxyA||j.proxyB!=g.proxyB)break;++c}}},B.prototype.Query=function(a,b){this.m_tree.Query(a,b)},B.prototype.RayCast=function(a,b){this.m_tree.RayCast(a,b)},B.prototype.Validate=function(){},B.prototype.Rebalance=function(a){void 0===a&&(a=0),this.m_tree.Rebalance(a)},B.prototype.BufferMove=function(a){this.m_moveBuffer[this.m_moveBuffer.length]=a},B.prototype.UnBufferMove=function(a){var b=parseInt(this.m_moveBuffer.indexOf(a));this.m_moveBuffer.splice(b,1)},B.prototype.ComparePairs=function(a,b){return 0},B.__implements={},B.__implements[T]=!0,C.b2DynamicTreeNode=function(){this.aabb=new q},C.prototype.IsLeaf=function(){return null==this.child1},D.b2DynamicTreePair=function(){},E.b2Manifold=function(){this.m_pointCount=0},E.prototype.b2Manifold=function(){this.m_points=new Vector(i.b2_maxManifoldPoints);for(var a=0;a<i.b2_maxManifoldPoints;a++)this.m_points[a]=new F;this.m_localPlaneNormal=new o,this.m_localPoint=new o},E.prototype.Reset=function(){for(var a=0;a<i.b2_maxManifoldPoints;a++)(this.m_points[a]instanceof F?this.m_points[a]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},E.prototype.Set=function(a){this.m_pointCount=a.m_pointCount;for(var b=0;b<i.b2_maxManifoldPoints;b++)(this.m_points[b]instanceof F?this.m_points[b]:null).Set(a.m_points[b]);this.m_localPlaneNormal.SetV(a.m_localPlaneNormal),this.m_localPoint.SetV(a.m_localPoint),this.m_type=a.m_type},E.prototype.Copy=function(){var a=new E;return a.Set(this),a},Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4}),F.b2ManifoldPoint=function(){this.m_localPoint=new o,this.m_id=new u},F.prototype.b2ManifoldPoint=function(){this.Reset()},F.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},F.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint),this.m_normalImpulse=a.m_normalImpulse,this.m_tangentImpulse=a.m_tangentImpulse,this.m_id.Set(a.m_id)},G.b2Point=function(){this.p=new o},G.prototype.Support=function(a,b,c){return void 0===b&&(b=0),void 0===c&&(c=0),this.p},G.prototype.GetFirstVertex=function(a){return this.p},H.b2RayCastInput=function(){this.p1=new o,this.p2=new o},H.prototype.b2RayCastInput=function(a,b,c){void 0===a&&(a=null),void 0===b&&(b=null),void 0===c&&(c=1),a&&this.p1.SetV(a),b&&this.p2.SetV(b),this.maxFraction=c},I.b2RayCastOutput=function(){this.normal=new o},J.b2Segment=function(){this.p1=new o,this.p2=new o},J.prototype.TestSegment=function(a,b,c,d){void 0===d&&(d=0);var e=c.p1,f=c.p2.x-e.x,g=c.p2.y-e.y,h=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,j=i,k=-h,l=100*Number.MIN_VALUE,m=-(f*j+g*k);if(m>l){var n=e.x-this.p1.x,o=e.y-this.p1.y,p=n*j+o*k;if(0<=p&&p<=d*m){var q=-f*o+g*n;if(-l*m<=q&&q<=m*(1+l)){p/=m;var r=Math.sqrt(j*j+k*k);return j/=r,k/=r,a[0]=p,b.Set(j,k),!0}}}return!1},J.prototype.Extend=function(a){this.ExtendForward(a),this.ExtendBackward(a)},J.prototype.ExtendForward=function(a){var b=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y,d=Math.min(b>0?(a.upperBound.x-this.p1.x)/b:b<0?(a.lowerBound.x-this.p1.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p1.y)/c:c<0?(a.lowerBound.y-this.p1.y)/c:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+b*d,this.p2.y=this.p1.y+c*d},J.prototype.ExtendBackward=function(a){var b=-this.p2.x+this.p1.x,c=-this.p2.y+this.p1.y,d=Math.min(b>0?(a.upperBound.x-this.p2.x)/b:b<0?(a.lowerBound.x-this.p2.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p2.y)/c:c<0?(a.lowerBound.y-this.p2.y)/c:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+b*d,this.p1.y=this.p2.y+c*d},K.b2SeparationFunction=function(){this.m_localPoint=new o,this.m_axis=new o},K.prototype.Initialize=function(a,b,c,d,e){this.m_proxyA=b,this.m_proxyB=d;var f=parseInt(a.count);i.b2Assert(0<f&&f<3);var g,h,j,k,m,n,v,w,p=0,q=0,r=0,s=0,t=0,u=0,x=0,y=0;if(1==f)this.m_type=K.e_points,g=this.m_proxyA.GetVertex(a.indexA[0]),k=this.m_proxyB.GetVertex(a.indexB[0]),w=g,v=c.R,p=c.position.x+(v.col1.x*w.x+v.col2.x*w.y),q=c.position.y+(v.col1.y*w.x+v.col2.y*w.y),w=k,v=e.R,r=e.position.x+(v.col1.x*w.x+v.col2.x*w.y),s=e.position.y+(v.col1.y*w.x+v.col2.y*w.y),this.m_axis.x=r-p,this.m_axis.y=s-q,this.m_axis.Normalize();else if(a.indexB[0]==a.indexB[1])this.m_type=K.e_faceA,h=this.m_proxyA.GetVertex(a.indexA[0]),j=this.m_proxyA.GetVertex(a.indexA[1]),k=this.m_proxyB.GetVertex(a.indexB[0]),this.m_localPoint.x=.5*(h.x+j.x),this.m_localPoint.y=.5*(h.y+j.y),this.m_axis=l.CrossVF(l.SubtractVV(j,h),1),this.m_axis.Normalize(),w=this.m_axis,v=c.R,t=v.col1.x*w.x+v.col2.x*w.y,u=v.col1.y*w.x+v.col2.y*w.y,w=this.m_localPoint,v=c.R,p=c.position.x+(v.col1.x*w.x+v.col2.x*w.y),q=c.position.y+(v.col1.y*w.x+v.col2.y*w.y),w=k,v=e.R,r=e.position.x+(v.col1.x*w.x+v.col2.x*w.y),s=e.position.y+(v.col1.y*w.x+v.col2.y*w.y),x=(r-p)*t+(s-q)*u,x<0&&this.m_axis.NegativeSelf();else if(a.indexA[0]==a.indexA[0])this.m_type=K.e_faceB,m=this.m_proxyB.GetVertex(a.indexB[0]),n=this.m_proxyB.GetVertex(a.indexB[1]),g=this.m_proxyA.GetVertex(a.indexA[0]),this.m_localPoint.x=.5*(m.x+n.x),this.m_localPoint.y=.5*(m.y+n.y),this.m_axis=l.CrossVF(l.SubtractVV(n,m),1),this.m_axis.Normalize(),w=this.m_axis,v=e.R,t=v.col1.x*w.x+v.col2.x*w.y,u=v.col1.y*w.x+v.col2.y*w.y,w=this.m_localPoint,v=e.R,r=e.position.x+(v.col1.x*w.x+v.col2.x*w.y),s=e.position.y+(v.col1.y*w.x+v.col2.y*w.y),w=g,v=c.R,p=c.position.x+(v.col1.x*w.x+v.col2.x*w.y),q=c.position.y+(v.col1.y*w.x+v.col2.y*w.y),x=(p-r)*t+(q-s)*u,x<0&&this.m_axis.NegativeSelf();else{h=this.m_proxyA.GetVertex(a.indexA[0]),j=this.m_proxyA.GetVertex(a.indexA[1]),m=this.m_proxyB.GetVertex(a.indexB[0]),n=this.m_proxyB.GetVertex(a.indexB[1]);var A=(l.MulX(c,g),l.MulMV(c.R,l.SubtractVV(j,h))),C=(l.MulX(e,k),l.MulMV(e.R,l.SubtractVV(n,m))),D=A.x*A.x+A.y*A.y,E=C.x*C.x+C.y*C.y,F=l.SubtractVV(C,A),G=A.x*F.x+A.y*F.y,H=C.x*F.x+C.y*F.y,I=A.x*C.x+A.y*C.y,J=D*E-I*I;x=0,0!=J&&(x=l.Clamp((I*H-G*E)/J,0,1));var L=(I*x+H)/E;L<0&&(L=0,x=l.Clamp((I-G)/D,0,1)),g=new o,g.x=h.x+x*(j.x-h.x),g.y=h.y+x*(j.y-h.y),k=new o,k.x=m.x+x*(n.x-m.x),k.y=m.y+x*(n.y-m.y),0==x||1==x?(this.m_type=K.e_faceB,this.m_axis=l.CrossVF(l.SubtractVV(n,m),1),this.m_axis.Normalize(),this.m_localPoint=k,w=this.m_axis,v=e.R,t=v.col1.x*w.x+v.col2.x*w.y,u=v.col1.y*w.x+v.col2.y*w.y,w=this.m_localPoint,v=e.R,r=e.position.x+(v.col1.x*w.x+v.col2.x*w.y),s=e.position.y+(v.col1.y*w.x+v.col2.y*w.y),w=g,v=c.R,p=c.position.x+(v.col1.x*w.x+v.col2.x*w.y),q=c.position.y+(v.col1.y*w.x+v.col2.y*w.y),y=(p-r)*t+(q-s)*u,x<0&&this.m_axis.NegativeSelf()):(this.m_type=K.e_faceA,this.m_axis=l.CrossVF(l.SubtractVV(j,h),1),this.m_localPoint=g,w=this.m_axis,v=c.R,t=v.col1.x*w.x+v.col2.x*w.y,u=v.col1.y*w.x+v.col2.y*w.y,w=this.m_localPoint,v=c.R,p=c.position.x+(v.col1.x*w.x+v.col2.x*w.y),q=c.position.y+(v.col1.y*w.x+v.col2.y*w.y),w=k,v=e.R,r=e.position.x+(v.col1.x*w.x+v.col2.x*w.y),s=e.position.y+(v.col1.y*w.x+v.col2.y*w.y),y=(r-p)*t+(s-q)*u,x<0&&this.m_axis.NegativeSelf())}},K.prototype.Evaluate=function(a,b){var c,d,e,f,g,h,k,j=0;switch(this.m_type){case K.e_points:return c=l.MulTMV(a.R,this.m_axis),d=l.MulTMV(b.R,this.m_axis.GetNegative()),e=this.m_proxyA.GetSupportVertex(c),f=this.m_proxyB.GetSupportVertex(d),g=l.MulX(a,e),h=l.MulX(b,f),j=(h.x-g.x)*this.m_axis.x+(h.y-g.y)*this.m_axis.y;case K.e_faceA:return k=l.MulMV(a.R,this.m_axis),g=l.MulX(a,this.m_localPoint),d=l.MulTMV(b.R,k.GetNegative()),f=this.m_proxyB.GetSupportVertex(d),h=l.MulX(b,f),j=(h.x-g.x)*k.x+(h.y-g.y)*k.y;case K.e_faceB:return k=l.MulMV(b.R,this.m_axis),h=l.MulX(b,this.m_localPoint),c=l.MulTMV(a.R,k.GetNegative()),e=this.m_proxyA.GetSupportVertex(c),g=l.MulX(a,e),j=(g.x-h.x)*k.x+(g.y-h.y)*k.y;default:return i.b2Assert(!1),0}},Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4}),L.b2Simplex=function(){this.m_v1=new N,this.m_v2=new N,this.m_v3=new N,this.m_vertices=new Vector(3)},L.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},L.prototype.ReadCache=function(a,b,c,d,e){i.b2Assert(0<=a.count&&a.count<=3);var f,g;this.m_count=a.count;for(var h=this.m_vertices,j=0;j<this.m_count;j++){var k=h[j];k.indexA=a.indexA[j],k.indexB=a.indexB[j],f=b.GetVertex(k.indexA),g=d.GetVertex(k.indexB),k.wA=l.MulX(c,f),k.wB=l.MulX(e,g),k.w=l.SubtractVV(k.wB,k.wA),k.a=0}if(this.m_count>1){var m=a.metric,n=this.GetMetric();(n<.5*m||2*m<n||n<Number.MIN_VALUE)&&(this.m_count=0)}0==this.m_count&&(k=h[0],k.indexA=0,k.indexB=0,f=b.GetVertex(0),g=d.GetVertex(0),k.wA=l.MulX(c,f),k.wB=l.MulX(e,g),k.w=l.SubtractVV(k.wB,k.wA),this.m_count=1)},L.prototype.WriteCache=function(a){a.metric=this.GetMetric(),a.count=Box2D.parseUInt(this.m_count);for(var b=this.m_vertices,c=0;c<this.m_count;c++)a.indexA[c]=Box2D.parseUInt(b[c].indexA),a.indexB[c]=Box2D.parseUInt(b[c].indexB)},L.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var a=l.SubtractVV(this.m_v2.w,this.m_v1.w),b=l.CrossVV(a,this.m_v1.w.GetNegative());return b>0?l.CrossFV(1,a):l.CrossVF(a,1);default:return i.b2Assert(!1),new o}},L.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return i.b2Assert(!1),new o;case 1:return this.m_v1.w;case 2:return new o(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return i.b2Assert(!1),new o}},L.prototype.GetWitnessPoints=function(a,b){switch(this.m_count){case 0:i.b2Assert(!1);break;case 1:a.SetV(this.m_v1.wA),b.SetV(this.m_v1.wB);break;case 2:a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,b.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,b.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:b.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,b.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:i.b2Assert(!1)}},L.prototype.GetMetric=function(){switch(this.m_count){case 0:return i.b2Assert(!1),0;case 1:return 0;case 2:return l.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return l.CrossVV(l.SubtractVV(this.m_v2.w,this.m_v1.w),l.SubtractVV(this.m_v3.w,this.m_v1.w));default:return i.b2Assert(!1),0}},L.prototype.Solve2=function(){var a=this.m_v1.w,b=this.m_v2.w,c=l.SubtractVV(b,a),d=-(a.x*c.x+a.y*c.y);if(d<=0)return this.m_v1.a=1,void(this.m_count=1);var e=b.x*c.x+b.y*c.y;if(e<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);var f=1/(e+d);this.m_v1.a=e*f,this.m_v2.a=d*f,this.m_count=2},L.prototype.Solve3=function(){var a=this.m_v1.w,b=this.m_v2.w,c=this.m_v3.w,d=l.SubtractVV(b,a),e=l.Dot(a,d),f=l.Dot(b,d),g=f,h=-e,i=l.SubtractVV(c,a),j=l.Dot(a,i),k=l.Dot(c,i),m=k,n=-j,o=l.SubtractVV(c,b),p=l.Dot(b,o),q=l.Dot(c,o),r=q,s=-p,t=l.CrossVV(d,i),u=t*l.CrossVV(b,c),v=t*l.CrossVV(c,a),w=t*l.CrossVV(a,b);if(h<=0&&n<=0)return this.m_v1.a=1,void(this.m_count=1);if(g>0&&h>0&&w<=0){var x=1/(g+h);return this.m_v1.a=g*x,this.m_v2.a=h*x,void(this.m_count=2)}if(m>0&&n>0&&v<=0){var y=1/(m+n);return this.m_v1.a=m*y,this.m_v3.a=n*y,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(g<=0&&s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(m<=0&&r<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(r>0&&s>0&&u<=0){var z=1/(r+s);return this.m_v2.a=r*z,this.m_v3.a=s*z,this.m_count=2,void this.m_v1.Set(this.m_v3)}var A=1/(u+v+w);this.m_v1.a=u*A,this.m_v2.a=v*A,this.m_v3.a=w*A,this.m_count=3},M.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},N.b2SimplexVertex=function(){},N.prototype.Set=function(a){this.wA.SetV(a.wA),this.wB.SetV(a.wB),this.w.SetV(a.w),this.a=a.a,this.indexA=a.indexA,this.indexB=a.indexB},O.b2TimeOfImpact=function(){},O.TimeOfImpact=function(a){++O.b2_toiCalls;var b=a.proxyA,c=a.proxyB,d=a.sweepA,e=a.sweepB;i.b2Assert(d.t0==e.t0),i.b2Assert(1-d.t0>Number.MIN_VALUE);var f=b.m_radius+c.m_radius,g=a.tolerance,h=0,j=1e3,k=0,m=0;for(O.s_cache.count=0,O.s_distanceInput.useRadii=!1;;){if(d.GetTransform(O.s_xfA,h),e.GetTransform(O.s_xfB,h),O.s_distanceInput.proxyA=b,O.s_distanceInput.proxyB=c,O.s_distanceInput.transformA=O.s_xfA,O.s_distanceInput.transformB=O.s_xfB,w.Distance(O.s_distanceOutput,O.s_cache,O.s_distanceInput),O.s_distanceOutput.distance<=0){h=1;break}O.s_fcn.Initialize(O.s_cache,b,O.s_xfA,c,O.s_xfB);var n=O.s_fcn.Evaluate(O.s_xfA,O.s_xfB);if(n<=0){h=1;break}if(0==k&&(m=n>f?l.Max(f-g,.75*f):l.Max(n-g,.02*f)),n-m<.5*g){if(0==k){h=1;break}break}var o=h,p=h,q=1,r=n;d.GetTransform(O.s_xfA,q),e.GetTransform(O.s_xfB,q);var s=O.s_fcn.Evaluate(O.s_xfA,O.s_xfB);if(s>=m){h=1;break}for(var t=0;;){var u=0;u=1&t?p+(m-r)*(q-p)/(s-r):.5*(p+q),d.GetTransform(O.s_xfA,u),e.GetTransform(O.s_xfB,u);var v=O.s_fcn.Evaluate(O.s_xfA,O.s_xfB);if(l.Abs(v-m)<.025*g){o=u;break}if(v>m?(p=u,r=v):(q=u,s=v),++t,++O.b2_toiRootIters,50==t)break}if(O.b2_toiMaxRootIters=l.Max(O.b2_toiMaxRootIters,t),o<(1+100*Number.MIN_VALUE)*h)break;if(h=o,k++,++O.b2_toiIters,k==j)break}return O.b2_toiMaxIters=l.Max(O.b2_toiMaxIters,k),h},Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new M,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new x,
Box2D.Collision.b2TimeOfImpact.s_xfA=new n,Box2D.Collision.b2TimeOfImpact.s_xfB=new n,Box2D.Collision.b2TimeOfImpact.s_fcn=new K,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new y}),P.b2TOIInput=function(){this.proxyA=new z,this.proxyB=new z,this.sweepA=new m,this.sweepB=new m},Q.b2WorldManifold=function(){this.m_normal=new o},Q.prototype.b2WorldManifold=function(){this.m_points=new Vector(i.b2_maxManifoldPoints);for(var a=0;a<i.b2_maxManifoldPoints;a++)this.m_points[a]=new o},Q.prototype.Initialize=function(a,b,c,d,e){if(void 0===c&&(c=0),void 0===e&&(e=0),0!=a.m_pointCount){var g,h,f=0,i=0,j=0,k=0,l=0,m=0,n=0;switch(a.m_type){case E.e_circles:h=b.R,g=a.m_localPoint;var o=b.position.x+h.col1.x*g.x+h.col2.x*g.y,p=b.position.y+h.col1.y*g.x+h.col2.y*g.y;h=d.R,g=a.m_points[0].m_localPoint;var q=d.position.x+h.col1.x*g.x+h.col2.x*g.y,r=d.position.y+h.col1.y*g.x+h.col2.y*g.y,s=q-o,t=r-p,u=s*s+t*t;if(u>Number.MIN_VALUE*Number.MIN_VALUE){var v=Math.sqrt(u);this.m_normal.x=s/v,this.m_normal.y=t/v}else this.m_normal.x=1,this.m_normal.y=0;var w=o+c*this.m_normal.x,x=p+c*this.m_normal.y,y=q-e*this.m_normal.x,z=r-e*this.m_normal.y;this.m_points[0].x=.5*(w+y),this.m_points[0].y=.5*(x+z);break;case E.e_faceA:for(h=b.R,g=a.m_localPlaneNormal,i=h.col1.x*g.x+h.col2.x*g.y,j=h.col1.y*g.x+h.col2.y*g.y,h=b.R,g=a.m_localPoint,k=b.position.x+h.col1.x*g.x+h.col2.x*g.y,l=b.position.y+h.col1.y*g.x+h.col2.y*g.y,this.m_normal.x=i,this.m_normal.y=j,f=0;f<a.m_pointCount;f++)h=d.R,g=a.m_points[f].m_localPoint,m=d.position.x+h.col1.x*g.x+h.col2.x*g.y,n=d.position.y+h.col1.y*g.x+h.col2.y*g.y,this.m_points[f].x=m+.5*(c-(m-k)*i-(n-l)*j-e)*i,this.m_points[f].y=n+.5*(c-(m-k)*i-(n-l)*j-e)*j;break;case E.e_faceB:for(h=d.R,g=a.m_localPlaneNormal,i=h.col1.x*g.x+h.col2.x*g.y,j=h.col1.y*g.x+h.col2.y*g.y,h=d.R,g=a.m_localPoint,k=d.position.x+h.col1.x*g.x+h.col2.x*g.y,l=d.position.y+h.col1.y*g.x+h.col2.y*g.y,this.m_normal.x=-i,this.m_normal.y=-j,f=0;f<a.m_pointCount;f++)h=b.R,g=a.m_points[f].m_localPoint,m=b.position.x+h.col1.x*g.x+h.col2.x*g.y,n=b.position.y+h.col1.y*g.x+h.col2.y*g.y,this.m_points[f].x=m+.5*(e-(m-k)*i-(n-l)*j-c)*i,this.m_points[f].y=n+.5*(e-(m-k)*i-(n-l)*j-c)*j}}},R.ClipVertex=function(){this.v=new o,this.id=new u},R.prototype.Set=function(a){this.v.SetV(a.v),this.id.Set(a.id)},S.Features=function(){},Object.defineProperty(S.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(S.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._referenceEdge=a,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}}),Object.defineProperty(S.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(S.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._incidentEdge=a,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}}),Object.defineProperty(S.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(S.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._incidentVertex=a,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}}),Object.defineProperty(S.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(S.prototype,"flip",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._flip=a,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}})}(),function(){var c=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),d=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,f=Box2D.Collision.Shapes.b2EdgeShape,g=Box2D.Collision.Shapes.b2MassData,h=Box2D.Collision.Shapes.b2PolygonShape,i=Box2D.Collision.Shapes.b2Shape,j=Box2D.Common.Math.b2Mat22,l=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),n=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform),o=Box2D.Common.Math.b2Vec2,K=(Box2D.Common.Math.b2Vec3,Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance),L=Box2D.Collision.b2DistanceInput,M=Box2D.Collision.b2DistanceOutput,N=Box2D.Collision.b2DistanceProxy,$=(Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache);Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase;Box2D.inherit(d,Box2D.Collision.Shapes.b2Shape),d.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,d.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new o},d.prototype.Copy=function(){var a=new d;return a.Set(this),a},d.prototype.Set=function(a){if(this.__super.Set.call(this,a),Box2D.is(a,d)){var b=a instanceof d?a:null;this.m_p.SetV(b.m_p)}},d.prototype.TestPoint=function(a,b){var c=a.R,d=a.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),e=a.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);return d=b.x-d,e=b.y-e,d*d+e*e<=this.m_radius*this.m_radius},d.prototype.RayCast=function(a,b,c){var d=c.R,e=c.position.x+(d.col1.x*this.m_p.x+d.col2.x*this.m_p.y),f=c.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y),g=b.p1.x-e,h=b.p1.y-f,i=g*g+h*h-this.m_radius*this.m_radius,j=b.p2.x-b.p1.x,k=b.p2.y-b.p1.y,l=g*j+h*k,m=j*j+k*k,n=l*l-m*i;if(n<0||m<Number.MIN_VALUE)return!1;var o=-(l+Math.sqrt(n));return 0<=o&&o<=b.maxFraction*m&&(o/=m,a.fraction=o,a.normal.x=g+o*j,a.normal.y=h+o*k,a.normal.Normalize(),!0)},d.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),e=b.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);a.lowerBound.Set(d-this.m_radius,e-this.m_radius),a.upperBound.Set(d+this.m_radius,e+this.m_radius)},d.prototype.ComputeMass=function(a,b){void 0===b&&(b=0),a.mass=b*c.b2_pi*this.m_radius*this.m_radius,a.center.SetV(this.m_p),a.I=a.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},d.prototype.ComputeSubmergedArea=function(a,b,c,d){void 0===b&&(b=0);var e=l.MulX(c,this.m_p),f=-(l.Dot(a,e)-b);if(f<-this.m_radius+Number.MIN_VALUE)return 0;if(f>this.m_radius)return d.SetV(e),Math.PI*this.m_radius*this.m_radius;var g=this.m_radius*this.m_radius,h=f*f,i=g*(Math.asin(f/this.m_radius)+Math.PI/2)+f*Math.sqrt(g-h),j=-2/3*Math.pow(g-h,1.5)/i;return d.x=e.x+a.x*j,d.y=e.y+a.y*j,i},d.prototype.GetLocalPosition=function(){return this.m_p},d.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)},d.prototype.GetRadius=function(){return this.m_radius},d.prototype.SetRadius=function(a){void 0===a&&(a=0),this.m_radius=a},d.prototype.b2CircleShape=function(a){void 0===a&&(a=0),this.__super.b2Shape.call(this),this.m_type=i.e_circleShape,this.m_radius=a},e.b2EdgeChainDef=function(){},e.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.inherit(f,Box2D.Collision.Shapes.b2Shape),f.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,f.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new o,this.m_v1=new o,this.m_v2=new o,this.m_coreV1=new o,this.m_coreV2=new o,this.m_normal=new o,this.m_direction=new o,this.m_cornerDir1=new o,this.m_cornerDir2=new o},f.prototype.TestPoint=function(a,b){return!1},f.prototype.RayCast=function(a,b,c){var d,e=b.p2.x-b.p1.x,f=b.p2.y-b.p1.y;d=c.R;var g=c.position.x+(d.col1.x*this.m_v1.x+d.col2.x*this.m_v1.y),h=c.position.y+(d.col1.y*this.m_v1.x+d.col2.y*this.m_v1.y),i=c.position.y+(d.col1.y*this.m_v2.x+d.col2.y*this.m_v2.y)-h,j=-(c.position.x+(d.col1.x*this.m_v2.x+d.col2.x*this.m_v2.y)-g),k=100*Number.MIN_VALUE,l=-(e*i+f*j);if(l>k){var m=b.p1.x-g,n=b.p1.y-h,o=m*i+n*j;if(0<=o&&o<=b.maxFraction*l){var p=-e*n+f*m;if(-k*l<=p&&p<=l*(1+k)){o/=l,a.fraction=o;var q=Math.sqrt(i*i+j*j);return a.normal.x=i/q,a.normal.y=j/q,!0}}}return!1},f.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_v1.x+c.col2.x*this.m_v1.y),e=b.position.y+(c.col1.y*this.m_v1.x+c.col2.y*this.m_v1.y),f=b.position.x+(c.col1.x*this.m_v2.x+c.col2.x*this.m_v2.y),g=b.position.y+(c.col1.y*this.m_v2.x+c.col2.y*this.m_v2.y);d<f?(a.lowerBound.x=d,a.upperBound.x=f):(a.lowerBound.x=f,a.upperBound.x=d),e<g?(a.lowerBound.y=e,a.upperBound.y=g):(a.lowerBound.y=g,a.upperBound.y=e)},f.prototype.ComputeMass=function(a,b){void 0===b&&(b=0),a.mass=0,a.center.SetV(this.m_v1),a.I=0},f.prototype.ComputeSubmergedArea=function(a,b,c,d){void 0===b&&(b=0);var e=new o(a.x*b,a.y*b),f=l.MulX(c,this.m_v1),g=l.MulX(c,this.m_v2),h=l.Dot(a,f)-b,i=l.Dot(a,g)-b;if(h>0){if(i>0)return 0;f.x=-i/(h-i)*f.x+h/(h-i)*g.x,f.y=-i/(h-i)*f.y+h/(h-i)*g.y}else i>0&&(g.x=-i/(h-i)*f.x+h/(h-i)*g.x,g.y=-i/(h-i)*f.y+h/(h-i)*g.y);return d.x=(e.x+f.x+g.x)/3,d.y=(e.y+f.y+g.y)/3,.5*((f.x-e.x)*(g.y-e.y)-(f.y-e.y)*(g.x-e.x))},f.prototype.GetLength=function(){return this.m_length},f.prototype.GetVertex1=function(){return this.m_v1},f.prototype.GetVertex2=function(){return this.m_v2},f.prototype.GetCoreVertex1=function(){return this.m_coreV1},f.prototype.GetCoreVertex2=function(){return this.m_coreV2},f.prototype.GetNormalVector=function(){return this.m_normal},f.prototype.GetDirectionVector=function(){return this.m_direction},f.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},f.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},f.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},f.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},f.prototype.GetFirstVertex=function(a){var b=a.R;return new o(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))},f.prototype.GetNextEdge=function(){return this.m_nextEdge},f.prototype.GetPrevEdge=function(){return this.m_prevEdge},f.prototype.Support=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0);var d=a.R,e=a.position.x+(d.col1.x*this.m_coreV1.x+d.col2.x*this.m_coreV1.y),f=a.position.y+(d.col1.y*this.m_coreV1.x+d.col2.y*this.m_coreV1.y),g=a.position.x+(d.col1.x*this.m_coreV2.x+d.col2.x*this.m_coreV2.y),h=a.position.y+(d.col1.y*this.m_coreV2.x+d.col2.y*this.m_coreV2.y);return e*b+f*c>g*b+h*c?(this.s_supportVec.x=e,this.s_supportVec.y=f):(this.s_supportVec.x=g,this.s_supportVec.y=h),this.s_supportVec},f.prototype.b2EdgeShape=function(a,b){this.__super.b2Shape.call(this),this.m_type=i.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=a,this.m_v2=b,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-c.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-c.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-c.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-c.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},f.prototype.SetPrevEdge=function(a,b,c,d){this.m_prevEdge=a,this.m_coreV1=b,this.m_cornerDir1=c,this.m_cornerConvex1=d},f.prototype.SetNextEdge=function(a,b,c,d){this.m_nextEdge=a,this.m_coreV2=b,this.m_cornerDir2=c,this.m_cornerConvex2=d},g.b2MassData=function(){this.mass=0,this.center=new o(0,0),this.I=0},Box2D.inherit(h,Box2D.Collision.Shapes.b2Shape),h.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,h.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},h.prototype.Copy=function(){var a=new h;return a.Set(this),a},h.prototype.Set=function(a){if(this.__super.Set.call(this,a),Box2D.is(a,h)){var b=a instanceof h?a:null;this.m_centroid.SetV(b.m_centroid),this.m_vertexCount=b.m_vertexCount,this.Reserve(this.m_vertexCount);for(var c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(b.m_vertices[c]),this.m_normals[c].SetV(b.m_normals[c])}},h.prototype.SetAsArray=function(a,b){void 0===b&&(b=0);var e,c=new Vector,d=0;for(d=0;d<a.length;++d)e=a[d],c.push(e);this.SetAsVector(c,b)},h.AsArray=function(a,b){void 0===b&&(b=0);var c=new h;return c.SetAsArray(a,b),c},h.prototype.SetAsVector=function(a,b){void 0===b&&(b=0),0==b&&(b=a.length),c.b2Assert(2<=b),this.m_vertexCount=b,this.Reserve(b);var d=0;for(d=0;d<this.m_vertexCount;d++)this.m_vertices[d].SetV(a[d]);for(d=0;d<this.m_vertexCount;++d){var e=parseInt(d),f=parseInt(d+1<this.m_vertexCount?d+1:0),g=l.SubtractVV(this.m_vertices[f],this.m_vertices[e]);c.b2Assert(g.LengthSquared()>Number.MIN_VALUE),this.m_normals[d].SetV(l.CrossVF(g,1)),this.m_normals[d].Normalize()}this.m_centroid=h.ComputeCentroid(this.m_vertices,this.m_vertexCount)},h.AsVector=function(a,b){void 0===b&&(b=0);var c=new h;return c.SetAsVector(a,b),c},h.prototype.SetAsBox=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},h.AsBox=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0);var c=new h;return c.SetAsBox(a,b),c},h.prototype.SetAsOrientedBox=function(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=null),void 0===d&&(d=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=c;var e=new n;e.position=c,e.R.Set(d);for(var f=0;f<this.m_vertexCount;++f)this.m_vertices[f]=l.MulX(e,this.m_vertices[f]),this.m_normals[f]=l.MulMV(e.R,this.m_normals[f])},h.AsOrientedBox=function(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=null),void 0===d&&(d=0);var e=new h;return e.SetAsOrientedBox(a,b,c,d),e},h.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(a),this.m_vertices[1].SetV(b),this.m_centroid.x=.5*(a.x+b.x),this.m_centroid.y=.5*(a.y+b.y),this.m_normals[0]=l.CrossVF(l.SubtractVV(b,a),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},h.AsEdge=function(a,b){var c=new h;return c.SetAsEdge(a,b),c},h.prototype.TestPoint=function(a,b){for(var c,d=a.R,e=b.x-a.position.x,f=b.y-a.position.y,g=e*d.col1.x+f*d.col1.y,h=e*d.col2.x+f*d.col2.y,i=0;i<this.m_vertexCount;++i){c=this.m_vertices[i],e=g-c.x,f=h-c.y,c=this.m_normals[i];var j=c.x*e+c.y*f;if(j>0)return!1}return!0},h.prototype.RayCast=function(a,b,c){var h,i,d=0,e=b.maxFraction,f=0,g=0;f=b.p1.x-c.position.x,g=b.p1.y-c.position.y,h=c.R;var j=f*h.col1.x+g*h.col1.y,k=f*h.col2.x+g*h.col2.y;f=b.p2.x-c.position.x,g=b.p2.y-c.position.y,h=c.R;for(var l=f*h.col1.x+g*h.col1.y,m=f*h.col2.x+g*h.col2.y,n=l-j,o=m-k,p=parseInt(-1),q=0;q<this.m_vertexCount;++q){i=this.m_vertices[q],f=i.x-j,g=i.y-k,i=this.m_normals[q];var r=i.x*f+i.y*g,s=i.x*n+i.y*o;if(0==s){if(r<0)return!1}else s<0&&r<d*s?(d=r/s,p=q):s>0&&r<e*s&&(e=r/s);if(e<d-Number.MIN_VALUE)return!1}return p>=0&&(a.fraction=d,h=c.R,i=this.m_normals[p],a.normal.x=h.col1.x*i.x+h.col2.x*i.y,a.normal.y=h.col1.y*i.x+h.col2.y*i.y,!0)},h.prototype.ComputeAABB=function(a,b){for(var c=b.R,d=this.m_vertices[0],e=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),f=b.position.y+(c.col1.y*d.x+c.col2.y*d.y),g=e,h=f,i=1;i<this.m_vertexCount;++i){d=this.m_vertices[i];var j=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),k=b.position.y+(c.col1.y*d.x+c.col2.y*d.y);e=e<j?e:j,f=f<k?f:k,g=g>j?g:j,h=h>k?h:k}a.lowerBound.x=e-this.m_radius,a.lowerBound.y=f-this.m_radius,a.upperBound.x=g+this.m_radius,a.upperBound.y=h+this.m_radius},h.prototype.ComputeMass=function(a,b){if(void 0===b&&(b=0),2==this.m_vertexCount)return a.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,void(a.I=0);for(var c=0,d=0,e=0,f=0,g=0,h=0,i=1/3,j=0;j<this.m_vertexCount;++j){var k=this.m_vertices[j],l=j+1<this.m_vertexCount?this.m_vertices[parseInt(j+1)]:this.m_vertices[0],m=k.x-g,n=k.y-h,o=l.x-g,p=l.y-h,q=m*p-n*o,r=.5*q;e+=r,c+=r*i*(g+k.x+l.x),d+=r*i*(h+k.y+l.y);var s=g,t=h,u=m,v=n,w=o,x=p,y=i*(.25*(u*u+w*u+w*w)+(s*u+s*w))+.5*s*s,z=i*(.25*(v*v+x*v+x*x)+(t*v+t*x))+.5*t*t;f+=q*(y+z)}a.mass=b*e,c*=1/e,d*=1/e,a.center.Set(c,d),a.I=b*f},h.prototype.ComputeSubmergedArea=function(a,b,c,d){void 0===b&&(b=0);var e=l.MulTMV(c.R,a),f=b-l.Dot(a,c.position),h=new Vector_a2j_Number,i=0,j=parseInt(-1),k=parseInt(-1),m=!1,n=0;for(n=0;n<this.m_vertexCount;++n){h[n]=l.Dot(e,this.m_vertices[n])-f;var p=h[n]<-Number.MIN_VALUE;n>0&&(p?m||(j=n-1,i++):m&&(k=n-1,i++)),m=p}switch(i){case 0:if(m){var q=new g;return this.ComputeMass(q,1),d.SetV(l.MulX(c,q.center)),q.mass}return 0;case 1:j==-1?j=this.m_vertexCount-1:k=this.m_vertexCount-1}var A,r=parseInt((j+1)%this.m_vertexCount),s=parseInt((k+1)%this.m_vertexCount),t=(0-h[j])/(h[r]-h[j]),u=(0-h[k])/(h[s]-h[k]),v=new o(this.m_vertices[j].x*(1-t)+this.m_vertices[r].x*t,this.m_vertices[j].y*(1-t)+this.m_vertices[r].y*t),w=new o(this.m_vertices[k].x*(1-u)+this.m_vertices[s].x*u,this.m_vertices[k].y*(1-u)+this.m_vertices[s].y*u),x=0,y=new o,z=this.m_vertices[r];for(n=r;n!=s;){n=(n+1)%this.m_vertexCount,A=n==s?w:this.m_vertices[n];var B=.5*((z.x-v.x)*(A.y-v.y)-(z.y-v.y)*(A.x-v.x));x+=B,y.x+=B*(v.x+z.x+A.x)/3,y.y+=B*(v.y+z.y+A.y)/3,z=A}return y.Multiply(1/x),d.SetV(l.MulX(c,y)),x},h.prototype.GetVertexCount=function(){return this.m_vertexCount},h.prototype.GetVertices=function(){return this.m_vertices},h.prototype.GetNormals=function(){return this.m_normals},h.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},h.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},h.prototype.Validate=function(){return!1},h.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=i.e_polygonShape,this.m_centroid=new o,this.m_vertices=new Vector,this.m_normals=new Vector},h.prototype.Reserve=function(a){void 0===a&&(a=0);for(var b=parseInt(this.m_vertices.length);b<a;b++)this.m_vertices[b]=new o,this.m_normals[b]=new o},h.ComputeCentroid=function(a,b){void 0===b&&(b=0);for(var c=new o,d=0,e=0,f=0,g=1/3,h=0;h<b;++h){var i=a[h],j=h+1<b?a[parseInt(h+1)]:a[0],k=i.x-e,l=i.y-f,m=j.x-e,n=j.y-f,p=k*n-l*m,q=.5*p;d+=q,c.x+=q*g*(e+i.x+j.x),c.y+=q*g*(f+i.y+j.y)}return c.x*=1/d,c.y*=1/d,c},h.ComputeOBB=function(a,b,c){void 0===c&&(c=0);var d=0,e=new Vector(c+1);for(d=0;d<c;++d)e[d]=b[d];e[c]=e[0];var f=Number.MAX_VALUE;for(d=1;d<=c;++d){var g=e[parseInt(d-1)],h=e[d].x-g.x,i=e[d].y-g.y,j=Math.sqrt(h*h+i*i);h/=j,i/=j;for(var k=-i,l=h,m=Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,p=-Number.MAX_VALUE,q=0;q<c;++q){var r=e[q].x-g.x,s=e[q].y-g.y,t=h*r+i*s,u=k*r+l*s;t<m&&(m=t),u<n&&(n=u),t>o&&(o=t),u>p&&(p=u)}var v=(o-m)*(p-n);if(v<.95*f){f=v,a.R.col1.x=h,a.R.col1.y=i,a.R.col2.x=k,a.R.col2.y=l;var w=.5*(m+o),x=.5*(n+p),y=a.R;a.center.x=g.x+(y.col1.x*w+y.col2.x*x),a.center.y=g.y+(y.col1.y*w+y.col2.y*x),a.extents.x=.5*(o-m),a.extents.y=.5*(p-n)}}},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new j}),i.b2Shape=function(){},i.prototype.Copy=function(){return null},i.prototype.Set=function(a){this.m_radius=a.m_radius},i.prototype.GetType=function(){return this.m_type},i.prototype.TestPoint=function(a,b){return!1},i.prototype.RayCast=function(a,b,c){return!1},i.prototype.ComputeAABB=function(a,b){},i.prototype.ComputeMass=function(a,b){void 0===b&&(b=0)},i.prototype.ComputeSubmergedArea=function(a,b,c,d){return void 0===b&&(b=0),0},i.TestOverlap=function(a,b,c,d){var e=new L;e.proxyA=new N,e.proxyA.Set(a),e.proxyB=new N,e.proxyB.Set(c),e.transformA=b,e.transformB=d,e.useRadii=!0;var f=new $;f.count=0;var g=new M;return K.Distance(g,f,e),g.distance<10*Number.MIN_VALUE},i.prototype.b2Shape=function(){this.m_type=i.e_unknownShape,this.m_radius=c.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),Box2D.Collision.Shapes.b2Shape.e_circleShape=0,Box2D.Collision.Shapes.b2Shape.e_polygonShape=1,Box2D.Collision.Shapes.b2Shape.e_edgeShape=2,Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var a=Box2D.Common.b2Color,c=(Box2D.Common.b2internal,Box2D.Common.b2Settings),f=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math);Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2,Box2D.Common.Math.b2Vec3;a.b2Color=function(){this._r=0,this._g=0,this._b=0},a.prototype.b2Color=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this._r=Box2D.parseUInt(255*f.Clamp(a,0,1)),this._g=Box2D.parseUInt(255*f.Clamp(b,0,1)),this._b=Box2D.parseUInt(255*f.Clamp(c,0,1))},a.prototype.Set=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this._r=Box2D.parseUInt(255*f.Clamp(a,0,1)),this._g=Box2D.parseUInt(255*f.Clamp(b,0,1)),this._b=Box2D.parseUInt(255*f.Clamp(c,0,1))},Object.defineProperty(a.prototype,"r",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._r=Box2D.parseUInt(255*f.Clamp(a,0,1))}}),Object.defineProperty(a.prototype,"g",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._g=Box2D.parseUInt(255*f.Clamp(a,0,1))}}),Object.defineProperty(a.prototype,"b",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._b=Box2D.parseUInt(255*f.Clamp(a,0,1))}}),Object.defineProperty(a.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),c.b2Settings=function(){},c.b2MixFriction=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),Math.sqrt(a*b)},c.b2MixRestitution=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),a>b?a:b},c.b2Assert=function(a){if(!a)throw"Assertion Failed"},Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*c.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*c.b2_pi,Box2D.Common.b2Settings.b2_toiSlop=8*c.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*c.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=c.b2_maxTranslation*c.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*c.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=c.b2_maxRotation*c.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*c.b2_pi})}(),function(){var e=(Box2D.Collision.b2AABB,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Common.Math.b2Mat22),f=Box2D.Common.Math.b2Mat33,g=Box2D.Common.Math.b2Math,h=Box2D.Common.Math.b2Sweep,i=Box2D.Common.Math.b2Transform,j=Box2D.Common.Math.b2Vec2,k=Box2D.Common.Math.b2Vec3;e.b2Mat22=function(){this.col1=new j,this.col2=new j},e.prototype.b2Mat22=function(){this.SetIdentity()},e.FromAngle=function(a){void 0===a&&(a=0);var b=new e;return b.Set(a),b},e.FromVV=function(a,b){var c=new e;return c.SetVV(a,b),c},e.prototype.Set=function(a){void 0===a&&(a=0);var b=Math.cos(a),c=Math.sin(a);this.col1.x=b,this.col2.x=-c,this.col1.y=c,this.col2.y=b},e.prototype.SetVV=function(a,b){this.col1.SetV(a),this.col2.SetV(b)},e.prototype.Copy=function(){var a=new e;return a.SetM(this),a},e.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2)},e.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},e.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},e.prototype.GetInverse=function(a){var b=this.col1.x,c=this.col2.x,d=this.col1.y,e=this.col2.y,f=b*e-c*d;return 0!=f&&(f=1/f),a.col1.x=f*e,a.col2.x=-f*c,a.col1.y=-f*d,a.col2.y=f*b,a},e.prototype.Solve=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0);var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!=h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},e.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},f.b2Mat33=function(){this.col1=new k,this.col2=new k,this.col3=new k},f.prototype.b2Mat33=function(a,b,c){void 0===a&&(a=null),void 0===b&&(b=null),void 0===c&&(c=null),a||b||c?(this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},f.prototype.SetVVV=function(a,b,c){this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)},f.prototype.Copy=function(){return new f(this.col1,this.col2,this.col3)},f.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2),this.col3.SetV(a.col3)},f.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col1.z+=a.col1.z,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y,this.col2.z+=a.col2.z,this.col3.x+=a.col3.x,this.col3.y+=a.col3.y,this.col3.z+=a.col3.z},f.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},f.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},f.prototype.Solve22=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0);var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!=h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},f.prototype.Solve33=function(a,b,c,d){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0);var e=this.col1.x,f=this.col1.y,g=this.col1.z,h=this.col2.x,i=this.col2.y,j=this.col2.z,k=this.col3.x,l=this.col3.y,m=this.col3.z,n=e*(i*m-j*l)+f*(j*k-h*m)+g*(h*l-i*k);return 0!=n&&(n=1/n),a.x=n*(b*(i*m-j*l)+c*(j*k-h*m)+d*(h*l-i*k)),a.y=n*(e*(c*m-d*l)+f*(d*k-b*m)+g*(b*l-c*k)),a.z=n*(e*(i*d-j*c)+f*(j*b-h*d)+g*(h*c-i*b)),a},g.b2Math=function(){},g.IsValid=function(a){return void 0===a&&(a=0),isFinite(a)},g.Dot=function(a,b){return a.x*b.x+a.y*b.y},g.CrossVV=function(a,b){return a.x*b.y-a.y*b.x},g.CrossVF=function(a,b){void 0===b&&(b=0);var c=new j(b*a.y,-b*a.x);return c},g.CrossFV=function(a,b){void 0===a&&(a=0);var c=new j(-a*b.y,a*b.x);return c},g.MulMV=function(a,b){var c=new j(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y);return c},g.MulTMV=function(a,b){var c=new j(g.Dot(b,a.col1),g.Dot(b,a.col2));return c},g.MulX=function(a,b){var c=g.MulMV(a.R,b);return c.x+=a.position.x,c.y+=a.position.y,c},g.MulXT=function(a,b){var c=g.SubtractVV(b,a.position),d=c.x*a.R.col1.x+c.y*a.R.col1.y;return c.y=c.x*a.R.col2.x+c.y*a.R.col2.y,c.x=d,c},g.AddVV=function(a,b){var c=new j(a.x+b.x,a.y+b.y);return c},g.SubtractVV=function(a,b){var c=new j(a.x-b.x,a.y-b.y);return c},g.Distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},g.DistanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},g.MulFV=function(a,b){void 0===a&&(a=0);var c=new j(a*b.x,a*b.y);return c},g.AddMM=function(a,b){var c=e.FromVV(g.AddVV(a.col1,b.col1),g.AddVV(a.col2,b.col2));return c},g.MulMM=function(a,b){var c=e.FromVV(g.MulMV(a,b.col1),g.MulMV(a,b.col2));return c},g.MulTMM=function(a,b){var c=new j(g.Dot(a.col1,b.col1),g.Dot(a.col2,b.col1)),d=new j(g.Dot(a.col1,b.col2),g.Dot(a.col2,b.col2)),f=e.FromVV(c,d);return f},g.Abs=function(a){return void 0===a&&(a=0),a>0?a:-a},g.AbsV=function(a){var b=new j(g.Abs(a.x),g.Abs(a.y));return b},g.AbsM=function(a){var b=e.FromVV(g.AbsV(a.col1),g.AbsV(a.col2));return b},g.Min=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),a<b?a:b},g.MinV=function(a,b){var c=new j(g.Min(a.x,b.x),g.Min(a.y,b.y));return c},g.Max=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),a>b?a:b},g.MaxV=function(a,b){var c=new j(g.Max(a.x,b.x),g.Max(a.y,b.y));return c},g.Clamp=function(a,b,c){return void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),a<b?b:a>c?c:a},g.ClampV=function(a,b,c){return g.MaxV(b,g.MinV(a,c))},g.Swap=function(a,b){var c=a[0];a[0]=b[0],b[0]=c},g.Random=function(){return 2*Math.random()-1},g.RandomRange=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0);var c=Math.random();return c=(b-a)*c+a},g.NextPowerOfTwo=function(a){return void 0===a&&(a=0),a|=a>>1&2147483647,a|=a>>2&1073741823,a|=a>>4&268435455,a|=a>>8&16777215,a|=a>>16&65535,a+1},g.IsPowerOfTwo=function(a){void 0===a&&(a=0);var b=a>0&&0==(a&a-1);return b},Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new j(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=e.FromVV(new j(1,0),new j(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new i(g.b2Vec2_zero,g.b2Mat22_identity)}),h.b2Sweep=function(){this.localCenter=new j,this.c0=new j,this.c=new j},h.prototype.Set=function(a){this.localCenter.SetV(a.localCenter),this.c0.SetV(a.c0),this.c.SetV(a.c),this.a0=a.a0,this.a=a.a,this.t0=a.t0},h.prototype.Copy=function(){var a=new h;return a.localCenter.SetV(this.localCenter),a.c0.SetV(this.c0),a.c.SetV(this.c),a.a0=this.a0,a.a=this.a,a.t0=this.t0,a},h.prototype.GetTransform=function(a,b){void 0===b&&(b=0),a.position.x=(1-b)*this.c0.x+b*this.c.x,a.position.y=(1-b)*this.c0.y+b*this.c.y;var c=(1-b)*this.a0+b*this.a;a.R.Set(c);var d=a.R;a.position.x-=d.col1.x*this.localCenter.x+d.col2.x*this.localCenter.y,a.position.y-=d.col1.y*this.localCenter.x+d.col2.y*this.localCenter.y},h.prototype.Advance=function(a){if(void 0===a&&(a=0),this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x,this.c0.y=(1-b)*this.c0.y+b*this.c.y,this.a0=(1-b)*this.a0+b*this.a,this.t0=a}},i.b2Transform=function(){this.position=new j,this.R=new e},i.prototype.b2Transform=function(a,b){void 0===a&&(a=null),void 0===b&&(b=null),a&&(this.position.SetV(a),this.R.SetM(b))},i.prototype.Initialize=function(a,b){this.position.SetV(a),this.R.SetM(b)},i.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},i.prototype.Set=function(a){
this.position.SetV(a.position),this.R.SetM(a.R)},i.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},j.b2Vec2=function(){},j.prototype.b2Vec2=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.x=a,this.y=b},j.prototype.SetZero=function(){this.x=0,this.y=0},j.prototype.Set=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.x=a,this.y=b},j.prototype.SetV=function(a){this.x=a.x,this.y=a.y},j.prototype.GetNegative=function(){return new j((-this.x),(-this.y))},j.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},j.Make=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),new j(a,b)},j.prototype.Copy=function(){return new j(this.x,this.y)},j.prototype.Add=function(a){this.x+=a.x,this.y+=a.y},j.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y},j.prototype.Multiply=function(a){void 0===a&&(a=0),this.x*=a,this.y*=a},j.prototype.MulM=function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y,this.y=a.col1.y*b+a.col2.y*this.y},j.prototype.MulTM=function(a){var b=g.Dot(this,a.col1);this.y=g.Dot(this,a.col2),this.x=b},j.prototype.CrossVF=function(a){void 0===a&&(a=0);var b=this.x;this.x=a*this.y,this.y=-a*b},j.prototype.CrossFV=function(a){void 0===a&&(a=0);var b=this.x;this.x=-a*this.y,this.y=a*b},j.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x,this.y=this.y<a.y?this.y:a.y},j.prototype.MaxV=function(a){this.x=this.x>a.x?this.x:a.x,this.y=this.y>a.y?this.y:a.y},j.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},j.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},j.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},j.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var b=1/a;return this.x*=b,this.y*=b,a},j.prototype.IsValid=function(){return g.IsValid(this.x)&&g.IsValid(this.y)},k.b2Vec3=function(){},k.prototype.b2Vec3=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this.x=a,this.y=b,this.z=c},k.prototype.SetZero=function(){this.x=this.y=this.z=0},k.prototype.Set=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this.x=a,this.y=b,this.z=c},k.prototype.SetV=function(a){this.x=a.x,this.y=a.y,this.z=a.z},k.prototype.GetNegative=function(){return new k((-this.x),(-this.y),(-this.z))},k.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},k.prototype.Copy=function(){return new k(this.x,this.y,this.z)},k.prototype.Add=function(a){this.x+=a.x,this.y+=a.y,this.z+=a.z},k.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y,this.z-=a.z},k.prototype.Multiply=function(a){void 0===a&&(a=0),this.x*=a,this.y*=a,this.z*=a}}(),function(){var d=(Box2D.Dynamics.Controllers.b2ControllerEdge,Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),e=Box2D.Common.Math.b2Sweep,f=Box2D.Common.Math.b2Transform,g=Box2D.Common.Math.b2Vec2,i=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),k=(Box2D.Common.b2internal,Box2D.Common.b2Settings),l=Box2D.Collision.b2AABB,q=(Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint),w=(Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase),C=(Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput),D=Box2D.Collision.b2RayCastOutput,P=(Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase,Box2D.Collision.Shapes.b2CircleShape),R=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),S=Box2D.Collision.Shapes.b2MassData,T=Box2D.Collision.Shapes.b2PolygonShape,U=Box2D.Collision.Shapes.b2Shape,V=Box2D.Dynamics.b2Body,W=Box2D.Dynamics.b2BodyDef,X=Box2D.Dynamics.b2ContactFilter,Y=Box2D.Dynamics.b2ContactImpulse,Z=Box2D.Dynamics.b2ContactListener,$=Box2D.Dynamics.b2ContactManager,_=Box2D.Dynamics.b2DebugDraw,aa=Box2D.Dynamics.b2DestructionListener,ba=Box2D.Dynamics.b2FilterData,ca=Box2D.Dynamics.b2Fixture,da=Box2D.Dynamics.b2FixtureDef,ea=Box2D.Dynamics.b2Island,fa=Box2D.Dynamics.b2TimeStep,ga=Box2D.Dynamics.b2World,ia=(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),ma=(Box2D.Dynamics.Contacts.b2ContactConstraint,Box2D.Dynamics.Contacts.b2ContactConstraintPoint,Box2D.Dynamics.Contacts.b2ContactEdge,Box2D.Dynamics.Contacts.b2ContactFactory),pa=(Box2D.Dynamics.Contacts.b2ContactRegister,Box2D.Dynamics.Contacts.b2ContactResult,Box2D.Dynamics.Contacts.b2ContactSolver),Ea=(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2NullContact,Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2Controller,Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2Jacobian,Box2D.Dynamics.Joints.b2Joint),Na=(Box2D.Dynamics.Joints.b2JointDef,Box2D.Dynamics.Joints.b2JointEdge,Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2PulleyJoint);Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2WeldJointDef;V.b2Body=function(){this.m_xf=new f,this.m_sweep=new e,this.m_linearVelocity=new g,this.m_force=new g},V.prototype.connectEdges=function(a,b,c){void 0===c&&(c=0);var e=Math.atan2(b.GetDirectionVector().y,b.GetDirectionVector().x),f=Math.tan(.5*(e-c)),g=d.MulFV(f,b.GetDirectionVector());g=d.SubtractVV(g,b.GetNormalVector()),g=d.MulFV(k.b2_toiSlop,g),g=d.AddVV(g,b.GetVertex1());var h=d.AddVV(a.GetDirectionVector(),b.GetDirectionVector());h.Normalize();var i=d.Dot(a.GetDirectionVector(),b.GetNormalVector())>0;return a.SetNextEdge(b,g,h,i),b.SetPrevEdge(a,g,h,i),e},V.prototype.CreateFixture=function(a){if(1==this.m_world.IsLocked())return null;var b=new ca;if(b.Create(this,this.m_xf,a),this.m_flags&V.e_activeFlag){var c=this.m_world.m_contactManager.m_broadPhase;b.CreateProxy(c,this.m_xf)}return b.m_next=this.m_fixtureList,this.m_fixtureList=b,++this.m_fixtureCount,b.m_body=this,b.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=ga.e_newFixture,b},V.prototype.CreateFixture2=function(a,b){void 0===b&&(b=0);var c=new da;return c.shape=a,c.density=b,this.CreateFixture(c)},V.prototype.DestroyFixture=function(a){if(1!=this.m_world.IsLocked()){for(var b=this.m_fixtureList,c=null,d=!1;null!=b;){if(b==a){c?c.m_next=a.m_next:this.m_fixtureList=a.m_next,d=!0;break}c=b,b=b.m_next}for(var e=this.m_contactList;e;){var f=e.contact;e=e.next;var g=f.GetFixtureA(),h=f.GetFixtureB();a!=g&&a!=h||this.m_world.m_contactManager.Destroy(f)}if(this.m_flags&V.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;a.DestroyProxy(i)}a.Destroy(),a.m_body=null,a.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},V.prototype.SetPositionAndAngle=function(a,b){void 0===b&&(b=0);var c;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(b),this.m_xf.position.SetV(a);var d=this.m_xf.R,e=this.m_sweep.localCenter;this.m_sweep.c.x=d.col1.x*e.x+d.col2.x*e.y,this.m_sweep.c.y=d.col1.y*e.x+d.col2.y*e.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=b;var f=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(f,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},V.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())},V.prototype.GetTransform=function(){return this.m_xf},V.prototype.GetPosition=function(){return this.m_xf.position},V.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,this.GetAngle())},V.prototype.GetAngle=function(){return this.m_sweep.a},V.prototype.SetAngle=function(a){void 0===a&&(a=0),this.SetPositionAndAngle(this.GetPosition(),a)},V.prototype.GetWorldCenter=function(){return this.m_sweep.c},V.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},V.prototype.SetLinearVelocity=function(a){this.m_type!=V.b2_staticBody&&this.m_linearVelocity.SetV(a)},V.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},V.prototype.SetAngularVelocity=function(a){void 0===a&&(a=0),this.m_type!=V.b2_staticBody&&(this.m_angularVelocity=a)},V.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},V.prototype.GetDefinition=function(){var a=new W;return a.type=this.GetType(),a.allowSleep=(this.m_flags&V.e_allowSleepFlag)==V.e_allowSleepFlag,a.angle=this.GetAngle(),a.angularDamping=this.m_angularDamping,a.angularVelocity=this.m_angularVelocity,a.fixedRotation=(this.m_flags&V.e_fixedRotationFlag)==V.e_fixedRotationFlag,a.bullet=(this.m_flags&V.e_bulletFlag)==V.e_bulletFlag,a.awake=(this.m_flags&V.e_awakeFlag)==V.e_awakeFlag,a.linearDamping=this.m_linearDamping,a.linearVelocity.SetV(this.GetLinearVelocity()),a.position=this.GetPosition(),a.userData=this.GetUserData(),a},V.prototype.ApplyForce=function(a,b){this.m_type==V.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x)},V.prototype.ApplyTorque=function(a){void 0===a&&(a=0),this.m_type==V.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=a)},V.prototype.ApplyImpulse=function(a,b){this.m_type==V.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x))},V.prototype.Split=function(a){for(var h,b=this.GetLinearVelocity().Copy(),c=this.GetAngularVelocity(),e=this.GetWorldCenter(),f=this,g=this.m_world.CreateBody(this.GetDefinition()),i=f.m_fixtureList;i;)if(a(i)){var j=i.m_next;h?h.m_next=j:f.m_fixtureList=j,f.m_fixtureCount--,i.m_next=g.m_fixtureList,g.m_fixtureList=i,g.m_fixtureCount++,i.m_body=g,i=j}else h=i,i=i.m_next;f.ResetMassData(),g.ResetMassData();var k=f.GetWorldCenter(),l=g.GetWorldCenter(),m=d.AddVV(b,d.CrossFV(c,d.SubtractVV(k,e))),n=d.AddVV(b,d.CrossFV(c,d.SubtractVV(l,e)));return f.SetLinearVelocity(m),g.SetLinearVelocity(n),f.SetAngularVelocity(c),g.SetAngularVelocity(c),f.SynchronizeFixtures(),g.SynchronizeFixtures(),g},V.prototype.Merge=function(a){var b;for(b=a.m_fixtureList;b;){var c=b.m_next;a.m_fixtureCount--,b.m_next=this.m_fixtureList,this.m_fixtureList=b,this.m_fixtureCount++,b.m_body=e,b=c}d.m_fixtureCount=0;var d=this,e=a;d.GetWorldCenter(),e.GetWorldCenter(),d.GetLinearVelocity().Copy(),e.GetLinearVelocity().Copy(),d.GetAngularVelocity(),e.GetAngularVelocity();d.ResetMassData(),this.SynchronizeFixtures()},V.prototype.GetMass=function(){return this.m_mass},V.prototype.GetInertia=function(){return this.m_I},V.prototype.GetMassData=function(a){a.mass=this.m_mass,a.I=this.m_I,a.center.SetV(this.m_sweep.localCenter)},V.prototype.SetMassData=function(a){if(k.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==V.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=a.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,a.I>0&&0==(this.m_flags&V.e_fixedRotationFlag)&&(this.m_I=a.I-this.m_mass*(a.center.x*a.center.x+a.center.y*a.center.y),this.m_invI=1/this.m_I);var b=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a.center),this.m_sweep.c0.SetV(d.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-b.x)}},V.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=V.b2_staticBody&&this.m_type!=V.b2_kinematicBody){for(var a=g.Make(0,0),b=this.m_fixtureList;b;b=b.m_next)if(0!=b.m_density){var c=b.GetMassData();this.m_mass+=c.mass,a.x+=c.center.x*c.mass,a.y+=c.center.y*c.mass,this.m_I+=c.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,a.x*=this.m_invMass,a.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&V.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(a.x*a.x+a.y*a.y),this.m_I*=this.m_inertiaScale,k.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a),this.m_sweep.c0.SetV(d.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x)}},V.prototype.GetWorldPoint=function(a){var b=this.m_xf.R,c=new g(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return c.x+=this.m_xf.position.x,c.y+=this.m_xf.position.y,c},V.prototype.GetWorldVector=function(a){return d.MulMV(this.m_xf.R,a)},V.prototype.GetLocalPoint=function(a){return d.MulXT(this.m_xf,a)},V.prototype.GetLocalVector=function(a){return d.MulTMV(this.m_xf.R,a)},V.prototype.GetLinearVelocityFromWorldPoint=function(a){return new g(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))},V.prototype.GetLinearVelocityFromLocalPoint=function(a){var b=this.m_xf.R,c=new g(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return c.x+=this.m_xf.position.x,c.y+=this.m_xf.position.y,new g(this.m_linearVelocity.x-this.m_angularVelocity*(c.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(c.x-this.m_sweep.c.x))},V.prototype.GetLinearDamping=function(){return this.m_linearDamping},V.prototype.SetLinearDamping=function(a){void 0===a&&(a=0),this.m_linearDamping=a},V.prototype.GetAngularDamping=function(){return this.m_angularDamping},V.prototype.SetAngularDamping=function(a){void 0===a&&(a=0),this.m_angularDamping=a},V.prototype.SetType=function(a){if(void 0===a&&(a=0),this.m_type!=a){this.m_type=a,this.ResetMassData(),this.m_type==V.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var b=this.m_contactList;b;b=b.next)b.contact.FlagForFiltering()}},V.prototype.GetType=function(){return this.m_type},V.prototype.SetBullet=function(a){a?this.m_flags|=V.e_bulletFlag:this.m_flags&=~V.e_bulletFlag},V.prototype.IsBullet=function(){return(this.m_flags&V.e_bulletFlag)==V.e_bulletFlag},V.prototype.SetSleepingAllowed=function(a){a?this.m_flags|=V.e_allowSleepFlag:(this.m_flags&=~V.e_allowSleepFlag,this.SetAwake(!0))},V.prototype.SetAwake=function(a){a?(this.m_flags|=V.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~V.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},V.prototype.IsAwake=function(){return(this.m_flags&V.e_awakeFlag)==V.e_awakeFlag},V.prototype.SetFixedRotation=function(a){a?this.m_flags|=V.e_fixedRotationFlag:this.m_flags&=~V.e_fixedRotationFlag,this.ResetMassData()},V.prototype.IsFixedRotation=function(){return(this.m_flags&V.e_fixedRotationFlag)==V.e_fixedRotationFlag},V.prototype.SetActive=function(a){if(a!=this.IsActive()){var b,c;if(a)for(this.m_flags|=V.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.CreateProxy(b,this.m_xf);else{for(this.m_flags&=~V.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.DestroyProxy(b);for(var d=this.m_contactList;d;){var e=d;d=d.next,this.m_world.m_contactManager.Destroy(e.contact)}this.m_contactList=null}}},V.prototype.IsActive=function(){return(this.m_flags&V.e_activeFlag)==V.e_activeFlag},V.prototype.IsSleepingAllowed=function(){return(this.m_flags&V.e_allowSleepFlag)==V.e_allowSleepFlag},V.prototype.GetFixtureList=function(){return this.m_fixtureList},V.prototype.GetJointList=function(){return this.m_jointList},V.prototype.GetControllerList=function(){return this.m_controllerList},V.prototype.GetContactList=function(){return this.m_contactList},V.prototype.GetNext=function(){return this.m_next},V.prototype.GetUserData=function(){return this.m_userData},V.prototype.SetUserData=function(a){this.m_userData=a},V.prototype.GetWorld=function(){return this.m_world},V.prototype.b2Body=function(a,b){this.m_flags=0,a.bullet&&(this.m_flags|=V.e_bulletFlag),a.fixedRotation&&(this.m_flags|=V.e_fixedRotationFlag),a.allowSleep&&(this.m_flags|=V.e_allowSleepFlag),a.awake&&(this.m_flags|=V.e_awakeFlag),a.active&&(this.m_flags|=V.e_activeFlag),this.m_world=b,this.m_xf.position.SetV(a.position),this.m_xf.R.Set(a.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=a.angle;var c=this.m_xf.R,d=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*d.x+c.col2.x*d.y,this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(a.linearVelocity),this.m_angularVelocity=a.angularVelocity,this.m_linearDamping=a.linearDamping,this.m_angularDamping=a.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=a.type,this.m_type==V.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=a.inertiaScale,this.m_userData=a.userData,this.m_fixtureList=null,this.m_fixtureCount=0},V.prototype.SynchronizeFixtures=function(){var a=V.s_xf1;a.R.Set(this.m_sweep.a0);var b=a.R,c=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(b.col1.x*c.x+b.col2.x*c.y),a.position.y=this.m_sweep.c0.y-(b.col1.y*c.x+b.col2.y*c.y);var d,e=this.m_world.m_contactManager.m_broadPhase;for(d=this.m_fixtureList;d;d=d.m_next)d.Synchronize(e,a,this.m_xf)},V.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y),this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)},V.prototype.ShouldCollide=function(a){if(this.m_type!=V.b2_dynamicBody&&a.m_type!=V.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other==a&&0==b.joint.m_collideConnected)return!1;return!0},V.prototype.Advance=function(a){void 0===a&&(a=0),this.m_sweep.Advance(a),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new f,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_allowSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2}),W.b2BodyDef=function(){this.position=new g,this.linearVelocity=new g},W.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=V.b2_staticBody,this.active=!0,this.inertiaScale=1},X.b2ContactFilter=function(){},X.prototype.ShouldCollide=function(a,b){var c=a.GetFilterData(),d=b.GetFilterData();if(c.groupIndex==d.groupIndex&&0!=c.groupIndex)return c.groupIndex>0;var e=0!=(c.maskBits&d.categoryBits)&&0!=(c.categoryBits&d.maskBits);return e},X.prototype.RayCollide=function(a,b){return!a||this.ShouldCollide(a instanceof ca?a:null,b)},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new X}),Y.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(k.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(k.b2_maxManifoldPoints)},Z.b2ContactListener=function(){},Z.prototype.BeginContact=function(a){},Z.prototype.EndContact=function(a){},Z.prototype.PreSolve=function(a,b){},Z.prototype.PostSolve=function(a,b){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Z}),$.b2ContactManager=function(){},$.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=X.b2_defaultFilter,this.m_contactListener=Z.b2_defaultListener,this.m_contactFactory=new ma(this.m_allocator),this.m_broadPhase=new w},$.prototype.AddPair=function(a,b){var c=a instanceof ca?a:null,d=b instanceof ca?b:null,e=c.GetBody(),f=d.GetBody();if(e!=f){for(var g=f.GetContactList();g;){if(g.other==e){var h=g.contact.GetFixtureA(),i=g.contact.GetFixtureB();if(h==c&&i==d)return;if(h==d&&i==c)return}g=g.next}if(0!=f.ShouldCollide(e)&&0!=this.m_contactFilter.ShouldCollide(c,d)){var j=this.m_contactFactory.Create(c,d);c=j.GetFixtureA(),d=j.GetFixtureB(),e=c.m_body,f=d.m_body,j.m_prev=null,j.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=j),this.m_world.m_contactList=j,j.m_nodeA.contact=j,j.m_nodeA.other=f,j.m_nodeA.prev=null,j.m_nodeA.next=e.m_contactList,null!=e.m_contactList&&(e.m_contactList.prev=j.m_nodeA),e.m_contactList=j.m_nodeA,j.m_nodeB.contact=j,j.m_nodeB.other=e,j.m_nodeB.prev=null,j.m_nodeB.next=f.m_contactList,null!=f.m_contactList&&(f.m_contactList.prev=j.m_nodeB),f.m_contactList=j.m_nodeB,++this.m_world.m_contactCount}}},$.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))},$.prototype.Destroy=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a),a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_world.m_contactList&&(this.m_world.m_contactList=a.m_next),a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next),a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev),a.m_nodeA==d.m_contactList&&(d.m_contactList=a.m_nodeA.next),a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next),a.m_nodeB.next&&(a.m_nodeB.next.prev=a.m_nodeB.prev),a.m_nodeB==e.m_contactList&&(e.m_contactList=a.m_nodeB.next),this.m_contactFactory.Destroy(a),--this.m_contactCount},$.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();if(0!=d.IsAwake()||0!=e.IsAwake()){if(a.m_flags&ia.e_filterFlag){if(0==e.ShouldCollide(d)){var f=a;a=f.GetNext(),this.Destroy(f);continue}if(0==this.m_contactFilter.ShouldCollide(b,c)){f=a,a=f.GetNext(),this.Destroy(f);continue}a.m_flags&=~ia.e_filterFlag}var g=b.m_proxy,h=c.m_proxy,i=this.m_broadPhase.TestOverlap(g,h);0!=i?(a.Update(this.m_contactListener),a=a.GetNext()):(f=a,a=f.GetNext(),this.Destroy(f))}else a=a.GetNext()}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new q}),_.b2DebugDraw=function(){},_.prototype.b2DebugDraw=function(){},_.prototype.SetFlags=function(a){void 0===a&&(a=0)},_.prototype.GetFlags=function(){},_.prototype.AppendFlags=function(a){void 0===a&&(a=0)},_.prototype.ClearFlags=function(a){void 0===a&&(a=0)},_.prototype.SetSprite=function(a){},_.prototype.GetSprite=function(){},_.prototype.SetDrawScale=function(a){void 0===a&&(a=0)},_.prototype.GetDrawScale=function(){},_.prototype.SetLineThickness=function(a){void 0===a&&(a=0)},_.prototype.GetLineThickness=function(){},_.prototype.SetAlpha=function(a){void 0===a&&(a=0)},_.prototype.GetAlpha=function(){},_.prototype.SetFillAlpha=function(a){void 0===a&&(a=0)},_.prototype.GetFillAlpha=function(){},_.prototype.SetXFormScale=function(a){void 0===a&&(a=0)},_.prototype.GetXFormScale=function(){},_.prototype.DrawPolygon=function(a,b,c){void 0===b&&(b=0)},_.prototype.DrawSolidPolygon=function(a,b,c){void 0===b&&(b=0)},_.prototype.DrawCircle=function(a,b,c){void 0===b&&(b=0)},_.prototype.DrawSolidCircle=function(a,b,c,d){void 0===b&&(b=0)},_.prototype.DrawSegment=function(a,b,c){},_.prototype.DrawTransform=function(a){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}),aa.b2DestructionListener=function(){},aa.prototype.SayGoodbyeJoint=function(a){},aa.prototype.SayGoodbyeFixture=function(a){},ba.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},ba.prototype.Copy=function(){var a=new ba;return a.categoryBits=this.categoryBits,a.maskBits=this.maskBits,a.groupIndex=this.groupIndex,a},ca.b2Fixture=function(){this.m_filter=new ba},ca.prototype.GetType=function(){return this.m_shape.GetType()},ca.prototype.GetShape=function(){return this.m_shape},ca.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,null!=this.m_body))for(var b=this.m_body.GetContactList();b;){var c=b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();d!=this&&e!=this||c.SetSensor(d.IsSensor()||e.IsSensor()),b=b.next}},ca.prototype.IsSensor=function(){return this.m_isSensor},ca.prototype.SetFilterData=function(a){if(this.m_filter=a.Copy(),!this.m_body)for(var b=this.m_body.GetContactList();b;){var c=b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();d!=this&&e!=this||c.FlagForFiltering(),b=b.next}},ca.prototype.GetFilterData=function(){return this.m_filter.Copy()},ca.prototype.GetBody=function(){return this.m_body},ca.prototype.GetNext=function(){return this.m_next},ca.prototype.GetUserData=function(){return this.m_userData},ca.prototype.SetUserData=function(a){this.m_userData=a},ca.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)},ca.prototype.RayCast=function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())},ca.prototype.GetMassData=function(a){return void 0===a&&(a=null),null==a&&(a=new S),this.m_shape.ComputeMass(a,this.m_density),a},ca.prototype.SetDensity=function(a){void 0===a&&(a=0),this.m_density=a},ca.prototype.GetDensity=function(){return this.m_density},ca.prototype.GetFriction=function(){return this.m_friction},ca.prototype.SetFriction=function(a){void 0===a&&(a=0),this.m_friction=a},ca.prototype.GetRestitution=function(){return this.m_restitution},ca.prototype.SetRestitution=function(a){void 0===a&&(a=0),this.m_restitution=a},ca.prototype.GetAABB=function(){return this.m_aabb},ca.prototype.b2Fixture=function(){this.m_aabb=new l,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},ca.prototype.Create=function(a,b,c){this.m_userData=c.userData,this.m_friction=c.friction,this.m_restitution=c.restitution,this.m_body=a,this.m_next=null,this.m_filter=c.filter.Copy(),this.m_isSensor=c.isSensor,this.m_shape=c.shape.Copy(),this.m_density=c.density},ca.prototype.Destroy=function(){this.m_shape=null},ca.prototype.CreateProxy=function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b),this.m_proxy=a.CreateProxy(this.m_aabb,this)},ca.prototype.DestroyProxy=function(a){null!=this.m_proxy&&(a.DestroyProxy(this.m_proxy),this.m_proxy=null)},ca.prototype.Synchronize=function(a,b,c){if(this.m_proxy){var e=new l,f=new l;this.m_shape.ComputeAABB(e,b),this.m_shape.ComputeAABB(f,c),this.m_aabb.Combine(e,f);var g=d.SubtractVV(c.position,b.position);a.MoveProxy(this.m_proxy,this.m_aabb,g)}},da.b2FixtureDef=function(){this.filter=new ba},da.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},ea.b2Island=function(){},ea.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},ea.prototype.Initialize=function(a,b,c,d,e,f){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0);var g=0;for(this.m_bodyCapacity=a,this.m_contactCapacity=b,this.m_jointCapacity=c,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=d,this.m_listener=e,this.m_contactSolver=f,g=this.m_bodies.length;g<a;g++)this.m_bodies[g]=null;for(g=this.m_contacts.length;g<b;g++)this.m_contacts[g]=null;for(g=this.m_joints.length;g<c;g++)this.m_joints[g]=null},ea.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},ea.prototype.Solve=function(a,b,c){var g,h,e=0,f=0;for(e=0;e<this.m_bodyCount;++e)g=this.m_bodies[e],g.GetType()==V.b2_dynamicBody&&(g.m_linearVelocity.x+=a.dt*(b.x+g.m_invMass*g.m_force.x),g.m_linearVelocity.y+=a.dt*(b.y+g.m_invMass*g.m_force.y),g.m_angularVelocity+=a.dt*g.m_invI*g.m_torque,g.m_linearVelocity.Multiply(d.Clamp(1-a.dt*g.m_linearDamping,0,1)),g.m_angularVelocity*=d.Clamp(1-a.dt*g.m_angularDamping,0,1));this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);var i=this.m_contactSolver;for(i.InitVelocityConstraints(a),e=0;e<this.m_jointCount;++e)h=this.m_joints[e],h.InitVelocityConstraints(a);for(e=0;e<a.velocityIterations;++e){for(f=0;f<this.m_jointCount;++f)h=this.m_joints[f],h.SolveVelocityConstraints(a);i.SolveVelocityConstraints()}for(e=0;e<this.m_jointCount;++e)h=this.m_joints[e],h.FinalizeVelocityConstraints();for(i.FinalizeVelocityConstraints(),e=0;e<this.m_bodyCount;++e)if(g=this.m_bodies[e],g.GetType()!=V.b2_staticBody){var j=a.dt*g.m_linearVelocity.x,l=a.dt*g.m_linearVelocity.y;j*j+l*l>k.b2_maxTranslationSquared&&(g.m_linearVelocity.Normalize(),g.m_linearVelocity.x*=k.b2_maxTranslation*a.inv_dt,g.m_linearVelocity.y*=k.b2_maxTranslation*a.inv_dt);var m=a.dt*g.m_angularVelocity;m*m>k.b2_maxRotationSquared&&(g.m_angularVelocity<0?g.m_angularVelocity=-k.b2_maxRotation*a.inv_dt:g.m_angularVelocity=k.b2_maxRotation*a.inv_dt),g.m_sweep.c0.SetV(g.m_sweep.c),g.m_sweep.a0=g.m_sweep.a,g.m_sweep.c.x+=a.dt*g.m_linearVelocity.x,g.m_sweep.c.y+=a.dt*g.m_linearVelocity.y,g.m_sweep.a+=a.dt*g.m_angularVelocity,g.SynchronizeTransform()}for(e=0;e<a.positionIterations;++e){var n=i.SolvePositionConstraints(k.b2_contactBaumgarte),o=!0;for(f=0;f<this.m_jointCount;++f){h=this.m_joints[f];var p=h.SolvePositionConstraints(k.b2_contactBaumgarte);o=o&&p}if(n&&o)break}if(this.Report(i.m_constraints),c){var q=Number.MAX_VALUE,r=k.b2_linearSleepTolerance*k.b2_linearSleepTolerance,s=k.b2_angularSleepTolerance*k.b2_angularSleepTolerance;for(e=0;e<this.m_bodyCount;++e)g=this.m_bodies[e],g.GetType()!=V.b2_staticBody&&(0==(g.m_flags&V.e_allowSleepFlag)&&(g.m_sleepTime=0,q=0),0==(g.m_flags&V.e_allowSleepFlag)||g.m_angularVelocity*g.m_angularVelocity>s||d.Dot(g.m_linearVelocity,g.m_linearVelocity)>r?(g.m_sleepTime=0,q=0):(g.m_sleepTime+=a.dt,q=d.Min(q,g.m_sleepTime)));if(q>=k.b2_timeToSleep)for(e=0;e<this.m_bodyCount;++e)g=this.m_bodies[e],g.SetAwake(!1)}},ea.prototype.SolveTOI=function(a){var b=0,c=0;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);var d=this.m_contactSolver;for(b=0;b<this.m_jointCount;++b)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;++b)for(d.SolveVelocityConstraints(),
c=0;c<this.m_jointCount;++c)this.m_joints[c].SolveVelocityConstraints(a);for(b=0;b<this.m_bodyCount;++b){var e=this.m_bodies[b];if(e.GetType()!=V.b2_staticBody){var f=a.dt*e.m_linearVelocity.x,g=a.dt*e.m_linearVelocity.y;f*f+g*g>k.b2_maxTranslationSquared&&(e.m_linearVelocity.Normalize(),e.m_linearVelocity.x*=k.b2_maxTranslation*a.inv_dt,e.m_linearVelocity.y*=k.b2_maxTranslation*a.inv_dt);var h=a.dt*e.m_angularVelocity;h*h>k.b2_maxRotationSquared&&(e.m_angularVelocity<0?e.m_angularVelocity=-k.b2_maxRotation*a.inv_dt:e.m_angularVelocity=k.b2_maxRotation*a.inv_dt),e.m_sweep.c0.SetV(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_sweep.c.x+=a.dt*e.m_linearVelocity.x,e.m_sweep.c.y+=a.dt*e.m_linearVelocity.y,e.m_sweep.a+=a.dt*e.m_angularVelocity,e.SynchronizeTransform()}}var i=.75;for(b=0;b<a.positionIterations;++b){var j=d.SolvePositionConstraints(i),l=!0;for(c=0;c<this.m_jointCount;++c){var m=this.m_joints[c].SolvePositionConstraints(k.b2_contactBaumgarte);l=l&&m}if(j&&l)break}this.Report(d.m_constraints)},ea.prototype.Report=function(a){if(null!=this.m_listener)for(var b=0;b<this.m_contactCount;++b){for(var c=this.m_contacts[b],d=a[b],e=0;e<d.pointCount;++e)ea.s_impulse.normalImpulses[e]=d.points[e].normalImpulse,ea.s_impulse.tangentImpulses[e]=d.points[e].tangentImpulse;this.m_listener.PostSolve(c,ea.s_impulse)}},ea.prototype.AddBody=function(a){a.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=a},ea.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a},ea.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new Y}),fa.b2TimeStep=function(){},fa.prototype.Set=function(a){this.dt=a.dt,this.inv_dt=a.inv_dt,this.positionIterations=a.positionIterations,this.velocityIterations=a.velocityIterations,this.warmStarting=a.warmStarting},ga.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new $,this.m_contactSolver=new pa,this.m_island=new ea},ga.prototype.b2World=function(a,b){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,ga.m_warmStarting=!0,ga.m_continuousPhysics=!0,this.m_allowSleep=b,this.m_gravity=a,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var c=new W;this.m_groundBody=this.CreateBody(c)},ga.prototype.SetDestructionListener=function(a){this.m_destructionListener=a},ga.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a},ga.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a},ga.prototype.SetDebugDraw=function(a){this.m_debugDraw=a},ga.prototype.SetBroadPhase=function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var c=this.m_bodyList;c;c=c.m_next)for(var d=c.m_fixtureList;d;d=d.m_next)d.m_proxy=a.CreateProxy(b.GetFatAABB(d.m_proxy),d)},ga.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},ga.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},ga.prototype.CreateBody=function(a){if(1==this.IsLocked())return null;var b=new V(a,this);return b.m_prev=null,b.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=b),this.m_bodyList=b,++this.m_bodyCount,b},ga.prototype.DestroyBody=function(a){if(1!=this.IsLocked()){for(var b=a.m_jointList;b;){var c=b;b=b.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint),this.DestroyJoint(c.joint)}for(var d=a.m_controllerList;d;){var e=d;d=d.nextController,e.controller.RemoveBody(a)}for(var f=a.m_contactList;f;){var g=f;f=f.next,this.m_contactManager.Destroy(g.contact)}a.m_contactList=null;for(var h=a.m_fixtureList;h;){var i=h;h=h.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(i),i.DestroyProxy(this.m_contactManager.m_broadPhase),i.Destroy()}a.m_fixtureList=null,a.m_fixtureCount=0,a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_bodyList&&(this.m_bodyList=a.m_next),--this.m_bodyCount}},ga.prototype.CreateJoint=function(a){var b=Ea.Create(a,null);b.m_prev=null,b.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=b),this.m_jointList=b,++this.m_jointCount,b.m_edgeA.joint=b,b.m_edgeA.other=b.m_bodyB,b.m_edgeA.prev=null,b.m_edgeA.next=b.m_bodyA.m_jointList,b.m_bodyA.m_jointList&&(b.m_bodyA.m_jointList.prev=b.m_edgeA),b.m_bodyA.m_jointList=b.m_edgeA,b.m_edgeB.joint=b,b.m_edgeB.other=b.m_bodyA,b.m_edgeB.prev=null,b.m_edgeB.next=b.m_bodyB.m_jointList,b.m_bodyB.m_jointList&&(b.m_bodyB.m_jointList.prev=b.m_edgeB),b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,d=a.bodyB;if(0==a.collideConnected)for(var e=d.GetContactList();e;)e.other==c&&e.contact.FlagForFiltering(),e=e.next;return b},ga.prototype.DestroyJoint=function(a){var b=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_jointList&&(this.m_jointList=a.m_next);var c=a.m_bodyA,d=a.m_bodyB;if(c.SetAwake(!0),d.SetAwake(!0),a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next),a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev),a.m_edgeA==c.m_jointList&&(c.m_jointList=a.m_edgeA.next),a.m_edgeA.prev=null,a.m_edgeA.next=null,a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next),a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev),a.m_edgeB==d.m_jointList&&(d.m_jointList=a.m_edgeB.next),a.m_edgeB.prev=null,a.m_edgeB.next=null,Ea.Destroy(a,null),--this.m_jointCount,0==b)for(var e=d.GetContactList();e;)e.other==c&&e.contact.FlagForFiltering(),e=e.next},ga.prototype.AddController=function(a){return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList=a,a.m_world=this,this.m_controllerCount++,a},ga.prototype.RemoveController=function(a){a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),this.m_controllerList==a&&(this.m_controllerList=a.m_next),this.m_controllerCount--},ga.prototype.CreateController=function(a){if(a.m_world!=this)throw new Error("Controller can only be a member of one world");return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=a),this.m_controllerList=a,++this.m_controllerCount,a.m_world=this,a},ga.prototype.DestroyController=function(a){a.Clear(),a.m_next&&(a.m_next.m_prev=a.m_prev),a.m_prev&&(a.m_prev.m_next=a.m_next),a==this.m_controllerList&&(this.m_controllerList=a.m_next),--this.m_controllerCount},ga.prototype.SetWarmStarting=function(a){ga.m_warmStarting=a},ga.prototype.SetContinuousPhysics=function(a){ga.m_continuousPhysics=a},ga.prototype.GetBodyCount=function(){return this.m_bodyCount},ga.prototype.GetJointCount=function(){return this.m_jointCount},ga.prototype.GetContactCount=function(){return this.m_contactCount},ga.prototype.SetGravity=function(a){this.m_gravity=a},ga.prototype.GetGravity=function(){return this.m_gravity},ga.prototype.GetGroundBody=function(){return this.m_groundBody},ga.prototype.Step=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this.m_flags&ga.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~ga.e_newFixture),this.m_flags|=ga.e_locked;var d=ga.s_timestep2;d.dt=a,d.velocityIterations=b,d.positionIterations=c,a>0?d.inv_dt=1/a:d.inv_dt=0,d.dtRatio=this.m_inv_dt0*a,d.warmStarting=ga.m_warmStarting,this.m_contactManager.Collide(),d.dt>0&&this.Solve(d),ga.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d),d.dt>0&&(this.m_inv_dt0=d.inv_dt),this.m_flags&=~ga.e_locked},ga.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0},ga.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var c,d,e,f,h,n,a=this.m_debugDraw.GetFlags(),q=(new g,new g,new g,new l,new l,[new g,new g,new g,new g]),r=new i(0,0,0);if(a&_.e_shapeBit)for(c=this.m_bodyList;c;c=c.m_next)for(n=c.m_xf,d=c.GetFixtureList();d;d=d.m_next)e=d.GetShape(),0==c.IsActive()?(r.Set(.5,.5,.3),this.DrawShape(e,n,r)):c.GetType()==V.b2_staticBody?(r.Set(.5,.9,.5),this.DrawShape(e,n,r)):c.GetType()==V.b2_kinematicBody?(r.Set(.5,.5,.9),this.DrawShape(e,n,r)):0==c.IsAwake()?(r.Set(.6,.6,.6),this.DrawShape(e,n,r)):(r.Set(.9,.7,.7),this.DrawShape(e,n,r));if(a&_.e_jointBit)for(f=this.m_jointList;f;f=f.m_next)this.DrawJoint(f);if(a&_.e_controllerBit)for(var s=this.m_controllerList;s;s=s.m_next)s.Draw(this.m_debugDraw);if(a&_.e_pairBit){r.Set(.3,.9,.9);for(var t=this.m_contactManager.m_contactList;t;t=t.GetNext()){var u=t.GetFixtureA(),v=t.GetFixtureB(),w=u.GetAABB().GetCenter(),x=v.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(w,x,r)}}if(a&_.e_aabbBit)for(h=this.m_contactManager.m_broadPhase,q=[new g,new g,new g,new g],c=this.m_bodyList;c;c=c.GetNext())if(0!=c.IsActive())for(d=c.GetFixtureList();d;d=d.GetNext()){var y=h.GetFatAABB(d.m_proxy);q[0].Set(y.lowerBound.x,y.lowerBound.y),q[1].Set(y.upperBound.x,y.lowerBound.y),q[2].Set(y.upperBound.x,y.upperBound.y),q[3].Set(y.lowerBound.x,y.upperBound.y),this.m_debugDraw.DrawPolygon(q,4,r)}if(a&_.e_centerOfMassBit)for(c=this.m_bodyList;c;c=c.m_next)n=ga.s_xf,n.R=c.m_xf.R,n.position=c.GetWorldCenter(),this.m_debugDraw.DrawTransform(n)}},ga.prototype.QueryAABB=function(a,b){function e(b){return a(d.GetUserData(b))}var c=this,d=c.m_contactManager.m_broadPhase;d.Query(e,b)},ga.prototype.QueryShape=function(a,b,c){function g(d){var f=e.GetUserData(d)instanceof ca?e.GetUserData(d):null;return!U.TestOverlap(b,c,f.GetShape(),f.GetBody().GetTransform())||a(f)}var d=this;void 0===c&&(c=null),null==c&&(c=new f,c.SetIdentity());var e=d.m_contactManager.m_broadPhase,h=new l;b.ComputeAABB(h,c),e.Query(g,h)},ga.prototype.QueryPoint=function(a,b){function e(c){var e=d.GetUserData(c)instanceof ca?d.GetUserData(c):null;return!e.TestPoint(b)||a(e)}var c=this,d=c.m_contactManager.m_broadPhase,f=new l;f.lowerBound.Set(b.x-k.b2_linearSlop,b.y-k.b2_linearSlop),f.upperBound.Set(b.x+k.b2_linearSlop,b.y+k.b2_linearSlop),d.Query(e,f)},ga.prototype.RayCast=function(a,b,c){function h(d,h){var i=e.GetUserData(h),j=i instanceof ca?i:null,k=j.RayCast(f,d);if(k){var l=f.fraction,m=new g((1-l)*b.x+l*c.x,(1-l)*b.y+l*c.y);return a(j,m,f.normal,l)}return d.maxFraction}var d=this,e=d.m_contactManager.m_broadPhase,f=new D,i=new C(b,c);e.RayCast(h,i)},ga.prototype.RayCastOne=function(a,b){function e(a,b,c,e){return void 0===e&&(e=0),d=a,e}var d,c=this;return c.RayCast(e,a,b),d},ga.prototype.RayCastAll=function(a,b){function e(a,b,c,e){return void 0===e&&(e=0),d[d.length]=a,1}var c=this,d=new Vector;return c.RayCast(e,a,b),d},ga.prototype.GetBodyList=function(){return this.m_bodyList},ga.prototype.GetJointList=function(){return this.m_jointList},ga.prototype.GetContactList=function(){return this.m_contactList},ga.prototype.IsLocked=function(){return(this.m_flags&ga.e_locked)>0},ga.prototype.Solve=function(a){for(var b,c=this.m_controllerList;c;c=c.m_next)c.Step(a);var d=this.m_island;for(d.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~V.e_islandFlag;for(var e=this.m_contactList;e;e=e.m_next)e.m_flags&=~ia.e_islandFlag;for(var f=this.m_jointList;f;f=f.m_next)f.m_islandFlag=!1;for(var h=(parseInt(this.m_bodyCount),this.s_stack),i=this.m_bodyList;i;i=i.m_next)if(!(i.m_flags&V.e_islandFlag)&&0!=i.IsAwake()&&0!=i.IsActive()&&i.GetType()!=V.b2_staticBody){d.Clear();var j=0;for(h[j++]=i,i.m_flags|=V.e_islandFlag;j>0;)if(b=h[--j],d.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()!=V.b2_staticBody){for(var k,l=b.m_contactList;l;l=l.next)l.contact.m_flags&ia.e_islandFlag||1!=l.contact.IsSensor()&&0!=l.contact.IsEnabled()&&0!=l.contact.IsTouching()&&(d.AddContact(l.contact),l.contact.m_flags|=ia.e_islandFlag,k=l.other,k.m_flags&V.e_islandFlag||(h[j++]=k,k.m_flags|=V.e_islandFlag));for(var m=b.m_jointList;m;m=m.next)1!=m.joint.m_islandFlag&&(k=m.other,0!=k.IsActive()&&(d.AddJoint(m.joint),m.joint.m_islandFlag=!0,k.m_flags&V.e_islandFlag||(h[j++]=k,k.m_flags|=V.e_islandFlag)))}d.Solve(a,this.m_gravity,this.m_allowSleep);for(var n=0;n<d.m_bodyCount;++n)b=d.m_bodies[n],b.GetType()==V.b2_staticBody&&(b.m_flags&=~V.e_islandFlag)}for(n=0;n<h.length&&h[n];++n)h[n]=null;for(b=this.m_bodyList;b;b=b.m_next)0!=b.IsAwake()&&0!=b.IsActive()&&b.GetType()!=V.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},ga.prototype.SolveTOI=function(a){var b,c,d,e,f,g,h,i=this.m_island;i.Initialize(this.m_bodyCount,k.b2_maxTOIContactsPerIsland,k.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var j=ga.s_queue;for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~V.e_islandFlag,b.m_sweep.t0=0;var l;for(l=this.m_contactList;l;l=l.m_next)l.m_flags&=~(ia.e_toiFlag|ia.e_islandFlag);for(h=this.m_jointList;h;h=h.m_next)h.m_islandFlag=!1;for(;;){var m=null,n=1;for(l=this.m_contactList;l;l=l.m_next)if(1!=l.IsSensor()&&0!=l.IsEnabled()&&0!=l.IsContinuous()){var o=1;if(l.m_flags&ia.e_toiFlag)o=l.m_toi;else{if(c=l.m_fixtureA,d=l.m_fixtureB,e=c.m_body,f=d.m_body,!(e.GetType()==V.b2_dynamicBody&&0!=e.IsAwake()||f.GetType()==V.b2_dynamicBody&&0!=f.IsAwake()))continue;var p=e.m_sweep.t0;e.m_sweep.t0<f.m_sweep.t0?(p=f.m_sweep.t0,e.m_sweep.Advance(p)):f.m_sweep.t0<e.m_sweep.t0&&(p=e.m_sweep.t0,f.m_sweep.Advance(p)),o=l.ComputeTOI(e.m_sweep,f.m_sweep),k.b2Assert(0<=o&&o<=1),o>0&&o<1&&(o=(1-o)*p+o,o>1&&(o=1)),l.m_toi=o,l.m_flags|=ia.e_toiFlag}Number.MIN_VALUE<o&&o<n&&(m=l,n=o)}if(null==m||1-100*Number.MIN_VALUE<n)break;if(c=m.m_fixtureA,d=m.m_fixtureB,e=c.m_body,f=d.m_body,ga.s_backupA.Set(e.m_sweep),ga.s_backupB.Set(f.m_sweep),e.Advance(n),f.Advance(n),m.Update(this.m_contactManager.m_contactListener),m.m_flags&=~ia.e_toiFlag,1!=m.IsSensor()&&0!=m.IsEnabled()){if(0!=m.IsTouching()){var q=e;q.GetType()!=V.b2_dynamicBody&&(q=f),i.Clear();var r=0,s=0;for(j[r+s++]=q,q.m_flags|=V.e_islandFlag;s>0;)if(b=j[r++],--s,i.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()==V.b2_dynamicBody){for(g=b.m_contactList;g&&i.m_contactCount!=i.m_contactCapacity;g=g.next)if(!(g.contact.m_flags&ia.e_islandFlag)&&1!=g.contact.IsSensor()&&0!=g.contact.IsEnabled()&&0!=g.contact.IsTouching()){i.AddContact(g.contact),g.contact.m_flags|=ia.e_islandFlag;var t=g.other;t.m_flags&V.e_islandFlag||(t.GetType()!=V.b2_staticBody&&(t.Advance(n),t.SetAwake(!0)),j[r+s]=t,++s,t.m_flags|=V.e_islandFlag)}for(var u=b.m_jointList;u;u=u.next)i.m_jointCount!=i.m_jointCapacity&&1!=u.joint.m_islandFlag&&(t=u.other,0!=t.IsActive()&&(i.AddJoint(u.joint),u.joint.m_islandFlag=!0,t.m_flags&V.e_islandFlag||(t.GetType()!=V.b2_staticBody&&(t.Advance(n),t.SetAwake(!0)),j[r+s]=t,++s,t.m_flags|=V.e_islandFlag)))}var v=ga.s_timestep;v.warmStarting=!1,v.dt=(1-n)*a.dt,v.inv_dt=1/v.dt,v.dtRatio=0,v.velocityIterations=a.velocityIterations,v.positionIterations=a.positionIterations,i.SolveTOI(v);var w=0;for(w=0;w<i.m_bodyCount;++w)if(b=i.m_bodies[w],b.m_flags&=~V.e_islandFlag,0!=b.IsAwake()&&b.GetType()==V.b2_dynamicBody)for(b.SynchronizeFixtures(),g=b.m_contactList;g;g=g.next)g.contact.m_flags&=~ia.e_toiFlag;for(w=0;w<i.m_contactCount;++w)l=i.m_contacts[w],l.m_flags&=~(ia.e_toiFlag|ia.e_islandFlag);for(w=0;w<i.m_jointCount;++w)h=i.m_joints[w],h.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else e.m_sweep.Set(ga.s_backupA),f.m_sweep.Set(ga.s_backupB),e.SynchronizeTransform(),f.SynchronizeTransform()}},ga.prototype.DrawJoint=function(a){var b=a.GetBodyA(),c=a.GetBodyB(),d=b.m_xf,e=c.m_xf,f=d.position,g=e.position,h=a.GetAnchorA(),i=a.GetAnchorB(),j=ga.s_jointColor;switch(a.m_type){case Ea.e_distanceJoint:this.m_debugDraw.DrawSegment(h,i,j);break;case Ea.e_pulleyJoint:var k=a instanceof Na?a:null,l=k.GetGroundAnchorA(),m=k.GetGroundAnchorB();this.m_debugDraw.DrawSegment(l,h,j),this.m_debugDraw.DrawSegment(m,i,j),this.m_debugDraw.DrawSegment(l,m,j);break;case Ea.e_mouseJoint:this.m_debugDraw.DrawSegment(h,i,j);break;default:b!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f,h,j),this.m_debugDraw.DrawSegment(h,i,j),c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(g,i,j)}},ga.prototype.DrawShape=function(a,b,c){switch(a.m_type){case U.e_circleShape:var e=a instanceof P?a:null,f=d.MulX(b,e.m_p),g=e.m_radius,h=b.R.col1;this.m_debugDraw.DrawSolidCircle(f,g,h,c);break;case U.e_polygonShape:var i=0,j=a instanceof T?a:null,k=parseInt(j.GetVertexCount()),l=j.GetVertices(),m=new Vector(k);for(i=0;i<k;++i)m[i]=d.MulX(b,l[i]);this.m_debugDraw.DrawSolidPolygon(m,k,c);break;case U.e_edgeShape:var n=a instanceof R?a:null;this.m_debugDraw.DrawSegment(d.MulX(b,n.GetVertex1()),d.MulX(b,n.GetVertex2()),c)}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new fa,Box2D.Dynamics.b2World.s_xf=new f,Box2D.Dynamics.b2World.s_backupA=new e,Box2D.Dynamics.b2World.s_backupB=new e,Box2D.Dynamics.b2World.s_timestep=new fa,Box2D.Dynamics.b2World.s_queue=new Vector,Box2D.Dynamics.b2World.s_jointColor=new i(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2})}(),function(){var a=Box2D.Collision.Shapes.b2CircleShape,c=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),e=(Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),f=Box2D.Collision.Shapes.b2Shape,g=Box2D.Dynamics.Contacts.b2CircleContact,h=Box2D.Dynamics.Contacts.b2Contact,i=Box2D.Dynamics.Contacts.b2ContactConstraint,j=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,k=Box2D.Dynamics.Contacts.b2ContactEdge,l=Box2D.Dynamics.Contacts.b2ContactFactory,m=Box2D.Dynamics.Contacts.b2ContactRegister,n=Box2D.Dynamics.Contacts.b2ContactResult,o=Box2D.Dynamics.Contacts.b2ContactSolver,p=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,q=Box2D.Dynamics.Contacts.b2NullContact,r=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,s=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,t=Box2D.Dynamics.Contacts.b2PolygonContact,u=Box2D.Dynamics.Contacts.b2PositionSolverManifold,v=Box2D.Dynamics.b2Body,H=(Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep),L=(Box2D.Dynamics.b2World,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),M=Box2D.Common.Math.b2Mat22,O=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),R=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),W=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision),X=Box2D.Collision.b2ContactID,fa=(Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold),pa=(Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact),qa=Box2D.Collision.b2TOIInput,ra=Box2D.Collision.b2WorldManifold;Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase;Box2D.inherit(g,Box2D.Dynamics.Contacts.b2Contact),g.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,g.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},g.Create=function(a){return new g},g.Destroy=function(a,b){},g.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)},g.prototype.Evaluate=function(){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody();W.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof a?this.m_fixtureA.GetShape():null,b.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,c.m_xf)},h.b2Contact=function(){this.m_nodeA=new k,this.m_nodeB=new k,this.m_manifold=new fa,this.m_oldManifold=new fa},h.prototype.GetManifold=function(){return this.m_manifold},h.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},h.prototype.IsTouching=function(){return(this.m_flags&h.e_touchingFlag)==h.e_touchingFlag},h.prototype.IsContinuous=function(){return(this.m_flags&h.e_continuousFlag)==h.e_continuousFlag},h.prototype.SetSensor=function(a){a?this.m_flags|=h.e_sensorFlag:this.m_flags&=~h.e_sensorFlag},h.prototype.IsSensor=function(){return(this.m_flags&h.e_sensorFlag)==h.e_sensorFlag},h.prototype.SetEnabled=function(a){a?this.m_flags|=h.e_enabledFlag:this.m_flags&=~h.e_enabledFlag},h.prototype.IsEnabled=function(){return(this.m_flags&h.e_enabledFlag)==h.e_enabledFlag},h.prototype.GetNext=function(){return this.m_next},h.prototype.GetFixtureA=function(){return this.m_fixtureA},h.prototype.GetFixtureB=function(){return this.m_fixtureB},h.prototype.FlagForFiltering=function(){this.m_flags|=h.e_filterFlag},h.prototype.b2Contact=function(){},h.prototype.Reset=function(a,b){if(void 0===a&&(a=null),void 0===b&&(b=null),this.m_flags=h.e_enabledFlag,!a||!b)return this.m_fixtureA=null,void(this.m_fixtureB=null);(a.IsSensor()||b.IsSensor())&&(this.m_flags|=h.e_sensorFlag);var c=a.GetBody(),d=b.GetBody();(c.GetType()!=v.b2_dynamicBody||c.IsBullet()||d.GetType()!=v.b2_dynamicBody||d.IsBullet())&&(this.m_flags|=h.e_continuousFlag),this.m_fixtureA=a,this.m_fixtureB=b,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},h.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=h.e_enabledFlag;var c=!1,d=(this.m_flags&h.e_touchingFlag)==h.e_touchingFlag,e=this.m_fixtureA.m_body,g=this.m_fixtureB.m_body,i=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&h.e_sensorFlag){if(i){var j=this.m_fixtureA.GetShape(),k=this.m_fixtureB.GetShape(),l=e.GetTransform(),m=g.GetTransform();c=f.TestOverlap(j,l,k,m)}this.m_manifold.m_pointCount=0}else{if(e.GetType()!=v.b2_dynamicBody||e.IsBullet()||g.GetType()!=v.b2_dynamicBody||g.IsBullet()?this.m_flags|=h.e_continuousFlag:this.m_flags&=~h.e_continuousFlag,i){this.Evaluate(),c=this.m_manifold.m_pointCount>0;for(var n=0;n<this.m_manifold.m_pointCount;++n){var o=this.m_manifold.m_points[n];o.m_normalImpulse=0,o.m_tangentImpulse=0;for(var p=o.m_id,q=0;q<this.m_oldManifold.m_pointCount;++q){var r=this.m_oldManifold.m_points[q];if(r.m_id.key==p.key){o.m_normalImpulse=r.m_normalImpulse,o.m_tangentImpulse=r.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;c!=d&&(e.SetAwake(!0),g.SetAwake(!0))}c?this.m_flags|=h.e_touchingFlag:this.m_flags&=~h.e_touchingFlag,0==d&&1==c&&a.BeginContact(this),1==d&&0==c&&a.EndContact(this),0==(this.m_flags&h.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},h.prototype.Evaluate=function(){},h.prototype.ComputeTOI=function(a,b){return h.s_input.proxyA.Set(this.m_fixtureA.GetShape()),h.s_input.proxyB.Set(this.m_fixtureB.GetShape()),h.s_input.sweepA=a,h.s_input.sweepB=b,h.s_input.tolerance=L.b2_linearSlop,pa.TimeOfImpact(h.s_input)},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64,Box2D.Dynamics.Contacts.b2Contact.s_input=new qa}),i.b2ContactConstraint=function(){this.localPlaneNormal=new R,this.localPoint=new R,this.normal=new R,this.normalMass=new M,this.K=new M},i.prototype.b2ContactConstraint=function(){this.points=new Vector(L.b2_maxManifoldPoints);for(var a=0;a<L.b2_maxManifoldPoints;a++)this.points[a]=new j},j.b2ContactConstraintPoint=function(){this.localPoint=new R,this.rA=new R,this.rB=new R},k.b2ContactEdge=function(){},l.b2ContactFactory=function(){},l.prototype.b2ContactFactory=function(a){this.m_allocator=a,this.InitializeRegisters()},l.prototype.AddType=function(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=0),this.m_registers[c][d].createFcn=a,this.m_registers[c][d].destroyFcn=b,this.m_registers[c][d].primary=!0,c!=d&&(this.m_registers[d][c].createFcn=a,this.m_registers[d][c].destroyFcn=b,this.m_registers[d][c].primary=!1)},l.prototype.InitializeRegisters=function(){this.m_registers=new Vector(f.e_shapeTypeCount);for(var a=0;a<f.e_shapeTypeCount;a++){this.m_registers[a]=new Vector(f.e_shapeTypeCount);for(var b=0;b<f.e_shapeTypeCount;b++)this.m_registers[a][b]=new m}this.AddType(g.Create,g.Destroy,f.e_circleShape,f.e_circleShape),this.AddType(r.Create,r.Destroy,f.e_polygonShape,f.e_circleShape),this.AddType(t.Create,t.Destroy,f.e_polygonShape,f.e_polygonShape),this.AddType(p.Create,p.Destroy,f.e_edgeShape,f.e_circleShape),this.AddType(s.Create,s.Destroy,f.e_polygonShape,f.e_edgeShape)},l.prototype.Create=function(a,b){var f,c=parseInt(a.GetType()),d=parseInt(b.GetType()),e=this.m_registers[c][d];if(e.pool)return f=e.pool,e.pool=f.m_next,e.poolCount--,f.Reset(a,b),f;var g=e.createFcn;return null!=g?e.primary?(f=g(this.m_allocator),f.Reset(a,b),f):(f=g(this.m_allocator),f.Reset(b,a),f):null},l.prototype.Destroy=function(a){a.m_manifold.m_pointCount>0&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var b=parseInt(a.m_fixtureA.GetType()),c=parseInt(a.m_fixtureB.GetType()),d=this.m_registers[b][c];d.poolCount++,a.m_next=d.pool,d.pool=a;var e=d.destroyFcn;e(a,this.m_allocator)},m.b2ContactRegister=function(){},n.b2ContactResult=function(){this.position=new R,this.normal=new R,this.id=new X},o.b2ContactSolver=function(){this.m_step=new H,this.m_constraints=new Vector},o.prototype.b2ContactSolver=function(){},o.prototype.Initialize=function(a,b,c,d){void 0===c&&(c=0);var e;this.m_step.Set(a),this.m_allocator=d;var f=0;for(this.m_constraintCount=c;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new i;for(f=0;f<c;++f){e=b[f];var j=e.m_fixtureA,k=e.m_fixtureB,l=j.m_shape,m=k.m_shape,n=l.m_radius,p=m.m_radius,q=j.m_body,r=k.m_body,s=e.GetManifold(),t=L.b2MixFriction(j.GetFriction(),k.GetFriction()),u=L.b2MixRestitution(j.GetRestitution(),k.GetRestitution()),v=q.m_linearVelocity.x,w=q.m_linearVelocity.y,x=r.m_linearVelocity.x,y=r.m_linearVelocity.y,z=q.m_angularVelocity,A=r.m_angularVelocity;L.b2Assert(s.m_pointCount>0),o.s_worldManifold.Initialize(s,q.m_xf,n,r.m_xf,p);var B=o.s_worldManifold.m_normal.x,C=o.s_worldManifold.m_normal.y,D=this.m_constraints[f];D.bodyA=q,D.bodyB=r,D.manifold=s,D.normal.x=B,D.normal.y=C,D.pointCount=s.m_pointCount,D.friction=t,D.restitution=u,D.localPlaneNormal.x=s.m_localPlaneNormal.x,D.localPlaneNormal.y=s.m_localPlaneNormal.y,D.localPoint.x=s.m_localPoint.x,D.localPoint.y=s.m_localPoint.y,D.radius=n+p,D.type=s.m_type;for(var E=0;E<D.pointCount;++E){var F=s.m_points[E],G=D.points[E];G.normalImpulse=F.m_normalImpulse,G.tangentImpulse=F.m_tangentImpulse,G.localPoint.SetV(F.m_localPoint);var H=G.rA.x=o.s_worldManifold.m_points[E].x-q.m_sweep.c.x,I=G.rA.y=o.s_worldManifold.m_points[E].y-q.m_sweep.c.y,J=G.rB.x=o.s_worldManifold.m_points[E].x-r.m_sweep.c.x,K=G.rB.y=o.s_worldManifold.m_points[E].y-r.m_sweep.c.y,M=H*C-I*B,N=J*C-K*B;M*=M,N*=N;var O=q.m_invMass+r.m_invMass+q.m_invI*M+r.m_invI*N;G.normalMass=1/O;var P=q.m_mass*q.m_invMass+r.m_mass*r.m_invMass;P+=q.m_mass*q.m_invI*M+r.m_mass*r.m_invI*N,G.equalizedMass=1/P;var Q=C,R=-B,S=H*R-I*Q,T=J*R-K*Q;S*=S,T*=T;var U=q.m_invMass+r.m_invMass+q.m_invI*S+r.m_invI*T;G.tangentMass=1/U,G.velocityBias=0;var V=x+-A*K-v- -z*I,W=y+A*J-w-z*H,X=D.normal.x*V+D.normal.y*W;X<-L.b2_velocityThreshold&&(G.velocityBias+=-D.restitution*X)}if(2==D.pointCount){var Y=D.points[0],Z=D.points[1],$=q.m_invMass,_=q.m_invI,aa=r.m_invMass,ba=r.m_invI,ca=Y.rA.x*C-Y.rA.y*B,da=Y.rB.x*C-Y.rB.y*B,ea=Z.rA.x*C-Z.rA.y*B,fa=Z.rB.x*C-Z.rB.y*B,ga=$+aa+_*ca*ca+ba*da*da,ha=$+aa+_*ea*ea+ba*fa*fa,ia=$+aa+_*ca*ea+ba*da*fa,ja=100;ga*ga<ja*(ga*ha-ia*ia)?(D.K.col1.Set(ga,ia),D.K.col2.Set(ia,ha),D.K.GetInverse(D.normalMass)):D.pointCount=1}}},o.prototype.InitVelocityConstraints=function(a){for(var e=0;e<this.m_constraintCount;++e){var f=this.m_constraints[e],g=f.bodyA,h=f.bodyB,i=g.m_invMass,j=g.m_invI,k=h.m_invMass,l=h.m_invI,m=f.normal.x,n=f.normal.y,o=n,p=-m,r=0,s=0;if(a.warmStarting)for(s=f.pointCount,r=0;r<s;++r){var t=f.points[r];t.normalImpulse*=a.dtRatio,t.tangentImpulse*=a.dtRatio;var u=t.normalImpulse*m+t.tangentImpulse*o,v=t.normalImpulse*n+t.tangentImpulse*p;g.m_angularVelocity-=j*(t.rA.x*v-t.rA.y*u),g.m_linearVelocity.x-=i*u,g.m_linearVelocity.y-=i*v,h.m_angularVelocity+=l*(t.rB.x*v-t.rB.y*u),h.m_linearVelocity.x+=k*u,h.m_linearVelocity.y+=k*v}else for(s=f.pointCount,r=0;r<s;++r){var w=f.points[r];w.normalImpulse=0,w.tangentImpulse=0}}},o.prototype.SolveVelocityConstraints=function(){for(var b,v,a=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,x=0;x<this.m_constraintCount;++x){var y=this.m_constraints[x],z=y.bodyA,A=y.bodyB,B=z.m_angularVelocity,C=A.m_angularVelocity,D=z.m_linearVelocity,E=A.m_linearVelocity,F=z.m_invMass,G=z.m_invI,H=A.m_invMass,I=A.m_invI,J=y.normal.x,K=y.normal.y,L=K,M=-J,N=y.friction;for(a=0;a<y.pointCount;a++)b=y.points[a],g=E.x-C*b.rB.y-D.x+B*b.rA.y,h=E.y+C*b.rB.x-D.y-B*b.rA.x,j=g*L+h*M,k=b.tangentMass*-j,l=N*b.normalImpulse,m=O.Clamp(b.tangentImpulse+k,-l,l),k=m-b.tangentImpulse,n=k*L,o=k*M,D.x-=F*n,D.y-=F*o,B-=G*(b.rA.x*o-b.rA.y*n),E.x+=H*n,E.y+=H*o,C+=I*(b.rB.x*o-b.rB.y*n),b.tangentImpulse=m;parseInt(y.pointCount);if(1==y.pointCount)b=y.points[0],g=E.x+-C*b.rB.y-D.x- -B*b.rA.y,h=E.y+C*b.rB.x-D.y-B*b.rA.x,i=g*J+h*K,k=-b.normalMass*(i-b.velocityBias),m=b.normalImpulse+k,m=m>0?m:0,k=m-b.normalImpulse,n=k*J,o=k*K,D.x-=F*n,D.y-=F*o,B-=G*(b.rA.x*o-b.rA.y*n),E.x+=H*n,E.y+=H*o,C+=I*(b.rB.x*o-b.rB.y*n),b.normalImpulse=m;else{var R=y.points[0],S=y.points[1],T=R.normalImpulse,U=S.normalImpulse,V=E.x-C*R.rB.y-D.x+B*R.rA.y,W=E.y+C*R.rB.x-D.y-B*R.rA.x,X=E.x-C*S.rB.y-D.x+B*S.rA.y,Y=E.y+C*S.rB.x-D.y-B*S.rA.x,Z=V*J+W*K,$=X*J+Y*K,_=Z-R.velocityBias,aa=$-S.velocityBias;v=y.K,_-=v.col1.x*T+v.col2.x*U,aa-=v.col1.y*T+v.col2.y*U;for(;;){v=y.normalMass;var ca=-(v.col1.x*_+v.col2.x*aa),da=-(v.col1.y*_+v.col2.y*aa);if(ca>=0&&da>=0){p=ca-T,q=da-U,r=p*J,s=p*K,t=q*J,u=q*K,D.x-=F*(r+t),D.y-=F*(s+u),B-=G*(R.rA.x*s-R.rA.y*r+S.rA.x*u-S.rA.y*t),E.x+=H*(r+t),E.y+=H*(s+u),C+=I*(R.rB.x*s-R.rB.y*r+S.rB.x*u-S.rB.y*t),R.normalImpulse=ca,S.normalImpulse=da;break}if(ca=-R.normalMass*_,da=0,Z=0,$=y.K.col1.y*ca+aa,ca>=0&&$>=0){p=ca-T,q=da-U,r=p*J,s=p*K,t=q*J,u=q*K,D.x-=F*(r+t),D.y-=F*(s+u),B-=G*(R.rA.x*s-R.rA.y*r+S.rA.x*u-S.rA.y*t),E.x+=H*(r+t),E.y+=H*(s+u),C+=I*(R.rB.x*s-R.rB.y*r+S.rB.x*u-S.rB.y*t),R.normalImpulse=ca,S.normalImpulse=da;break}if(ca=0,da=-S.normalMass*aa,Z=y.K.col2.x*da+_,$=0,da>=0&&Z>=0){p=ca-T,q=da-U,r=p*J,s=p*K,t=q*J,u=q*K,D.x-=F*(r+t),D.y-=F*(s+u),B-=G*(R.rA.x*s-R.rA.y*r+S.rA.x*u-S.rA.y*t),E.x+=H*(r+t),E.y+=H*(s+u),C+=I*(R.rB.x*s-R.rB.y*r+S.rB.x*u-S.rB.y*t),R.normalImpulse=ca,S.normalImpulse=da;break}if(ca=0,da=0,Z=_,$=aa,Z>=0&&$>=0){p=ca-T,q=da-U,r=p*J,s=p*K,t=q*J,u=q*K,D.x-=F*(r+t),D.y-=F*(s+u),B-=G*(R.rA.x*s-R.rA.y*r+S.rA.x*u-S.rA.y*t),E.x+=H*(r+t),E.y+=H*(s+u),C+=I*(R.rB.x*s-R.rB.y*r+S.rB.x*u-S.rB.y*t),R.normalImpulse=ca,S.normalImpulse=da;break}break}}z.m_angularVelocity=B,
A.m_angularVelocity=C}},o.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var b=this.m_constraints[a],c=b.manifold,d=0;d<b.pointCount;++d){var e=c.m_points[d],f=b.points[d];e.m_normalImpulse=f.normalImpulse,e.m_tangentImpulse=f.tangentImpulse}},o.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);for(var b=0,c=0;c<this.m_constraintCount;c++){var d=this.m_constraints[c],e=d.bodyA,f=d.bodyB,g=e.m_mass*e.m_invMass,h=e.m_mass*e.m_invI,i=f.m_mass*f.m_invMass,j=f.m_mass*f.m_invI;o.s_psm.Initialize(d);for(var k=o.s_psm.m_normal,l=0;l<d.pointCount;l++){var m=d.points[l],n=o.s_psm.m_points[l],p=o.s_psm.m_separations[l],q=n.x-e.m_sweep.c.x,r=n.y-e.m_sweep.c.y,s=n.x-f.m_sweep.c.x,t=n.y-f.m_sweep.c.y;b=b<p?b:p;var u=O.Clamp(a*(p+L.b2_linearSlop),-L.b2_maxLinearCorrection,0),v=-m.equalizedMass*u,w=v*k.x,x=v*k.y;e.m_sweep.c.x-=g*w,e.m_sweep.c.y-=g*x,e.m_sweep.a-=h*(q*x-r*w),e.SynchronizeTransform(),f.m_sweep.c.x+=i*w,f.m_sweep.c.y+=i*x,f.m_sweep.a+=j*(s*x-t*w),f.SynchronizeTransform()}}return b>-1.5*L.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new ra,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new u}),Box2D.inherit(p,Box2D.Dynamics.Contacts.b2Contact),p.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,p.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},p.Create=function(a){return new p},p.Destroy=function(a,b){},p.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)},p.prototype.Evaluate=function(){var b=this.m_fixtureA.GetBody(),d=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof c?this.m_fixtureA.GetShape():null,b.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,d.m_xf)},p.prototype.b2CollideEdgeAndCircle=function(a,b,c,d,e){},Box2D.inherit(q,Box2D.Dynamics.Contacts.b2Contact),q.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,q.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},q.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},q.prototype.Evaluate=function(){},Box2D.inherit(r,Box2D.Dynamics.Contacts.b2Contact),r.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,r.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},r.Create=function(a){return new r},r.Destroy=function(a,b){},r.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b),L.b2Assert(a.GetType()==f.e_polygonShape),L.b2Assert(b.GetType()==f.e_circleShape)},r.prototype.Evaluate=function(){var b=this.m_fixtureA.m_body,c=this.m_fixtureB.m_body;W.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,b.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,c.m_xf)},Box2D.inherit(s,Box2D.Dynamics.Contacts.b2Contact),s.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,s.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},s.Create=function(a){return new s},s.Destroy=function(a,b){},s.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b),L.b2Assert(a.GetType()==f.e_polygonShape),L.b2Assert(b.GetType()==f.e_edgeShape)},s.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof c?this.m_fixtureB.GetShape():null,b.m_xf)},s.prototype.b2CollidePolyAndEdge=function(a,b,c,d,e){},Box2D.inherit(t,Box2D.Dynamics.Contacts.b2Contact),t.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,t.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},t.Create=function(a){return new t},t.Destroy=function(a,b){},t.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)},t.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();W.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,b.m_xf)},u.b2PositionSolverManifold=function(){},u.prototype.b2PositionSolverManifold=function(){this.m_normal=new R,this.m_separations=new Vector_a2j_Number(L.b2_maxManifoldPoints),this.m_points=new Vector(L.b2_maxManifoldPoints);for(var a=0;a<L.b2_maxManifoldPoints;a++)this.m_points[a]=new R},u.prototype.Initialize=function(a){L.b2Assert(a.pointCount>0);var e,f,b=0,c=0,d=0,g=0,h=0;switch(a.type){case fa.e_circles:e=a.bodyA.m_xf.R,f=a.localPoint;var i=a.bodyA.m_xf.position.x+(e.col1.x*f.x+e.col2.x*f.y),j=a.bodyA.m_xf.position.y+(e.col1.y*f.x+e.col2.y*f.y);e=a.bodyB.m_xf.R,f=a.points[0].localPoint;var k=a.bodyB.m_xf.position.x+(e.col1.x*f.x+e.col2.x*f.y),l=a.bodyB.m_xf.position.y+(e.col1.y*f.x+e.col2.y*f.y),m=k-i,n=l-j,o=m*m+n*n;if(o>Number.MIN_VALUE*Number.MIN_VALUE){var p=Math.sqrt(o);this.m_normal.x=m/p,this.m_normal.y=n/p}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(i+k),this.m_points[0].y=.5*(j+l),this.m_separations[0]=m*this.m_normal.x+n*this.m_normal.y-a.radius;break;case fa.e_faceA:for(e=a.bodyA.m_xf.R,f=a.localPlaneNormal,this.m_normal.x=e.col1.x*f.x+e.col2.x*f.y,this.m_normal.y=e.col1.y*f.x+e.col2.y*f.y,e=a.bodyA.m_xf.R,f=a.localPoint,g=a.bodyA.m_xf.position.x+(e.col1.x*f.x+e.col2.x*f.y),h=a.bodyA.m_xf.position.y+(e.col1.y*f.x+e.col2.y*f.y),e=a.bodyB.m_xf.R,b=0;b<a.pointCount;++b)f=a.points[b].localPoint,c=a.bodyB.m_xf.position.x+(e.col1.x*f.x+e.col2.x*f.y),d=a.bodyB.m_xf.position.y+(e.col1.y*f.x+e.col2.y*f.y),this.m_separations[b]=(c-g)*this.m_normal.x+(d-h)*this.m_normal.y-a.radius,this.m_points[b].x=c,this.m_points[b].y=d;break;case fa.e_faceB:for(e=a.bodyB.m_xf.R,f=a.localPlaneNormal,this.m_normal.x=e.col1.x*f.x+e.col2.x*f.y,this.m_normal.y=e.col1.y*f.x+e.col2.y*f.y,e=a.bodyB.m_xf.R,f=a.localPoint,g=a.bodyB.m_xf.position.x+(e.col1.x*f.x+e.col2.x*f.y),h=a.bodyB.m_xf.position.y+(e.col1.y*f.x+e.col2.y*f.y),e=a.bodyA.m_xf.R,b=0;b<a.pointCount;++b)f=a.points[b].localPoint,c=a.bodyA.m_xf.position.x+(e.col1.x*f.x+e.col2.x*f.y),d=a.bodyA.m_xf.position.y+(e.col1.y*f.x+e.col2.y*f.y),this.m_separations[b]=(c-g)*this.m_normal.x+(d-h)*this.m_normal.y-a.radius,this.m_points[b].Set(c,d);this.m_normal.x*=-1,this.m_normal.y*=-1}},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new R,Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new R})}(),function(){var o=(Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Common.Math.b2Mat22),q=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),t=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),v=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),E=(Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape,Box2D.Dynamics.Controllers.b2BuoyancyController),F=Box2D.Dynamics.Controllers.b2ConstantAccelController,G=Box2D.Dynamics.Controllers.b2ConstantForceController,H=Box2D.Dynamics.Controllers.b2Controller,I=Box2D.Dynamics.Controllers.b2ControllerEdge,J=Box2D.Dynamics.Controllers.b2GravityController,K=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(E,Box2D.Dynamics.Controllers.b2Controller),E.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,E.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new t(0,(-1)),this.offset=0,this.density=0,this.velocity=new t(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},E.prototype.Step=function(a){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var b=this.m_bodyList;b;b=b.nextBody){var c=b.body;if(0!=c.IsAwake()){for(var d=new t,e=new t,f=0,g=0,h=c.GetFixtureList();h;h=h.GetNext()){var i=new t,j=h.GetShape().ComputeSubmergedArea(this.normal,this.offset,c.GetTransform(),i);f+=j,d.x+=j*i.x,d.y+=j*i.y;var k=0;k=(this.useDensity,1),g+=j*k,e.x+=j*i.x*k,e.y+=j*i.y*k}if(d.x/=f,d.y/=f,e.x/=g,e.y/=g,!(f<Number.MIN_VALUE)){var l=this.gravity.GetNegative();l.Multiply(this.density*f),c.ApplyForce(l,e);var m=c.GetLinearVelocityFromWorldPoint(d);m.Subtract(this.velocity),m.Multiply(-this.linearDrag*f),c.ApplyForce(m,d),c.ApplyTorque(-c.GetInertia()/c.GetMass()*f*c.GetAngularVelocity()*this.angularDrag)}}}}},E.prototype.Draw=function(a){var b=1e3,c=new t,d=new t;c.x=this.normal.x*this.offset+this.normal.y*b,c.y=this.normal.y*this.offset-this.normal.x*b,d.x=this.normal.x*this.offset-this.normal.y*b,d.y=this.normal.y*this.offset+this.normal.x*b;var e=new v(0,0,1);a.DrawSegment(c,d,e)},Box2D.inherit(F,Box2D.Dynamics.Controllers.b2Controller),F.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,F.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new t(0,0)},F.prototype.Step=function(a){for(var b=new t(this.A.x*a.dt,this.A.y*a.dt),c=this.m_bodyList;c;c=c.nextBody){var d=c.body;d.IsAwake()&&d.SetLinearVelocity(new t(d.GetLinearVelocity().x+b.x,d.GetLinearVelocity().y+b.y))}},Box2D.inherit(G,Box2D.Dynamics.Controllers.b2Controller),G.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,G.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new t(0,0)},G.prototype.Step=function(a){for(var b=this.m_bodyList;b;b=b.nextBody){var c=b.body;c.IsAwake()&&c.ApplyForce(this.F,c.GetWorldCenter())}},H.b2Controller=function(){},H.prototype.Step=function(a){},H.prototype.Draw=function(a){},H.prototype.AddBody=function(a){var b=new I;b.controller=this,b.body=a,b.nextBody=this.m_bodyList,b.prevBody=null,this.m_bodyList=b,b.nextBody&&(b.nextBody.prevBody=b),this.m_bodyCount++,b.nextController=a.m_controllerList,b.prevController=null,a.m_controllerList=b,b.nextController&&(b.nextController.prevController=b),a.m_controllerCount++},H.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!=this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody),b.nextBody&&(b.nextBody.prevBody=b.prevBody),b.nextController&&(b.nextController.prevController=b.prevController),b.prevController&&(b.prevController.nextController=b.nextController),this.m_bodyList==b&&(this.m_bodyList=b.nextBody),a.m_controllerList==b&&(a.m_controllerList=b.nextController),a.m_controllerCount--,this.m_bodyCount--},H.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},H.prototype.GetNext=function(){return this.m_next},H.prototype.GetWorld=function(){return this.m_world},H.prototype.GetBodyList=function(){return this.m_bodyList},I.b2ControllerEdge=function(){},Box2D.inherit(J,Box2D.Dynamics.Controllers.b2Controller),J.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,J.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},J.prototype.Step=function(a){var b=null,c=null,d=null,e=0,f=null,g=null,h=null,i=0,j=0,k=0,l=null;if(this.invSqr)for(b=this.m_bodyList;b;b=b.nextBody)for(c=b.body,d=c.GetWorldCenter(),e=c.GetMass(),f=this.m_bodyList;f!=b;f=f.nextBody)g=f.body,h=g.GetWorldCenter(),i=h.x-d.x,j=h.y-d.y,k=i*i+j*j,k<Number.MIN_VALUE||(l=new t(i,j),l.Multiply(this.G/k/Math.sqrt(k)*e*g.GetMass()),c.IsAwake()&&c.ApplyForce(l,d),l.Multiply(-1),g.IsAwake()&&g.ApplyForce(l,h));else for(b=this.m_bodyList;b;b=b.nextBody)for(c=b.body,d=c.GetWorldCenter(),e=c.GetMass(),f=this.m_bodyList;f!=b;f=f.nextBody)g=f.body,h=g.GetWorldCenter(),i=h.x-d.x,j=h.y-d.y,k=i*i+j*j,k<Number.MIN_VALUE||(l=new t(i,j),l.Multiply(this.G/k*e*g.GetMass()),c.IsAwake()&&c.ApplyForce(l,d),l.Multiply(-1),g.IsAwake()&&g.ApplyForce(l,h))},Box2D.inherit(K,Box2D.Dynamics.Controllers.b2Controller),K.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,K.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new o,this.maxTimestep=0},K.prototype.SetAxisAligned=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.T.col1.x=-a,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-b,a>0||b>0?this.maxTimestep=1/Math.max(a,b):this.maxTimestep=0},K.prototype.Step=function(a){var b=a.dt;if(!(b<=Number.MIN_VALUE)){b>this.maxTimestep&&this.maxTimestep>0&&(b=this.maxTimestep);for(var c=this.m_bodyList;c;c=c.nextBody){var d=c.body;if(d.IsAwake()){var e=d.GetWorldVector(q.MulMV(this.T,d.GetLocalVector(d.GetLinearVelocity())));d.SetLinearVelocity(new t(d.GetLinearVelocity().x+e.x*b,d.GetLinearVelocity().y+e.y*b))}}}}}(),function(){var c=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),d=Box2D.Common.Math.b2Mat22,e=Box2D.Common.Math.b2Mat33,f=Box2D.Common.Math.b2Math,i=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),j=Box2D.Common.Math.b2Vec3,k=Box2D.Dynamics.Joints.b2DistanceJoint,l=Box2D.Dynamics.Joints.b2DistanceJointDef,m=Box2D.Dynamics.Joints.b2FrictionJoint,n=Box2D.Dynamics.Joints.b2FrictionJointDef,o=Box2D.Dynamics.Joints.b2GearJoint,p=Box2D.Dynamics.Joints.b2GearJointDef,q=Box2D.Dynamics.Joints.b2Jacobian,r=Box2D.Dynamics.Joints.b2Joint,s=Box2D.Dynamics.Joints.b2JointDef,t=Box2D.Dynamics.Joints.b2JointEdge,u=Box2D.Dynamics.Joints.b2LineJoint,v=Box2D.Dynamics.Joints.b2LineJointDef,w=Box2D.Dynamics.Joints.b2MouseJoint,x=Box2D.Dynamics.Joints.b2MouseJointDef,y=Box2D.Dynamics.Joints.b2PrismaticJoint,z=Box2D.Dynamics.Joints.b2PrismaticJointDef,A=Box2D.Dynamics.Joints.b2PulleyJoint,B=Box2D.Dynamics.Joints.b2PulleyJointDef,C=Box2D.Dynamics.Joints.b2RevoluteJoint,D=Box2D.Dynamics.Joints.b2RevoluteJointDef,E=Box2D.Dynamics.Joints.b2WeldJoint,F=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World;Box2D.inherit(k,Box2D.Dynamics.Joints.b2Joint),k.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,k.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_u=new i},k.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},k.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},k.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new i(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)},k.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),0},k.prototype.GetLength=function(){return this.m_length},k.prototype.SetLength=function(a){void 0===a&&(a=0),this.m_length=a},k.prototype.GetFrequency=function(){return this.m_frequencyHz},k.prototype.SetFrequency=function(a){void 0===a&&(a=0),this.m_frequencyHz=a},k.prototype.GetDampingRatio=function(){return this.m_dampingRatio},k.prototype.SetDampingRatio=function(a){void 0===a&&(a=0),this.m_dampingRatio=a},k.prototype.b2DistanceJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_length=a.length,this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},k.prototype.InitVelocityConstraints=function(a){var b,d=0,e=this.m_bodyA,f=this.m_bodyB;b=e.m_xf.R;var g=this.m_localAnchor1.x-e.m_sweep.localCenter.x,h=this.m_localAnchor1.y-e.m_sweep.localCenter.y;d=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=d,b=f.m_xf.R;var i=this.m_localAnchor2.x-f.m_sweep.localCenter.x,j=this.m_localAnchor2.y-f.m_sweep.localCenter.y;d=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=d,this.m_u.x=f.m_sweep.c.x+i-e.m_sweep.c.x-g,this.m_u.y=f.m_sweep.c.y+j-e.m_sweep.c.y-h;var k=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);k>c.b2_linearSlop?this.m_u.Multiply(1/k):this.m_u.SetZero();var l=g*this.m_u.y-h*this.m_u.x,m=i*this.m_u.y-j*this.m_u.x,n=e.m_invMass+e.m_invI*l*l+f.m_invMass+f.m_invI*m*m;if(this.m_mass=0!=n?1/n:0,this.m_frequencyHz>0){var o=k-this.m_length,p=2*Math.PI*this.m_frequencyHz,q=2*this.m_mass*this.m_dampingRatio*p,r=this.m_mass*p*p;this.m_gamma=a.dt*(q+a.dt*r),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=o*a.dt*r*this.m_gamma,this.m_mass=n+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}if(a.warmStarting){this.m_impulse*=a.dtRatio;var s=this.m_impulse*this.m_u.x,t=this.m_impulse*this.m_u.y;e.m_linearVelocity.x-=e.m_invMass*s,e.m_linearVelocity.y-=e.m_invMass*t,e.m_angularVelocity-=e.m_invI*(g*t-h*s),f.m_linearVelocity.x+=f.m_invMass*s,f.m_linearVelocity.y+=f.m_invMass*t,f.m_angularVelocity+=f.m_invI*(i*t-j*s)}else this.m_impulse=0},k.prototype.SolveVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;var j=c.m_linearVelocity.x+-c.m_angularVelocity*f,k=c.m_linearVelocity.y+c.m_angularVelocity*e,l=d.m_linearVelocity.x+-d.m_angularVelocity*i,m=d.m_linearVelocity.y+d.m_angularVelocity*h,n=this.m_u.x*(l-j)+this.m_u.y*(m-k),o=-this.m_mass*(n+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=o;var p=o*this.m_u.x,q=o*this.m_u.y;c.m_linearVelocity.x-=c.m_invMass*p,c.m_linearVelocity.y-=c.m_invMass*q,c.m_angularVelocity-=c.m_invI*(e*q-f*p),d.m_linearVelocity.x+=d.m_invMass*p,d.m_linearVelocity.y+=d.m_invMass*q,d.m_angularVelocity+=d.m_invI*(h*q-i*p)},k.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);var b;if(this.m_frequencyHz>0)return!0;var d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var g=this.m_localAnchor1.x-d.m_sweep.localCenter.x,h=this.m_localAnchor1.y-d.m_sweep.localCenter.y,i=b.col1.x*g+b.col2.x*h;h=b.col1.y*g+b.col2.y*h,g=i,b=e.m_xf.R;var j=this.m_localAnchor2.x-e.m_sweep.localCenter.x,k=this.m_localAnchor2.y-e.m_sweep.localCenter.y;i=b.col1.x*j+b.col2.x*k,k=b.col1.y*j+b.col2.y*k,j=i;var l=e.m_sweep.c.x+j-d.m_sweep.c.x-g,m=e.m_sweep.c.y+k-d.m_sweep.c.y-h,n=Math.sqrt(l*l+m*m);l/=n,m/=n;var o=n-this.m_length;o=f.Clamp(o,-c.b2_maxLinearCorrection,c.b2_maxLinearCorrection);var p=-this.m_mass*o;this.m_u.Set(l,m);var q=p*this.m_u.x,r=p*this.m_u.y;return d.m_sweep.c.x-=d.m_invMass*q,d.m_sweep.c.y-=d.m_invMass*r,d.m_sweep.a-=d.m_invI*(g*r-h*q),e.m_sweep.c.x+=e.m_invMass*q,e.m_sweep.c.y+=e.m_invMass*r,e.m_sweep.a+=e.m_invI*(j*r-k*q),d.SynchronizeTransform(),e.SynchronizeTransform(),f.Abs(o)<c.b2_linearSlop},Box2D.inherit(l,Box2D.Dynamics.Joints.b2JointDef),l.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,l.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},l.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=r.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},l.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));var e=d.x-c.x,f=d.y-c.y;this.length=Math.sqrt(e*e+f*f),this.frequencyHz=0,this.dampingRatio=0},Box2D.inherit(m,Box2D.Dynamics.Joints.b2Joint),m.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,m.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new i,this.m_localAnchorB=new i,this.m_linearMass=new d,this.m_linearImpulse=new i},m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},m.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new i(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)},m.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_angularImpulse},m.prototype.SetMaxForce=function(a){void 0===a&&(a=0),this.m_maxForce=a},m.prototype.GetMaxForce=function(){return this.m_maxForce},m.prototype.SetMaxTorque=function(a){void 0===a&&(a=0),this.m_maxTorque=a},m.prototype.GetMaxTorque=function(){return this.m_maxTorque},m.prototype.b2FrictionJoint=function(a){this.__super.b2Joint.call(this,a),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=a.maxForce,this.m_maxTorque=a.maxTorque},m.prototype.InitVelocityConstraints=function(a){var b,c=0,e=this.m_bodyA,f=this.m_bodyB;b=e.m_xf.R;var g=this.m_localAnchorA.x-e.m_sweep.localCenter.x,h=this.m_localAnchorA.y-e.m_sweep.localCenter.y;c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c,b=f.m_xf.R;var i=this.m_localAnchorB.x-f.m_sweep.localCenter.x,j=this.m_localAnchorB.y-f.m_sweep.localCenter.y;c=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=c;var k=e.m_invMass,l=f.m_invMass,m=e.m_invI,n=f.m_invI,o=new d;if(o.col1.x=k+l,o.col2.x=0,o.col1.y=0,o.col2.y=k+l,o.col1.x+=m*h*h,o.col2.x+=-m*g*h,o.col1.y+=-m*g*h,o.col2.y+=m*g*g,o.col1.x+=n*j*j,o.col2.x+=-n*i*j,o.col1.y+=-n*i*j,o.col2.y+=n*i*i,o.GetInverse(this.m_linearMass),this.m_angularMass=m+n,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),a.warmStarting){this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio;var p=this.m_linearImpulse;e.m_linearVelocity.x-=k*p.x,e.m_linearVelocity.y-=k*p.y,e.m_angularVelocity-=m*(g*p.y-h*p.x+this.m_angularImpulse),f.m_linearVelocity.x+=l*p.x,f.m_linearVelocity.y+=l*p.y,f.m_angularVelocity+=n*(i*p.y-j*p.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},m.prototype.SolveVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB,g=d.m_linearVelocity,h=d.m_angularVelocity,j=e.m_linearVelocity,k=e.m_angularVelocity,l=d.m_invMass,m=e.m_invMass,n=d.m_invI,o=e.m_invI;b=d.m_xf.R;var p=this.m_localAnchorA.x-d.m_sweep.localCenter.x,q=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*p+b.col2.x*q,q=b.col1.y*p+b.col2.y*q,p=c,b=e.m_xf.R;var r=this.m_localAnchorB.x-e.m_sweep.localCenter.x,s=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*r+b.col2.x*s,s=b.col1.y*r+b.col2.y*s,r=c;var t=0,u=k-h,v=-this.m_angularMass*u,w=this.m_angularImpulse;t=a.dt*this.m_maxTorque,this.m_angularImpulse=f.Clamp(this.m_angularImpulse+v,-t,t),v=this.m_angularImpulse-w,h-=n*v,k+=o*v;var x=j.x-k*s-g.x+h*q,y=j.y+k*r-g.y-h*p,z=f.MulMV(this.m_linearMass,new i((-x),(-y))),A=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(z),t=a.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>t*t&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(t)),z=f.SubtractVV(this.m_linearImpulse,A),g.x-=l*z.x,g.y-=l*z.y,h-=n*(p*z.y-q*z.x),j.x+=m*z.x,j.y+=m*z.y,k+=o*(r*z.y-s*z.x),d.m_angularVelocity=h,e.m_angularVelocity=k},m.prototype.SolvePositionConstraints=function(a){return void 0===a&&(a=0),!0},Box2D.inherit(n,Box2D.Dynamics.Joints.b2JointDef),n.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,n.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},n.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=r.e_frictionJoint,this.maxForce=0,this.maxTorque=0},n.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))},Box2D.inherit(o,Box2D.Dynamics.Joints.b2Joint),o.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,o.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new i,this.m_groundAnchor2=new i,this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_J=new q},o.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},o.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},o.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new i(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)},o.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);var b=this.m_bodyB.m_xf.R,c=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,e=b.col1.x*c+b.col2.x*d;d=b.col1.y*c+b.col2.y*d,c=e;var f=this.m_impulse*this.m_J.linearB.x,g=this.m_impulse*this.m_J.linearB.y;return a*(this.m_impulse*this.m_J.angularB-c*g+d*f)},o.prototype.GetRatio=function(){return this.m_ratio},o.prototype.SetRatio=function(a){void 0===a&&(a=0),this.m_ratio=a},o.prototype.b2GearJoint=function(a){this.__super.b2Joint.call(this,a);var b=parseInt(a.joint1.m_type),c=parseInt(a.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var d=0,e=0;this.m_ground1=a.joint1.GetBodyA(),this.m_bodyA=a.joint1.GetBodyB(),b==r.e_revoluteJoint?(this.m_revolute1=a.joint1 instanceof C?a.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),d=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1 instanceof y?a.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),d=this.m_prismatic1.GetJointTranslation()),this.m_ground2=a.joint2.GetBodyA(),this.m_bodyB=a.joint2.GetBodyB(),c==r.e_revoluteJoint?(this.m_revolute2=a.joint2 instanceof C?a.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),e=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2 instanceof y?a.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),e=this.m_prismatic2.GetJointTranslation()),this.m_ratio=a.ratio,this.m_constant=d+this.m_ratio*e,this.m_impulse=0},o.prototype.InitVelocityConstraints=function(a){var j,k,b=this.m_ground1,c=this.m_ground2,d=this.m_bodyA,e=this.m_bodyB,f=0,g=0,h=0,i=0,l=0,m=0,n=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,n+=d.m_invI):(j=b.m_xf.R,k=this.m_prismatic1.m_localXAxis1,f=j.col1.x*k.x+j.col2.x*k.y,g=j.col1.y*k.x+j.col2.y*k.y,j=d.m_xf.R,h=this.m_localAnchor1.x-d.m_sweep.localCenter.x,i=this.m_localAnchor1.y-d.m_sweep.localCenter.y,m=j.col1.x*h+j.col2.x*i,i=j.col1.y*h+j.col2.y*i,h=m,l=h*g-i*f,this.m_J.linearA.Set(-f,-g),this.m_J.angularA=-l,n+=d.m_invMass+d.m_invI*l*l),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,n+=this.m_ratio*this.m_ratio*e.m_invI):(j=c.m_xf.R,k=this.m_prismatic2.m_localXAxis1,f=j.col1.x*k.x+j.col2.x*k.y,g=j.col1.y*k.x+j.col2.y*k.y,j=e.m_xf.R,h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,i=this.m_localAnchor2.y-e.m_sweep.localCenter.y,m=j.col1.x*h+j.col2.x*i,i=j.col1.y*h+j.col2.y*i,h=m,l=h*g-i*f,this.m_J.linearB.Set(-this.m_ratio*f,-this.m_ratio*g),this.m_J.angularB=-this.m_ratio*l,n+=this.m_ratio*this.m_ratio*(e.m_invMass+e.m_invI*l*l)),this.m_mass=n>0?1/n:0,a.warmStarting?(d.m_linearVelocity.x+=d.m_invMass*this.m_impulse*this.m_J.linearA.x,d.m_linearVelocity.y+=d.m_invMass*this.m_impulse*this.m_J.linearA.y,d.m_angularVelocity+=d.m_invI*this.m_impulse*this.m_J.angularA,e.m_linearVelocity.x+=e.m_invMass*this.m_impulse*this.m_J.linearB.x,e.m_linearVelocity.y+=e.m_invMass*this.m_impulse*this.m_J.linearB.y,e.m_angularVelocity+=e.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},o.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=this.m_J.Compute(b.m_linearVelocity,b.m_angularVelocity,c.m_linearVelocity,c.m_angularVelocity),e=-this.m_mass*d;this.m_impulse+=e,b.m_linearVelocity.x+=b.m_invMass*e*this.m_J.linearA.x,b.m_linearVelocity.y+=b.m_invMass*e*this.m_J.linearA.y,b.m_angularVelocity+=b.m_invI*e*this.m_J.angularA,c.m_linearVelocity.x+=c.m_invMass*e*this.m_J.linearB.x,c.m_linearVelocity.y+=c.m_invMass*e*this.m_J.linearB.y,c.m_angularVelocity+=c.m_invI*e*this.m_J.angularB},o.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);var b=0,d=this.m_bodyA,e=this.m_bodyB,f=0,g=0;f=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),g=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var h=this.m_constant-(f+this.m_ratio*g),i=-this.m_mass*h;return d.m_sweep.c.x+=d.m_invMass*i*this.m_J.linearA.x,d.m_sweep.c.y+=d.m_invMass*i*this.m_J.linearA.y,d.m_sweep.a+=d.m_invI*i*this.m_J.angularA,e.m_sweep.c.x+=e.m_invMass*i*this.m_J.linearB.x,e.m_sweep.c.y+=e.m_invMass*i*this.m_J.linearB.y,e.m_sweep.a+=e.m_invI*i*this.m_J.angularB,d.SynchronizeTransform(),e.SynchronizeTransform(),b<c.b2_linearSlop},Box2D.inherit(p,Box2D.Dynamics.Joints.b2JointDef),p.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,p.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},p.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=r.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},q.b2Jacobian=function(){this.linearA=new i,this.linearB=new i},q.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},q.prototype.Set=function(a,b,c,d){void 0===b&&(b=0),void 0===d&&(d=0),this.linearA.SetV(a),this.angularA=b,this.linearB.SetV(c),this.angularB=d},q.prototype.Compute=function(a,b,c,d){return void 0===b&&(b=0),void 0===d&&(d=0),this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*d},r.b2Joint=function(){this.m_edgeA=new t,this.m_edgeB=new t,this.m_localCenterA=new i,this.m_localCenterB=new i},r.prototype.GetType=function(){return this.m_type},r.prototype.GetAnchorA=function(){return null},r.prototype.GetAnchorB=function(){return null},r.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),null},r.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),0},r.prototype.GetBodyA=function(){return this.m_bodyA},r.prototype.GetBodyB=function(){return this.m_bodyB},r.prototype.GetNext=function(){return this.m_next},r.prototype.GetUserData=function(){return this.m_userData},r.prototype.SetUserData=function(a){this.m_userData=a},r.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},r.Create=function(a,b){var c=null;switch(a.type){case r.e_distanceJoint:c=new k(a instanceof l?a:null);break;case r.e_mouseJoint:c=new w(a instanceof x?a:null);break;case r.e_prismaticJoint:c=new y(a instanceof z?a:null);break;case r.e_revoluteJoint:c=new C(a instanceof D?a:null);break;case r.e_pulleyJoint:c=new A(a instanceof B?a:null);break;case r.e_gearJoint:c=new o(a instanceof p?a:null);break;case r.e_lineJoint:c=new u(a instanceof v?a:null);break;case r.e_weldJoint:
c=new E(a instanceof F?a:null);break;case r.e_frictionJoint:c=new m(a instanceof n?a:null)}return c},r.Destroy=function(a,b){},r.prototype.b2Joint=function(a){c.b2Assert(a.bodyA!=a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},r.prototype.InitVelocityConstraints=function(a){},r.prototype.SolveVelocityConstraints=function(a){},r.prototype.FinalizeVelocityConstraints=function(){},r.prototype.SolvePositionConstraints=function(a){return void 0===a&&(a=0),!1},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}),s.b2JointDef=function(){},s.prototype.b2JointDef=function(){this.type=r.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},t.b2JointEdge=function(){},Box2D.inherit(u,Box2D.Dynamics.Joints.b2Joint),u.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,u.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_localXAxis1=new i,this.m_localYAxis1=new i,this.m_axis=new i,this.m_perp=new i,this.m_K=new d,this.m_impulse=new i},u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},u.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new i(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},u.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.y},u.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,d=a.GetWorldPoint(this.m_localAnchor1),e=b.GetWorldPoint(this.m_localAnchor2),f=e.x-d.x,g=e.y-d.y,h=a.GetWorldVector(this.m_localXAxis1),i=h.x*f+h.y*g;return i},u.prototype.GetJointSpeed=function(){var c,a=this.m_bodyA,b=this.m_bodyB;c=a.m_xf.R;var d=this.m_localAnchor1.x-a.m_sweep.localCenter.x,e=this.m_localAnchor1.y-a.m_sweep.localCenter.y,f=c.col1.x*d+c.col2.x*e;e=c.col1.y*d+c.col2.y*e,d=f,c=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,h=this.m_localAnchor2.y-b.m_sweep.localCenter.y;f=c.col1.x*g+c.col2.x*h,h=c.col1.y*g+c.col2.y*h,g=f;var i=a.m_sweep.c.x+d,j=a.m_sweep.c.y+e,k=b.m_sweep.c.x+g,l=b.m_sweep.c.y+h,m=k-i,n=l-j,o=a.GetWorldVector(this.m_localXAxis1),p=a.m_linearVelocity,q=b.m_linearVelocity,r=a.m_angularVelocity,s=b.m_angularVelocity,t=m*(-r*o.y)+n*(r*o.x)+(o.x*(q.x+-s*h-p.x- -r*e)+o.y*(q.y+s*g-p.y-r*d));return t},u.prototype.IsLimitEnabled=function(){return this.m_enableLimit},u.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},u.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},u.prototype.GetUpperLimit=function(){return this.m_upperTranslation},u.prototype.SetLimits=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},u.prototype.IsMotorEnabled=function(){return this.m_enableMotor},u.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},u.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},u.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},u.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},u.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},u.prototype.GetMotorForce=function(){return this.m_motorImpulse},u.prototype.b2LineJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=r.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},u.prototype.InitVelocityConstraints=function(a){var e,b=this.m_bodyA,d=this.m_bodyB,g=0;this.m_localCenterA.SetV(b.GetLocalCenter()),this.m_localCenterB.SetV(d.GetLocalCenter());var h=b.GetTransform();d.GetTransform();e=b.m_xf.R;var j=this.m_localAnchor1.x-this.m_localCenterA.x,k=this.m_localAnchor1.y-this.m_localCenterA.y;g=e.col1.x*j+e.col2.x*k,k=e.col1.y*j+e.col2.y*k,j=g,e=d.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,m=this.m_localAnchor2.y-this.m_localCenterB.y;g=e.col1.x*l+e.col2.x*m,m=e.col1.y*l+e.col2.y*m,l=g;var n=d.m_sweep.c.x+l-b.m_sweep.c.x-j,o=d.m_sweep.c.y+m-b.m_sweep.c.y-k;this.m_invMassA=b.m_invMass,this.m_invMassB=d.m_invMass,this.m_invIA=b.m_invI,this.m_invIB=d.m_invI,this.m_axis.SetV(f.MulMV(h.R,this.m_localXAxis1)),this.m_a1=(n+j)*this.m_axis.y-(o+k)*this.m_axis.x,this.m_a2=l*this.m_axis.y-m*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(f.MulMV(h.R,this.m_localYAxis1)),this.m_s1=(n+j)*this.m_perp.y-(o+k)*this.m_perp.x,this.m_s2=l*this.m_perp.y-m*this.m_perp.x;var p=this.m_invMassA,q=this.m_invMassB,s=this.m_invIA,t=this.m_invIB;if(this.m_K.col1.x=p+q+s*this.m_s1*this.m_s1+t*this.m_s2*this.m_s2,this.m_K.col1.y=s*this.m_s1*this.m_a1+t*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=p+q+s*this.m_a1*this.m_a1+t*this.m_a2*this.m_a2,this.m_enableLimit){var u=this.m_axis.x*n+this.m_axis.y*o;f.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*c.b2_linearSlop?this.m_limitState=r.e_equalLimits:u<=this.m_lowerTranslation?this.m_limitState!=r.e_atLowerLimit&&(this.m_limitState=r.e_atLowerLimit,this.m_impulse.y=0):u>=this.m_upperTranslation?this.m_limitState!=r.e_atUpperLimit&&(this.m_limitState=r.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=r.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=r.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,w=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,x=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,y=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;b.m_linearVelocity.x-=this.m_invMassA*v,b.m_linearVelocity.y-=this.m_invMassA*w,b.m_angularVelocity-=this.m_invIA*x,d.m_linearVelocity.x+=this.m_invMassB*v,d.m_linearVelocity.y+=this.m_invMassB*w,d.m_angularVelocity+=this.m_invIB*y}else this.m_impulse.SetZero(),this.m_motorImpulse=0},u.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=b.m_linearVelocity,e=b.m_angularVelocity,g=c.m_linearVelocity,h=c.m_angularVelocity,j=0,k=0,l=0,m=0;if(this.m_enableMotor&&this.m_limitState!=r.e_equalLimits){var n=this.m_axis.x*(g.x-d.x)+this.m_axis.y*(g.y-d.y)+this.m_a2*h-this.m_a1*e,o=this.m_motorMass*(this.m_motorSpeed-n),p=this.m_motorImpulse,q=a.dt*this.m_maxMotorForce;this.m_motorImpulse=f.Clamp(this.m_motorImpulse+o,-q,q),o=this.m_motorImpulse-p,j=o*this.m_axis.x,k=o*this.m_axis.y,l=o*this.m_a1,m=o*this.m_a2,d.x-=this.m_invMassA*j,d.y-=this.m_invMassA*k,e-=this.m_invIA*l,g.x+=this.m_invMassB*j,g.y+=this.m_invMassB*k,h+=this.m_invIB*m}var s=this.m_perp.x*(g.x-d.x)+this.m_perp.y*(g.y-d.y)+this.m_s2*h-this.m_s1*e;if(this.m_enableLimit&&this.m_limitState!=r.e_inactiveLimit){var t=this.m_axis.x*(g.x-d.x)+this.m_axis.y*(g.y-d.y)+this.m_a2*h-this.m_a1*e,u=this.m_impulse.Copy(),v=this.m_K.Solve(new i,-s,-t);this.m_impulse.Add(v),this.m_limitState==r.e_atLowerLimit?this.m_impulse.y=f.Max(this.m_impulse.y,0):this.m_limitState==r.e_atUpperLimit&&(this.m_impulse.y=f.Min(this.m_impulse.y,0));var w=-s-(this.m_impulse.y-u.y)*this.m_K.col2.x,x=0;x=0!=this.m_K.col1.x?w/this.m_K.col1.x+u.x:u.x,this.m_impulse.x=x,v.x=this.m_impulse.x-u.x,v.y=this.m_impulse.y-u.y,j=v.x*this.m_perp.x+v.y*this.m_axis.x,k=v.x*this.m_perp.y+v.y*this.m_axis.y,l=v.x*this.m_s1+v.y*this.m_a1,m=v.x*this.m_s2+v.y*this.m_a2,d.x-=this.m_invMassA*j,d.y-=this.m_invMassA*k,e-=this.m_invIA*l,g.x+=this.m_invMassB*j,g.y+=this.m_invMassB*k,h+=this.m_invIB*m}else{var y=0;y=0!=this.m_K.col1.x?-s/this.m_K.col1.x:0,this.m_impulse.x+=y,j=y*this.m_perp.x,k=y*this.m_perp.y,l=y*this.m_s1,m=y*this.m_s2,d.x-=this.m_invMassA*j,d.y-=this.m_invMassA*k,e-=this.m_invIA*l,g.x+=this.m_invMassB*j,g.y+=this.m_invMassB*k,h+=this.m_invIB*m}b.m_linearVelocity.SetV(d),b.m_angularVelocity=e,c.m_linearVelocity.SetV(g),c.m_angularVelocity=h},u.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);var n,g=this.m_bodyA,h=this.m_bodyB,j=g.m_sweep.c,k=g.m_sweep.a,l=h.m_sweep.c,m=h.m_sweep.a,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=!1,w=0,x=d.FromAngle(k),y=d.FromAngle(m);n=x;var z=this.m_localAnchor1.x-this.m_localCenterA.x,A=this.m_localAnchor1.y-this.m_localCenterA.y;o=n.col1.x*z+n.col2.x*A,A=n.col1.y*z+n.col2.y*A,z=o,n=y;var B=this.m_localAnchor2.x-this.m_localCenterB.x,C=this.m_localAnchor2.y-this.m_localCenterB.y;o=n.col1.x*B+n.col2.x*C,C=n.col1.y*B+n.col2.y*C,B=o;var D=l.x+B-j.x-z,E=l.y+C-j.y-A;if(this.m_enableLimit){this.m_axis=f.MulMV(x,this.m_localXAxis1),this.m_a1=(D+z)*this.m_axis.y-(E+A)*this.m_axis.x,this.m_a2=B*this.m_axis.y-C*this.m_axis.x;var F=this.m_axis.x*D+this.m_axis.y*E;f.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*c.b2_linearSlop?(w=f.Clamp(F,-c.b2_maxLinearCorrection,c.b2_maxLinearCorrection),t=f.Abs(F),v=!0):F<=this.m_lowerTranslation?(w=f.Clamp(F-this.m_lowerTranslation+c.b2_linearSlop,-c.b2_maxLinearCorrection,0),t=this.m_lowerTranslation-F,v=!0):F>=this.m_upperTranslation&&(w=f.Clamp(F-this.m_upperTranslation+c.b2_linearSlop,0,c.b2_maxLinearCorrection),t=F-this.m_upperTranslation,v=!0)}this.m_perp=f.MulMV(x,this.m_localYAxis1),this.m_s1=(D+z)*this.m_perp.y-(E+A)*this.m_perp.x,this.m_s2=B*this.m_perp.y-C*this.m_perp.x;var G=new i,H=this.m_perp.x*D+this.m_perp.y*E;if(t=f.Max(t,f.Abs(H)),u=0,v)p=this.m_invMassA,q=this.m_invMassB,r=this.m_invIA,s=this.m_invIB,this.m_K.col1.x=p+q+r*this.m_s1*this.m_s1+s*this.m_s2*this.m_s2,this.m_K.col1.y=r*this.m_s1*this.m_a1+s*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=p+q+r*this.m_a1*this.m_a1+s*this.m_a2*this.m_a2,this.m_K.Solve(G,-H,-w);else{p=this.m_invMassA,q=this.m_invMassB,r=this.m_invIA,s=this.m_invIB;var I=p+q+r*this.m_s1*this.m_s1+s*this.m_s2*this.m_s2,J=0;J=0!=I?-H/I:0,G.x=J,G.y=0}var K=G.x*this.m_perp.x+G.y*this.m_axis.x,L=G.x*this.m_perp.y+G.y*this.m_axis.y,M=G.x*this.m_s1+G.y*this.m_a1,N=G.x*this.m_s2+G.y*this.m_a2;return j.x-=this.m_invMassA*K,j.y-=this.m_invMassA*L,k-=this.m_invIA*M,l.x+=this.m_invMassB*K,l.y+=this.m_invMassB*L,m+=this.m_invIB*N,g.m_sweep.a=k,h.m_sweep.a=m,g.SynchronizeTransform(),h.SynchronizeTransform(),t<=c.b2_linearSlop&&u<=c.b2_angularSlop},Box2D.inherit(v,Box2D.Dynamics.Joints.b2JointDef),v.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,v.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i,this.localAxisA=new i},v.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=r.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},v.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d)},Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint),w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,w.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new d,this.K1=new d,this.K2=new d,this.m_localAnchor=new i,this.m_target=new i,this.m_impulse=new i,this.m_mass=new d,this.m_C=new i},w.prototype.GetAnchorA=function(){return this.m_target},w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},w.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new i(a*this.m_impulse.x,a*this.m_impulse.y)},w.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),0},w.prototype.GetTarget=function(){return this.m_target},w.prototype.SetTarget=function(a){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=a},w.prototype.GetMaxForce=function(){return this.m_maxForce},w.prototype.SetMaxForce=function(a){void 0===a&&(a=0),this.m_maxForce=a},w.prototype.GetFrequency=function(){return this.m_frequencyHz},w.prototype.SetFrequency=function(a){void 0===a&&(a=0),this.m_frequencyHz=a},w.prototype.GetDampingRatio=function(){return this.m_dampingRatio},w.prototype.SetDampingRatio=function(a){void 0===a&&(a=0),this.m_dampingRatio=a},w.prototype.b2MouseJoint=function(a){this.__super.b2Joint.call(this,a),this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,c=this.m_target.y-this.m_bodyB.m_xf.position.y,d=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*d.col1.x+c*d.col1.y,this.m_localAnchor.y=b*d.col2.x+c*d.col2.y,this.m_maxForce=a.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_beta=0,this.m_gamma=0},w.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyB,c=b.GetMass(),d=2*Math.PI*this.m_frequencyHz,e=2*c*this.m_dampingRatio*d,f=c*d*d;this.m_gamma=a.dt*(e+a.dt*f),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=a.dt*f*this.m_gamma;var g;g=b.m_xf.R;var h=this.m_localAnchor.x-b.m_sweep.localCenter.x,i=this.m_localAnchor.y-b.m_sweep.localCenter.y,j=g.col1.x*h+g.col2.x*i;i=g.col1.y*h+g.col2.y*i,h=j;var k=b.m_invMass,l=b.m_invI;this.K1.col1.x=k,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=k,this.K2.col1.x=l*i*i,this.K2.col2.x=-l*h*i,this.K2.col1.y=-l*h*i,this.K2.col2.y=l*h*h,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=b.m_sweep.c.x+h-this.m_target.x,this.m_C.y=b.m_sweep.c.y+i-this.m_target.y,b.m_angularVelocity*=.98,this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,b.m_linearVelocity.x+=k*this.m_impulse.x,b.m_linearVelocity.y+=k*this.m_impulse.y,b.m_angularVelocity+=l*(h*this.m_impulse.y-i*this.m_impulse.x)},w.prototype.SolveVelocityConstraints=function(a){var c,b=this.m_bodyB,d=0,e=0;c=b.m_xf.R;var f=this.m_localAnchor.x-b.m_sweep.localCenter.x,g=this.m_localAnchor.y-b.m_sweep.localCenter.y;d=c.col1.x*f+c.col2.x*g,g=c.col1.y*f+c.col2.y*g,f=d;var h=b.m_linearVelocity.x+-b.m_angularVelocity*g,i=b.m_linearVelocity.y+b.m_angularVelocity*f;c=this.m_mass,d=h+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,e=i+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var j=-(c.col1.x*d+c.col2.x*e),k=-(c.col1.y*d+c.col2.y*e),l=this.m_impulse.x,m=this.m_impulse.y;this.m_impulse.x+=j,this.m_impulse.y+=k;var n=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>n*n&&this.m_impulse.Multiply(n/this.m_impulse.Length()),j=this.m_impulse.x-l,k=this.m_impulse.y-m,b.m_linearVelocity.x+=b.m_invMass*j,b.m_linearVelocity.y+=b.m_invMass*k,b.m_angularVelocity+=b.m_invI*(f*k-g*j)},w.prototype.SolvePositionConstraints=function(a){return void 0===a&&(a=0),!0},Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef),x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,x.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new i},x.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=r.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(y,Box2D.Dynamics.Joints.b2Joint),y.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,y.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_localXAxis1=new i,this.m_localYAxis1=new i,this.m_axis=new i,this.m_perp=new i,this.m_K=new e,this.m_impulse=new j},y.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},y.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},y.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new i(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},y.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.y},y.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,d=a.GetWorldPoint(this.m_localAnchor1),e=b.GetWorldPoint(this.m_localAnchor2),f=e.x-d.x,g=e.y-d.y,h=a.GetWorldVector(this.m_localXAxis1),i=h.x*f+h.y*g;return i},y.prototype.GetJointSpeed=function(){var c,a=this.m_bodyA,b=this.m_bodyB;c=a.m_xf.R;var d=this.m_localAnchor1.x-a.m_sweep.localCenter.x,e=this.m_localAnchor1.y-a.m_sweep.localCenter.y,f=c.col1.x*d+c.col2.x*e;e=c.col1.y*d+c.col2.y*e,d=f,c=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,h=this.m_localAnchor2.y-b.m_sweep.localCenter.y;f=c.col1.x*g+c.col2.x*h,h=c.col1.y*g+c.col2.y*h,g=f;var i=a.m_sweep.c.x+d,j=a.m_sweep.c.y+e,k=b.m_sweep.c.x+g,l=b.m_sweep.c.y+h,m=k-i,n=l-j,o=a.GetWorldVector(this.m_localXAxis1),p=a.m_linearVelocity,q=b.m_linearVelocity,r=a.m_angularVelocity,s=b.m_angularVelocity,t=m*(-r*o.y)+n*(r*o.x)+(o.x*(q.x+-s*h-p.x- -r*e)+o.y*(q.y+s*g-p.y-r*d));return t},y.prototype.IsLimitEnabled=function(){return this.m_enableLimit},y.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},y.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},y.prototype.GetUpperLimit=function(){return this.m_upperTranslation},y.prototype.SetLimits=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},y.prototype.IsMotorEnabled=function(){return this.m_enableMotor},y.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},y.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},y.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},y.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},y.prototype.GetMotorForce=function(){return this.m_motorImpulse},y.prototype.b2PrismaticJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=r.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},y.prototype.InitVelocityConstraints=function(a){var e,b=this.m_bodyA,d=this.m_bodyB,g=0;this.m_localCenterA.SetV(b.GetLocalCenter()),this.m_localCenterB.SetV(d.GetLocalCenter());var h=b.GetTransform();d.GetTransform();e=b.m_xf.R;var j=this.m_localAnchor1.x-this.m_localCenterA.x,k=this.m_localAnchor1.y-this.m_localCenterA.y;g=e.col1.x*j+e.col2.x*k,k=e.col1.y*j+e.col2.y*k,j=g,e=d.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,m=this.m_localAnchor2.y-this.m_localCenterB.y;g=e.col1.x*l+e.col2.x*m,m=e.col1.y*l+e.col2.y*m,l=g;var n=d.m_sweep.c.x+l-b.m_sweep.c.x-j,o=d.m_sweep.c.y+m-b.m_sweep.c.y-k;this.m_invMassA=b.m_invMass,this.m_invMassB=d.m_invMass,this.m_invIA=b.m_invI,this.m_invIB=d.m_invI,this.m_axis.SetV(f.MulMV(h.R,this.m_localXAxis1)),this.m_a1=(n+j)*this.m_axis.y-(o+k)*this.m_axis.x,this.m_a2=l*this.m_axis.y-m*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(f.MulMV(h.R,this.m_localYAxis1)),this.m_s1=(n+j)*this.m_perp.y-(o+k)*this.m_perp.x,this.m_s2=l*this.m_perp.y-m*this.m_perp.x;var p=this.m_invMassA,q=this.m_invMassB,s=this.m_invIA,t=this.m_invIB;if(this.m_K.col1.x=p+q+s*this.m_s1*this.m_s1+t*this.m_s2*this.m_s2,this.m_K.col1.y=s*this.m_s1+t*this.m_s2,this.m_K.col1.z=s*this.m_s1*this.m_a1+t*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=s+t,this.m_K.col2.z=s*this.m_a1+t*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=p+q+s*this.m_a1*this.m_a1+t*this.m_a2*this.m_a2,this.m_enableLimit){var u=this.m_axis.x*n+this.m_axis.y*o;f.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*c.b2_linearSlop?this.m_limitState=r.e_equalLimits:u<=this.m_lowerTranslation?this.m_limitState!=r.e_atLowerLimit&&(this.m_limitState=r.e_atLowerLimit,this.m_impulse.z=0):u>=this.m_upperTranslation?this.m_limitState!=r.e_atUpperLimit&&(this.m_limitState=r.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=r.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=r.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,w=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,x=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,y=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;b.m_linearVelocity.x-=this.m_invMassA*v,b.m_linearVelocity.y-=this.m_invMassA*w,b.m_angularVelocity-=this.m_invIA*x,d.m_linearVelocity.x+=this.m_invMassB*v,d.m_linearVelocity.y+=this.m_invMassB*w,d.m_angularVelocity+=this.m_invIB*y}else this.m_impulse.SetZero(),this.m_motorImpulse=0},y.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=b.m_linearVelocity,e=b.m_angularVelocity,g=c.m_linearVelocity,h=c.m_angularVelocity,k=0,l=0,m=0,n=0;if(this.m_enableMotor&&this.m_limitState!=r.e_equalLimits){var o=this.m_axis.x*(g.x-d.x)+this.m_axis.y*(g.y-d.y)+this.m_a2*h-this.m_a1*e,p=this.m_motorMass*(this.m_motorSpeed-o),q=this.m_motorImpulse,s=a.dt*this.m_maxMotorForce;this.m_motorImpulse=f.Clamp(this.m_motorImpulse+p,-s,s),p=this.m_motorImpulse-q,k=p*this.m_axis.x,l=p*this.m_axis.y,m=p*this.m_a1,n=p*this.m_a2,d.x-=this.m_invMassA*k,d.y-=this.m_invMassA*l,e-=this.m_invIA*m,g.x+=this.m_invMassB*k,g.y+=this.m_invMassB*l,h+=this.m_invIB*n}var t=this.m_perp.x*(g.x-d.x)+this.m_perp.y*(g.y-d.y)+this.m_s2*h-this.m_s1*e,u=h-e;if(this.m_enableLimit&&this.m_limitState!=r.e_inactiveLimit){var v=this.m_axis.x*(g.x-d.x)+this.m_axis.y*(g.y-d.y)+this.m_a2*h-this.m_a1*e,w=this.m_impulse.Copy(),x=this.m_K.Solve33(new j,-t,-u,-v);this.m_impulse.Add(x),this.m_limitState==r.e_atLowerLimit?this.m_impulse.z=f.Max(this.m_impulse.z,0):this.m_limitState==r.e_atUpperLimit&&(this.m_impulse.z=f.Min(this.m_impulse.z,0));var y=-t-(this.m_impulse.z-w.z)*this.m_K.col3.x,z=-u-(this.m_impulse.z-w.z)*this.m_K.col3.y,A=this.m_K.Solve22(new i,y,z);A.x+=w.x,A.y+=w.y,this.m_impulse.x=A.x,this.m_impulse.y=A.y,x.x=this.m_impulse.x-w.x,x.y=this.m_impulse.y-w.y,x.z=this.m_impulse.z-w.z,k=x.x*this.m_perp.x+x.z*this.m_axis.x,l=x.x*this.m_perp.y+x.z*this.m_axis.y,m=x.x*this.m_s1+x.y+x.z*this.m_a1,n=x.x*this.m_s2+x.y+x.z*this.m_a2,d.x-=this.m_invMassA*k,d.y-=this.m_invMassA*l,e-=this.m_invIA*m,g.x+=this.m_invMassB*k,g.y+=this.m_invMassB*l,h+=this.m_invIB*n}else{var B=this.m_K.Solve22(new i,-t,-u);this.m_impulse.x+=B.x,this.m_impulse.y+=B.y,k=B.x*this.m_perp.x,l=B.x*this.m_perp.y,m=B.x*this.m_s1+B.y,n=B.x*this.m_s2+B.y,d.x-=this.m_invMassA*k,d.y-=this.m_invMassA*l,e-=this.m_invIA*m,g.x+=this.m_invMassB*k,g.y+=this.m_invMassB*l,h+=this.m_invIB*n}b.m_linearVelocity.SetV(d),b.m_angularVelocity=e,c.m_linearVelocity.SetV(g),c.m_angularVelocity=h},y.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);var o,g=this.m_bodyA,h=this.m_bodyB,k=g.m_sweep.c,l=g.m_sweep.a,m=h.m_sweep.c,n=h.m_sweep.a,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=!1,x=0,y=d.FromAngle(l),z=d.FromAngle(n);o=y;var A=this.m_localAnchor1.x-this.m_localCenterA.x,B=this.m_localAnchor1.y-this.m_localCenterA.y;p=o.col1.x*A+o.col2.x*B,B=o.col1.y*A+o.col2.y*B,A=p,o=z;var C=this.m_localAnchor2.x-this.m_localCenterB.x,D=this.m_localAnchor2.y-this.m_localCenterB.y;p=o.col1.x*C+o.col2.x*D,D=o.col1.y*C+o.col2.y*D,C=p;var E=m.x+C-k.x-A,F=m.y+D-k.y-B;if(this.m_enableLimit){this.m_axis=f.MulMV(y,this.m_localXAxis1),this.m_a1=(E+A)*this.m_axis.y-(F+B)*this.m_axis.x,this.m_a2=C*this.m_axis.y-D*this.m_axis.x;var G=this.m_axis.x*E+this.m_axis.y*F;f.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*c.b2_linearSlop?(x=f.Clamp(G,-c.b2_maxLinearCorrection,c.b2_maxLinearCorrection),u=f.Abs(G),w=!0):G<=this.m_lowerTranslation?(x=f.Clamp(G-this.m_lowerTranslation+c.b2_linearSlop,-c.b2_maxLinearCorrection,0),u=this.m_lowerTranslation-G,w=!0):G>=this.m_upperTranslation&&(x=f.Clamp(G-this.m_upperTranslation+c.b2_linearSlop,0,c.b2_maxLinearCorrection),u=G-this.m_upperTranslation,w=!0)}this.m_perp=f.MulMV(y,this.m_localYAxis1),this.m_s1=(E+A)*this.m_perp.y-(F+B)*this.m_perp.x,this.m_s2=C*this.m_perp.y-D*this.m_perp.x;var H=new j,I=this.m_perp.x*E+this.m_perp.y*F,J=n-l-this.m_refAngle;if(u=f.Max(u,f.Abs(I)),v=f.Abs(J),w)q=this.m_invMassA,r=this.m_invMassB,s=this.m_invIA,t=this.m_invIB,this.m_K.col1.x=q+r+s*this.m_s1*this.m_s1+t*this.m_s2*this.m_s2,this.m_K.col1.y=s*this.m_s1+t*this.m_s2,this.m_K.col1.z=s*this.m_s1*this.m_a1+t*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=s+t,this.m_K.col2.z=s*this.m_a1+t*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=q+r+s*this.m_a1*this.m_a1+t*this.m_a2*this.m_a2,this.m_K.Solve33(H,-I,-J,-x);else{q=this.m_invMassA,r=this.m_invMassB,s=this.m_invIA,t=this.m_invIB;var K=q+r+s*this.m_s1*this.m_s1+t*this.m_s2*this.m_s2,L=s*this.m_s1+t*this.m_s2,M=s+t;this.m_K.col1.Set(K,L,0),this.m_K.col2.Set(L,M,0);var N=this.m_K.Solve22(new i,-I,-J);H.x=N.x,H.y=N.y,H.z=0}var O=H.x*this.m_perp.x+H.z*this.m_axis.x,P=H.x*this.m_perp.y+H.z*this.m_axis.y,Q=H.x*this.m_s1+H.y+H.z*this.m_a1,R=H.x*this.m_s2+H.y+H.z*this.m_a2;return k.x-=this.m_invMassA*O,k.y-=this.m_invMassA*P,l-=this.m_invIA*Q,m.x+=this.m_invMassB*O,m.y+=this.m_invMassB*P,n+=this.m_invIB*R,g.m_sweep.a=l,h.m_sweep.a=n,g.SynchronizeTransform(),h.SynchronizeTransform(),u<=c.b2_linearSlop&&v<=c.b2_angularSlop},Box2D.inherit(z,Box2D.Dynamics.Joints.b2JointDef),z.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,z.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i,this.localAxisA=new i},z.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=r.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},z.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(A,Box2D.Dynamics.Joints.b2Joint),A.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,A.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new i,this.m_groundAnchor2=new i,this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_u1=new i,this.m_u2=new i},A.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},A.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},A.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new i(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)},A.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),0},A.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor1),a},A.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor2),a},A.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,d=a.x-b,e=a.y-c;return Math.sqrt(d*d+e*e)},A.prototype.GetLength2=function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,d=a.x-b,e=a.y-c;return Math.sqrt(d*d+e*e)},A.prototype.GetRatio=function(){return this.m_ratio},A.prototype.b2PulleyJoint=function(a){this.__super.b2Joint.call(this,a);this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_ratio=a.ratio,this.m_constant=a.lengthA+this.m_ratio*a.lengthB,this.m_maxLength1=f.Min(a.maxLengthA,this.m_constant-this.m_ratio*A.b2_minPulleyLength),this.m_maxLength2=f.Min(a.maxLengthB,(this.m_constant-A.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},A.prototype.InitVelocityConstraints=function(a){var e,b=this.m_bodyA,d=this.m_bodyB;e=b.m_xf.R;var f=this.m_localAnchor1.x-b.m_sweep.localCenter.x,g=this.m_localAnchor1.y-b.m_sweep.localCenter.y,h=e.col1.x*f+e.col2.x*g;g=e.col1.y*f+e.col2.y*g,f=h,e=d.m_xf.R;var i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y;h=e.col1.x*i+e.col2.x*j,j=e.col1.y*i+e.col2.y*j,i=h;var k=b.m_sweep.c.x+f,l=b.m_sweep.c.y+g,m=d.m_sweep.c.x+i,n=d.m_sweep.c.y+j,o=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,p=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,q=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,s=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(k-o,l-p),this.m_u2.Set(m-q,n-s);var t=this.m_u1.Length(),u=this.m_u2.Length();t>c.b2_linearSlop?this.m_u1.Multiply(1/t):this.m_u1.SetZero(),u>c.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero();
var v=this.m_constant-t-this.m_ratio*u;v>0?(this.m_state=r.e_inactiveLimit,this.m_impulse=0):this.m_state=r.e_atUpperLimit,t<this.m_maxLength1?(this.m_limitState1=r.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=r.e_atUpperLimit,u<this.m_maxLength2?(this.m_limitState2=r.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=r.e_atUpperLimit;var w=f*this.m_u1.y-g*this.m_u1.x,x=i*this.m_u2.y-j*this.m_u2.x;if(this.m_limitMass1=b.m_invMass+b.m_invI*w*w,this.m_limitMass2=d.m_invMass+d.m_invI*x*x,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,a.warmStarting){this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=a.dtRatio,this.m_limitImpulse2*=a.dtRatio;var y=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,z=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,A=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,B=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;b.m_linearVelocity.x+=b.m_invMass*y,b.m_linearVelocity.y+=b.m_invMass*z,b.m_angularVelocity+=b.m_invI*(f*z-g*y),d.m_linearVelocity.x+=d.m_invMass*A,d.m_linearVelocity.y+=d.m_invMass*B,d.m_angularVelocity+=d.m_invI*(i*B-j*A)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},A.prototype.SolveVelocityConstraints=function(a){var d,b=this.m_bodyA,c=this.m_bodyB;d=b.m_xf.R;var e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,g=this.m_localAnchor1.y-b.m_sweep.localCenter.y,h=d.col1.x*e+d.col2.x*g;g=d.col1.y*e+d.col2.y*g,e=h,d=c.m_xf.R;var i=this.m_localAnchor2.x-c.m_sweep.localCenter.x,j=this.m_localAnchor2.y-c.m_sweep.localCenter.y;h=d.col1.x*i+d.col2.x*j,j=d.col1.y*i+d.col2.y*j,i=h;var k=0,l=0,m=0,n=0,o=0,p=0,q=0,s=0,t=0,u=0,v=0;this.m_state==r.e_atUpperLimit&&(k=b.m_linearVelocity.x+-b.m_angularVelocity*g,l=b.m_linearVelocity.y+b.m_angularVelocity*e,m=c.m_linearVelocity.x+-c.m_angularVelocity*j,n=c.m_linearVelocity.y+c.m_angularVelocity*i,t=-(this.m_u1.x*k+this.m_u1.y*l)-this.m_ratio*(this.m_u2.x*m+this.m_u2.y*n),u=this.m_pulleyMass*-t,v=this.m_impulse,this.m_impulse=f.Max(0,this.m_impulse+u),u=this.m_impulse-v,o=-u*this.m_u1.x,p=-u*this.m_u1.y,q=-this.m_ratio*u*this.m_u2.x,s=-this.m_ratio*u*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*o,b.m_linearVelocity.y+=b.m_invMass*p,b.m_angularVelocity+=b.m_invI*(e*p-g*o),c.m_linearVelocity.x+=c.m_invMass*q,c.m_linearVelocity.y+=c.m_invMass*s,c.m_angularVelocity+=c.m_invI*(i*s-j*q)),this.m_limitState1==r.e_atUpperLimit&&(k=b.m_linearVelocity.x+-b.m_angularVelocity*g,l=b.m_linearVelocity.y+b.m_angularVelocity*e,t=-(this.m_u1.x*k+this.m_u1.y*l),u=-this.m_limitMass1*t,v=this.m_limitImpulse1,this.m_limitImpulse1=f.Max(0,this.m_limitImpulse1+u),u=this.m_limitImpulse1-v,o=-u*this.m_u1.x,p=-u*this.m_u1.y,b.m_linearVelocity.x+=b.m_invMass*o,b.m_linearVelocity.y+=b.m_invMass*p,b.m_angularVelocity+=b.m_invI*(e*p-g*o)),this.m_limitState2==r.e_atUpperLimit&&(m=c.m_linearVelocity.x+-c.m_angularVelocity*j,n=c.m_linearVelocity.y+c.m_angularVelocity*i,t=-(this.m_u2.x*m+this.m_u2.y*n),u=-this.m_limitMass2*t,v=this.m_limitImpulse2,this.m_limitImpulse2=f.Max(0,this.m_limitImpulse2+u),u=this.m_limitImpulse2-v,q=-u*this.m_u2.x,s=-u*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*q,c.m_linearVelocity.y+=c.m_invMass*s,c.m_angularVelocity+=c.m_invI*(i*s-j*q))},A.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);var e,b=this.m_bodyA,d=this.m_bodyB,g=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,i=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,j=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,k=0,l=0,m=0,n=0,o=0,p=0,q=0,s=0,t=0,u=0,v=0,w=0,z=0,A=0;return this.m_state==r.e_atUpperLimit&&(e=b.m_xf.R,k=this.m_localAnchor1.x-b.m_sweep.localCenter.x,l=this.m_localAnchor1.y-b.m_sweep.localCenter.y,z=e.col1.x*k+e.col2.x*l,l=e.col1.y*k+e.col2.y*l,k=z,e=d.m_xf.R,m=this.m_localAnchor2.x-d.m_sweep.localCenter.x,n=this.m_localAnchor2.y-d.m_sweep.localCenter.y,z=e.col1.x*m+e.col2.x*n,n=e.col1.y*m+e.col2.y*n,m=z,o=b.m_sweep.c.x+k,p=b.m_sweep.c.y+l,q=d.m_sweep.c.x+m,s=d.m_sweep.c.y+n,this.m_u1.Set(o-g,p-h),this.m_u2.Set(q-i,s-j),t=this.m_u1.Length(),u=this.m_u2.Length(),t>c.b2_linearSlop?this.m_u1.Multiply(1/t):this.m_u1.SetZero(),u>c.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero(),v=this.m_constant-t-this.m_ratio*u,A=f.Max(A,-v),v=f.Clamp(v+c.b2_linearSlop,-c.b2_maxLinearCorrection,0),w=-this.m_pulleyMass*v,o=-w*this.m_u1.x,p=-w*this.m_u1.y,q=-this.m_ratio*w*this.m_u2.x,s=-this.m_ratio*w*this.m_u2.y,b.m_sweep.c.x+=b.m_invMass*o,b.m_sweep.c.y+=b.m_invMass*p,b.m_sweep.a+=b.m_invI*(k*p-l*o),d.m_sweep.c.x+=d.m_invMass*q,d.m_sweep.c.y+=d.m_invMass*s,d.m_sweep.a+=d.m_invI*(m*s-n*q),b.SynchronizeTransform(),d.SynchronizeTransform()),this.m_limitState1==r.e_atUpperLimit&&(e=b.m_xf.R,k=this.m_localAnchor1.x-b.m_sweep.localCenter.x,l=this.m_localAnchor1.y-b.m_sweep.localCenter.y,z=e.col1.x*k+e.col2.x*l,l=e.col1.y*k+e.col2.y*l,k=z,o=b.m_sweep.c.x+k,p=b.m_sweep.c.y+l,this.m_u1.Set(o-g,p-h),t=this.m_u1.Length(),t>c.b2_linearSlop?(this.m_u1.x*=1/t,this.m_u1.y*=1/t):this.m_u1.SetZero(),v=this.m_maxLength1-t,A=f.Max(A,-v),v=f.Clamp(v+c.b2_linearSlop,-c.b2_maxLinearCorrection,0),w=-this.m_limitMass1*v,o=-w*this.m_u1.x,p=-w*this.m_u1.y,b.m_sweep.c.x+=b.m_invMass*o,b.m_sweep.c.y+=b.m_invMass*p,b.m_sweep.a+=b.m_invI*(k*p-l*o),b.SynchronizeTransform()),this.m_limitState2==r.e_atUpperLimit&&(e=d.m_xf.R,m=this.m_localAnchor2.x-d.m_sweep.localCenter.x,n=this.m_localAnchor2.y-d.m_sweep.localCenter.y,z=e.col1.x*m+e.col2.x*n,n=e.col1.y*m+e.col2.y*n,m=z,q=d.m_sweep.c.x+m,s=d.m_sweep.c.y+n,this.m_u2.Set(q-i,s-j),u=this.m_u2.Length(),u>c.b2_linearSlop?(this.m_u2.x*=1/u,this.m_u2.y*=1/u):this.m_u2.SetZero(),v=this.m_maxLength2-u,A=f.Max(A,-v),v=f.Clamp(v+c.b2_linearSlop,-c.b2_maxLinearCorrection,0),w=-this.m_limitMass2*v,q=-w*this.m_u2.x,s=-w*this.m_u2.y,d.m_sweep.c.x+=d.m_invMass*q,d.m_sweep.c.y+=d.m_invMass*s,d.m_sweep.a+=d.m_invI*(m*s-n*q),d.SynchronizeTransform()),A<c.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),Box2D.inherit(B,Box2D.Dynamics.Joints.b2JointDef),B.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,B.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new i,this.groundAnchorB=new i,this.localAnchorA=new i,this.localAnchorB=new i},B.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=r.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},B.prototype.Initialize=function(a,b,c,d,e,f,g){void 0===g&&(g=0),this.bodyA=a,this.bodyB=b,this.groundAnchorA.SetV(c),this.groundAnchorB.SetV(d),this.localAnchorA=this.bodyA.GetLocalPoint(e),this.localAnchorB=this.bodyB.GetLocalPoint(f);var h=e.x-c.x,i=e.y-c.y;this.lengthA=Math.sqrt(h*h+i*i);var j=f.x-d.x,k=f.y-d.y;this.lengthB=Math.sqrt(j*j+k*k),this.ratio=g;var l=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=l-this.ratio*A.b2_minPulleyLength,this.maxLengthB=(l-A.b2_minPulleyLength)/this.ratio},Box2D.inherit(C,Box2D.Dynamics.Joints.b2Joint),C.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,C.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new d,this.K1=new d,this.K2=new d,this.K3=new d,this.impulse3=new j,this.impulse2=new i,this.reduced=new i,this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_impulse=new j,this.m_mass=new e},C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},C.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new i(a*this.m_impulse.x,a*this.m_impulse.y)},C.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.z},C.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},C.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},C.prototype.IsLimitEnabled=function(){return this.m_enableLimit};C.prototype.EnableLimit=function(a){this.m_enableLimit=a};C.prototype.GetLowerLimit=function(){return this.m_lowerAngle},C.prototype.GetUpperLimit=function(){return this.m_upperAngle},C.prototype.SetLimits=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.m_lowerAngle=a,this.m_upperAngle=b},C.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},C.prototype.EnableMotor=function(a){this.m_enableMotor=a},C.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},C.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},C.prototype.SetMaxMotorTorque=function(a){void 0===a&&(a=0),this.m_maxMotorTorque=a},C.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},C.prototype.b2RevoluteJoint=function(a){this.__super.b2Joint.call(this,a),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=a.lowerAngle,this.m_upperAngle=a.upperAngle,this.m_maxMotorTorque=a.maxMotorTorque,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=r.e_inactiveLimit},C.prototype.InitVelocityConstraints=function(a){var e,b=this.m_bodyA,d=this.m_bodyB,g=0;this.m_enableMotor||this.m_enableLimit,e=b.m_xf.R;var h=this.m_localAnchor1.x-b.m_sweep.localCenter.x,i=this.m_localAnchor1.y-b.m_sweep.localCenter.y;g=e.col1.x*h+e.col2.x*i,i=e.col1.y*h+e.col2.y*i,h=g,e=d.m_xf.R;var j=this.m_localAnchor2.x-d.m_sweep.localCenter.x,k=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=e.col1.x*j+e.col2.x*k,k=e.col1.y*j+e.col2.y*k,j=g;var l=b.m_invMass,m=d.m_invMass,n=b.m_invI,o=d.m_invI;if(this.m_mass.col1.x=l+m+i*i*n+k*k*o,this.m_mass.col2.x=-i*h*n-k*j*o,this.m_mass.col3.x=-i*n-k*o,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=l+m+h*h*n+j*j*o,this.m_mass.col3.y=h*n+j*o,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=n+o,this.m_motorMass=1/(n+o),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var p=d.m_sweep.a-b.m_sweep.a-this.m_referenceAngle;f.Abs(this.m_upperAngle-this.m_lowerAngle)<2*c.b2_angularSlop?this.m_limitState=r.e_equalLimits:p<=this.m_lowerAngle?(this.m_limitState!=r.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=r.e_atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!=r.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=r.e_atUpperLimit):(this.m_limitState=r.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=r.e_inactiveLimit;if(a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var q=this.m_impulse.x,s=this.m_impulse.y;b.m_linearVelocity.x-=l*q,b.m_linearVelocity.y-=l*s,b.m_angularVelocity-=n*(h*s-i*q+this.m_motorImpulse+this.m_impulse.z),d.m_linearVelocity.x+=m*q,d.m_linearVelocity.y+=m*s,d.m_angularVelocity+=o*(j*s-k*q+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},C.prototype.SolveVelocityConstraints=function(a){var d,b=this.m_bodyA,c=this.m_bodyB,e=0,g=0,h=0,i=0,j=0,k=0,l=b.m_linearVelocity,m=b.m_angularVelocity,n=c.m_linearVelocity,o=c.m_angularVelocity,p=b.m_invMass,q=c.m_invMass,s=b.m_invI,t=c.m_invI;if(this.m_enableMotor&&this.m_limitState!=r.e_equalLimits){var u=o-m-this.m_motorSpeed,v=this.m_motorMass*-u,w=this.m_motorImpulse,x=a.dt*this.m_maxMotorTorque;this.m_motorImpulse=f.Clamp(this.m_motorImpulse+v,-x,x),v=this.m_motorImpulse-w,m-=s*v,o+=t*v}if(this.m_enableLimit&&this.m_limitState!=r.e_inactiveLimit){d=b.m_xf.R,h=this.m_localAnchor1.x-b.m_sweep.localCenter.x,i=this.m_localAnchor1.y-b.m_sweep.localCenter.y,e=d.col1.x*h+d.col2.x*i,i=d.col1.y*h+d.col2.y*i,h=e,d=c.m_xf.R,j=this.m_localAnchor2.x-c.m_sweep.localCenter.x,k=this.m_localAnchor2.y-c.m_sweep.localCenter.y,e=d.col1.x*j+d.col2.x*k,k=d.col1.y*j+d.col2.y*k,j=e;var y=n.x+-o*k-l.x- -m*i,z=n.y+o*j-l.y-m*h,A=o-m;this.m_mass.Solve33(this.impulse3,-y,-z,-A),this.m_limitState==r.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==r.e_atLowerLimit?(g=this.m_impulse.z+this.impulse3.z,g<0&&(this.m_mass.Solve22(this.reduced,-y,-z),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==r.e_atUpperLimit&&(g=this.m_impulse.z+this.impulse3.z,g>0&&(this.m_mass.Solve22(this.reduced,-y,-z),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),l.x-=p*this.impulse3.x,l.y-=p*this.impulse3.y,m-=s*(h*this.impulse3.y-i*this.impulse3.x+this.impulse3.z),n.x+=q*this.impulse3.x,n.y+=q*this.impulse3.y,o+=t*(j*this.impulse3.y-k*this.impulse3.x+this.impulse3.z)}else{d=b.m_xf.R,h=this.m_localAnchor1.x-b.m_sweep.localCenter.x,i=this.m_localAnchor1.y-b.m_sweep.localCenter.y,e=d.col1.x*h+d.col2.x*i,i=d.col1.y*h+d.col2.y*i,h=e,d=c.m_xf.R,j=this.m_localAnchor2.x-c.m_sweep.localCenter.x,k=this.m_localAnchor2.y-c.m_sweep.localCenter.y,e=d.col1.x*j+d.col2.x*k,k=d.col1.y*j+d.col2.y*k,j=e;var B=n.x+-o*k-l.x- -m*i,C=n.y+o*j-l.y-m*h;this.m_mass.Solve22(this.impulse2,-B,-C),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,l.x-=p*this.impulse2.x,l.y-=p*this.impulse2.y,m-=s*(h*this.impulse2.y-i*this.impulse2.x),n.x+=q*this.impulse2.x,n.y+=q*this.impulse2.y,o+=t*(j*this.impulse2.y-k*this.impulse2.x)}b.m_linearVelocity.SetV(l),b.m_angularVelocity=m,c.m_linearVelocity.SetV(n),c.m_angularVelocity=o},C.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);var e,d=0,g=this.m_bodyA,h=this.m_bodyB,i=0,j=0,k=0,l=0,m=0;if(this.m_enableLimit&&this.m_limitState!=r.e_inactiveLimit){var n=h.m_sweep.a-g.m_sweep.a-this.m_referenceAngle,o=0;this.m_limitState==r.e_equalLimits?(d=f.Clamp(n-this.m_lowerAngle,-c.b2_maxAngularCorrection,c.b2_maxAngularCorrection),o=-this.m_motorMass*d,i=f.Abs(d)):this.m_limitState==r.e_atLowerLimit?(d=n-this.m_lowerAngle,i=-d,d=f.Clamp(d+c.b2_angularSlop,-c.b2_maxAngularCorrection,0),o=-this.m_motorMass*d):this.m_limitState==r.e_atUpperLimit&&(d=n-this.m_upperAngle,i=d,d=f.Clamp(d-c.b2_angularSlop,0,c.b2_maxAngularCorrection),o=-this.m_motorMass*d),g.m_sweep.a-=g.m_invI*o,h.m_sweep.a+=h.m_invI*o,g.SynchronizeTransform(),h.SynchronizeTransform()}e=g.m_xf.R;var p=this.m_localAnchor1.x-g.m_sweep.localCenter.x,q=this.m_localAnchor1.y-g.m_sweep.localCenter.y;k=e.col1.x*p+e.col2.x*q,q=e.col1.y*p+e.col2.y*q,p=k,e=h.m_xf.R;var s=this.m_localAnchor2.x-h.m_sweep.localCenter.x,t=this.m_localAnchor2.y-h.m_sweep.localCenter.y;k=e.col1.x*s+e.col2.x*t,t=e.col1.y*s+e.col2.y*t,s=k;var u=h.m_sweep.c.x+s-g.m_sweep.c.x-p,v=h.m_sweep.c.y+t-g.m_sweep.c.y-q,w=u*u+v*v,x=Math.sqrt(w);j=x;var y=g.m_invMass,z=h.m_invMass,A=g.m_invI,B=h.m_invI,D=10*c.b2_linearSlop;if(w>D*D){var G=y+z,H=1/G;l=H*-u,m=H*-v;var I=.5;g.m_sweep.c.x-=I*y*l,g.m_sweep.c.y-=I*y*m,h.m_sweep.c.x+=I*z*l,h.m_sweep.c.y+=I*z*m,u=h.m_sweep.c.x+s-g.m_sweep.c.x-p,v=h.m_sweep.c.y+t-g.m_sweep.c.y-q}return this.K1.col1.x=y+z,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=y+z,this.K2.col1.x=A*q*q,this.K2.col2.x=-A*p*q,this.K2.col1.y=-A*p*q,this.K2.col2.y=A*p*p,this.K3.col1.x=B*t*t,this.K3.col2.x=-B*s*t,this.K3.col1.y=-B*s*t,this.K3.col2.y=B*s*s,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(C.tImpulse,-u,-v),l=C.tImpulse.x,m=C.tImpulse.y,g.m_sweep.c.x-=g.m_invMass*l,g.m_sweep.c.y-=g.m_invMass*m,g.m_sweep.a-=g.m_invI*(p*m-q*l),h.m_sweep.c.x+=h.m_invMass*l,h.m_sweep.c.y+=h.m_invMass*m,h.m_sweep.a+=h.m_invI*(s*m-t*l),g.SynchronizeTransform(),h.SynchronizeTransform(),j<=c.b2_linearSlop&&i<=c.b2_angularSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new i}),Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef),D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,D.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},D.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=r.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},D.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(E,Box2D.Dynamics.Joints.b2Joint),E.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,E.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new i,this.m_localAnchorB=new i,this.m_impulse=new j,this.m_mass=new e},E.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},E.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},E.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new i(a*this.m_impulse.x,a*this.m_impulse.y)},E.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.z},E.prototype.b2WeldJoint=function(a){this.__super.b2Joint.call(this,a),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new e},E.prototype.InitVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m,a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,d.m_linearVelocity.x-=j*this.m_impulse.x,d.m_linearVelocity.y-=j*this.m_impulse.y,d.m_angularVelocity-=l*(f*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z),e.m_linearVelocity.x+=k*this.m_impulse.x,e.m_linearVelocity.y+=k*this.m_impulse.y,e.m_angularVelocity+=m*(h*this.m_impulse.y-i*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},E.prototype.SolveVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB,f=d.m_linearVelocity,g=d.m_angularVelocity,h=e.m_linearVelocity,i=e.m_angularVelocity,k=d.m_invMass,l=e.m_invMass,m=d.m_invI,n=e.m_invI;b=d.m_xf.R;var o=this.m_localAnchorA.x-d.m_sweep.localCenter.x,p=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*o+b.col2.x*p,p=b.col1.y*o+b.col2.y*p,o=c,b=e.m_xf.R;var q=this.m_localAnchorB.x-e.m_sweep.localCenter.x,r=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*q+b.col2.x*r,r=b.col1.y*q+b.col2.y*r,q=c;var s=h.x-i*r-f.x+g*p,t=h.y+i*q-f.y-g*o,u=i-g,v=new j;this.m_mass.Solve33(v,-s,-t,-u),this.m_impulse.Add(v),f.x-=k*v.x,f.y-=k*v.y,g-=m*(o*v.y-p*v.x+v.z),h.x+=l*v.x,h.y+=l*v.y,i+=n*(q*v.y-r*v.x+v.z),d.m_angularVelocity=g,e.m_angularVelocity=i},E.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);var b,d=0,e=this.m_bodyA,g=this.m_bodyB;b=e.m_xf.R;var h=this.m_localAnchorA.x-e.m_sweep.localCenter.x,i=this.m_localAnchorA.y-e.m_sweep.localCenter.y;d=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=d,b=g.m_xf.R;var k=this.m_localAnchorB.x-g.m_sweep.localCenter.x,l=this.m_localAnchorB.y-g.m_sweep.localCenter.y;d=b.col1.x*k+b.col2.x*l,l=b.col1.y*k+b.col2.y*l,k=d;var m=e.m_invMass,n=g.m_invMass,o=e.m_invI,p=g.m_invI,q=g.m_sweep.c.x+k-e.m_sweep.c.x-h,r=g.m_sweep.c.y+l-e.m_sweep.c.y-i,s=g.m_sweep.a-e.m_sweep.a-this.m_referenceAngle,t=10*c.b2_linearSlop,u=Math.sqrt(q*q+r*r),v=f.Abs(s);u>t&&(o*=1,p*=1),this.m_mass.col1.x=m+n+i*i*o+l*l*p,this.m_mass.col2.x=-i*h*o-l*k*p,this.m_mass.col3.x=-i*o-l*p,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=m+n+h*h*o+k*k*p,this.m_mass.col3.y=h*o+k*p,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=o+p;var w=new j;return this.m_mass.Solve33(w,-q,-r,-s),e.m_sweep.c.x-=m*w.x,e.m_sweep.c.y-=m*w.y,e.m_sweep.a-=o*(h*w.y-i*w.x+w.z),g.m_sweep.c.x+=n*w.x,g.m_sweep.c.y+=n*w.y,g.m_sweep.a+=p*(k*w.y-l*w.x+w.z),e.SynchronizeTransform(),g.SynchronizeTransform(),u<=c.b2_linearSlop&&v<=c.b2_angularSlop},Box2D.inherit(F,Box2D.Dynamics.Joints.b2JointDef),F.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,F.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},F.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=r.e_weldJoint,this.referenceAngle=0},F.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var a=Box2D.Dynamics.b2DebugDraw;a.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var a=this;this.m_sprite={graphics:{clear:function(){a.m_ctx.clearRect(0,0,a.m_ctx.canvas.width,a.m_ctx.canvas.height)}}}},a.prototype._color=function(a,b){return"rgba("+((16711680&a)>>16)+","+((65280&a)>>8)+","+(255&a)+","+b+")"},a.prototype.b2DebugDraw=function(){this.m_drawFlags=0},a.prototype.SetFlags=function(a){void 0===a&&(a=0),this.m_drawFlags=a},a.prototype.GetFlags=function(){return this.m_drawFlags},a.prototype.AppendFlags=function(a){void 0===a&&(a=0),this.m_drawFlags|=a},a.prototype.ClearFlags=function(a){void 0===a&&(a=0),this.m_drawFlags&=~a},a.prototype.SetSprite=function(a){this.m_ctx=a},a.prototype.GetSprite=function(){return this.m_ctx},a.prototype.SetDrawScale=function(a){void 0===a&&(a=0),this.m_drawScale=a},a.prototype.GetDrawScale=function(){return this.m_drawScale},a.prototype.SetLineThickness=function(a){void 0===a&&(a=0),this.m_lineThickness=a,this.m_ctx.strokeWidth=a},a.prototype.GetLineThickness=function(){return this.m_lineThickness},a.prototype.SetAlpha=function(a){void 0===a&&(a=0),this.m_alpha=a},a.prototype.GetAlpha=function(){return this.m_alpha},a.prototype.SetFillAlpha=function(a){void 0===a&&(a=0),this.m_fillAlpha=a},a.prototype.GetFillAlpha=function(){return this.m_fillAlpha},a.prototype.SetXFormScale=function(a){void 0===a&&(a=0),this.m_xformScale=a},a.prototype.GetXFormScale=function(){return this.m_xformScale},a.prototype.DrawPolygon=function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(c.color,this.m_alpha),d.moveTo(a[0].x*e,a[0].y*e);for(var f=1;f<b;f++)d.lineTo(a[f].x*e,a[f].y*e);d.lineTo(a[0].x*e,a[0].y*e),d.closePath(),d.stroke()}},a.prototype.DrawSolidPolygon=function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(c.color,this.m_alpha),d.fillStyle=this._color(c.color,this.m_fillAlpha),d.moveTo(a[0].x*e,a[0].y*e);for(var f=1;f<b;f++)d.lineTo(a[f].x*e,a[f].y*e);d.lineTo(a[0].x*e,a[0].y*e),d.closePath(),d.fill(),d.stroke()}},a.prototype.DrawCircle=function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(c.color,this.m_alpha),d.arc(a.x*e,a.y*e,b*e,0,2*Math.PI,!0),d.closePath(),d.stroke()}},a.prototype.DrawSolidCircle=function(a,b,c,d){if(b){var e=this.m_ctx,f=this.m_drawScale,g=a.x*f,h=a.y*f;e.moveTo(0,0),e.beginPath(),e.strokeStyle=this._color(d.color,this.m_alpha),e.fillStyle=this._color(d.color,this.m_fillAlpha),e.arc(g,h,b*f,0,2*Math.PI,!0),e.moveTo(g,h),e.lineTo((a.x+c.x*b)*f,(a.y+c.y*b)*f),e.closePath(),e.fill(),e.stroke()}},a.prototype.DrawSegment=function(a,b,c){var d=this.m_ctx,e=this.m_drawScale;d.strokeStyle=this._color(c.color,this.m_alpha),d.beginPath(),d.moveTo(a.x*e,a.y*e),d.lineTo(b.x*e,b.y*e),d.closePath(),d.stroke()},a.prototype.DrawTransform=function(a){var b=this.m_ctx,c=this.m_drawScale;b.beginPath(),b.strokeStyle=this._color(16711680,this.m_alpha),b.moveTo(a.position.x*c,a.position.y*c),b.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*c,(a.position.y+this.m_xformScale*a.R.col1.y)*c),b.strokeStyle=this._color(65280,this.m_alpha),b.moveTo(a.position.x*c,a.position.y*c),b.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*c,(a.position.y+this.m_xformScale*a.R.col2.y)*c),b.closePath(),b.stroke()}}();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;