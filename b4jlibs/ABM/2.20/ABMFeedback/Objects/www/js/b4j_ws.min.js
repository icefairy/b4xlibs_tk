function hasClass(a,b){return a.classList?a.classList.contains(b):!!a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function addClass(a,b){a.classList?a.classList.add(b):hasClass(a,b)||(a.className+=" "+b)}function removeClass(a,b){if(a.classList)a.classList.remove(b);else if(hasClass(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}}function KeepAlive(){var a=new XMLHttpRequest,b=Math.round(1e6*Math.random());a.open("HEAD","donotdelete.conn?rand="+b,!0),a.onload=function(b){if(4===a.readyState&&a.status>=200&&a.status<304)try{1!==b4j_ws.readyState}catch(a){}},a.onerror=function(a){},a.send(null)}function b4j_sendData(a){b4j_ws.send(JSON.stringify({type:"data",data:a}))}function b4j_raiseEvent(a,b){var c=document.getElementById("pageconnectedindicator");try{if(1!==b4j_ws.readyState){if(b4j_closeMessage===!1&&("undefined"==typeof RobustWebSocket?window.console.error("Server is currently not available."):window.console.error("Connection is closed. Trying to reconnect."),b4j_closeMessage=!0),null===c){var d=Math.round(1e6*Math.random());RunToastNoConnection(d)}}else b4j_closeMessage=!1,b4j_ws.send(JSON.stringify({type:"event",event:a,params:b}))}catch(a){if(window.console.error(a),null===c){var d=Math.round(1e6*Math.random());RunToastNoConnection(d)}}}function b4j_addEvent(a,b,c,d){var e=$(a);e.length>0&&e.on(b,function(b){d&&(b.preventDefault(),b.stopPropagation()),b.target.id?b4j_raiseEvent(c,{which:b.which,target:b.target.id,pageX:b.pageX,pageY:b.pageY,metaKey:b.metaKey}):b4j_raiseEvent(c,{which:b.which,target:a,pageX:b.pageX,pageY:b.pageY,metaKey:b.metaKey})})}function b4j_addAutomaticEvents(a){$.each(a,function(a,b){b4j_addEvent("#"+b.id,b.event,b.id+"_"+b.event,!0)})}function b4j_runFunction(a,b){return window[a].apply(null,b)}function b4j_eval(a,b){var c=new Function(b);return c.apply(null,a)}function b4j_connect(a){if("undefined"==typeof WebSocket)return void window.alert("WebSockets are not supported by your browser.");var c,b=window.location;c=0!=b.port?("https:"===b.protocol?"wss://":"ws://")+b.hostname+":"+b.port+a+b.search:("https:"===b.protocol?"wss://":"ws://")+b.hostname+a+b.search,"undefined"==typeof RobustWebSocket?(console.log("Using normal WebSocket"),WebSocketType="normal",b4j_ws=new WebSocket(c)):(console.log("Using RobustWebSocket"),WebSocketType="robust",b4j_ws=new RobustWebSocket(c)),b4j_ws.addEventListener("message",function(a){var b=JSON.parse(a.data);"runmethod"===b.etype?$(b.id)[b.method].apply($(b.id),b.params):"runmethodWithResult"===b.etype?b4j_sendData($(b.id)[b.method].apply($(b.id),b.params)):"setAutomaticEvents"===b.etype?b4j_addAutomaticEvents(b.data):"runFunction"===b.etype?b4j_runFunction(b.prop,b.value):"runFunctionWithResult"===b.etype?b4j_sendData(b4j_runFunction(b.prop,b.value)):"eval"===b.etype?b4j_eval(b.value,b.prop):"evalWithResult"===b.etype?b4j_sendData(b4j_eval(b.value,b.prop)):"alert"===b.etype&&window.alert(b.prop)}),b4j_ws.addEventListener("open",function(a){console.log("WebSocket opened"),reconnectTimeout&&clearInterval(reconnectTimeout);var b=document.body,c=document.getElementById("isloaderwrapper");if(c&&!hasClass(c,"isloading")&&!hasClass(b,"loaded")){addClass(b,"loaded");var d=document.getElementById("loader-wrapper");d&&d.parentElement.removeChild(d)}var e=document.getElementById("pageconnectedindicator");e&&(removeClass(e,"indicatorinactive"),addClass(e,"indicatoractive"))}),b4j_ws.addEventListener("close",function(a){console.log("closed - navigator.onLine:"+navigator.onLine),reconnectTimeout&&clearInterval(reconnectTimeout);var b=document.getElementById("pageconnectedindicator");b&&(removeClass(b,"indicatoractive"),addClass(b,"indicatorinactive")),navigator.onLine||(reconnectTimeout=setInterval(function(){navigator.onLine&&(clearInterval(reconnectTimeout),"robust"==WebSocketType&&b4j_ws.startReconnect(a))},1e3))});var d=isOnIOS?"pagehide":"beforeunload";window.addEventListener(d,function(a){b4j_raiseEvent("page_parseevent",{eventname:"beforeunload",eventparams:""})})}var hasEvents=!1;"function"!=typeof Object.assign&&!function(){Object.assign=function(a){"use strict";if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)d.hasOwnProperty(e)&&(b[e]=d[e])}return b}}(),function(a){function b(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c;return"undefined"!=typeof document?(c=document.createEvent("CustomEvent"),c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail)):c={type:a,detail:b.detail,bubbles:!1,cancelable:!1,preventDefault:function(){},stopPropagation:function(){}},c}"function"!=typeof a.CustomEvent&&(a.Event&&(b.prototype=a.Event.prototype),a.CustomEvent=b)}(this),function(a,b){"function"==typeof define&&define.amd?define(function(){return a(b,navigator)}):"object"==typeof exports&&"object"==typeof module?module.exports=a(b,navigator):b.RobustWebSocket=a(b,"undefined"!=typeof Mocha?Mocha:navigator)}(function(a,b){var c=function(d,e,f){function p(){n&&(n=null,clearTimeout(n))}function t(){s&&(a.removeEventListener("online",q),a.removeEventListener("offline",r),s=!1,hasEvents=!1)}function u(){s||(a.addEventListener("online",q),a.addEventListener("offline",r),s=!0,hasEvents=!0)}function v(a){if(1e3===a.code||m){console.log("Stop reconnecting: "+a.code+","+m),j=0;var c=document.getElementById("pageconnectedindicator");if(null===c){var d=Math.round(1e6*Math.random());RunToastNoConnection(d)}}else{if(b.onLine===!1)return void(l=!0);var e=o.shouldReconnect(a,i);"number"==typeof e&&(n=setTimeout(w,e))}}function w(){n=null,g=new WebSocket(d),j++,i.dispatchEvent(Object.assign(new CustomEvent("connecting"),{attempts:j,reconnects:k})),h=setTimeout(function(){h=null,t(),i.dispatchEvent(Object.assign(new CustomEvent("timeout"),{attempts:j,reconnects:k}))},o.timeout),["open","close","message","error"].forEach(function(a){g.addEventListener(a,function(b){i.dispatchEvent(b);var c=i["on"+a];if("function"==typeof c)return c.apply(i,arguments)})}),u()}var h,n,g={close:function(){}},i=this,j=0,k=-1,l=!1,m=!1,o=Object.assign({},c.defaultOptions,"function"==typeof f?{shouldReconnect:f}:f);if("number"!=typeof o.timeout)throw new Error("timeout must be the number of milliseconds to timeout a connection attempt");if("function"!=typeof o.shouldReconnect)throw new Error("shouldReconnect must be a function that returns the number of milliseconds to wait for a reconnect attempt, or null or undefined to not reconnect.");["bufferedAmount","url","readyState","protocol","extensions"].forEach(function(a){Object.defineProperty(i,a,{get:function(){return g[a]}})});var q=function(a){l&&(p(),v(a))},r=function(){l=!0,g.close(1e3)},s=!1;i.send=function(){return g.send.apply(g,arguments)},i.close=function(a,b){return"number"!=typeof a&&(b=a,a=1e3),p(),l=!1,m=!0,t(),g.close(a,b)},i.open=function(){g.readyState!==WebSocket.OPEN&&g.readyState!==WebSocket.CONNECTING&&(p(),l=!1,m=!1,w())},i.startReconnect=function(a){l&&(p(),v(a))},Object.defineProperty(i,"listeners",{value:{open:[function(a){h&&(clearTimeout(h),h=null),a.reconnects=++k,a.attempts=j,j=0,l=!1}],close:[v]}}),Object.defineProperty(i,"attempts",{get:function(){return j},enumerable:!0}),Object.defineProperty(i,"reconnects",{get:function(){return k},enumerable:!0}),o.automaticOpen&&w()};return c.defaultOptions={timeout:1e3,shouldReconnect:function(a,b){if("online"===a.type)return 0;if(1008!==a.code&&1011!==a.code)return 1e3},automaticOpen:!0},c.prototype.addEventListener=function(a,b){a in this.listeners||(this.listeners[a]=[]),this.listeners[a].push(b)},c.prototype.removeEventListener=function(a,b){if(a in this.listeners)for(var c=this.listeners[a],d=0,e=c.length;d<e;d++)if(c[d]===b)return void c.splice(d,1)},c.prototype.dispatchEvent=function(a){if(a.type in this.listeners){a.currentTarget=this;for(var b=this.listeners[a.type],c=0,d=b.length;c<d;c++)b[c].call(this,a)}},c},this);var b4j_ws,b4j_closeMessage=!1,isOnIOS=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),WebSocketType,mySessionId="",reconnectTimeout;